{
    "body": "### Steps to reproduce\n\nSummary:\r\nCannot concretize (some?) environments in (certain?) Spack installations:\r\n```\r\n $ spack --verbose concretize --force\r\n==> Starting concretization pool with 4 processes\r\n==> Error: errors occurred during concretization of the environment:\r\n```\r\n\r\nHow to reproduce:\r\nGood question! I have one `spack` installation where this seems to occur. If I duplicate the environment in a different `spack` installation I do not see the problem. See example `curl` environment below. If I try to concretizer, I get the error above. \r\n\r\nHow to (mostly) work around:\r\nThe behavior is not obviously consistent, but I seem to be able to fix this (concretize successfully) by either:\r\n1. Modifying the compiler, `flags`, `flag`, `flags` by 1) removing the `-we147` flag AND restricting to only one entry, eg `cflags: -O2`.\r\n2. building the environment in a different Spack. I presume a fresh, new installation would do the trick, but `git reset --hard; git pull` does not.\r\n3. Switch from `clingo` to `original` concretizer.\r\n\r\n\r\nEnvironment `spack.yaml`:\r\n```\r\nspack:\r\n  # add package specs to the `specs` list\r\n  specs: [curl, autoconf, libtool, automake]\r\n  view: true\r\n  packages:\r\n    curl:\r\n      version: [7.80.0]\r\n    all:\r\n      compiler: [intel@2021.4.0]\r\n  config:\r\n    install_missing_compilers: true\r\n    checksum: true\r\n    deprecated: false\r\n    dirty: false\r\n    ccache: false\r\n    concretizer: clingo\r\n    shared_linking: rpath\r\n    build_stage:\r\n    - /scratch/${user}/spack_stage\r\n    - $tempdir/${user}/spack-stage\r\n    - ~/.spack/stage\r\n#\r\n  compilers:\r\n  - compiler:\r\n      spec: gcc@4.8.5\r\n      paths:\r\n        cc: /usr/bin/gcc\r\n        cxx: /usr/bin/g++\r\n        f77: /usr/bin/gfortran\r\n        fc: /usr/bin/gfortran\r\n      flags:\r\n        cflags: -mrdrnd\r\n      operating_system: centos7\r\n      target: x86_64\r\n      modules: []\r\n      environment: {}\r\n      extra_rpaths: []\r\n  - compiler:\r\n      spec: intel@19.0.0.117\r\n      paths:\r\n        cc: /share/software/user/restricted/icc/2019/bin/icc\r\n        cxx: /share/software/user/restricted/icc/2019/bin/icpc\r\n        f77: /share/software/user/restricted/ifort/2019/bin/ifort\r\n        fc: /share/software/user/restricted/ifort/2019/bin/ifort\r\n      flags:\r\n        cflags: -O2\r\n        cxxflags: -O2\r\n        fflags: -O2 -fallow-argument-mismatch\r\n      operating_system: centos7\r\n      target: x86_64\r\n      modules: [devel, icc/2019, ifort/2019]\r\n      environment: {}\r\n      extra_rpaths: []\r\n  - compiler:\r\n      spec: gcc@11.2.0\r\n      paths:\r\n        cc: /home/groups/s-ees/share/cees/spack_compilers/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/gcc-11.2.0-pjl2s6u6mujagujmbvb2chncwdrgeec6/bin/gcc\r\n        cxx: /home/groups/s-ees/share/cees/spack_compilers/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/gcc-11.2.0-pjl2s6u6mujagujmbvb2chncwdrgeec6/bin/g++\r\n        f77: /home/groups/s-ees/share/cees/spack_compilers/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/gcc-11.2.0-pjl2s6u6mujagujmbvb2chncwdrgeec6/bin/gfortran\r\n        fc: /home/groups/s-ees/share/cees/spack_compilers/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/gcc-11.2.0-pjl2s6u6mujagujmbvb2chncwdrgeec6/bin/gfortran\r\n      flags:\r\n        cflags: -O2 -mrdrnd\r\n        cxxflags: -O2\r\n        fflags: -O2 -fallow-argument-mismatch\r\n      operating_system: centos7\r\n      target: x86_64\r\n      modules: []\r\n      environment: {}\r\n      extra_rpaths: []\r\n  - compiler:\r\n      spec: intel@2021.4.0\r\n      paths:\r\n        cc: /home/groups/s-ees/share/cees/spack_cees/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/intel-oneapi-compilers-2021.4.0-2xfl6e7kdhxegq5msukpqoxdmftsu2w6/compiler/2021.4.0/linux/bin/intel64/icc\r\n        cxx: /home/groups/s-ees/share/cees/spack_cees/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/intel-oneapi-compilers-2021.4.0-2xfl6e7kdhxegq5msukpqoxdmftsu2w6/compiler/2021.4.0/linux/bin/intel64/icpc\r\n        f77: /home/groups/s-ees/share/cees/spack_cees/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/intel-oneapi-compilers-2021.4.0-2xfl6e7kdhxegq5msukpqoxdmftsu2w6/compiler/2021.4.0/linux/bin/intel64/ifort\r\n        fc: /home/groups/s-ees/share/cees/spack_cees/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/intel-oneapi-compilers-2021.4.0-2xfl6e7kdhxegq5msukpqoxdmftsu2w6/compiler/2021.4.0/linux/bin/intel64/ifort\r\n      flags:\r\n        cflags: -O2 -we147\r\n        cxxflags: -O2 -we147\r\n        fflags: -O2 -fallow-argument-mismatch\r\n      operating_system: centos7\r\n      target: x86_64\r\n      modules: [gcc/9.]\r\n      environment: {}\r\n      extra_rpaths: []\r\n  - compiler:\r\n      spec: oneapi@2021.4.0\r\n      paths:\r\n        cc: /home/groups/s-ees/share/cees/spack_cees/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/intel-oneapi-compilers-2021.4.0-2xfl6e7kdhxegq5msukpqoxdmftsu2w6/compiler/2021.4.0/linux/bin/icx\r\n        cxx: /home/groups/s-ees/share/cees/spack_cees/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/intel-oneapi-compilers-2021.4.0-2xfl6e7kdhxegq5msukpqoxdmftsu2w6/compiler/2021.4.0/linux/bin/icpx\r\n        f77: /home/groups/s-ees/share/cees/spack_cees/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/intel-oneapi-compilers-2021.4.0-2xfl6e7kdhxegq5msukpqoxdmftsu2w6/compiler/2021.4.0/linux/bin/ifx\r\n        fc: /home/groups/s-ees/share/cees/spack_cees/spack/opt/spack/linux-centos7-x86_64_v3/gcc-4.8.5/intel-oneapi-compilers-2021.4.0-2xfl6e7kdhxegq5msukpqoxdmftsu2w6/compiler/2021.4.0/linux/bin/ifx\r\n      flags:\r\n        cflags: -O2\r\n        cxxflags: -O2\r\n        fflags: -O2 -fallow-argument-mismatch\r\n      operating_system: centos7\r\n      target: x86_64\r\n      modules: [gcc/9.]\r\n      environment: {}\r\n      extra_rpaths: []\r\n\r\n```\r\n\n\n### Error message\n\n```\r\n $ spack --verbose concretize --force\r\n==> Starting concretization pool with 4 processes\r\n==> Error: errors occurred during concretization of the environment:\r\n```\r\n\r\nLooking at debug:\r\n`spack --debug concretize --force`\r\nIn this case, it appears to hang up on the `ncurses` package, and is possibly related to switching concretizers?\r\n```\r\n==> [2021-12-06-18:02:06.554133] build(ncurses)\r\nTraceback (most recent call last):\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/bin/spack\", line 98, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/main.py\", line 882, in main\r\n    return _main(argv)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/main.py\", line 865, in _main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/main.py\", line 535, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/cmd/concretize.py\", line 39, in concretize\r\n    concretized_specs = env.concretize(\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/environment/environment.py\", line 1118, in concretize\r\n    return self._concretize_separately(tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/environment/environment.py\", line 1225, in _concretize_separately\r\n    concretized_root_specs = spack.util.parallel.parallel_map(\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/util/parallel.py\", line 135, in parallel_map\r\n    raise_if_errors(*results, debug=debug)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/util/parallel.py\", line 83, in raise_if_errors\r\n    raise RuntimeError(error_fmt.format(msg))\r\nRuntimeError: [PID=6131] Traceback (most recent call last):\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/util/parallel.py\", line 53, in __call__\r\n    value = self.func(*args, **kwargs)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/environment/environment.py\", line 2055, in _concretize_task\r\n    return _concretize_from_constraints(spec_constraints, tests, reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/environment/environment.py\", line 2033, in _concretize_from_constraints\r\n    return s.concretized(tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2683, in concretized\r\n    clone.concretize(tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2639, in concretize\r\n    self._new_concretize(tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2610, in _new_concretize\r\n    result = spack.solver.asp.solve([self], tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 2024, in solve\r\n    return driver.solve(\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 592, in solve\r\n    answers = builder.build_specs(tuples)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 1958, in build_specs\r\n    self.reorder_flags()\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 1875, in reorder_flags\r\n    check_same_flags(spec.compiler_flags, compiler_flags)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 262, in check_same_flags\r\n    assert values1 == values2\r\nAssertionError\r\n\r\n[PID=6132] Traceback (most recent call last):\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/util/parallel.py\", line 53, in __call__\r\n    value = self.func(*args, **kwargs)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/environment/environment.py\", line 2055, in _concretize_task\r\n    return _concretize_from_constraints(spec_constraints, tests, reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/environment/environment.py\", line 2033, in _concretize_from_constraints\r\n    return s.concretized(tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2683, in concretized\r\n    clone.concretize(tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2639, in concretize\r\n    self._new_concretize(tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2610, in _new_concretize\r\n    result = spack.solver.asp.solve([self], tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 2024, in solve\r\n    return driver.solve(\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 592, in solve\r\n    answers = builder.build_specs(tuples)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 1958, in build_specs\r\n    self.reorder_flags()\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 1875, in reorder_flags\r\n    check_same_flags(spec.compiler_flags, compiler_flags)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 262, in check_same_flags\r\n    assert values1 == values2\r\nAssertionError\r\n\r\n[PID=6133] Traceback (most recent call last):\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/util/parallel.py\", line 53, in __call__\r\n    value = self.func(*args, **kwargs)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/environment/environment.py\", line 2055, in _concretize_task\r\n    return _concretize_from_constraints(spec_constraints, tests, reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/environment/environment.py\", line 2033, in _concretize_from_constraints\r\n    return s.concretized(tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2683, in concretized\r\n    clone.concretize(tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2639, in concretize\r\n    self._new_concretize(tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2610, in _new_concretize\r\n    result = spack.solver.asp.solve([self], tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 2024, in solve\r\n    return driver.solve(\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 592, in solve\r\n    answers = builder.build_specs(tuples)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 1958, in build_specs\r\n    self.reorder_flags()\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 1875, in reorder_flags\r\n    check_same_flags(spec.compiler_flags, compiler_flags)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 262, in check_same_flags\r\n    assert values1 == values2\r\nAssertionError\r\n\r\n[PID=6134] Traceback (most recent call last):\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/util/parallel.py\", line 53, in __call__\r\n    value = self.func(*args, **kwargs)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/environment/environment.py\", line 2055, in _concretize_task\r\n    return _concretize_from_constraints(spec_constraints, tests, reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/environment/environment.py\", line 2033, in _concretize_from_constraints\r\n    return s.concretized(tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2683, in concretized\r\n    clone.concretize(tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2639, in concretize\r\n    self._new_concretize(tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/spec.py\", line 2610, in _new_concretize\r\n    result = spack.solver.asp.solve([self], tests=tests, reuse=reuse)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 2024, in solve\r\n    return driver.solve(\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 592, in solve\r\n    answers = builder.build_specs(tuples)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 1958, in build_specs\r\n    self.reorder_flags()\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 1875, in reorder_flags\r\n    check_same_flags(spec.compiler_flags, compiler_flags)\r\n  File \"/scratch/users/myoder96/spack_dev/base/spack/lib/spack/spack/solver/asp.py\", line 262, in check_same_flags\r\n    assert values1 == values2\r\nAssertionError\r\n```\r\n\n\n### Information on your system\n\n* **Spack:** 0.17.0-442-941e650\r\n* **Python:** 3.8.8\r\n* **Platform:** linux-centos7-zen2\r\n* **Concretizer:** clingo\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "markyoder",
    "url": "https://api.github.com/repos/spack/spack/issues/27828",
    "updated_at": "2021-12-09 00:46:07",
    "created_at": "2021-12-07 02:07:41",
    "closed_at": "2021-12-09 00:46:07",
    "state": "closed",
    "title": "Error: errors occurred during concretization of the environment:",
    "number": 27828,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1072830854,
    "html_url": "https://github.com/spack/spack/issues/27828",
    "assignees": [],
    "comments": 10
}