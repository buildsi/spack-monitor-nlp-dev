{
    "body": "This fixes cryptic error messages generated by `get_rpaths` trying to process lists containing None or empty string values.\r\n\r\nI was seeing messages like:\r\n```\r\n$ spack install -v libsigsegv@2.13%clang@12.0.0\r\n==> Installing libsigsegv-2.13-oowjyvf2ojbr4itgodtjxqi5j4apb6wb\r\n==> No binary for libsigsegv-2.13-oowjyvf2ojbr4itgodtjxqi5j4apb6wb found: installing from source\r\n==> Error: TypeError: expected str, bytes or os.PathLike object, not NoneType\r\n\r\nspack/lib/spack/spack/build_environment.py:1044, in _setup_pkg_and_run:\r\n       1041        tb_string = traceback.format_exc()\r\n       1042\r\n       1043        # build up some context from the offending package so we can\r\n  >>   1044        # show that, too.\r\n       1045        package_context = get_package_context(tb)\r\n       1046\r\n       1047        logfile = None\r\n```\r\n\r\nModifying line 1041 to throw an exception lead to a better error message:\r\n```\r\n$ spack install -v libsigsegv@2.13%clang@12.0.0\r\n==> Installing libsigsegv-2.13-oowjyvf2ojbr4itgodtjxqi5j4apb6wb\r\n==> No binary for libsigsegv-2.13-oowjyvf2ojbr4itgodtjxqi5j4apb6wb found: installing from source\r\nProcess Process-1:\r\nTraceback (most recent call last):\r\n  File \"spack/lib/spack/spack/build_environment.py\", line 1026, in _setup_pkg_and_run\r\n    kwargs['env_modifications'] = setup_package(\r\n  File \"spack/lib/spack/spack/build_environment.py\", line 766, in setup_package\r\n    set_module_variables_for_package(pkg)\r\n  File \"spack/lib/spack/spack/build_environment.py\", line 579, in set_module_variables_for_package\r\n    _set_variables_for_single_module(pkg, mod)\r\n  File \"spack/lib/spack/spack/build_environment.py\", line 522, in _set_variables_for_single_module\r\n    m.std_cmake_args = spack.build_systems.cmake.CMakePackage._std_args(pkg)\r\n  File \"spack/lib/spack/spack/build_systems/cmake.py\", line 187, in _std_args\r\n    spack.build_environment.get_rpaths(pkg)),\r\n  File \"spack/lib/spack/spack/build_environment.py\", line 691, in get_rpaths\r\n    return list(dedupe(filter_system_paths(rpaths)))\r\n  File \"spack/lib/spack/spack/util/environment.py\", line 67, in filter_system_paths\r\n    return [p for p in paths if not is_system_path(p)]\r\n  File \"spack/lib/spack/spack/util/environment.py\", line 67, in <listcomp>\r\n    return [p for p in paths if not is_system_path(p)]\r\n  File \"spack/lib/spack/spack/util/environment.py\", line 62, in is_system_path\r\n    return os.path.normpath(path) in system_dirs\r\n  File \"/opt/cray/pe/python/3.8.5.1/lib/python3.8/posixpath.py\", line 336, in normpath\r\n    path = os.fspath(path)\r\nTypeError: expected str, bytes or os.PathLike object, not NoneType\r\n\r\nDuring handling of the above exception, another exception occurred: ...\r\n```\r\nThis fix removes None paths before filtering out system paths.",
    "user": "frobnitzem",
    "url": "https://api.github.com/repos/spack/spack/issues/27364",
    "updated_at": "2021-11-15 12:23:41",
    "created_at": "2021-11-11 17:33:37",
    "closed_at": "None",
    "state": "open",
    "title": "Bugfix for environment containing empty library paths.",
    "number": 27364,
    "milestone": null,
    "labels": [
        "build-environment"
    ],
    "id": 1051209600,
    "html_url": "https://github.com/spack/spack/pull/27364",
    "assignees": [
        "haampie"
    ],
    "comments": 1
}