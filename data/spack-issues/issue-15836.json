{
    "body": "On cori@NERSC and theta@ALCF, #7483 introduced a build regression.\r\n\r\n    if '@2.0.0:' in self.spec:\r\n        args.append('--enable-netloc')\r\n\r\nnetloc requires MPI, yet `hwloc` does not have an MPI dependency because it is commonly depended upon by MPI implementations (e.g., OpenMPI and at least one version of mpich- #15302).\r\n\r\nHere is the debug log:\r\n\r\n[tau.gcc@8.3.0.log](https://github.com/spack/spack/files/4423263/tau.gcc%408.3.0.log)\r\n\r\nThe relevant part is\r\n\r\n\tmake[2]: Entering directory '/tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi'\r\n\t\tCC       netloc_rank_order.o\r\n\t\tCC       netloc_mpi_find_hosts-netloc_mpi_find_hosts.o\r\n\t\tCCLD     netloc_rank_order\r\n\t\tCCLD     netloc_mpi_find_hosts\r\n\t/usr/bin/ld: netloc_mpi_find_hosts-netloc_mpi_find_hosts.o: in function `main':\r\n\t/tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:40: undefined reference to `MPI_Init'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:42: undefined reference to `MPI_Comm_rank'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:43: undefined reference to `MPI_Comm_size'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:48: undefined reference to `MPI_Abort'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:57: undefined reference to `MPI_Get_processor_name'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:157: undefined reference to `MPI_Send'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:159: undefined reference to `MPI_Send'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:162: undefined reference to `MPI_Recv'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:223: undefined reference to `MPI_Finalize'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:93: undefined reference to `MPI_Recv'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:99: undefined reference to `MPI_Recv'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:116: undefined reference to `MPI_Send'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:112: undefined reference to `MPI_Send'\r\n\t/usr/bin/ld: /tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/utils/netloc/mpi/netloc_mpi_find_hosts.c:65: undefined reference to `MPI_Abort'\r\n\tcollect2: error: ld returned 1 exit status\r\n\r\nThe detailed compilation logs:\r\n[spack-cc-hwloc-naj47dq.in.log](https://github.com/spack/spack/files/4423287/spack-cc-hwloc-naj47dq.in.log)\r\n[spack-cc-hwloc-naj47dq.out.log](https://github.com/spack/spack/files/4423288/spack-cc-hwloc-naj47dq.out.log)\r\n\r\nUnsurprisingly, the compiler link directories don't include an MPI source:\r\n\r\n\tcc\r\n\t-g\r\n\t-O2\r\n\t-o\r\n\t.libs/netloc_mpi_find_hosts\r\n\tnetloc_mpi_find_hosts-netloc_mpi_find_hosts.o\r\n\t../../../netloc/.libs/libnetloc.so\r\n\t-L/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/libpciaccess-0.13.5-3w47xhqx6yyf25w3xl6la7qmeswp2mx5/lib\r\n\t-L/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/libxml2-2.9.9-ys6suob3jslml7w6bfgovhytvicsiuey/lib\r\n\t-L/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/xz-5.2.5-v6hllz4ig7jsyb4wjkdtpaejcmuniv77/lib\r\n\t-L/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/zlib-1.2.11-opn2xungd3hfytvpnj5h6yt6bandexht/lib\r\n\t-L/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/libiconv-1.16-uwyfaltarblqnu3opnriickfqwku234g/lib\r\n\t/tmp/thaines/spack-stage/spack-stage-hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/spack-src/hwloc/.libs/libhwloc.so\r\n\t../../../hwloc/.libs/libhwloc.so\r\n\t/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/libpciaccess-0.13.5-3w47xhqx6yyf25w3xl6la7qmeswp2mx5/lib/libpciaccess.so\r\n\t/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/libxml2-2.9.9-ys6suob3jslml7w6bfgovhytvicsiuey/lib/libxml2.so\r\n\t-ldl\r\n\t-lz\r\n\t/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/xz-5.2.5-v6hllz4ig7jsyb4wjkdtpaejcmuniv77/lib/liblzma.so\r\n\t-lpthread\r\n\t/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/libiconv-1.16-uwyfaltarblqnu3opnriickfqwku234g/lib/libiconv.so\r\n\t-lm\r\n\t-pthread\r\n\t-Wl,-rpath\r\n\t-Wl,/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/hwloc-2.1.0-naj47dqjmbfpkol3dkjwrdtfz6xsv7qy/lib\r\n\t-Wl,-rpath\r\n\t-Wl,/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/libpciaccess-0.13.5-3w47xhqx6yyf25w3xl6la7qmeswp2mx5/lib\r\n\t-Wl,-rpath\r\n\t-Wl,/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/libxml2-2.9.9-ys6suob3jslml7w6bfgovhytvicsiuey/lib\r\n\t-Wl,-rpath\r\n\t-Wl,/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/xz-5.2.5-v6hllz4ig7jsyb4wjkdtpaejcmuniv77/lib\r\n\t-Wl,-rpath\r\n\t-Wl,/global/cscratch1/sd/thaines/spack/opt/spack/cray-cnl7-haswell/gcc-8.3.0/libiconv-1.16-uwyfaltarblqnu3opnriickfqwku234g/lib\r\n\r\nI do not have an MPI module loaded\r\n\r\n\t$ module list\r\n\tCurrently Loaded Modulefiles:\r\n\t1) modules/3.2.11.4                                 17) job/2.2.4-7.0.1.1_3.31__g36b56f4.ari\r\n\t2) nsg/1.2.0                                        18) dvs/2.12_2.2.151-7.0.1.1_5.33__g7eb5e703\r\n\t3) altd/2.0                                         19) alps/6.6.57-7.0.1.1_5.5__g1b735148.ari\r\n\t4) darshan/3.1.7                                    20) rca/2.2.20-7.0.1.1_4.37__g8e3fb5b.ari\r\n\t5) cray-mpich/7.7.10                                21) atp/2.1.3\r\n\t6) craype-haswell                                   22) PrgEnv-gnu/6.0.5\r\n\t7) craype-hugepages2M                               23) llvm/9.0.1\r\n\t8) craype-network-aries                             24) gcc/8.3.0\r\n\t9) craype/2.6.2                                     25) git/2.21.0\r\n\t10) cray-libsci/19.06.1                              26) cray-python/3.7.3.2\r\n\t11) udreg/2.3.2-7.0.1.1_3.26__g8175d3d.ari           27) boost-1.70.0-gcc-8.3.0-c7og6c2\r\n\t12) ugni/6.0.14.0-7.0.1.1_7.29__ge78e5b0.ari         28) cmake-3.16.5-gcc-8.3.0-rfdshcr\r\n\t13) pmi/5.0.14                                       29) elfutils-0.178-gcc-8.3.0-juylyy7\r\n\t14) dmapp/7.1.1-7.0.1.1_4.39__g38cf134.ari           30) intel-tbb-2020.1-gcc-8.3.0-wrxfw5i\r\n\t15) gni-headers/5.0.12.0-7.0.1.1_6.24__g3b1768f.ari  31) nano-4.4-gcc-8.3.0-kwiutcn\r\n\t16) xpmem/2.2.20-7.0.1.1_4.6__g0475745.ari           32) perl-5.30.1-gcc-8.3.0-d6sik3t\r\n\r\n\r\n---\r\n### Spack version\r\n    $ spack --version\r\n        0.14.1-411-5f308daf0\r\n\r\n    $ git branch -v\r\n        develop c3c057f2b package: update flit and py-pyelftools versions (#15817)\r\n\r\n### Steps to reproduce the issue\r\n\r\n    $ spack install hwloc@2.1.0%gcc@8.3.0~cairo~cuda~gl+libxml2~nvml+pci+shared\r\n\r\nNB: This is the variant used by `tau` which is what I was actually installing.\r\n\r\n### Platform and user environment\r\n\r\n    $ uname -a\r\n        Linux cori04 4.12.14-150.47-default #1 SMP Wed Dec 18 15:05:52 UTC 2019 (8162e25) x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n    $ lsb_release -d\r\n        Description:\tSUSE Linux Enterprise Server 15\r\n\r\n### General information\r\n\r\n- [x] I have run `spack --version` and reported the version of Spack\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n",
    "user": "hainest",
    "url": "https://api.github.com/repos/spack/spack/issues/15836",
    "updated_at": "2020-04-22 20:34:32",
    "created_at": "2020-04-02 20:02:35",
    "closed_at": "2020-04-22 20:34:32",
    "state": "closed",
    "title": "Installation issue: hwloc",
    "number": 15836,
    "milestone": null,
    "labels": [
        "cray",
        "build-error"
    ],
    "id": 592892108,
    "html_url": "https://github.com/spack/spack/issues/15836",
    "assignees": [
        "scheibelp"
    ],
    "comments": 6
}