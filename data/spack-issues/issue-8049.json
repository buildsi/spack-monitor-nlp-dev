{
    "body": "Summary:\r\n\r\n`spack install libx11@1.6.3 ^inputproto@2.3.2 ^kbproto@1.0.7  ^libxcb@1.12 ^pkg-config@0.29.2 ^util-macros@1.19.1 ^xextproto@7.3.0 ^xproto@7.0.29 ^xtrans@1.3.5 ^libpthread-stubs@0.3 %intel@18.0.1 arch=linux-centos7-x86_64`\r\n\r\nfails in configure stage due to a conflict between the configure script of libx11 and the cpp wrapper from SPACK\r\n\r\n### Expected Result\r\n\r\nThat libx11 compiles with intel@18.0.1\r\n\r\n### Actual Result\r\n\r\n```\r\n==> Executing phase : 'configure'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/cluster/apps/spack/var/spack/stage/libx11-1.6.3-fnpagv4reyxraalvu7iie5goqftxnr25/libX11-1.6.3/configure' '--prefix=/cluster/spack/apps/linux-centos7-x86_64/intel-18.0.1/libx11-1.6.3-fnpagv4reyxraalvu7iie5goqftxnr25'\r\n/cluster/apps/spack/lib/spack/spack/build_systems/autotools.py:266, in configure:\r\n     258      def configure(self, spec, prefix):\r\n     259          \"\"\"Runs configure with the arguments specified in\r\n     260          :py:meth:`~.AutotoolsPackage.configure_args`\r\n     261          and an appropriately set prefix.\r\n     262          \"\"\"\r\n     263          options = ['--prefix={0}'.format(prefix)] + self.configure_args()\r\n     264  \r\n     265          with working_dir(self.build_directory, create=True):\r\n  >> 266              inspect.getmodule(self).configure(*options)\r\n\r\nSee build log for details:\r\n  /scratch/spackapps/spack-stage/spack-stage-vT5yhC/libX11-1.6.3/spack-build.out\r\n```\r\n\r\nThe spack-build.out contains the following logs:\r\n\r\n```\r\nchecking for cpp... /cluster/apps/spack/lib/spack/env/cpp\r\nchecking if /cluster/apps/spack/lib/spack/env/cpp requires -undef... cpp: error: language core-avx2 not recognized\r\ncpp: error: language core-avx2 not recognized\r\ncpp: error: language core-avx2 not recognized\r\ncpp: error: language core-avx2 not recognized\r\ncpp: error: language core-avx2 not recognized\r\ncpp: error: language core-avx2 not recognized\r\nconfigure: error: /cluster/apps/spack/lib/spack/env/cpp defines unix with or without -undef.  I don't know what to do.\r\n```\r\n\r\ncompiler.yaml:\r\n\r\n```\r\n- compiler:\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags:\r\n      cflags: -O2 -xcore-avx2 -march=core-avx2\r\n      cppflags: -O2 -xcore-avx2 -march=core-avx2\r\n      cxxflags: -O2 -xcore-avx2 -march=core-avx2\r\n    modules: []\r\n    operating_system: centos7\r\n    paths:\r\n      cc: /cluster/apps/intel/parallel_studio_xe_2018_r1/compilers_and_libraries_2018.1.163/linux/bin/intel64/icc\r\n      cxx: /cluster/apps/intel/parallel_studio_xe_2018_r1/compilers_and_libraries_2018.1.163/linux/bin/intel64/icpc\r\n      f77: /cluster/apps/intel/parallel_studio_xe_2018_r1/compilers_and_libraries_2018.1.163/linux/bin/intel64/ifort\r\n      fc: /cluster/apps/intel/parallel_studio_xe_2018_r1/compilers_and_libraries_2018.1.163/linux/bin/intel64/ifort\r\n    spec: intel@18.0.1\r\n    target: x86_64\r\n```\r\n\r\nconfig.log:\r\n\r\n```\r\nconfigure:18727: checking for cpp\r\nconfigure:18746: found /cluster/apps/spack/lib/spack/env/cpp\r\nconfigure:18758: result: /cluster/apps/spack/lib/spack/env/cpp\r\nconfigure:18774: checking if /cluster/apps/spack/lib/spack/env/cpp requires -undef\r\nconfigure:18794: error: /cluster/apps/spack/lib/spack/env/cpp defines unix with or without -undef.  I don't know what to do.\r\n\r\n```\r\n\r\nLines 18774 to 18794 from the configure script:\r\n\r\n```\r\n# Check for flag to avoid builtin definitions - assumes unix is predefined,\r\n# which is not the best choice for supporting other OS'es, but covers most\r\n# of the ones we need for now.\r\n{ $as_echo \"$as_me:${as_lineno-$LINENO}: checking if $RAWCPP requires -undef\" >&5\r\n$as_echo_n \"checking if $RAWCPP requires -undef... \" >&6; }\r\ncat confdefs.h - <<_ACEOF >conftest.$ac_ext\r\n/* end confdefs.h.  */\r\nDoes cpp redefine unix ?\r\n_ACEOF\r\nif test `${RAWCPP} < conftest.$ac_ext | grep -c 'unix'` -eq 1 ; then\r\n        { $as_echo \"$as_me:${as_lineno-$LINENO}: result: no\" >&5\r\n$as_echo \"no\" >&6; }\r\nelse\r\n        if test `${RAWCPP} -undef < conftest.$ac_ext | grep -c 'unix'` -eq 1 ; then\r\n                RAWCPPFLAGS=-undef\r\n                { $as_echo \"$as_me:${as_lineno-$LINENO}: result: yes\" >&5\r\n$as_echo \"yes\" >&6; }\r\n        # under Cygwin unix is still defined even with -undef\r\n        elif test `${RAWCPP} -undef -ansi < conftest.$ac_ext | grep -c 'unix'` -eq 1 ; then\r\n                RAWCPPFLAGS=\"-undef -ansi\"\r\n                { $as_echo \"$as_me:${as_lineno-$LINENO}: result: yes, with -ansi\" >&5\r\n$as_echo \"yes, with -ansi\" >&6; }\r\n        else\r\n                as_fn_error $? \"${RAWCPP} defines unix with or without -undef.  I don't know what to do.\" \"$LINENO\" 5\r\n        fi\r\nfi\r\nrm -f conftest.$ac_ext\r\n```\r\n\r\n### Information on your system\r\n\r\nThis includes:\r\n\r\n 1. which platform you are using: CentOS Linux release 7.4.1708 (Core) \r\n\r\n",
    "user": "samfux84",
    "url": "https://api.github.com/repos/spack/spack/issues/8049",
    "updated_at": "2021-07-05 10:00:27",
    "created_at": "2018-05-08 08:41:41",
    "closed_at": "2018-09-06 07:57:59",
    "state": "closed",
    "title": "libx11 installation with intel 18.0.1 fails during configure stage",
    "number": 8049,
    "milestone": null,
    "labels": [
        "build-error",
        "X11"
    ],
    "id": 321094240,
    "html_url": "https://github.com/spack/spack/issues/8049",
    "assignees": [],
    "comments": 6
}