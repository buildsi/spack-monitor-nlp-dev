{
    "body": "The Argonne 'Theta' system is a little bit different from the NERSC Cray machines.    I know you've been doing a lot of work on Cray systems, so I'm working from a just-checked-out 'develop' version. \r\n\r\nspack finds a whole bunch of compilers:\r\n\r\n```% spack compilers\r\n==> Available compilers\r\n-- cce ----------------------------------------------------------\r\ncce@8.5.7  cce@8.5.5  cce@8.5.4  cce@8.5.2  cce@8.5.1  cce@8.5.0  cce@8.4.6\r\n\r\n-- gcc ----------------------------------------------------------\r\ngcc@6.3.0  gcc@6.2.0  gcc@6.1.0  gcc@5.3.0  gcc@4.9.3  gcc@4.8\r\n\r\n-- intel --------------------------------------------------------\r\nintel@17.0.1.132  intel@17.0.1  intel@17.0.0.098  intel@16.0.3.210\r\n```\r\n\r\nLet's look at something simple:\r\n\r\n```\r\n% spack spec bzip2\r\nInput spec\r\n--------------------------------\r\nbzip2\r\n\r\nNormalized\r\n--------------------------------\r\nbzip2\r\n\r\nConcretized\r\n--------------------------------\r\nbzip2@1.0.6%gcc@6.3.0+shared arch=cray-CNL-mic_knl \r\n```\r\ngreat! spack found a compiler and the arch.  Let's go!\r\n\r\n```\r\n==> Installing bzip2\r\n==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'show' 'PrgEnv-gnu'\r\n==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'unload' 'PrgEnv'\r\n==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'unload' 'PrgEnv-x1' \r\n==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'unload' 'PrgEnv-x2' \r\n==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'unload' 'PrgEnv-cray'                                                                               ==> '/opt/cray/pe/modules/3.2.10.5/bin/modulecmd' 'python' 'unload' 'PrgEnv-intel'                                                                              ==> Error: SyntaxError: invalid syntax (<string>, line 504)   /gpfs/theta-fs1/home/robl/src/spack/lib/spack/spack/build_environment.py:567, in child_execution:                                                                    547      def child_execution(child_connection, input_stream): \r\n548          try:                                                              \r\n549              setup_package(pkg, dirty=dirty)                               \r\n550              function(input_stream)                                        \r\n551              child_connection.send(None)                                    \r\n552          except StopIteration as e:                                        \r\n553              # StopIteration is used to stop installations                  \r\n554              # before the final stage, mainly for debug purposes            \r\n555              tty.msg(e.message)                                             \r\n556              child_connection.send(None)                                    \r\n557          except:                                                            \r\n558              # catch ANYTHING that goes wrong in the child process         \r\n559              exc_type, exc, tb = sys.exc_info()                           \r\n560                                                                             \r\n561              # Need to unwind the traceback in the child because traceback                                                                                  562              # objects can't be sent to the parent.                         \r\n563              tb_string = traceback.format_exc()                            \r\n564                                                                             \r\n565              # build up some context from the offending package so we can                                                                                   566              # show that, too.                                           \r\n>> 567              package_context = get_package_context(tb)                     \r\n568                                                                             \r\n569              build_log = None                                              \r\n570              if hasattr(pkg, 'log_path'):                                  \r\n571                  build_log = pkg.log_path                                  \r\n572                                                                            \r\n573              # make a pickleable exception to send to parent.              \r\n574              msg = \"%s: %s\" % (str(exc_type.__name__), str(exc))\r\n575\r\n576              ce = ChildError(msg, tb_string, build_log, package_context)\r\n577              child_connection.send(ce)\r\n578\r\n579          finally:\r\n580              child_connection.close()\r\nTraceback (most recent call last):\r\n  File \"/gpfs/theta-fs1/home/robl/src/spack/lib/spack/spack/build_environment.py\", line 549, in child_execution \r\n    setup_package(pkg, dirty=dirty)\r\n  File \"/gpfs/theta-fs1/home/robl/src/spack/lib/spack/spack/build_environment.py\", line 492, in setup_package   \r\n    set_compiler_environment_variables(pkg, spack_env)\r\n  File \"/gpfs/theta-fs1/home/robl/src/spack/lib/spack/spack/build_environment.py\", line 227, in set_compiler_environment_variables\r\n    load_module(mod)\r\n  File \"/gpfs/theta-fs1/home/robl/src/spack/lib/spack/spack/build_environment.py\", line 139, in load_module\r\n    error=str), '<string>', 'exec'))\r\n  File \"<string>\", line 504\r\n    craype-mic-knl requires cce/8.4 or later, intel/14.0 or later, or gcc/5.1 or later\r\n                          ^\r\nSyntaxError: invalid syntax\r\n```\r\n\r\nI'm not really sure what's going on here.  Definitely open to the suggestion that I did not do enough configuring -- things seemed to work automatically and I have not had to edit or create any .yaml files by hand ... yet.\r\n\r\n The error is the same as in #2359 , though I don't think for the same reason.  I also found #2572 , but that's been fixed for a few months and also does not seem to be what I'm running into either.",
    "user": "roblatham00",
    "url": "https://api.github.com/repos/spack/spack/issues/3153",
    "updated_at": "2017-09-11 19:23:32",
    "created_at": "2017-02-15 19:49:54",
    "closed_at": "2017-09-11 19:23:32",
    "state": "closed",
    "title": "spack on Cray (again)",
    "number": 3153,
    "milestone": null,
    "labels": [
        "cray"
    ],
    "id": 207909120,
    "html_url": "https://github.com/spack/spack/issues/3153",
    "assignees": [
        "mamelara",
        "becker33"
    ],
    "comments": 14
}