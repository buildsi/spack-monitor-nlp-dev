{
    "body": "It looks like projections configured in modules.yaml do not work in Spack 0.16.2 as expected.\r\nAttempting to substitute the ${ARCHITECTURE} token with just the \"target\" seems to work under Spack 0.16.2 only for the installation path, but not the module path.\r\n\r\n### Steps to reproduce\r\n**1) Configuration:**\r\n````console\r\nconfig.yaml\r\n  install_tree:\r\n    root: /opt/ohpc/pub/libs/spack/0.16.2\r\n    projections:\r\n      all: \"${ARCHITECTURE}/${COMPILERNAME}-${COMPILERVER}/${PACKAGE}-${VERSION}-${HASH}\"\r\n````\r\n\r\n````console\r\nmodules.yaml\r\nmodules:\r\n  default:\r\n    roots:\r\n      lmod: /opt/ohpc/pub/modulesspk\r\n    enable:\r\n      - lmod\r\n\r\n    lmod:\r\n      core_compilers:\r\n        - 'gcc@4.8'\r\n      hierarchy:\r\n        - mpi\r\n````\r\n\r\n\r\n\r\n**2) Install package:**\r\n````console\r\nspack install libsigsegv arch=zen2\r\nspack install libsigsegv\r\n````\r\n**3) Check result:**\r\n````console\r\nspack find\r\n==>; 2 installed packages\r\n-- linux-centos8-haswell / gcc@9.3.0 ----------------------------\r\nlibsigsegv@2.13\r\n\r\n-- linux-centos8-zen2 / gcc@9.3.0 -------------------------------\r\nlibsigsegv@2.13\r\n````\r\n\r\n````console\r\nmodule av\r\n\r\n---------------------------------------- /opt/ohpc/pub/modulesspk --------------------------------\r\n   linux-centos8-x86_64/gcc/9.3.0/libsigsegv/2.13-rnukwl5    linux-centos8-x86_64/gcc/9.3.0/libsigsegv/2.13-uk7f7mt (D)\r\n\r\n---------------------------------------- /opt/ohpc/admin/modulefiles -----------------------------\r\n   spack/0.16.2 (L)\r\n\r\n  Where:\r\n   D:  Default Module\r\n   L:  Module is loaded\r\n\r\nUse \"module spider\" to find all possible modules and extensions.\r\nUse \"module keyword key1 key2 ...\" to search for all possible modules matching any of the \"keys\".\r\n````\r\n````console\r\nls -al /opt/ohpc/pub/modulesspk/linux-centos8-x86_64/gcc/9.3.0/libsigsegv/\r\ntotal 8\r\ndrwxr-xr-x. 2 root root  54 Sep  9 14:18 .\r\ndrwxr-xr-x. 3 root root  24 Sep  9 11:53 ..\r\n-rw-r--r--. 1 root root 652 Sep  9 14:18 2.13-rnukwl5.lua\r\n-rw-r--r--. 1 root root 643 Sep  9 11:53 2.13-uk7f7mt.lua\r\n````\r\n````console\r\nls -al /opt/ohpc/pub/libs/spack/0.16.2/\r\ntotal 0\r\ndrwxr-xr-x. 6 root root  89 Sep  9 14:18 .\r\ndrwxr-xr-x. 3 root root  20 Sep  8 15:33 ..\r\ndrwxr-xr-x. 2 root root  19 Sep  8 15:34 bin\r\ndrwxr-xr-x. 3 root root  23 Sep  9 14:18 linux-centos8-haswell\r\ndrwxr-xr-x. 3 root root  23 Sep  9 11:53 linux-centos8-zen2\r\ndrwxr-xr-x. 3 root root 116 Sep  9 14:18 .spack-db\r\n````\r\n\r\n**Expected result**:\r\n````console\r\nls -al /opt/ohpc/pub/modulesspk/linux-centos8-haswell/gcc/9.3.0/libsigsegv/\r\ntotal 8\r\ndrwxr-xr-x. 2 root root  54 Sep  9 14:18 .\r\ndrwxr-xr-x. 3 root root  24 Sep  9 11:53 ..\r\n-rw-r--r--. 1 root root 652 Sep  9 14:18 2.13-rnukwl5.lua\r\n````\r\n````console\r\nls -al /opt/ohpc/pub/modulesspk/linux-centos8-zen2/gcc/9.3.0/libsigsegv/\r\ntotal 8\r\ndrwxr-xr-x. 2 root root  54 Sep  9 14:18 .\r\ndrwxr-xr-x. 3 root root  24 Sep  9 11:53 ..\r\n-rw-r--r--. 1 root root 643 Sep  9 11:53 2.13-uk7f7mt.lua\r\n````\r\n````console\r\nls -al /opt/ohpc/pub/libs/spack/0.16.2/\r\ntotal 0\r\ndrwxr-xr-x. 6 root root  89 Sep  9 14:18 .\r\ndrwxr-xr-x. 3 root root  20 Sep  8 15:33 ..\r\ndrwxr-xr-x. 2 root root  19 Sep  8 15:34 bin\r\ndrwxr-xr-x. 3 root root  23 Sep  9 14:18 linux-centos8-haswell\r\ndrwxr-xr-x. 3 root root  23 Sep  9 11:53 linux-centos8-zen2\r\ndrwxr-xr-x. 3 root root 116 Sep  9 14:18 .spack-db\r\n````\r\n\r\n\r\n\r\n### Error message\r\n\r\nNo error message generated, compilation succeeds.\r\nBut result does not meet the expectations.\r\n\r\n### Information on your system\r\n\r\nspack debug report\r\n* **Spack:** 0.16.2-3869-81be31aee0\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-centos8-haswell\r\n* **Concretizer:** original\r\n* **Os:** CentOS8\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "kelbstf",
    "url": "https://api.github.com/repos/spack/spack/issues/25446",
    "updated_at": "2021-09-12 18:02:52",
    "created_at": "2021-08-16 19:36:20",
    "closed_at": "2021-09-12 18:02:52",
    "state": "closed",
    "title": "projections of module path fails, but works for installation path",
    "number": 25446,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 972041367,
    "html_url": "https://github.com/spack/spack/issues/25446",
    "assignees": [],
    "comments": 1
}