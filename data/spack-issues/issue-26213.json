{
    "body": "### Steps to reproduce the issue\n\n```console\r\n$ spack concretize -f\r\n==> Concretized ucx@1.11.1%aocc@3.1.0+cm+cma+dc+ib-hw-tm+mlx5-dv+optimizations+rc+thread_multiple+ud\r\n -   6t3b7s5  ucx@1.11.1%aocc@3.1.0~assertions+cm+cma~cuda+dc~debug~dm~gdrcopy+ib-hw-tm~java~knem~logging+mlx5-dv+optimizations~parameter_checking+pic+rc+thread_multiple+ud~xpmem cuda_arch=none arch=linux-rocky8-zen2\r\n[+]  fkq2726      ^numactl@2.0.14%aocc@3.1.0 patches=4e1d78cbbb85de625bad28705e748856033eaafab92a66dffd383a3d7e00cc94,62fc8a8bf7665a60e8f4c93ebbd535647cebf74198f7afafec4c085a8825c006 arch=linux-rocky8-zen2\r\n -   uxa6bqg          ^autoconf@2.69%aocc@3.1.0 patches=7793209b33013dc0f81208718c68440c5aae80e7a1c4b8d336e382525af791a7 arch=linux-rocky8-zen2\r\n -   2h66lmh          ^automake@1.16.1%aocc@3.1.0 arch=linux-rocky8-zen2\r\n -   rsrxdnv          ^libtool@2.4.6%aocc@3.1.0 arch=linux-rocky8-zen2\r\n -   6i6at64          ^m4@1.4.18%aocc@3.1.0+sigsegv patches=3877ab548f88597ab2327a2230ee048d2d07ace1062efe81fc92e91b7f39cd00,fc9b61654a3ba1a8d6cd78ce087e7c96366c290bc8d2c299f09828d793b853c8 arch=linux-rocky8-zen2\r\n -   cnetf2c      ^pkgconf@1.4.2%aocc@3.1.0 arch=linux-rocky8-zen2\r\n[+]  xy5irkn      ^rdma-core@32.0%aocc@3.1.0~ipo build_type=RelWithDebInfo arch=linux-rocky8-zen2\r\n\r\n==> Updating view at /home/bc/env/ucx-pre/.spack-env/view\r\n==> Warning: [/home/bc/env/ucx-pre/.spack-env/._view/bqvhihmw6oalo46zrg35x6psarrdy374] Skipping external package: rdma-core@32.0%aocc@3.1.0~ipo build_type=RelWithDebInfo arch=linux-rocky8-zen2/xy5irkn\r\n$ spack install\r\n==> Installing environment /home/bc/env/ucx-pre\r\n[+] /usr (external autoconf-2.69-uxa6bqg3a4ztwkkrzamgvp7oazrndeze)\r\n[+] /usr (external automake-1.16.1-2h66lmhf2akul35pjwbj7clouspssq5g)\r\n[+] /usr (external libtool-2.4.6-rsrxdnvarbm3h3mpvx776726lcrchpku)\r\n[+] /usr (external m4-1.4.18-6i6at64g4imv4kljcoexa6za5hnr54kb)\r\n[+] /usr (external pkgconf-1.4.2-cnetf2choiv7fzodmpj2gebenc7ho34a)\r\n[+] /usr (external rdma-core-32.0-xy5irkn7jsofmj2ucwv3afjh3vcswtrw)\r\n[+] /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.1.0/numactl-2.0.14-fkq2726zyicunbbmqhwddz3vuonr5psv\r\n==> Installing ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y\r\n==> No binary for ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y found: installing from source\r\n==> Using cached archive: /home/bc/spack/var/spack/cache/_source-cache/archive/29/29338cad18858517f96b46ff83bdd259a5899e274792cebd269717c660aa86fd.tar.gz\r\n==> No patches needed for ucx\r\n==> ucx: Executing phase: 'autoreconf'\r\n==> ucx: Executing phase: 'configure'\r\n==> ucx: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16' 'V=1'\r\n\r\n2 errors found in build log:\r\n     1503    make[3]: Leaving directory '/tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y/\r\n             spack-src/src/tools/perf/lib'\r\n     1504    make[3]: Entering directory '/tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y\r\n             /spack-src/src/tools/perf'\r\n     1505    /home/bc/spack/lib/spack/env/aocc/clang -DHAVE_CONFIG_H -I. -I../../..  -DCPU_FLAGS=\"|avx\" -I/tmp/bc/spa\r\n             ck-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y/spack-src/src -I/tmp/bc/spack-stage/spa\r\n             ck-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y/spack-src -I/tmp/bc/spack-stage/spack-stage-ucx-1.1\r\n             1.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y/spack-src/src   -O3 -g -Wall -Werror -fmax-type-align=16 -mavx -fun\r\n             wind-tables -Wno-missing-field-initializers -Wno-unused-parameter -Wno-unused-label -Wno-long-long -Wno-\r\n             endif-labels -Wno-sign-compare -Wno-multichar -Wno-deprecated-declarations -Winvalid-pch -Wno-pointer-si\r\n             gn -Werror-implicit-function-declaration -Wno-format-zero-length -Wnested-externs -Wshadow -Werror=decla\r\n             ration-after-statement -fopenmp  -MT ucx_perftest-perftest.o -MD -MP -MF .deps/ucx_perftest-perftest.Tpo\r\n              -c -o ucx_perftest-perftest.o `test -f 'perftest.c' || echo './'`perftest.c\r\n     1506    mv -f .deps/ucx_perftest-perftest.Tpo .deps/ucx_perftest-perftest.Po\r\n     1507    /bin/sh ../../../libtool  --tag=CC   --mode=link /home/bc/spack/lib/spack/env/aocc/clang -O3 -g -Wall -W\r\n             error -fmax-type-align=16 -mavx -funwind-tables -Wno-missing-field-initializers -Wno-unused-parameter -W\r\n             no-unused-label -Wno-long-long -Wno-endif-labels -Wno-sign-compare -Wno-multichar -Wno-deprecated-declar\r\n             ations -Winvalid-pch -Wno-pointer-sign -Werror-implicit-function-declaration -Wno-format-zero-length -Wn\r\n             ested-externs -Wshadow -Werror=declaration-after-statement -fopenmp   -Wl,-dynamic-list-data  -o ucx_per\r\n             ftest ucx_perftest-perftest.o /tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24\r\n             y/spack-src/src/uct/libuct.la /tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24\r\n             y/spack-src/src/ucp/libucp.la /tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24\r\n             y/spack-src/src/ucs/libucs.la lib/libucxperf.la -lpthread -lrt -lrt  -lbfd -ldl\r\n     1508    libtool: link: /home/bc/spack/lib/spack/env/aocc/clang -O3 -g -Wall -Werror -fmax-type-align=16 -mavx -f\r\n             unwind-tables -Wno-missing-field-initializers -Wno-unused-parameter -Wno-unused-label -Wno-long-long -Wn\r\n             o-endif-labels -Wno-sign-compare -Wno-multichar -Wno-deprecated-declarations -Winvalid-pch -Wno-pointer-\r\n             sign -Werror-implicit-function-declaration -Wno-format-zero-length -Wnested-externs -Wshadow -Werror=dec\r\n             laration-after-statement -fopenmp -Wl,-dynamic-list-data -o .libs/ucx_perftest ucx_perftest-perftest.o  \r\n             lib/.libs/libucxperf.a /tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y/spack\r\n             -src/src/ucp/.libs/libucp.so /tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y\r\n             /spack-src/src/uct/.libs/libuct.so /tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rk\r\n             aqj24y/spack-src/src/ucs/.libs/libucs.so -lm -lnuma /tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54g\r\n             k4kwaigmjkmiwh3rkaqj24y/spack-src/src/ucm/.libs/libucm.so -lpthread -lrt -lbfd -ldl -fopenmp -Wl,-rpath \r\n             -Wl,/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.1.0/ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y/li\r\n             b\r\n  >> 1509    ld.lld: error: unknown argument '-dynamic-list-data'\r\n  >> 1510    clang-12: error: linker command failed with exit code 1 (use -v to see invocation)\r\n     1511    make[3]: *** [Makefile:628: ucx_perftest] Error 1\r\n     1512    make[3]: Leaving directory '/tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y/\r\n             spack-src/src/tools/perf'\r\n     1513    make[2]: *** [Makefile:710: all-recursive] Error 1\r\n     1514    make[2]: Leaving directory '/tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y/\r\n             spack-src/src/tools/perf'\r\n     1515    make[1]: *** [Makefile:735: all-recursive] Error 1\r\n     1516    make[1]: Leaving directory '/tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y/\r\n             spack-src'\r\n\r\nSee build log for details:\r\n  /tmp/bc/spack-stage/spack-stage-ucx-1.11.1-6t3b7s54gk4kwaigmjkmiwh3rkaqj24y/spack-build-out.txt\r\n```\n\n### Information on your system\n\n```\r\n* **Spack:** 0.16.2-4349-d34b2638c7\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-rocky8-zen2\r\n* **Concretizer:** clingo\r\n```\n\n### Additional information\n\n`ucx` fails to build with `%aocc` because AOCC's `lld` doesn't support `-dynamic-list-data`.\r\n\r\nRelated UCX issues:\r\nhttps://github.com/openucx/ucx/issues/4549 \r\nhttps://github.com/openucx/ucx/issues/5545\r\n\r\n[spack-build-out.txt](https://github.com/spack/spack/files/7221122/spack-build-out.txt)\r\n[spack-build-env.txt](https://github.com/spack/spack/files/7221123/spack-build-env.txt)\r\n[config.log](https://github.com/spack/spack/files/7221129/config.log)\r\n\r\n@hppritcha \n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "zzzoom",
    "url": "https://api.github.com/repos/spack/spack/issues/26213",
    "updated_at": "2021-12-20 11:50:32",
    "created_at": "2021-09-23 22:37:46",
    "closed_at": "None",
    "state": "open",
    "title": "Installation issue: ucx %aocc",
    "number": 26213,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1005905232,
    "html_url": "https://github.com/spack/spack/issues/26213",
    "assignees": [],
    "comments": 10
}