{
    "body": "### Steps to reproduce the issue\n\n```\r\nspack install amber@20 %intel +cuda cuda_arch=37 +x11 ^intel-mpi ^cuda@10.2.89\r\n```\n\n### Information on your system\n\n* **Spack:** 0.16.2-4201-eb99db5\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-rhel7-broadwell\r\n* **Concretizer:** original\r\n\n\n### Additional information\n\n@hseara\r\n\r\nFirst, thanks very much for this package file.  It doesn't work currently, but looks very promising.  The upstream is clearly shaky and buggy, so props for trying to deal with that.\r\n\r\nI'm including my best package file, which doesn't work, but might contain some breadcrumbs for moving forward.  Notably, it appears that downloads of `AmberTools.*` no longer works.  Perhaps the URL has changed.  Otherwise, manual download.\r\n\r\nAlso, there's a hard-coded \"18\" in the package file, which is now \"20\".  Perhaps there's some way to pick up the actual version.\r\n\r\nHere's the diff from today's `develop` branch that I'm using.  Not sure whether zapping older versions is necessary, but I was trying to remove complications.\r\n\r\nThe `update` option doesn't work.  There seems to be a problem with `update.7`, which might be due to the content, which strangely identifies it as `update.12`.  Not sure.\r\n\r\nThe `nomkl` is due to an odd issue with the Intel (19) compiler alternative not being able to find a shared MKL library.  Guessing this is due to a botch in the Amber config scripts.\r\n\r\n```\r\ndiff --git a/var/spack/repos/builtin/packages/amber/package.py b/var/spack/repos/builtin/packages/amber/package.py\r\nindex 6bfc4fb..0cb995c 100644\r\n--- a/var/spack/repos/builtin/packages/amber/package.py\r\n+++ b/var/spack/repos/builtin/packages/amber/package.py\r\n@@ -23,30 +23,23 @@ class Amber(Package, CudaPackage):\r\n        \"\"\"\r\n\r\n     homepage = \"https://ambermd.org/\"\r\n-    url = \"file://{0}/Amber18.tar.bz2\".format(os.getcwd())\r\n+    url = \"file://{0}/Amber20.tar.bz2\".format(os.getcwd())\r\n     manual_download = True\r\n\r\n     maintainers = ['hseara']\r\n\r\n     version(\r\n         '20', sha256='a4c53639441c8cc85adee397933d07856cc4a723c82c6bea585cd76c197ead75')\r\n-    version(\r\n-        '18', sha256='2060897c0b11576082d523fb63a51ba701bc7519ff7be3d299d5ec56e8e6e277')\r\n-    version(\r\n-        '16', sha256='3b7ef281fd3c46282a51b6a6deed9ed174a1f6d468002649d84bfc8a2577ae5d',\r\n-        deprecated=True)\r\n\r\n     resources = {\r\n         # [version amber, version ambertools , sha256sum]\r\n-        '20': ('20', 'b1e1f8f277c54e88abc9f590e788bbb2f7a49bcff5e8d8a6eacfaf332a4890f9'),\r\n-        '18': ('19', '0c86937904854b64e4831e047851f504ec45b42e593db4ded92c1bee5973e699'),\r\n-        '16': ('16', '7b876afe566e9dd7eb6a5aa952a955649044360f15c1f5d4d91ba7f41f3105fa'),\r\n+        '20': ('21', 'f55fa930598d5a8e9749e8a22d1f25cab7fcf911d98570e35365dd7f262aaafd'),\r\n     }\r\n     for ver, (ambertools_ver, ambertools_checksum) in resources.items():\r\n         resource(when='@{0}'.format(ver),\r\n                  name='AmberTools',\r\n-                 url='http://ambermd.org/downloads/AmberTools{0}.tar.bz2'.format(\r\n-                      ambertools_ver),\r\n+                 url = \"file://{0}/AmberTools{1}.tar.bz2\".format(os.getcwd(),\r\n+                                                                 ambertools_ver),\r\n                  sha256=ambertools_checksum,\r\n                  destination='',\r\n                  placement='ambertools_tmpdir',\r\n@@ -62,6 +55,8 @@ class Amber(Package, CudaPackage):\r\n         ('20', '7', '143b6a09f774aeae8b002afffb00839212020139a11873a3a1a34d4a63fa995d'),\r\n         ('20', '8', 'a6fc6d5c8ba0aad3a8afe44d1539cc299ef78ab53721e28244198fd5425d14ad'),\r\n         ('20', '9', '5ce6b534bab869b1e9bfefa353d7f578750e54fa72c8c9d74ddf129d993e78cf'),\r\n+        ('20', '10', '76a683435be7cbb860f5bd26f09a0548c2e77c5a481fc6d64b55a3a443ce481d'),\r\n+        ('20', '11', 'f40b3612bd3e59efa2fa1ec06ed6fd92446ee0f1d5d99d0f7796f66b18e64060'),\r\n         ('18', '1', '3cefac9a24ece99176d5d2d58fea2722de3e235be5138a128428b9260fe922ad'),\r\n         ('18', '2', '3a0707a9a59dcbffa765dcf87b68001450095c51b96ec39d21260ba548a2f66a'),\r\n         ('18', '3', '24c2e06f71ae553a408caa3f722254db2cbf1ca4db274542302184e3d6ca7015'),\r\n@@ -186,6 +181,7 @@ def install(self, spec, prefix):\r\n         conf = Executable('./configure')\r\n         base_args = ['--skip-python',\r\n                      '--with-netcdf', self.spec['netcdf-fortran'].prefix,\r\n+                     '-nomkl',\r\n                      ]\r\n         if self.spec.satisfies('~x11'):\r\n             base_args += ['-noX11']\r\n\r\n```\r\n\r\nThis version ultimately fails like so\r\n```\r\n==> amber: Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j14' 'install'\r\n\r\n15 errors found in build log:\r\n     7275    gti_schedule_functions.h(108): warning #3500: field initializers are a C++11 feature\r\n     7276          FunctionType functionType=linear;\r\n     7277                                   ^\r\n     7278\r\n     7279    In file included from gpuContext.h(6),\r\n     7280                     from gpu.cpp(23):\r\n  >> 7281    gti_gpuContext.h(47): error: qualified name is not allowed\r\n     7282        std::unique_ptr< GpuBuffer<bool>>       pbTLNeedNewNeighborList;\r\n     7283        ^\r\n     7284\r\n     7285    In file included from gpuContext.h(6),\r\n     7286                     from gpu.cpp(23):\r\n  >> 7287    gti_gpuContext.h(47): error #77: this declaration has no storage class or type specifier\r\n     7288        std::unique_ptr< GpuBuffer<bool>>       pbTLNeedNewNeighborList;\r\n     7289        ^\r\n     7290\r\n     7291    In file included from gpuContext.h(6),\r\n     7292                     from gpu.cpp(23):\r\n  >> 7293    gti_gpuContext.h(47): error: expected a \";\"\r\n     7294        std::unique_ptr< GpuBuffer<bool>>       pbTLNeedNewNeighborList;\r\n     7295                       ^\r\n     7296\r\n```\r\nand so on.\r\n\r\nSeems like a language version issue versus compiler versions.  Not sure whether I'll have time soon to dig deeper.\r\n\r\n\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "michaelkarlcoleman",
    "url": "https://api.github.com/repos/spack/spack/issues/25853",
    "updated_at": "2021-09-08 23:23:20",
    "created_at": "2021-09-08 23:23:20",
    "closed_at": "None",
    "state": "open",
    "title": "Installation issue: amber",
    "number": 25853,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 991607384,
    "html_url": "https://github.com/spack/spack/issues/25853",
    "assignees": [],
    "comments": 0
}