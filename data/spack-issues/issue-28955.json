{
    "body": "### Steps to reproduce\n\nHi, I have just installed spack (latest development version) and have found that the command ```spack unload``` does not clean the environment vars that it setted, like ```LD_LIBRARY_PATH``` . Example: I have just installed ```zlib``` and ```lmod```. Then\r\n\r\n```console\r\n$ echo $LD_LIBRARY_PATH\r\n:/usr/lib64/zulu-openjdk17/lib/server\r\n$ source share/spack/setup-env.sh\r\n$ spack load lmod\r\n$ echo $LD_LIBRARY_PATH\r\n/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/tcl-8.6.11-oi2m2joes6esitgq4e4spmvqpk6p6g3n/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/lua-luaposix-35.0-34l3atm54jcvngcixtyingcybh5w77nd/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/lua-luafilesystem-1_7_0_2-l4if7cignaw7bytxzlput7dsvsd3lo44/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/lua-5.3.5-x5kahnebyoc3pwxprjymuppziafwv2eh/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/readline-8.1-etpf3ktnpwhmxjux7oz6dmyv5czaecvj/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/ncurses-6.2-vms34pwafcme3dn234uf4uuzbx3nxdr7/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/curl-7.80.0-6vskdmi6j3p3hihrqrb2nc63su6r5jvr/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/zlib-1.2.11-vwcrhmtz2kjwrqr4vys2cxhqwdtxc54c/lib::/usr/lib64/zulu-openjdk17/lib/server\r\n$ spack unload lmod \r\n$ echo $LD_LIBRARY_PATH\r\n/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/tcl-8.6.11-oi2m2joes6esitgq4e4spmvqpk6p6g3n/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/lua-luaposix-35.0-34l3atm54jcvngcixtyingcybh5w77nd/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/lua-luafilesystem-1_7_0_2-l4if7cignaw7bytxzlput7dsvsd3lo44/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/lua-5.3.5-x5kahnebyoc3pwxprjymuppziafwv2eh/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/readline-8.1-etpf3ktnpwhmxjux7oz6dmyv5czaecvj/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/ncurses-6.2-vms34pwafcme3dn234uf4uuzbx3nxdr7/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/curl-7.80.0-6vskdmi6j3p3hihrqrb2nc63su6r5jvr/lib:/opt/PACKAGES/spack/opt/spack/linux-slackware15-x86_64/gcc-11.2.0/zlib-1.2.11-vwcrhmtz2kjwrqr4vys2cxhqwdtxc54c/lib::/usr/lib64/zulu-openjdk17/lib/server\r\n```\r\nI tried using ```spack edit lmod``` to search for clues but I don't see anything there and my spack knowledge is very basic. What can I do? what I am doing wrong? Thanks for any advice  (this affects posterior uses of my system)\n\n### Error message\n\nActually there is no error message but this is the output\r\n```console\r\n$ spack --debug --stacktrace unload lmod\r\nlib/spack/spack/cmd/__init__.py:123 ==> [2022-02-15-11:46:39.632272] Imported unload from built-in commands\r\nlib/spack/spack/cmd/__init__.py:123 ==> [2022-02-15-11:46:39.632928] Imported unload from built-in commands\r\nlib/spack/spack/config.py:1007 ==> [2022-02-15-11:46:39.634216] Reading config file /opt/PACKAGES/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/config.py:1007 ==> [2022-02-15-11:46:39.649540] Reading config file /opt/PACKAGES/spack/etc/spack/defaults/bootstrap.yaml\r\nlib/spack/spack/database.py:373 ==> [2022-02-15-11:46:39.655629] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:377 ==> [2022-02-15-11:46:39.655789] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/config.py:1007 ==> [2022-02-15-11:46:39.659465] Reading config file /opt/PACKAGES/spack/etc/spack/defaults/repos.yaml\r\nlib/spack/spack/config.py:1007 ==> [2022-02-15-11:46:39.709983] Reading config file /opt/PACKAGES/spack/etc/spack/defaults/modules.yaml\r\nlib/spack/spack/config.py:1007 ==> [2022-02-15-11:46:39.719071] Reading config file /opt/PACKAGES/spack/etc/spack/defaults/linux/modules.yaml\r\nlib/spack/spack/config.py:1007 ==> [2022-02-15-11:46:39.735852] Reading config file /root/.spack/linux/compilers.yaml\r\n```\n\n### Information on your system\n\nLinux, x86_64, slackware 15, compiler gcc 11.2.0 \r\n\r\n```console\r\n* **Spack:** 0.17.1-1196-55996d3ad4\r\n* **Python:** 3.9.10\r\n* **Platform:** linux-slackware15-skylake\r\n* **Concretizer:** clingo\r\n```\r\n\r\nI have added a custom package configuration since after loading a package I was getting weird error messages when unloading , related to oen ssl, so I added the following to etc/spack/packages.yaml\r\n```yaml\r\npackages:\r\n    openssl:\r\n        externals:\r\n        - spec: openssl@1.0.2g\r\n          prefix: /usr\r\n        buildable: False\r\n``` \n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "iluvatar1",
    "url": "https://api.github.com/repos/spack/spack/issues/28955",
    "updated_at": "2022-02-15 16:52:39",
    "created_at": "2022-02-15 16:52:39",
    "closed_at": "None",
    "state": "open",
    "title": "Some env vars (ike LD_LIBRARY_PATH) not cleaned after unload",
    "number": 28955,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1138954409,
    "html_url": "https://github.com/spack/spack/issues/28955",
    "assignees": [],
    "comments": 0
}