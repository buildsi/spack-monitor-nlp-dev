{
    "body": "### Steps to reproduce the issue\n\n`rocsolver@4.5.2 ^fmt@8.1.1` builds fails using:\r\n* `spack@develop` (3d29e0d64139e11b0551eae8a25dd9f1232515e1 from `Mon Mar 7 11:58:39 2022 -0700`)\r\n* Ubuntu 20.04, X86_64\r\n* GCC 9.3.0\r\n\r\nIt looks like there should be a conflict for `rocsolver@4.5.2 ^fmt@8.1.1`. Same error w/ `^fmt@8.1.0\r\n\r\nConcrete spec: [rocsolver.spec.json.txt](https://github.com/spack/spack/files/8200915/rocsolver.spec.json.txt)\r\n\r\nConcretization:\r\n```\r\nrocsolver@4.5.2%gcc@9.3.0~ipo+optimal amdgpu_target=gfx906:xnack- build_type=Release arch=linux-ubuntu20.04-x86_64\r\n    ^cmake@3.22.2%gcc@9.3.0~doc+ncurses+openssl+ownlibs~qt build_type=Release arch=linux-ubuntu20.04-x86_64\r\n        ^ncurses@6.2%gcc@9.3.0~symlinks+termlib abi=none arch=linux-ubuntu20.04-x86_64\r\n            ^pkgconf@1.8.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^openssl@1.1.1m%gcc@9.3.0~docs certs=system arch=linux-ubuntu20.04-x86_64\r\n            ^perl@5.34.0%gcc@9.3.0+cpanm+shared+threads arch=linux-ubuntu20.04-x86_64\r\n                ^berkeley-db@18.1.40%gcc@9.3.0+cxx~docs+stl patches=b231fcc arch=linux-ubuntu20.04-x86_64\r\n                ^bzip2@1.0.8%gcc@9.3.0~debug~pic+shared arch=linux-ubuntu20.04-x86_64\r\n                    ^diffutils@3.8%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                        ^libiconv@1.16%gcc@9.3.0 libs=shared,static arch=linux-ubuntu20.04-x86_64\r\n                ^gdbm@1.19%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^readline@8.1%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^zlib@1.2.11%gcc@9.3.0+optimize+pic+shared arch=linux-ubuntu20.04-x86_64\r\n    ^fmt@8.1.1%gcc@9.3.0~ipo+pic~shared build_type=RelWithDebInfo cxxstd=11 arch=linux-ubuntu20.04-x86_64\r\n    ^hip@4.5.2%gcc@9.3.0~ipo build_type=Release patches=24ca25a,2a41904 arch=linux-ubuntu20.04-x86_64\r\n        ^comgr@4.5.2%gcc@9.3.0~ipo build_type=Release arch=linux-ubuntu20.04-x86_64\r\n            ^llvm-amdgpu@4.5.2%gcc@9.3.0~ipo~link_llvm_dylib~llvm_dylib+openmp+rocm-device-libs build_type=Release patches=d999f3b arch=linux-ubuntu20.04-x86_64\r\n                ^hwloc@2.7.0%gcc@9.3.0~cairo~cuda~gl~libudev+libxml2~netloc~nvml~opencl+pci~rocm+shared arch=linux-ubuntu20.04-x86_64\r\n                    ^libpciaccess@0.16%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                        ^libtool@2.4.6%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                            ^m4@1.4.19%gcc@9.3.0+sigsegv patches=9dc5fbd,bfdffa7 arch=linux-ubuntu20.04-x86_64\r\n                                ^libsigsegv@2.13%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                        ^util-macros@1.19.3%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^libxml2@2.9.12%gcc@9.3.0~python arch=linux-ubuntu20.04-x86_64\r\n                        ^xz@5.2.5%gcc@9.3.0+pic libs=shared,static arch=linux-ubuntu20.04-x86_64\r\n                ^libelf@0.8.13%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^perl-data-dumper@2.173%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^python@3.8.12%gcc@9.3.0+bz2+ctypes+dbm~debug+ensurepip+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93,4c24573,f2fd060 arch=linux-ubuntu20.04-x86_64\r\n                    ^expat@2.4.6%gcc@9.3.0+libbsd arch=linux-ubuntu20.04-x86_64\r\n                        ^libbsd@0.11.5%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                            ^libmd@1.0.4%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^gettext@0.21%gcc@9.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-ubuntu20.04-x86_64\r\n                        ^tar@1.34%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^libffi@3.4.2%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^sqlite@3.37.2%gcc@9.3.0+column_metadata+dynamic_extensions+fts~functions+rtree arch=linux-ubuntu20.04-x86_64\r\n                    ^util-linux-uuid@2.37.4%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^z3@4.8.14%gcc@9.3.0~gmp~ipo~python build_type=RelWithDebInfo arch=linux-ubuntu20.04-x86_64\r\n            ^rocm-cmake@4.5.2%gcc@9.3.0~ipo+ldconfig build_type=Release arch=linux-ubuntu20.04-x86_64\r\n        ^hsa-rocr-dev@4.5.2%gcc@9.3.0+image~ipo+shared build_type=Release patches=71e6851 arch=linux-ubuntu20.04-x86_64\r\n            ^hsakmt-roct@4.5.2%gcc@9.3.0~ipo+shared build_type=Release patches=f926273 arch=linux-ubuntu20.04-x86_64\r\n                ^libdrm@2.4.110%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^docbook-xml@4.5%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^docbook-xsl@1.79.2%gcc@9.3.0 patches=a92c397 arch=linux-ubuntu20.04-x86_64\r\n                    ^libpthread-stubs@0.4%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^meson@0.61.2%gcc@9.3.0 patches=aa6c50d arch=linux-ubuntu20.04-x86_64\r\n                        ^ninja@1.10.2%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                        ^py-pip@21.3.1%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                        ^py-setuptools@59.4.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                            ^py-wheel@0.37.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^numactl@2.0.14%gcc@9.3.0 patches=4e1d78c,62fc8a8,ff37630 arch=linux-ubuntu20.04-x86_64\r\n                    ^autoconf@2.69%gcc@9.3.0 patches=35c4492,7793209,a49dd5b arch=linux-ubuntu20.04-x86_64\r\n                    ^automake@1.16.5%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^xxd-standalone@8.2.1201%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^mesa@21.3.1%gcc@9.3.0+glx~llvm+opengl~opengles+osmesa~strip buildtype=debugoptimized default_library=shared patches=ada85be arch=linux-ubuntu20.04-x86_64\r\n            ^bison@3.8.2%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^flex@2.6.3%gcc@9.3.0+lex~nls arch=linux-ubuntu20.04-x86_64\r\n                ^findutils@4.8.0%gcc@9.3.0 patches=440b954 arch=linux-ubuntu20.04-x86_64\r\n            ^glproto@1.4.17%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^libunwind@1.5.0%gcc@9.3.0~block_signals~conservative_checks~cxx_exceptions~debug~debug_frame+docs+pic+tests+weak_backtrace+xz~zlib components=none libs=shared,static arch=linux-ubuntu20.04-x86_64\r\n            ^libx11@1.7.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^inputproto@2.3.2%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^kbproto@1.0.7%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^libxcb@1.14%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^libxau@1.0.8%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                        ^xproto@7.0.31%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^libxdmcp@1.1.2%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^xcb-proto@1.14.1%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^xextproto@7.3.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^xtrans@1.3.5%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^libxext@1.3.3%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^libxt@1.1.5%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^libice@1.0.9%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^libsm@1.2.3%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^py-mako@1.1.6%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^py-markupsafe@2.0.1%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^xrandr@1.5.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^libxrandr@1.5.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^libxrender@0.9.10%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                        ^renderproto@0.11.1%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^randrproto@1.5.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^rocminfo@4.5.2%gcc@9.3.0~ipo build_type=Release arch=linux-ubuntu20.04-x86_64\r\n        ^roctracer-dev-api@4.5.2%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n    ^rocblas@4.5.2%gcc@9.3.0~ipo build_type=Release patches=6a52b28 tensile_architecture=all arch=linux-ubuntu20.04-x86_64\r\n        ^msgpack-c@3.1.1%gcc@9.3.0~ipo build_type=RelWithDebInfo arch=linux-ubuntu20.04-x86_64\r\n        ^perl-file-which@1.22%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^py-msgpack@1.0.3%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^py-pyyaml@6.0%gcc@9.3.0+libyaml arch=linux-ubuntu20.04-x86_64\r\n            ^libyaml@0.2.5%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^py-cython@0.29.24%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^py-virtualenv@20.10.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^py-backports-entry-points-selectable@1.1.1%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^py-setuptools-scm@6.3.2%gcc@9.3.0+toml arch=linux-ubuntu20.04-x86_64\r\n                    ^py-packaging@21.3%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                        ^py-pyparsing@3.0.6%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^py-tomli@1.2.2%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^py-distlib@0.3.4%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^py-filelock@3.5.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^py-platformdirs@2.4.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n            ^py-six@1.16.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^rocm-smi-lib@4.5.2%gcc@9.3.0~ipo+shared build_type=Release patches=8bc40cc arch=linux-ubuntu20.04-x86_64\r\n```\r\n\r\nReproducer (here using Docker image `ecpe4s/ubuntu20.04-runner-x86_64:2022-02-01`)\r\n```\r\n$> spack mirror add E4S https://cache.e4s.io\r\n$> spack buildcache keys -it\r\n$> spack install --cache-only --include-build-deps --only dependencies -f ./rocsolver.spec.json\r\n\r\n$> spack install --no-cache --only package -f ./rocsolver.spec.json\r\n...\r\n==> Installing rocsolver-4.5.2-bglnzqutgp7hj52chfekrwu3i5ivpp6c\r\n==> Fetching https://mirror.spack.io/_source-cache/archive/46/4639322bd1e77fedfdeb9032633bde6211a0b1cc16a612db7754f873f18a492f.tar.gz\r\n==> No patches needed for rocsolver\r\n==> rocsolver: Executing phase: 'cmake'\r\n==> rocsolver: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16'\r\n...\r\n     4814    In file included from /tmp/root/spack-stage/spack-stage-rocsolver-4.5.2-bglnzqutgp7hj52chfekrwu3i5ivpp6c/spack-src/library/src/auxiliary/rocauxiliary_orgtr_ungtr.cpp:5:\r\n     4815    In file included from /tmp/root/spack-stage/spack-stage-rocsolver-4.5.2-bglnzqutgp7hj52chfekrwu3i5ivpp6c/spack-src/library/src/auxiliary/rocauxiliary_orgtr_ungtr.hpp:12:\r\n     4816    In file included from /tmp/root/spack-stage/spack-stage-rocsolver-4.5.2-bglnzqutgp7hj52chfekrwu3i5ivpp6c/spack-src/library/src/auxiliary/rocauxiliary_orgql_ungql.hpp:12:\r\n     4817    In file included from /tmp/root/spack-stage/spack-stage-rocsolver-4.5.2-bglnzqutgp7hj52chfekrwu3i5ivpp6c/spack-src/library/src/auxiliary/rocauxiliary_larfb.hpp:12:\r\n     4818    In file included from /tmp/root/spack-stage/spack-stage-rocsolver-4.5.2-bglnzqutgp7hj52chfekrwu3i5ivpp6c/spack-src/library/src/include/rocblas.hpp:15:\r\n     4819    In file included from /tmp/root/spack-stage/spack-stage-rocsolver-4.5.2-bglnzqutgp7hj52chfekrwu3i5ivpp6c/spack-src/library/src/include/rocsolver_logger.hpp:9:\r\n  >> 4820    /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/fmt-8.1.1-mswoitr42xb2xrytqwp2jgl535d22dcg/include/fmt/ranges.h:737:21: error: no matching member function for call to 'format'\r\n     4821                       .format(std::get<sizeof...(T) - N>(value.tuple), ctx);\r\n     4822                       ~^~~~~~\r\n     4823    /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/fmt-8.1.1-mswoitr42xb2xrytqwp2jgl535d22dcg/include/fmt/ranges.h:741:14: note: in instantiation of function template specialization\r\n              'fmt::formatter<fmt::tuple_join_view<char, rocsolver_logvalue<const char *> &, rocsolver_logvalue<rocblas_fill_> &, rocsolver_logvalue<const char *> &, rocsolver_logvalue<int> &, ro\r\n             csolver_logvalue<const char *> &, rocsolver_logvalue<int> &>>::do_format<fmt::basic_format_context<fmt::appender, char>, 1>' requested here\r\n     4824          return do_format(value, ctx, std::integral_constant<size_t, N - 1>());\r\n     4825                 ^\r\n     4826    /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/fmt-8.1.1-mswoitr42xb2xrytqwp2jgl535d22dcg/include/fmt/ranges.h:741:14: note: in instantiation of function template specialization\r\n              'fmt::formatter<fmt::tuple_join_view<char, rocsolver_logvalue<const char *> &, rocsolver_logvalue<rocblas_fill_> &, rocsolver_logvalue<const char *> &, rocsolver_logvalue<int> &, ro\r\n             csolver_logvalue<const char *> &, rocsolver_logvalue<int> &>>::do_format<fmt::basic_format_context<fmt::appender, char>, 2>' requested here\r\n\r\n     ...\r\n\r\n     4849        return rocsolver_orgtr_ungtr_impl<float>(handle, uplo, n, A, lda, ipiv);\r\n     4850               ^\r\n     4851    /tmp/root/spack-stage/spack-stage-rocsolver-4.5.2-bglnzqutgp7hj52chfekrwu3i5ivpp6c/spack-src/library/src/include/rocsolver_logvalue.hpp:40:10: note: candidate function template not v\r\n             iable: 'this' argument has type 'const __tuple_element_t<5UL, tuple<fmt::formatter<rocsolver_logvalue<const char *>>, fmt::formatter<rocsolver_logvalue<rocblas_fill>>, fmt::formatter\r\n             <rocsolver_logvalue<const char *>>, fmt::formatter<rocsolver_logvalue<int>>, fmt::formatter<rocsolver_logvalue<const char *>>, fmt::formatter<rocsolver_logvalue<int>>>>' (aka 'const\r\n             fmt::formatter<rocsolver_logvalue<int>>'), but method is not marked const\r\n     4852        auto format(rocsolver_logvalue<T> wrapper, FormatCtx& ctx)\r\n     4853             ^\r\n     4854    6 errors generated when compiling for gfx906.\r\n  >> 4855    make[2]: *** [library/src/CMakeFiles/rocsolver.dir/build.make:303: library/src/CMakeFiles/rocsolver.dir/auxiliary/rocauxiliary_orgtr_ungtr.cpp.o] Error 1\r\n     4856    make[2]: Leaving directory '/tmp/root/spack-stage/spack-stage-rocsolver-4.5.2-bglnzqutgp7hj52chfekrwu3i5ivpp6c/spack-build-bglnzqu'\r\n  >> 4857    make[1]: *** [CMakeFiles/Makefile2:134: library/src/CMakeFiles/rocsolver.dir/all] Error 2\r\n     4858    make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-rocsolver-4.5.2-bglnzqutgp7hj52chfekrwu3i5ivpp6c/spack-build-bglnzqu'\r\n  >> 4859    make: *** [Makefile:159: all] Error 2\r\n```\n\n### Error message\n\n<details><summary>Error message</summary><pre>\r\n... see above\r\n</pre></details>\r\n\n\n### Information on your system\n\n* **Spack:** 0.17.1-1474-3d29e0d641\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-zen2\r\n* **Concretizer:** clingo\n\n### Additional information\n\n[spack-build-env.txt](https://github.com/spack/spack/files/8200931/spack-build-env.txt)\r\n[spack-build-out.txt](https://github.com/spack/spack/files/8200932/spack-build-out.txt)\r\n\r\n@arjun-raj-kuppala @haampie @srekolam \n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "eugeneswalker",
    "url": "https://api.github.com/repos/spack/spack/issues/29390",
    "updated_at": "2022-03-08 01:58:42",
    "created_at": "2022-03-07 21:35:59",
    "closed_at": "2022-03-08 01:58:42",
    "state": "closed",
    "title": "rocsolver@4.5.2 ^fmt@8.1.0:8.1.1 build fails: fmt/ranges.h: error: no matching member function for call to 'format'",
    "number": 29390,
    "milestone": null,
    "labels": [
        "build-error",
        "e4s",
        "ROCm/hip"
    ],
    "id": 1161950579,
    "html_url": "https://github.com/spack/spack/issues/29390",
    "assignees": [],
    "comments": 0
}