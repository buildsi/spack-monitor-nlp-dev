{
    "body": "### freetype, tcl, tk required during cmake phase\r\nOpencascade depends on freetype, tcl, tk, per [dox/overview/overview.md](http://git.dev.opencascade.org/gitweb/?p=occt.git;a=blob;f=dox/overview/overview.md;h=8115c900737b27bb72f01f37916f16d2ea8b994d;hb=33d9a6fa21ca4fa711da7066655aa2ba854545ee#l217).\r\n\r\nOpencascade is pretty good at finding dependencies without specifying dirs, but attempting to install on a clean spack build container ([Dockerfile](https://github.com/eic/eic-spack/blob/master/docker/ubuntu18.04/Dockerfile)) with\r\n```\r\ndocker run --rm -it electronioncollider/spack-builder:ubuntu18.04 bash -c \"spack install opencascade\"\r\n```\r\nfails with:\r\n```\r\n==> Error: Failed to install opencascade due to ChildError: ProcessError: Command exited with status 1:\r\n    'cmake' '-G' 'Unix Makefiles' '-DCMAKE_INSTALL_PREFIX:STRING=/cvmfs/eic.opensciencegrid.org/packages/opencascade/7.4.0/linux-ubuntu18.04-x86_64-gcc-7.5.0-4wogqkmmaqskveg43xt4c6gv6fcbreaq' '-DCMAKE_BUILD_TYPE:STRING=RelWithDebInfo' '-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON' '-DCMAKE_INSTALL_RPATH_USE_LINK_PATH:BOOL=OFF' '-DCMAKE_INSTALL_RPATH:STRING=/cvmfs/eic.opensciencegrid.org/packages/opencascade/7.4.0/linux-ubuntu18.04-x86_64-gcc-7.5.0-4wogqkmmaqskveg43xt4c6gv6fcbreaq/lib;/cvmfs/eic.opensciencegrid.org/packages/opencascade/7.4.0/linux-ubuntu18.04-x86_64-gcc-7.5.0-4wogqkmmaqskveg43xt4c6gv6fcbreaq/lib64' '-DCMAKE_PREFIX_PATH:STRING=/cvmfs/eic.opensciencegrid.org/packages/cmake/3.17.3/linux-ubuntu18.04-x86_64-gcc-7.5.0-thpwguiiywo7hewgnm76t7r6w53mt6cy' '-DUSE_TBB=OFF' '-DUSE_VTK=OFF' '-DUSE_FREEIMAGE=OFF' '-DUSE_RAPIDJSON=OFF' '/tmp/root/spack-stage/spack-stage-opencascade-7.4.0-4wogqkmmaqskveg43xt4c6gv6fcbreaq/spack-src'\r\n1 error found in build log:\r\n     46    This warning is for project developers.  Use -Wno-dev to suppress it.\r\n     47    \r\n     48    -- Could NOT find Tclsh (missing: TCL_TCLSH)\r\n     49    -- Info: Freetype is used by OCCT\r\n     50    -- Could NOT find Freetype (missing: FREETYPE_LIBRARY FREETYPE_INCLUDE_DIRS)\r\n     51    -- Info: TKIVtk and TKIVtkDraw toolkits excluded due to VTK usage is disabled\r\n  >> 52    CMake Error at CMakeLists.txt:726 (message):\r\n     53      Could not find headers of used third-party products:\r\n     54      3RDPARTY_TCL_INCLUDE_DIR 3RDPARTY_TK_INCLUDE_DIR\r\n     55      3RDPARTY_FREETYPE_INCLUDE_DIR_ft2build\r\n     56      3RDPARTY_FREETYPE_INCLUDE_DIR_freetype2\r\n     57    \r\n     58    \r\n```\r\n\r\nAlternative solutions explored:\r\n- Turning off with `-DUSE_TCL=OFF` or `-DUSE_FREETYPE=OFF` has no effect (those were just extrapolations based on their use for other external libraries; there's no documentation that would indicate that they should work).\r\n- Just depending on freetype, tcl is not sufficient (tk has many more dependencies through libx11 and libxft so it was a worthwhile attempt).\r\n\r\n### gl required during build phase\r\nOpencascade depends on opengl, per [dox/overview/overview.md](http://git.dev.opencascade.org/gitweb/?p=occt.git;a=blob;f=dox/overview/overview.md;h=8115c900737b27bb72f01f37916f16d2ea8b994d;hb=33d9a6fa21ca4fa711da7066655aa2ba854545ee#l217) as well, which (unfortunately) means a whole lot else as well (in particular mesa pulls in llvm by default).\r\n\r\nEven after including freetype, tcl, tk it appears that opencascade gets past the cmake phase, but fails in the build with a missing header `GL/glx.h`:\r\n```\r\n==> Error: Failed to install opencascade due to ChildError: ProcessError: Command exited with status 2:\r\n    'make' '-j4'\r\n4 errors found in build log:\r\n     4670    [ 31%] Building CXX object src/TKService/CMakeFiles/TKService.dir/__/Aspect/Aspect_DisplayConnection.cxx.o\r\n     4671    cd /tmp/root/spack-stage/spack-stage-opencascade-7.4.0-ijosajraihg3shwjclrrdd4phg53nzoq/spack-build/src/TKService && /spack/lib/spack/env/gcc/g++  -DOCC_CONVERT_SIGNALS -DTKService_EXPORTS -I/cvmfs/eic.opensciencegrid.org/p\r\n             ackages/tcl/8.6.8/linux-ubuntu18.04-x86_64-gcc-7.5.0-aszidznovy2kcbefk4dexwf5mlrjbbcw/include -I/cvmfs/eic.opensciencegrid.org/packages/tk/8.6.8/linux-ubuntu18.04-x86_64-gcc-7.5.0-sw4jc7z36ma3zdb2wbti7omhtrrqdqij/include -I\r\n             /cvmfs/eic.opensciencegrid.org/packages/freetype/2.10.1/linux-ubuntu18.04-x86_64-gcc-7.5.0-kv5tk7sbjvjgemjxxa7xel6cqvn2356x/include/freetype2 -I/tmp/root/spack-stage/spack-stage-opencascade-7.4.0-ijosajraihg3shwjclrrdd4phg5\r\n             3nzoq/spack-build/include/opencascade  -std=c++0x  -fexceptions -fPIC -Wall -Wextra -O2 -g -DNDEBUG -fPIC   -o CMakeFiles/TKService.dir/__/Aspect/Aspect_DisplayConnection.cxx.o -c /tmp/root/spack-stage/spack-stage-opencasca\r\n             de-7.4.0-ijosajraihg3shwjclrrdd4phg53nzoq/spack-src/src/Aspect/Aspect_DisplayConnection.cxx\r\n     4672    In file included from /tmp/root/spack-stage/spack-stage-opencascade-7.4.0-ijosajraihg3shwjclrrdd4phg53nzoq/spack-build/include/opencascade/InterfaceGraphic.hxx:1:0,\r\n     4673                     from /tmp/root/spack-stage/spack-stage-opencascade-7.4.0-ijosajraihg3shwjclrrdd4phg53nzoq/spack-src/src/Aspect/Aspect_DisplayConnection.hxx:24,\r\n     4674                     from /tmp/root/spack-stage/spack-stage-opencascade-7.4.0-ijosajraihg3shwjclrrdd4phg53nzoq/spack-build/include/opencascade/Aspect_DisplayConnection.hxx:1,\r\n     4675                     from /tmp/root/spack-stage/spack-stage-opencascade-7.4.0-ijosajraihg3shwjclrrdd4phg53nzoq/spack-src/src/Aspect/Aspect_DisplayConnection.cxx:14:\r\n  >> 4676    /tmp/root/spack-stage/spack-stage-opencascade-7.4.0-ijosajraihg3shwjclrrdd4phg53nzoq/spack-src/src/InterfaceGraphic/InterfaceGraphic.hxx:41:10: fatal error: GL/glx.h: No such file or directory\r\n     4677     #include <GL/glx.h>\r\n     4678              ^~~~~~~~~~\r\n     4679    compilation terminated.\r\n     4680    src/TKService/CMakeFiles/TKService.dir/build.make:111: recipe for target 'src/TKService/CMakeFiles/TKService.dir/__/Aspect/Aspect_DisplayConnection.cxx.o' failed\r\n```\r\n\r\n### new version available\r\nTaking advantage of this PR to add the newest patch release 7.4.0p1, which required a new url_for_version().\r\n\r\n\r\nNo maintainer listed, original package by @bfovet .",
    "user": "wdconinc",
    "url": "https://api.github.com/repos/spack/spack/issues/17357",
    "updated_at": "2020-08-29 16:28:18",
    "created_at": "2020-07-02 18:59:31",
    "closed_at": "2020-07-05 20:25:39",
    "state": "closed",
    "title": "[opencascade] depends_on freetype, tcl, tk, gl",
    "number": 17357,
    "milestone": null,
    "labels": [
        "new-version",
        "dependencies"
    ],
    "id": 650142986,
    "html_url": "https://github.com/spack/spack/pull/17357",
    "assignees": [],
    "comments": 0
}