{
    "body": "Modifications:\r\n- [x] Stacktraces are shown only if debug mode is active\r\n\r\n\r\nWith this environment:\r\n```yaml\r\nspack:\r\n  specs:\r\n  - zlib\r\n  - hdf5+bar\r\n```\r\nand an artificially introduced conflict:\r\n```diff\r\n--- a/var/spack/repos/builtin/packages/zlib/package.py\r\n+++ b/var/spack/repos/builtin/packages/zlib/package.py\r\n@@ -29,7 +29,8 @@ class Zlib(Package):\r\n             description='Enable -O2 for a more optimized lib')\r\n \r\n     patch('w_patch.patch', when=\"@1.2.11%cce\")\r\n-\r\n+    conflicts('%gcc')\r\n+\r\n     @property\r\n     def libs(self):\r\n         shared = '+shared' in self.spec\r\n\r\n```\r\nwe get the following output:\r\n\r\n<details>\r\n\r\n<summary>After the PR</summary>\r\n\r\n```console\r\n$ spack -e . concretize -f\r\n==> Starting concretization pool with 2 processes\r\n==> Error: errors occurred during concretization of the environment:\r\nzlib does not satisfy unknown\r\ntrying to set variant \"bar\" in package \"hdf5\", but the package has no such variant [happened during concretization of hdf5+bar]\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n\r\n<summary>Before the PR</summary>\r\n\r\n```console\r\n$ spack -e . concretize -f\r\n==> Starting concretization pool with 2 processes\r\n==> Error: errors occurred in worker processes:\r\n[PID=30631] Traceback (most recent call last):\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/util/parallel.py\", line 50, in __call__\r\n    value = self.func(*args, **kwargs)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/environment/environment.py\", line 2021, in _concretize_task\r\n    return _concretize_from_constraints(spec_constraints, tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/environment/environment.py\", line 1999, in _concretize_from_constraints\r\n    return s.concretized(tests=tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/spec.py\", line 2678, in concretized\r\n    clone.concretize(tests=tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/spec.py\", line 2640, in concretize\r\n    self._new_concretize(tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/spec.py\", line 2613, in _new_concretize\r\n    raise spack.error.UnsatisfiableSpecError(\r\nspack.error.UnsatisfiableSpecError: zlib does not satisfy unknown\r\n\r\n[PID=30632] Traceback (most recent call last):\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/util/parallel.py\", line 50, in __call__\r\n    value = self.func(*args, **kwargs)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/environment/environment.py\", line 2021, in _concretize_task\r\n    return _concretize_from_constraints(spec_constraints, tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/environment/environment.py\", line 2014, in _concretize_from_constraints\r\n    raise e\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/environment/environment.py\", line 1999, in _concretize_from_constraints\r\n    return s.concretized(tests=tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/spec.py\", line 2678, in concretized\r\n    clone.concretize(tests=tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/spec.py\", line 2640, in concretize\r\n    self._new_concretize(tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/spec.py\", line 2610, in _new_concretize\r\n    result = spack.solver.asp.solve([self], tests=tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/solver/asp.py\", line 1688, in solve\r\n    spack.spec.Spec.ensure_valid_variants(s)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/spec.py\", line 3066, in ensure_valid_variants\r\n    raise vt.UnknownVariantError(spec, not_existing)\r\nspack.variant.UnknownVariantError: trying to set variant \"bar\" in package \"hdf5\", but the package has no such variant [happened during concretization of hdf5+bar]\r\n\r\n[PARENT PROCESS]:\r\n  File \"/home/culpo/PycharmProjects/spack/bin/spack\", line 100, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/main.py\", line 816, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/main.py\", line 529, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/cmd/concretize.py\", line 37, in concretize\r\n    concretized_specs = env.concretize(force=args.force, tests=tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/environment/environment.py\", line 1057, in concretize\r\n    return self._concretize_separately(tests=tests)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/environment/environment.py\", line 1163, in _concretize_separately\r\n    concretized_root_specs = spack.util.parallel.parallel_map(\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/util/parallel.py\", line 128, in parallel_map\r\n    raise_if_errors(*results)\r\n  File \"/home/culpo/PycharmProjects/spack/lib/spack/spack/util/parallel.py\", line 76, in raise_if_errors\r\n    traceback.print_stack(file=err_stream)\r\n```\r\n\r\n</details>\r\n\r\nThe error message for specs which are unsat will be improved further with #26719 ",
    "user": "alalazo",
    "url": "https://api.github.com/repos/spack/spack/issues/26843",
    "updated_at": "2021-10-20 12:34:50",
    "created_at": "2021-10-20 04:54:01",
    "closed_at": "2021-10-20 11:30:07",
    "state": "closed",
    "title": "Reduce verbosity of error messages when concretizing environments",
    "number": 26843,
    "milestone": null,
    "labels": [
        "environments",
        "utilities"
    ],
    "id": 1030972750,
    "html_url": "https://github.com/spack/spack/pull/26843",
    "assignees": [],
    "comments": 1
}