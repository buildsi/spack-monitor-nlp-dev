{
    "body": "### Steps to reproduce the issue\n\n```console\r\n$ spack install ucx@1.10.1+cuda+gdrcopy\r\n```\r\nWhen I tried to build UCX 1.10.1 with GDRCopy 2.2, I ran into the following error:\r\n\r\n```\r\nrocm_gdr_ep.c: In function 'uct_rocm_gdr_ep_put_short':\r\nrocm_gdr_ep.c:47:15: error: implicit declaration of function 'gdr_copy_to_bar'; did you mean 'gdr_copy_to_mapping'? [-Werror=implicit-function-declaration]\r\n   47 |         ret = gdr_copy_to_bar((void *)remote_addr, buffer, length);\r\n      |               ^~~~~~~~~~~~~~~\r\n      |               gdr_copy_to_mapping\r\nrocm_gdr_ep.c:47:15: error: nested extern declaration of 'gdr_copy_to_bar' [-Werror=nested-externs]\r\nrocm_gdr_ep.c: In function 'uct_rocm_gdr_ep_get_short':\r\nrocm_gdr_ep.c:67:15: error: implicit declaration of function 'gdr_copy_from_bar'; did you mean 'gdr_copy_from_mapping'? [-Werror=implicit-function-declaration]\r\n   67 |         ret = gdr_copy_from_bar(buffer, (void *)remote_addr, length);\r\n      |               ^~~~~~~~~~~~~~~~~\r\n      |               gdr_copy_from_mapping\r\nrocm_gdr_ep.c:67:15: error: nested extern declaration of 'gdr_copy_from_bar' [-Werror=nested-externs]\r\ncc1: all warnings being treated as errors\r\nmake[4]: *** [Makefile:622: libuct_rocm_gdr_la-rocm_gdr_ep.lo] Error 1\r\nmake[4]: *** Waiting for unfinished jobs....\r\n```\r\n\r\nThe issues seems to come from incompatibility of `rocm_gdr` with newer versions of GDRCopy (> 2.0, I presume) which has been discussed [here](https://github.com/openucx/ucx/issues/4489). I could fix it by adding a new variant `rocm` to UCX package and setting the default to `False`.\r\n\r\nCurrently, Spack does not `rocm` as a variant and probably adding this variant and setting to `False` is a solution?\n\n### Information on your system\n\n* **Spack:** 0.16.3-5026-94a9733822\r\n* **Python:** 3.7.3\r\n* **Platform:** linux-debian10-broadwell\r\n* **Concretizer:** clingo\n\n### Additional information\n\n```\r\n==> ucx: Executing phase: 'autoreconf'\r\n==> ucx: Executing phase: 'configure'\r\n==> [2021-10-27-13:02:21.855882] 'contrib/configure-release' '--prefix=/home/mpaipuri/spack/opt/spack/linux-debian10-broadwell/gcc-9.3.0/ucx-1.10.1-4ghx7jadjpm6sgy6b4ingjkrpjors2sa' '--enable-mt' '--enable-cma' '--disable-params-check' '--with-avx' '--enable-optimizations' '--disable-assertions' '--disable-logging' '--with-pic' '--with-rc' '--with-ud' '--with-dc' '--with-mlx5-dv' '--with-ib-hw-tm' '--without-dm' '--without-cm' '--without-java' '--with-cuda=/home/mpaipuri/spack/opt/spack/linux-debian10-broadwell/gcc-9.3.0/cuda-11.4.0-ngdlgzyygj5tbrjhbdfplywzmbq7gev6' '--with-gdrcopy=/home/mpaipuri/spack/opt/spack/linux-debian10-broadwell/gcc-9.3.0/gdrcopy-2.2-lhghcojywjtsxcr56knumxq6zq7hmp4x' '--without-knem' '--without-xpmem'\r\nchecking for gcc... /home/mpaipuri/spack/lib/spack/env/gcc/gcc\r\nchecking whether the C compiler works... yes\r\nchecking for C compiler default output file name... a.out\r\nchecking for suffix of executables... \r\nchecking whether we are cross compiling... no\r\nchecking for suffix of object files... o\r\nchecking whether we are using the GNU C compiler... yes\r\nchecking whether /home/mpaipuri/spack/lib/spack/env/gcc/gcc accepts -g... yes\r\nchecking for /home/mpaipuri/spack/lib/spack/env/gcc/gcc option to accept ISO C89... none needed\r\nchecking how to run the C preprocessor... /home/mpaipuri/spack/lib/spack/env/gcc/gcc -E\r\nchecking for grep that handles long lines and -e... /usr/bin/grep\r\nchecking for egrep... /usr/bin/grep -E\r\nchecking for ANSI C header files... yes\r\nchecking for sys/types.h... yes\r\nchecking for sys/stat.h... yes\r\nchecking for stdlib.h... yes\r\nchecking for string.h... yes\r\nchecking for memory.h... yes\r\nchecking for strings.h... yes\r\nchecking for inttypes.h... yes\r\nchecking for stdint.h... yes\r\nchecking for unistd.h... yes\r\nchecking minix/config.h usability... no\r\nchecking minix/config.h presence... no\r\nchecking for minix/config.h... no\r\nchecking whether it is safe to define __EXTENSIONS__... yes\r\nchecking for git... yes\r\nchecking for a BSD-compatible install... /usr/bin/install -c\r\nchecking whether build environment is sane... yes\r\nchecking for a thread-safe mkdir -p... /usr/bin/mkdir -p\r\nchecking for gawk... gawk\r\nchecking whether make sets $(MAKE)... yes\r\nchecking for style of include used by make... GNU\r\nchecking whether make supports nested variables... yes\r\nchecking whether UID '14592' is supported by ustar format... yes\r\nchecking whether GID '8000' is supported by ustar format... yes\r\nchecking how to create a ustar tar archive... gnutar\r\nchecking dependency style of /home/mpaipuri/spack/lib/spack/env/gcc/gcc... gcc3\r\nchecking whether make supports nested variables... (cached) yes\r\nchecking whether to enable maintainer-specific portions of Makefiles... no\r\nchecking for gcc... (cached) /home/mpaipuri/spack/lib/spack/env/gcc/gcc\r\nchecking whether we are using the GNU C compiler... (cached) yes\r\nchecking whether /home/mpaipuri/spack/lib/spack/env/gcc/gcc accepts -g... (cached) yes\r\nchecking for /home/mpaipuri/spack/lib/spack/env/gcc/gcc option to accept ISO C89... (cached) none needed\r\nchecking whether we are using the GNU C++ compiler... yes\r\nchecking whether /home/mpaipuri/spack/lib/spack/env/gcc/g++ accepts -g... yes\r\nchecking dependency style of /home/mpaipuri/spack/lib/spack/env/gcc/g++... gcc3\r\nchecking for /home/mpaipuri/spack/lib/spack/env/gcc/gcc option to support OpenMP... -fopenmp\r\nchecking dependency style of /home/mpaipuri/spack/lib/spack/env/gcc/gcc... gcc3\r\nchecking whether ln -s works... yes\r\nchecking for a sed that does not truncate output... /usr/bin/sed\r\nchecking build system type... x86_64-unknown-linux-gnu\r\nchecking host system type... x86_64-unknown-linux-gnu\r\nchecking how to print strings... printf\r\nchecking for a sed that does not truncate output... (cached) /usr/bin/sed\r\nchecking for fgrep... /usr/bin/grep -F\r\nchecking for ld used by /home/mpaipuri/spack/lib/spack/env/gcc/gcc... /home/mpaipuri/spack/lib/spack/env/ld\r\nchecking if the linker (/home/mpaipuri/spack/lib/spack/env/ld) is GNU ld... yes\r\nchecking for BSD- or MS-compatible name lister (nm)... /usr/bin/nm -B\r\nchecking the name lister (/usr/bin/nm -B) interface... BSD nm\r\nchecking the maximum length of command line arguments... 1572864\r\nchecking whether the shell understands some XSI constructs... yes\r\nchecking whether the shell understands \"+=\"... yes\r\nchecking how to convert x86_64-unknown-linux-gnu file names to x86_64-unknown-linux-gnu format... func_convert_file_noop\r\nchecking how to convert x86_64-unknown-linux-gnu file names to toolchain format... func_convert_file_noop\r\nchecking for /home/mpaipuri/spack/lib/spack/env/ld option to reload object files... -r\r\nchecking for objdump... objdump\r\nchecking how to recognize dependent libraries... pass_all\r\nchecking for dlltool... no\r\nchecking how to associate runtime and link libraries... printf %s\\n\r\nchecking for ar... ar\r\nchecking for archiver @FILE support... @\r\nchecking for strip... strip\r\nchecking for ranlib... ranlib\r\nchecking command to parse /usr/bin/nm -B output from /home/mpaipuri/spack/lib/spack/env/gcc/gcc object... ok\r\nchecking for sysroot... no\r\nchecking for mt... mt\r\nchecking if mt is a manifest tool... no\r\nchecking for dlfcn.h... yes\r\nchecking for objdir... .libs\r\nchecking if /home/mpaipuri/spack/lib/spack/env/gcc/gcc supports -fno-rtti -fno-exceptions... no\r\nchecking for /home/mpaipuri/spack/lib/spack/env/gcc/gcc option to produce PIC... -fPIC -DPIC\r\nchecking if /home/mpaipuri/spack/lib/spack/env/gcc/gcc PIC flag -fPIC -DPIC works... yes\r\nchecking if /home/mpaipuri/spack/lib/spack/env/gcc/gcc static flag -static works... yes\r\nchecking if /home/mpaipuri/spack/lib/spack/env/gcc/gcc supports -c -o file.o... yes\r\nchecking if /home/mpaipuri/spack/lib/spack/env/gcc/gcc supports -c -o file.o... (cached) yes\r\nchecking whether the /home/mpaipuri/spack/lib/spack/env/gcc/gcc linker (/home/mpaipuri/spack/lib/spack/env/ld -m elf_x86_64) supports shared libraries... yes\r\nchecking whether -lc should be explicitly linked in... no\r\nchecking dynamic linker characteristics... GNU/Linux ld.so\r\nchecking how to hardcode library paths into programs... immediate\r\nchecking whether stripping libraries is possible... yes\r\nchecking if libtool supports shared libraries... yes\r\nchecking whether to build shared libraries... yes\r\nchecking whether to build static libraries... yes\r\nchecking how to run the C++ preprocessor... /home/mpaipuri/spack/lib/spack/env/gcc/g++ -E\r\nchecking for ld used by /home/mpaipuri/spack/lib/spack/env/gcc/g++... /home/mpaipuri/spack/lib/spack/env/ld -m elf_x86_64\r\nchecking if the linker (/home/mpaipuri/spack/lib/spack/env/ld -m elf_x86_64) is GNU ld... yes\r\nchecking whether the /home/mpaipuri/spack/lib/spack/env/gcc/g++ linker (/home/mpaipuri/spack/lib/spack/env/ld -m elf_x86_64) supports shared libraries... yes\r\nchecking for /home/mpaipuri/spack/lib/spack/env/gcc/g++ option to produce PIC... -fPIC -DPIC\r\nchecking if /home/mpaipuri/spack/lib/spack/env/gcc/g++ PIC flag -fPIC -DPIC works... yes\r\nchecking if /home/mpaipuri/spack/lib/spack/env/gcc/g++ static flag -static works... yes\r\nchecking if /home/mpaipuri/spack/lib/spack/env/gcc/g++ supports -c -o file.o... yes\r\nchecking if /home/mpaipuri/spack/lib/spack/env/gcc/g++ supports -c -o file.o... (cached) yes\r\nchecking whether the /home/mpaipuri/spack/lib/spack/env/gcc/g++ linker (/home/mpaipuri/spack/lib/spack/env/ld -m elf_x86_64) supports shared libraries... yes\r\nchecking dynamic linker characteristics... (cached) GNU/Linux ld.so\r\nchecking how to hardcode library paths into programs... immediate\r\nchecking for ANSI C header files... (cached) yes\r\nchecking for cos in -lm... yes\r\nchecking for C/C++ restrict keyword... __restrict\r\nchecking whether strerror_r is declared... yes\r\nchecking for strerror_r... yes\r\nchecking whether strerror_r returns char *... yes\r\nchecking for pkg-config... /home/mpaipuri/spack/opt/spack/linux-debian10-broadwell/gcc-9.3.0/pkgconf-1.8.0-yndsolnup343y4rx3hncu5xseyt5ppg6/bin/pkg-config\r\nchecking if ln -s supports --relative... yes\r\nchecking for dot... yes\r\nchecking for doxygen... no\r\nconfigure: WARNING: doxygen not found - will not generate any doxygen documentation\r\n/tmp/mpaipuri/spack-stage/spack-stage-ucx-1.10.1-4ghx7jadjpm6sgy6b4ingjkrpjors2sa/spack-src/contrib/../configure: line 13896: doxygen: command not found\r\nconfigure: WARNING: doxygen version  is bad. Required version: 1.8.6 and above\r\nchecking for perl... /usr/bin/perl\r\nchecking for size_t... yes\r\nchecking compiler flag -diag-error 10006... no\r\nchecking whether -diag-disable 1478 overrides deprecated declarations... no\r\nchecking whether -Wno-deprecated-declarations overrides deprecated declarations... yes\r\nchecking compiler flag -diag-disable 269... no\r\nchecking compiler flag -fmax-type-align=16... no\r\nchecking -mavx... yes\r\nconfigure: Detected CPU implementation: \r\nconfigure: Detected CPU architecture: \r\nconfigure: Detected CPU variant: \r\nconfigure: Detected CPU part: \r\nchecking for __attribute__(optimize)... 1\r\nchecking compiler flag -funwind-tables... yes\r\nconfigure: compiling with unwind tables\r\nchecking if /home/mpaipuri/spack/lib/spack/env/gcc/g++ works... yes\r\nchecking c++11 support... yes\r\nchecking gnu++11 support... yes\r\nchecking whether _GLIBCXX_NOTHROW is declared... yes\r\nchecking compiler flag --display_error_number... no\r\nchecking compiler flag --diag_suppress 181... no\r\nchecking compiler flag --diag_suppress 381... no\r\nchecking compiler flag --diag_suppress 1215... no\r\nchecking compiler flag --diag_suppress 1901... no\r\nchecking compiler flag --diag_suppress 1902... no\r\nchecking compiler flag -pedantic... yes\r\nchecking compiler flag -Wno-missing-field-initializers... yes\r\nchecking compiler flag -Wno-unused-parameter... yes\r\nchecking compiler flag -Wno-unused-label... yes\r\nchecking compiler flag -Wno-long-long... yes\r\nchecking compiler flag -Wno-endif-labels... yes\r\nchecking compiler flag -Wno-sign-compare... yes\r\nchecking compiler flag -Wno-multichar... yes\r\nchecking compiler flag -Wno-deprecated-declarations... yes\r\nchecking compiler flag -Winvalid-pch... yes\r\nchecking compiler flag -Wno-pointer-sign... yes\r\nchecking compiler flag -Werror-implicit-function-declaration... yes\r\nchecking compiler flag -Wno-format-zero-length... yes\r\nchecking compiler flag -Wnested-externs... yes\r\nchecking compiler flag -Wshadow... yes\r\nchecking compiler flag -Werror=declaration-after-statement... yes\r\nchecking for working alloca.h... yes\r\nchecking for alloca... yes\r\nchecking for shm_open in -lrt... yes\r\nchecking for timer_create in -lrt... yes\r\nchecking libgen.h usability... yes\r\nchecking libgen.h presence... yes\r\nchecking for libgen.h... yes\r\nchecking whether asprintf is declared... yes\r\nchecking whether basename is declared... yes\r\nchecking whether fmemopen is declared... yes\r\nchecking sys/cpuset.h usability... no\r\nchecking sys/cpuset.h presence... no\r\nchecking for sys/cpuset.h... no\r\nchecking whether CPU_ZERO is declared... yes\r\nchecking whether CPU_ISSET is declared... yes\r\nchecking for cpu_set_t... yes\r\nchecking for cpuset_t... no\r\nchecking for sighandler_t... yes\r\nchecking for __sighandler_t... yes\r\nchecking pthread_np.h usability... no\r\nchecking pthread_np.h presence... no\r\nchecking for pthread_np.h... no\r\nchecking for library containing pthread_create... -lpthread\r\nchecking for library containing pthread_atfork... none required\r\nchecking for clearenv... yes\r\nchecking for malloc_trim... yes\r\nchecking for memalign... yes\r\nchecking for posix_memalign... yes\r\nchecking for mremap... yes\r\nchecking for sched_setaffinity... yes\r\nchecking for sched_getaffinity... yes\r\nchecking for cpuset_setaffinity... no\r\nchecking for cpuset_getaffinity... no\r\nchecking whether F_SETOWN_EX is declared... yes\r\nchecking whether ethtool_cmd_speed is declared... yes\r\nchecking whether SPEED_UNKNOWN is declared... yes\r\nchecking whether __ppc_get_timebase_freq is declared... no\r\nchecking sys/platform/ppc.h usability... no\r\nchecking sys/platform/ppc.h presence... no\r\nchecking for sys/platform/ppc.h... no\r\nchecking for using Google C++ Testing Framework... no\r\nchecking numa.h usability... yes\r\nchecking numa.h presence... yes\r\nchecking for numa.h... yes\r\nchecking numaif.h usability... yes\r\nchecking numaif.h presence... yes\r\nchecking for numaif.h... yes\r\nchecking for mbind in -lnuma... yes\r\nchecking for struct bitmask... yes\r\nchecking malloc hooks... yes\r\nchecking sys/capability.h usability... no\r\nchecking sys/capability.h presence... no\r\nchecking for sys/capability.h... no\r\nchecking whether PR_SET_PTRACER is declared... yes\r\nchecking for struct in6_addr.s6_addr32... yes\r\nchecking for struct in6_addr.__u6_addr.__u6_addr32... no\r\nchecking for struct iphdr.daddr.s_addr... no\r\nchecking for struct ip.ip_dst.s_addr... yes\r\nchecking for struct sigevent._sigev_un._tid... yes\r\nchecking for struct sigevent.sigev_notify_thread_id... no\r\nchecking for struct sigaction.sa_restorer... yes\r\nchecking sys/epoll.h usability... yes\r\nchecking sys/epoll.h presence... yes\r\nchecking for sys/epoll.h... yes\r\nchecking sys/eventfd.h usability... yes\r\nchecking sys/eventfd.h presence... yes\r\nchecking for sys/eventfd.h... yes\r\nchecking sys/event.h usability... no\r\nchecking sys/event.h presence... no\r\nchecking for sys/event.h... no\r\nchecking sys/thr.h usability... no\r\nchecking sys/thr.h presence... no\r\nchecking for sys/thr.h... no\r\nchecking malloc.h usability... yes\r\nchecking malloc.h presence... yes\r\nchecking for malloc.h... yes\r\nchecking malloc_np.h usability... no\r\nchecking malloc_np.h presence... no\r\nchecking for malloc_np.h... no\r\nchecking endian.h, usability... no\r\nchecking endian.h, presence... no\r\nchecking for endian.h,... no\r\nchecking sys/endian.h usability... no\r\nchecking sys/endian.h presence... no\r\nchecking for sys/endian.h... no\r\nchecking linux/mman.h usability... yes\r\nchecking linux/mman.h presence... yes\r\nchecking for linux/mman.h... yes\r\nchecking linux/ip.h usability... yes\r\nchecking linux/ip.h presence... yes\r\nchecking for linux/ip.h... yes\r\nchecking linux/futex.h usability... yes\r\nchecking linux/futex.h presence... yes\r\nchecking for linux/futex.h... yes\r\nchecking for net/ethernet.h... yes\r\nchecking for netinet/ip.h... yes\r\nconfigure: Memory allocator is ptmalloc-2.8.6 version\r\nchecking for malloc_get_state... no\r\nchecking for malloc_set_state... no\r\nchecking whether MADV_FREE is declared... yes\r\nchecking whether MADV_REMOVE is declared... yes\r\nchecking whether POSIX_MADV_DONTNEED is declared... yes\r\nchecking whether SYS_mmap is declared... yes\r\nchecking whether SYS_munmap is declared... yes\r\nchecking whether SYS_mremap is declared... yes\r\nchecking whether SYS_brk is declared... yes\r\nchecking whether SYS_madvise is declared... yes\r\nchecking whether SYS_shmat is declared... yes\r\nchecking whether SYS_shmdt is declared... yes\r\nchecking whether SYS_ipc is declared... no\r\nchecking for __curbrk... yes\r\nchecking for tc_malloc in -ltcmalloc... no\r\nconfigure: WARNING: Java support was explicitly disabled.\r\nchecking cuda.h usability... yes\r\nchecking cuda.h presence... yes\r\nchecking for cuda.h... yes\r\nchecking cuda_runtime.h usability... yes\r\nchecking cuda_runtime.h presence... yes\r\nchecking for cuda_runtime.h... yes\r\nchecking for cuDeviceGetUuid in -lcuda... yes\r\nchecking for cudaGetDeviceCount in -lcudart... yes\r\nconfigure: ROCm path was not specified. Guessing ...\r\nchecking hsa.h usability... yes\r\nchecking hsa.h presence... yes\r\nchecking for hsa.h... yes\r\nchecking hsa_ext_amd.h usability... yes\r\nchecking hsa_ext_amd.h presence... yes\r\nchecking for hsa_ext_amd.h... yes\r\nchecking for hsa_init in -lhsa-runtime64... yes\r\nchecking for hipFree in -lhip_hcc... no\r\nchecking hip_runtime.h usability... yes\r\nchecking hip_runtime.h presence... yes\r\nchecking for hip_runtime.h... yes\r\nchecking for hipFree in -lamdhip64... yes\r\nchecking bfd.h usability... no\r\nchecking bfd.h presence... no\r\nchecking for bfd.h... no\r\nconfigure: WARNING: binutils headers not found\r\nchecking for bfd_openr in -lbfd... no\r\nconfigure: WARNING: bfd library not found\r\nchecking for dlopen in -ldl... yes\r\nchecking for main in -lintl... no\r\nconfigure: WARNING: intl library not found\r\nchecking for struct dl_phdr_info... yes\r\nchecking whether bfd_get_section_flags is declared... no\r\nchecking whether bfd_section_flags is declared... no\r\nchecking whether bfd_get_section_vma is declared... no\r\nchecking whether bfd_section_vma is declared... no\r\nchecking bfd_section_size API version... 2-args API\r\nconfigure: WARNING: detailed backtrace is not supported\r\nchecking __attribute__((constructor))... yes\r\nconfigure: enabling builtin memcpy\r\nchecking for __clear_cache... yes\r\nchecking for __aarch64_sync_cache_range... no\r\nchecking gdrapi.h usability... yes\r\nchecking gdrapi.h presence... yes\r\nchecking for gdrapi.h... yes\r\nchecking for gdr_pin_buffer in -lgdrapi ... yes\r\nchecking whether gdr_copy_to_mapping is declared... yes\r\nconfigure: Compiling with verbs support from /usr\r\nchecking infiniband/verbs.h usability... yes\r\nchecking infiniband/verbs.h presence... yes\r\nchecking for infiniband/verbs.h... yes\r\nchecking for ibv_get_device_list in -libverbs... yes\r\nchecking whether ibv_wc_status_str is declared... yes\r\nchecking whether ibv_event_type_str is declared... yes\r\nchecking whether ibv_query_gid is declared... yes\r\nchecking whether ibv_get_device_name is declared... yes\r\nchecking whether ibv_create_srq is declared... yes\r\nchecking whether ibv_get_async_event is declared... yes\r\nchecking infiniband/verbs_exp.h usability... no\r\nchecking infiniband/verbs_exp.h presence... no\r\nchecking for infiniband/verbs_exp.h... no\r\nchecking for struct ibv_exp_device_attr.exp_device_cap_flags... no\r\nchecking for struct ibv_exp_device_attr.odp_caps... no\r\nchecking for struct ibv_exp_device_attr.odp_caps.per_transport_caps.dc_odp_caps... no\r\nchecking for struct ibv_exp_device_attr.odp_mr_max_size... no\r\nchecking for struct ibv_exp_qp_init_attr.max_inl_recv... no\r\nchecking for struct ibv_async_event.element.dct... no\r\nchecking whether IBV_CREATE_CQ_ATTR_IGNORE_OVERRUN is declared... yes\r\nchecking whether IBV_EXP_CQ_IGNORE_OVERRUN is declared... no\r\nconfigure: Checking for legacy bare-metal support\r\nchecking infiniband/mlx5_hw.h usability... no\r\nchecking infiniband/mlx5_hw.h presence... no\r\nchecking for infiniband/mlx5_hw.h... no\r\nconfigure: Checking for DV bare-metal support\r\nchecking for mlx5dv_query_device in -lmlx5-rdmav2... no\r\nchecking for mlx5dv_query_device in -lmlx5... yes\r\nchecking for infiniband/mlx5dv.h... yes\r\nchecking whether mlx5dv_init_obj is declared... yes\r\nchecking whether mlx5dv_create_qp is declared... yes\r\nchecking whether mlx5dv_is_supported is declared... yes\r\nchecking whether mlx5dv_devx_subscribe_devx_event is declared... yes\r\nchecking whether MLX5DV_CQ_INIT_ATTR_MASK_CQE_SIZE is declared... yes\r\nchecking whether MLX5DV_QP_CREATE_ALLOW_SCATTER_TO_CQE is declared... yes\r\nchecking whether MLX5DV_UAR_ALLOC_TYPE_BF is declared... yes\r\nchecking whether MLX5DV_UAR_ALLOC_TYPE_NC is declared... yes\r\nchecking for struct mlx5dv_cq.cq_uar... yes\r\nchecking whether MLX5DV_OBJ_AH is declared... yes\r\nchecking whether MLX5DV_DCTYPE_DCT is declared... yes\r\nchecking whether ibv_alloc_td is declared... yes\r\nchecking whether ibv_alloc_td is declared... (cached) yes\r\nchecking whether MLX5DV_CONTEXT_FLAGS_DEVX is declared... yes\r\nconfigure: Compiling with mlx5 bare-metal support\r\nchecking whether IBV_LINK_LAYER_INFINIBAND is declared... yes\r\nchecking whether IBV_LINK_LAYER_ETHERNET is declared... yes\r\nchecking whether IBV_EVENT_GID_CHANGE is declared... yes\r\nchecking whether ibv_create_qp_ex is declared... yes\r\nchecking whether ibv_create_srq_ex is declared... yes\r\nchecking whether ibv_query_device_ex is declared... yes\r\nchecking whether IBV_EXP_ACCESS_ALLOCATE_MR is declared... no\r\nchecking whether IBV_EXP_ACCESS_ON_DEMAND is declared... no\r\nchecking whether IBV_EXP_DEVICE_MR_ALLOCATE is declared... no\r\nchecking whether IBV_EXP_WR_NOP is declared... no\r\nchecking whether IBV_EXP_DEVICE_DC_TRANSPORT is declared... no\r\nchecking whether IBV_EXP_ATOMIC_HCA_REPLY_BE is declared... no\r\nchecking whether IBV_EXP_PREFETCH_WRITE_ACCESS is declared... no\r\nchecking whether IBV_EXP_QP_OOO_RW_DATA_PLACEMENT is declared... no\r\nchecking whether IBV_EXP_DCT_OOO_RW_DATA_PLACEMENT is declared... no\r\nchecking whether IBV_EXP_CQ_MODERATION is declared... no\r\nchecking whether IBV_EXP_DEVICE_ATTR_PCI_ATOMIC_CAPS is declared... no\r\nchecking whether ibv_exp_reg_mr is declared... no\r\nchecking whether ibv_exp_create_qp is declared... no\r\nchecking whether ibv_exp_prefetch_mr is declared... no\r\nchecking whether ibv_exp_create_srq is declared... no\r\nchecking whether ibv_exp_setenv is declared... no\r\nchecking whether ibv_exp_query_gid_attr is declared... no\r\nchecking whether ibv_exp_query_device is declared... no\r\nchecking whether ibv_exp_post_send is declared... no\r\nchecking whether IBV_EXP_WR_EXT_MASKED_ATOMIC_CMP_AND_SWP is declared... no\r\nchecking whether IBV_EXP_WR_EXT_MASKED_ATOMIC_FETCH_AND_ADD is declared... no\r\nchecking whether IBV_EXP_QP_INIT_ATTR_ATOMICS_ARG is declared... no\r\nchecking whether IBV_EXP_SEND_EXT_ATOMIC_INLINE is declared... no\r\nchecking whether IBV_EXP_DEVICE_ATTR_RESERVED_2 is declared... no\r\nchecking whether IBV_EXP_MR_INDIRECT_KLMS is declared... no\r\nchecking whether IBV_EXP_QP_CREATE_UMR is declared... no\r\nchecking for struct ibv_exp_qp_init_attr.umr_caps... no\r\nchecking whether IBV_EXP_MR_FIXED_BUFFER_SIZE is declared... no\r\nchecking for struct ibv_device_attr_ex.pci_atomic_caps... yes\r\nconfigure: WARNING: Compiling without extended atomics support\r\nchecking for struct ibv_exp_masked_atomic_params.masked_log_atomic_arg_sizes_network_endianness... no\r\nchecking whether IBV_EXP_ODP_SUPPORT_IMPLICIT is declared... no\r\nchecking whether IBV_EXP_ACCESS_ON_DEMAND is declared... (cached) no\r\nchecking whether IBV_ACCESS_ON_DEMAND is declared... yes\r\nchecking whether IBV_EXP_ODP_SUPPORT_IMPLICIT is declared... (cached) no\r\nchecking whether IBV_ODP_SUPPORT_IMPLICIT is declared... yes\r\nchecking whether IBV_ACCESS_RELAXED_ORDERING is declared... yes\r\nchecking whether IBV_QPF_GRH_REQUIRED is declared... yes\r\nchecking whether ibv_exp_prefetch_mr is declared... (cached) no\r\nchecking whether ibv_advise_mr is declared... yes\r\nchecking for struct mlx5_wqe_av.base... no\r\nchecking for struct mlx5_grh_av.rmac... no\r\nchecking for struct mlx5_cqe64.ib_stride_index... no\r\nchecking whether IBV_EXP_QPT_DC_INI is declared... no\r\nchecking infiniband/tm_types.h usability... yes\r\nchecking infiniband/tm_types.h presence... yes\r\nchecking for infiniband/tm_types.h... yes\r\nchecking for struct ibv_exp_tmh.tag... no\r\nchecking for struct ibv_tmh.tag... yes\r\nchecking for struct ibv_tm_caps.flags... yes\r\nchecking whether ibv_cmd_modify_qp is declared... no\r\nconfigure: Checking OFED valgrind libs /usr/lib64/mlnx_ofed/valgrind\r\nchecking /usr/include/rdma/rdma_cma.h usability... no\r\nchecking /usr/include/rdma/rdma_cma.h presence... no\r\nchecking for /usr/include/rdma/rdma_cma.h... no\r\nconfigure: WARNING: RDMACM requested but required file (rdma/rdma_cma.h) could not be found in /usr\r\nchecking sys/uio.h usability... yes\r\nchecking sys/uio.h presence... yes\r\nchecking for sys/uio.h... yes\r\nchecking for process_vm_readv... yes\r\nconfigure: WARNING: KNEM was explicitly disabled\r\nchecking cray-ugni... no\r\nchecking whether IPPROTO_TCP is declared... yes\r\nchecking whether SOL_SOCKET is declared... yes\r\nchecking whether SO_KEEPALIVE is declared... yes\r\nchecking whether TCP_KEEPCNT is declared... yes\r\nchecking whether TCP_KEEPIDLE is declared... yes\r\nchecking whether TCP_KEEPINTVL is declared... yes\r\nchecking compiler flag -fno-exceptions... yes\r\nchecking compiler flag -fno-rtti... yes\r\nchecking compiler flag --no_exceptions... no\r\nchecking compiler flag -fno-tree-vectorize... yes\r\nchecking compiler flag --diag_suppress 236... no\r\nchecking that generated files are newer than configure... done\r\nconfigure: creating ./config.status\r\nconfig.status: creating src/ucm/cuda/Makefile\r\nconfig.status: creating src/ucm/rocm/Makefile\r\nconfig.status: creating src/ucm/Makefile\r\nconfig.status: creating src/uct/cuda/gdr_copy/Makefile\r\nconfig.status: creating src/uct/cuda/Makefile\r\nconfig.status: creating src/uct/ib/cm/Makefile\r\nconfig.status: creating src/uct/ib/rdmacm/Makefile\r\nconfig.status: creating src/uct/ib/Makefile\r\nconfig.status: creating src/uct/rocm/gdr/Makefile\r\nconfig.status: creating src/uct/rocm/Makefile\r\nconfig.status: creating src/uct/sm/scopy/cma/Makefile\r\nconfig.status: creating src/uct/sm/scopy/knem/Makefile\r\nconfig.status: creating src/uct/sm/scopy/Makefile\r\nconfig.status: creating src/uct/sm/mm/xpmem/Makefile\r\nconfig.status: creating src/uct/sm/mm/Makefile\r\nconfig.status: creating src/uct/sm/Makefile\r\nconfig.status: creating src/uct/ugni/Makefile\r\nconfig.status: creating src/uct/Makefile\r\nconfig.status: creating src/tools/perf/lib/Makefile\r\nconfig.status: creating src/tools/perf/cuda/Makefile\r\nconfig.status: creating src/tools/perf/rocm/Makefile\r\nconfig.status: creating src/tools/perf/Makefile\r\nconfig.status: creating test/gtest/ucm/test_dlopen/Makefile\r\nconfig.status: creating test/gtest/ucm/test_dlopen/rpath-subdir/Makefile\r\nconfig.status: creating test/gtest/ucs/test_module/Makefile\r\nconfig.status: creating test/gtest/Makefile\r\nconfig.status: creating Makefile\r\nconfig.status: creating docs/doxygen/header.tex\r\nconfig.status: creating src/uct/api/version.h\r\nconfig.status: creating ucx.spec\r\nconfig.status: creating ucx.pc\r\nconfig.status: creating contrib/rpmdef.sh\r\nconfig.status: creating debian/rules\r\nconfig.status: creating debian/control\r\nconfig.status: creating debian/changelog\r\nconfig.status: creating src/ucs/Makefile\r\nconfig.status: creating src/ucp/Makefile\r\nconfig.status: creating src/ucp/api/ucp_version.h\r\nconfig.status: creating src/ucp/core/ucp_version.c\r\nconfig.status: creating src/tools/info/Makefile\r\nconfig.status: creating src/tools/profile/Makefile\r\nconfig.status: creating test/apps/Makefile\r\nconfig.status: creating test/apps/iodemo/Makefile\r\nconfig.status: creating test/apps/sockaddr/Makefile\r\nconfig.status: creating test/apps/profiling/Makefile\r\nconfig.status: creating test/mpi/Makefile\r\nconfig.status: creating bindings/java/Makefile\r\nconfig.status: creating bindings/java/pom.xml\r\nconfig.status: creating bindings/java/src/main/native/Makefile\r\nconfig.status: creating examples/Makefile\r\nconfig.status: creating test/mpi/run_mpi.sh\r\nconfig.status: creating config.h\r\nconfig.status: executing depfiles commands\r\nconfig.status: executing libtool commands\r\nconfigure: =========================================================\r\nconfigure: UCX build configuration:\r\nconfigure:       Build prefix:   /home/mpaipuri/spack/opt/spack/linux-debian10-broadwell/gcc-9.3.0/ucx-1.10.1-4ghx7jadjpm6sgy6b4ingjkrpjors2sa\r\nconfigure: Preprocessor flags:   -DCPU_FLAGS=\"|avx\" -I${abs_top_srcdir}/src -I${abs_top_builddir} -I${abs_top_builddir}/src\r\nconfigure:         C compiler:   /home/mpaipuri/spack/lib/spack/env/gcc/gcc -O3 -g -Wall -Werror -mavx -funwind-tables -Wno-missing-field-initializers -Wno-unused-parameter -Wno-unused-label -Wno-long-long -Wno-endif-labels -Wno-sign-compare -Wno-multichar -Wno-deprecated-declarations -Winvalid-pch -Wno-pointer-sign -Werror-implicit-function-declaration -Wno-format-zero-length -Wnested-externs -Wshadow -Werror=declaration-after-statement\r\nconfigure:       C++ compiler:   /home/mpaipuri/spack/lib/spack/env/gcc/g++ -O3 -g -Wall -Werror -mavx -funwind-tables -Wno-missing-field-initializers -Wno-unused-parameter -Wno-unused-label -Wno-long-long -Wno-endif-labels -Wno-sign-compare -Wno-multichar -Wno-deprecated-declarations -Winvalid-pch\r\nconfigure:       Multi-thread:   enabled\r\nconfigure:          MPI tests:   disabled\r\nconfigure:      Devel headers:   no\r\nconfigure:           Bindings:   < >\r\nconfigure:        UCT modules:   < cuda ib rocm cma >\r\nconfigure:       CUDA modules:   < gdrcopy >\r\nconfigure:       ROCM modules:   < gdr >\r\nconfigure:         IB modules:   < >\r\nconfigure:        UCM modules:   < cuda rocm >\r\nconfigure:       Perf modules:   < cuda rocm >\r\nconfigure: =========================================================\r\n\r\n```\r\n\r\nMaintainer: @hppritcha \r\n\r\nPS: As I could successfully build it by modifying the UCX package file locally, I do not have logs anymore.\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "mahendrapaipuri",
    "url": "https://api.github.com/repos/spack/spack/issues/26980",
    "updated_at": "2021-11-01 14:05:57",
    "created_at": "2021-10-27 13:04:02",
    "closed_at": "2021-11-01 14:05:57",
    "state": "closed",
    "title": "Installation issue: ucx with gdrcopy",
    "number": 26980,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1037397435,
    "html_url": "https://github.com/spack/spack/issues/26980",
    "assignees": [],
    "comments": 2
}