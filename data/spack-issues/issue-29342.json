{
    "body": "### Steps to reproduce the issue\n\n```console\r\n$ spack spec -I llvm\r\nInput spec\r\n--------------------------------\r\nllvm@13%gcc\r\n\r\nConcretized\r\n--------------------------------\r\nkslhovh  llvm@13.0.1%gcc@10.2.1+clang~code_signing+compiler-rt~cuda~flang+gold+internal_unwind~ipo~libcxx~link_llvm_dylib+lld+lldb~llvm_dylib~mlir+omp_as_runtime~omp_debug~omp_tsan+polly~python~shared_libs~split_dwarf~z3 build_type=Release targets=none version_suffix=none arch=linux-debian11-skylake\r\ny3wlxwk      ^binutils@2.38%gcc@10.2.1~gas+gold~headers~interwork+ld~libiberty~lto+nls+plugins libs=shared,static arch=linux-debian11-skylake\r\nasesl6c          ^diffutils@3.8%gcc@10.2.1 arch=linux-debian11-skylake\r\n6gzbhqj              ^libiconv@1.16%gcc@10.2.1 libs=shared,static arch=linux-debian11-skylake\r\nwp2cx6c          ^gettext@0.21%gcc@10.2.1+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-debian11-skylake\r\nbztq52k              ^bzip2@1.0.8%gcc@10.2.1~debug~pic+shared arch=linux-debian11-skylake\r\nkqh5uem              ^libxml2@2.9.12%gcc@10.2.1~python arch=linux-debian11-skylake\r\nyckq7g7                  ^pkgconf@1.8.0%gcc@10.2.1 arch=linux-debian11-skylake\r\nwjudasv                  ^xz@5.2.5%gcc@10.2.1~pic libs=shared,static arch=linux-debian11-skylake\r\n7l3ibnl                  ^zlib@1.2.11%gcc@10.2.1+optimize+pic+shared arch=linux-debian11-skylake\r\nbefp3xm              ^ncurses@6.2%gcc@10.2.1~symlinks+termlib abi=none arch=linux-debian11-skylake\r\n3xxuheg              ^tar@1.34%gcc@10.2.1 arch=linux-debian11-skylake\r\nw5f4nim      ^cmake@3.22.2%gcc@10.2.1~doc+ncurses+openssl+ownlibs~qt build_type=Release arch=linux-debian11-skylake\r\njesaas7          ^openssl@1.1.1m%gcc@10.2.1~docs certs=system arch=linux-debian11-skylake\r\nv73srpt              ^perl@5.34.0%gcc@10.2.1+cpanm+shared+threads arch=linux-debian11-skylake\r\nf5tq7pu                  ^berkeley-db@18.1.40%gcc@10.2.1+cxx~docs+stl patches=b231fcc arch=linux-debian11-skylake\r\n7vkbn7d                  ^gdbm@1.19%gcc@10.2.1 arch=linux-debian11-skylake\r\nikmpaem                      ^readline@8.1%gcc@10.2.1 arch=linux-debian11-skylake\r\n4t7zrhk      ^hwloc@2.7.0%gcc@10.2.1~cairo~cuda~gl~libudev+libxml2~netloc~nvml~opencl+pci~rocm+shared arch=linux-debian11-skylake\r\nhx6potr          ^libpciaccess@0.16%gcc@10.2.1 arch=linux-debian11-skylake\r\n3qly76p              ^libtool@2.4.6%gcc@10.2.1 arch=linux-debian11-skylake\r\n7tmpfit                  ^m4@1.4.19%gcc@10.2.1+sigsegv patches=9dc5fbd,bfdffa7 arch=linux-debian11-skylake\r\nbfk5kkz                      ^libsigsegv@2.13%gcc@10.2.1 arch=linux-debian11-skylake\r\nhn74rjj              ^util-macros@1.19.3%gcc@10.2.1 arch=linux-debian11-skylake\r\nuzl52fj      ^libedit@3.1-20210216%gcc@10.2.1 arch=linux-debian11-skylake\r\nlqirkkf      ^ninja@1.10.2%gcc@10.2.1 arch=linux-debian11-skylake\r\nov45bff          ^python@3.9.10%gcc@10.2.1+bz2+ctypes+dbm~debug+ensurepip+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93,4c24573,f2fd060 arch=linux-debian11-skylake\r\nt2wj6l4              ^expat@2.4.6%gcc@10.2.1+libbsd arch=linux-debian11-skylake\r\n3l3whzy                  ^libbsd@0.11.5%gcc@10.2.1 arch=linux-debian11-skylake\r\niuvzw6t                      ^libmd@1.0.4%gcc@10.2.1 arch=linux-debian11-skylake\r\nyq6cs6k              ^libffi@3.4.2%gcc@10.2.1 arch=linux-debian11-skylake\r\n4p6awn4              ^sqlite@3.37.2%gcc@10.2.1+column_metadata+dynamic_extensions+fts~functions+rtree arch=linux-debian11-skylake\r\njyy67pa              ^util-linux-uuid@2.37.4%gcc@10.2.1 arch=linux-debian11-skylake\r\ne5tzttp      ^perl-data-dumper@2.173%gcc@10.2.1 arch=linux-debian11-skylake\r\nzsgwvru      ^swig@4.0.2%gcc@10.2.1 arch=linux-debian11-skylake\r\nlgykikt          ^pcre@8.45%gcc@10.2.1~jit+multibyte+utf arch=linux-debian11-skylake\r\n```\r\n\n\n### Error message\n\nI can't really post the error message, since it's too long for the issue body. Please have a look at [`spack-build-out.txt`](https://gist.githubusercontent.com/behrmann/6038c4826297b03fdef94ba6165c838f/raw/8ddbe95ab7abecfeef3c0cd767392356fad279ec/spack-build-out.txt)\r\n\r\n<details><summary>(shortened) error message</summary><pre>\r\n3 errors found in build log:\r\n\r\n  >> 17261    FAILED: bin/lldb-server\r\n  >> 17263    /local_scratch/behrmj87/build/spack/test/spack/opt/spack/linux-debian11-skylake/gcc-10.2.1/binutils-2.38-y3wlxwkc3pjb5mkjoslqh72k6sdhgksl/bin/ld: /usr/lib/gcc/x86_64-linux-gnu/10/../../../x86_64-linux-gnu/libncurses.so.6: undefined reference to `_nc_tiparm@@NCURSES6_TINFO_6.2.current'\r\n  >> 17264    collect2: error: ld returned 1 exit status\r\n\r\nSee build log for details:\r\n  /tmp/behrmj87/spack-stage/spack-stage-llvm-13.0.1-kslhovhwidx2fmdxyxjeclwap2aiupsh/spack-build-out.txt\r\n</pre></details>\n\n### Information on your system\n\n```console\r\n$ spack debug report\r\n* **Spack:** 0.17.1-1443-6bc2e660e8\r\n* **Python:** 3.9.2\r\n* **Platform:** linux-debian11-skylake\r\n* **Concretizer:** clingo\r\n```\n\n### Additional information\n\nThe same thing happens for `llvm@12` (with the same error), but `llvm@11` builds fine. The error occurs with both `-j1` and `-j6` for `spack install`. Disabling lldb (`~lldb`) fixes the build (because the problem is sidestepped). I'm not sure, but this does sound like the error that lead to the report #27085.\r\n\r\nThe relevant compiler is\r\n```\r\n- compiler:\r\n    spec: gcc@10.2.1\r\n    paths:\r\n      cc: /usr/bin/gcc\r\n      cxx: /usr/bin/g++\r\n      f77: /usr/bin/gfortran\r\n      fc: /usr/bin/gfortran\r\n    flags: {}\r\n    operating_system: debian11\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n```\r\n\r\nThe build information can be found in [this gist](https://gist.github.com/behrmann/6038c4826297b03fdef94ba6165c838f):\r\n- [`spack-build-env.txt`](https://gist.githubusercontent.com/behrmann/6038c4826297b03fdef94ba6165c838f/raw/8ddbe95ab7abecfeef3c0cd767392356fad279ec/spack-build-env.txt)\r\n- [`spack-build-out.txt`](https://gist.githubusercontent.com/behrmann/6038c4826297b03fdef94ba6165c838f/raw/8ddbe95ab7abecfeef3c0cd767392356fad279ec/spack-build-out.txt)\r\n\r\nI guess the relevant part of the build output is (linebreaks added for readability)\r\n```console\r\n$ grep /usr/lib/gcc spack-build-out.txte\r\n[3417/5898] cd /tmp/behrmj87/spack-stage/spack-stage-llvm-13.0.1-kslhovhwidx2fmdxyxjeclwap2aiupsh/spack-build-kslhovh/tools/clang/lib/Tooling \r\n&& /tmp/behrmj87/spack-stage/spack-stage-llvm-13.0.1-kslhovhwidx2fmdxyxjeclwap2aiupsh/spack-build-kslhovh/bin/clang-ast-dump --skip-processing=0 \r\n-I /tmp/behrmj87/spack-stage/spack-stage-llvm-13.0.1-kslhovhwidx2fmdxyxjeclwap2aiupsh/spack-build-kslhovh/lib/clang/13.0.1/include \r\n-I /tmp/behrmj87/spack-stage/spack-stage-llvm-13.0.1-kslhovhwidx2fmdxyxjeclwap2aiupsh/spack-src/llvm/../clang/include \r\n-I /tmp/behrmj87/spack-stage/spack-stage-llvm-13.0.1-kslhovhwidx2fmdxyxjeclwap2aiupsh/spack-build-kslhovh/tools/clang/include \r\n-I /tmp/behrmj87/spack-stage/spack-stage-llvm-13.0.1-kslhovhwidx2fmdxyxjeclwap2aiupsh/spack-build-kslhovh/include \r\n-I /tmp/behrmj87/spack-stage/spack-stage-llvm-13.0.1-kslhovhwidx2fmdxyxjeclwap2aiupsh/spack-src/llvm/include \r\n-I /usr/include/c++/10 \r\n-I /usr/include/x86_64-linux-gnu/c++/10 \r\n-I /usr/include/c++/10/backward \r\n-I /usr/lib/gcc/x86_64-linux-gnu/10/include \r\n-I /usr/local/include \r\n-I /usr/include/x86_64-linux-gnu \r\n-I /usr/include \r\n--json-output-path /tmp/behrmj87/spack-stage/spack-stage-llvm-13.0.1-kslhovhwidx2fmdxyxjeclwap2aiupsh/spack-build-kslhovh/tools/clang/lib/Tooling/ASTNodeAPI.json\r\n\r\n/local_scratch/behrmj87/build/spack/test/spack/opt/spack/linux-debian11-skylake/gcc-10.2.1/binutils-2.38-y3wlxwkc3pjb5mkjoslqh72k6sdhgksl/bin/ld: \r\n  /usr/lib/gcc/x86_64-linux-gnu/10/../../../x86_64-linux-gnu/libncurses.so.6: undefined reference to `_nc_tiparm@NCURSES6_TINFO_6.2.current'\r\n```\r\nIt seems to me like it hits the wrong ncurses (the one from the system), because it tries to grab ncurses relative to gcc. \r\n\r\ncc: @haampie  @trws\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "behrmann",
    "url": "https://api.github.com/repos/spack/spack/issues/29342",
    "updated_at": "2022-03-04 16:14:11",
    "created_at": "2022-03-04 16:14:11",
    "closed_at": "None",
    "state": "open",
    "title": "Installation issue: llvm",
    "number": 29342,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1159810761,
    "html_url": "https://github.com/spack/spack/issues/29342",
    "assignees": [],
    "comments": 0
}