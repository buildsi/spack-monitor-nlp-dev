{
    "body": "I failed to install my package with openmpi in #13215 , so I tried to set more flags through  `def edit ` to see if it will help. \r\n\r\nHowever,  I am not sure if it is the right thing to do or I should just add more to my configure.ac (we are using Autotools). I am also not sure if I have written my python.py right, especially the  `def edit ` part. \r\n\r\nSorry for submitting a lot of issues recently, and thanks a lot for all the help I have received! You guys are great!\r\n\r\n**python.py**\r\n   ```\r\n git = \"https://github.com/sdsc/p3dfft.3\"\r\n\r\n    version('develop', branch = 'master')\r\n    version('0.0.0', '3c62c2bdf4aa91c3f1ab122efc1b3799')\r\n\r\n    variant('fftw', default = True,\r\n            description='Builds with FFTW library')\r\n    variant('essl', default=False,\r\n            description='Builds with ESSL library')\r\n    variant('mpi', default = True,\r\n            description=\"Enable MPI support.\")\r\n    variant('openmp', default=False,\r\n            description=\"Enable OpenMP support.\")\r\n    variant('measure', default=False,\r\n            description=\"Define if you want to use the measure fftw planner flag\")\r\n    variant('estimate', default=False,\r\n            description=\"Define if you want to use the estimate fftw planner flag\")\r\n    variant('patient', default=False,\r\n            description=\"[Define if you want to use the patient fftw planner flag]\")\r\n\r\n    depends_on('mpi',when = '+mpi')\r\n    depends_on('fftw',when = '+fftw')\r\n    depends_on('essl',when = '+essl')\r\n    depends_on('openmp',when = '+openmp')\r\n\r\n\r\n    def setup_environment(self, spack_env, run_env):\r\n        spec = self.spec\r\n\r\n        spack_env.set('CC', spec['mpi'].mpicc)\r\n        spack_env.set('FC', spec['mpi'].mpifc)\r\n        spack_env.set('CXX', spec['mpi'].mpicxx)\r\n\r\n\r\n    def edit(self, spec, prefix):\r\n         if '^openmpi' in spec :\r\n          if self.compiler.name == 'intel'  :\r\n                        flags=\"-lmpi_mpifh -limf -lifcore\"\r\n                if self.compiler.name == 'pgi'  :\r\n                        flags=\"-lmpi_mpifh -pgf90libs\"\r\n                config['FORTRAN_LIB'] = flags\r\n    def install(self, spec, prefix):\r\n        config_args = ['--prefix={0}'.format(prefix)]\r\n\r\n        if '+fftw' in spec:\r\n            config_args.append('--enable-fftw')\r\n            config_args.append ('--with-fftw-lib= %s' % spec['fftw'].prefix.lib)\r\n            config_args.append ('--with-fftw-inc= %s' % spec['fftw'].prefix.include)\r\n            if '+measure' in spec:\r\n                 config_args.append('--enable-fftwmeasure')\r\n            if '+estimate' in spec:\r\n                 config_args.append('--enable-fftwestimate')\r\n            if '+patient' in spec:\r\n                 config_args.append('--enable-fftwpatient')\r\n\r\n        if '+essl' in spec:\r\n            config_args.append('--enable-essl')\r\n            config_args.append ('--with-essl-lib= %s' % spec['essl'].prefix.lib)\r\n            config_args.append ('--with-essl-inc= %s' % spec['essl'].prefix.include)\r\n\r\n        if '+mkl' in spec:\r\n            config_args.append('--enable-mkl')\r\n            config_args.append ('--with-mkl-lib= %s' % spec['mkl'].prefix.lib)\r\n            config_args.append ('--with-mkl-inc= %s' % spec['mkl'].prefix.include)\r\n\r\n        configure( *config_args)\r\n\r\n        make()\r\n        make('install')\r\n```\r\n\r\n**things I want to add if in configure =.ac:**\r\n```\r\n# check whether to use OpenMPI\r\nAC_MSG_CHECKING([whether to use OpenMPI])\r\nAC_ARG_ENABLE(openmpi, [AC_HELP_STRING([--enable-openmpi], [use the OpenMPI MPI implementation])], ok=$enableval, ok=no)\r\nAC_MSG_RESULT([$ok])\r\ncase $compiler in\r\n    ibm)\r\n    ;;\r\n    intel)\r\n        if test \"$ok\" = \"yes\"; then\r\n\t        AC_SUBST(FORTRAN_LIB,\"-lmpi_mpifh -limf -lifcore\") \r\n        else\r\n\t        AC_SUBST(FORTRAN_LIB,\"-limf -lifcore\") #-lmpichf90 \r\n        fi\r\n    ;;\r\n    pgi)\r\n        if test \"$ok\" = \"yes\"; then\r\n            AC_SUBST(FORTRAN_LIB,\"-lmpi_mpifh -pgf90libs\")\r\n        else\r\n            AC_SUBST(FORTRAN_LIB,\"-lmpichf90 -pgf90libs\")\r\n        fi\r\n    ;;\r\n    cray)\r\n    ;;\r\n    gnu)\r\n        if test \"$ok\" = \"yes\"; then\r\n\t        AC_SUBST(FORTRAN_LIB,\"-lmpi_mpifh -lgfortran\")\r\n        else\r\n\t        AC_SUBST(FORTRAN_LIB,\"-lgfortran\")\r\n        fi\r\n    ;;\r\n    *)\r\nesac\r\n```\r\n\r\nThank you !",
    "user": "SheraLee",
    "url": "https://api.github.com/repos/spack/spack/issues/13483",
    "updated_at": "2019-11-12 02:11:04",
    "created_at": "2019-10-29 12:14:52",
    "closed_at": "2019-11-12 02:11:04",
    "state": "closed",
    "title": "How to add OpenMPI flags through def edit",
    "number": 13483,
    "milestone": null,
    "labels": [],
    "id": 513875265,
    "html_url": "https://github.com/spack/spack/issues/13483",
    "assignees": [],
    "comments": 0
}