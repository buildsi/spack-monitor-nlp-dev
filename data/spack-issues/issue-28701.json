{
    "body": "Fixes #24014 \r\n\r\nSince Spack does not install external packages, this PR skips them *by default* when running stand-alone tests.  The assumption is that such packages have likely undergone an acceptance test process.  However, the tests *can* be run against installed externals using `spack test run --externals`.\r\n\r\n```\r\n$ spack test run -h\r\nusage: spack test run [-h] [--alias ALIAS] [--fail-fast] [--fail-first]\r\n                      [--externals] [--keep-stage]\r\n                      [--log-format {None,junit,cdash}] [--log-file LOG_FILE]\r\n                      [--help-cdash] [--clean | --dirty]\r\n                      ...\r\n\r\nRun tests for the specified installed packages.\r\n\r\n    If no specs are listed, run tests for all packages in the current\r\n    environment or all installed packages if there is no active environment.\r\n    \r\n\r\npositional arguments:\r\n  installed_specs       one or more installed package specs\r\n\r\noptional arguments:\r\n  --alias ALIAS         Provide an alias for this test-suite for subsequent access.\r\n  --clean               unset harmful variables in the build environment (default)\r\n  --dirty               preserve user environment in spack's build environment (danger!)\r\n  --externals      Test packages that are externally installed.\r\n  --fail-fast           Stop tests for each package after the first failure.\r\n  --fail-first          Stop after the first failed package.\r\n  --help-cdash          Show usage instructions for CDash reporting\r\n  --keep-stage          Keep testing directory for debugging\r\n  --log-file LOG_FILE   filename for the log file. if not passed a default will be used\r\n  --log-format {None,junit,cdash}\r\n                        format to be used for log files\r\n  -h, --help            show this help message and exit\r\n```\r\n\r\nResults from running tests against externally installed packages *without the option* are, for example:\r\n\r\n```\r\n$ spack test run openmpi xz\r\n==> Spack test h53e5oth7pwfqtm4d6z6nt3doc32iy34\r\n\r\n$ spack test results\r\n==> Results for test suite 'h53e5oth7pwfqtm4d6z6nt3doc32iy34':\r\n==>   openmpi-4.1.2-37vuqvc SKIPPED\r\n==>   xz-5.2.2-iwgisde SKIPPED\r\n==>   xz-5.2.2-i5m6iu6 SKIPPED\r\n\r\n$ spack test results -l\r\n==> Results for test suite 'h53e5oth7pwfqtm4d6z6nt3doc32iy34':\r\n==>   openmpi-4.1.2-37vuqvc SKIPPED\r\nTesting package openmpi-4.1.2-37vuqvc\r\nSkipped external package\r\n\r\n==>   xz-5.2.2-iwgisde SKIPPED\r\nTesting package xz-5.2.2-iwgisde\r\nSkipped external package\r\n\r\n==>   xz-5.2.2-i5m6iu6 SKIPPED\r\nTesting package xz-5.2.2-i5m6iu6\r\nSkipped external package\r\n\r\n```\r\n\r\nThe `junit` output from `spack test run --log-format junit openmpi xz` is:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!--\r\n    This file has been modeled after the basic\r\n    specifications at this url:\r\n\r\n    http://help.catchsoftware.com/display/ET/JUnit+Format\r\n-->\r\n<testsuites>\r\n    <testsuite name=\"openmpi_37vuqvc\"\r\n               errors=\"0\"\r\n               tests=\"1\"\r\n               failures=\"0\"\r\n               time=\"0.002861499786376953\"\r\n               timestamp=\"Tue, 01 Feb 2022 18:20:42\" >\r\n        <properties>\r\n            <property name=\"architecture\" value=\"linux-rhel7-skylake_avx512\" />\r\n            <property name=\"compiler\" value=\"gcc@8.3.1\" />\r\n        </properties>\r\n        <testcase classname=\"openmpi\"\r\n                  name=\"37vuqvcq7pp2yeattawjomxfrw6a5mo3\"\r\n                  time=\"0.002861499786376953\">\r\n            <skipped />\r\n            <system-out>\r\nSkipped external package\r\n            </system-out>\r\n        </testcase>\r\n    </testsuite>\r\n    <testsuite name=\"xz_iwgisde\"\r\n               errors=\"0\"\r\n               tests=\"1\"\r\n               failures=\"0\"\r\n               time=\"0.002824068069458008\"\r\n               timestamp=\"Tue, 01 Feb 2022 18:20:42\" >\r\n        <properties>\r\n            <property name=\"architecture\" value=\"linux-rhel7-skylake_avx512\" />\r\n            <property name=\"compiler\" value=\"gcc@8.3.1\" />\r\n        </properties>\r\n        <testcase classname=\"xz\"\r\n                  name=\"iwgisdepiy7nislfoooycg4arjqjlc5s\"\r\n                  time=\"0.002824068069458008\">\r\n            <skipped />\r\n            <system-out>\r\nSkipped external package\r\n            </system-out>\r\n        </testcase>\r\n    </testsuite>\r\n    <testsuite name=\"xz_i5m6iu6\"\r\n               errors=\"0\"\r\n               tests=\"1\"\r\n               failures=\"0\"\r\n               time=\"0.002808094024658203\"\r\n               timestamp=\"Tue, 01 Feb 2022 18:20:42\" >\r\n        <properties>\r\n            <property name=\"architecture\" value=\"linux-rhel7-cascadelake\" />\r\n            <property name=\"compiler\" value=\"intel@19.0.4.227\" />\r\n        </properties>\r\n        <testcase classname=\"xz\"\r\n                  name=\"i5m6iu6vcvp5mbmyh5ah6vfdbzvfjzgo\"\r\n                  time=\"0.002808094024658203\">\r\n            <skipped />\r\n            <system-out>\r\nSkipped external package\r\n            </system-out>\r\n        </testcase>\r\n    </testsuite>\r\n```\r\n\r\nResults when using `--externals`:\r\n\r\n```\r\n$ spack test run --externals openmpi xz\r\n==> Spack test h53e5oth7pwfqtm4d6z6nt3doc32iy34\r\n==> Testing package openmpi-4.1.2-37vuqvc\r\n==> Error: TestFailure: 9 tests failed.\r\n<..snip..>\r\n\r\nSee test log for details:\r\n  /g/g21/dahlgren/.spack/test/h53e5oth7pwfqtm4d6z6nt3doc32iy34/openmpi-4.1.2-37vuqvc-test-out.txt\r\n\r\n==> Testing package xz-5.2.2-iwgisde\r\n==> Testing package xz-5.2.2-i5m6iu6\r\n==> Error: 1 test(s) in the suite failed.\r\n\r\n$ spack test results\r\n==> Results for test suite 'h53e5oth7pwfqtm4d6z6nt3doc32iy34':\r\n==>   openmpi-4.1.2-37vuqvc FAILED\r\n==>   xz-5.2.2-iwgisde NO-TESTS\r\n==>   xz-5.2.2-i5m6iu6 NO-TESTS\r\n\r\n$ spack test results -l\r\n==> Results for test suite 'h53e5oth7pwfqtm4d6z6nt3doc32iy34':\r\n==>   openmpi-4.1.2-37vuqvc FAILED\r\n==> Testing package openmpi-4.1.2-37vuqvc\r\n<..snip..>\r\n\r\n==>   xz-5.2.2-iwgisde NO-TESTS\r\n==> Testing package xz-5.2.2-iwgisde\r\nNo tests to run\r\n\r\n==>   xz-5.2.2-i5m6iu6 NO-TESTS\r\n==> Testing package xz-5.2.2-i5m6iu6\r\nNo tests to run\r\n```",
    "user": "tldahlgren",
    "url": "https://api.github.com/repos/spack/spack/issues/28701",
    "updated_at": "2022-02-17 18:47:43",
    "created_at": "2022-02-01 02:11:16",
    "closed_at": "2022-02-17 18:47:43",
    "state": "closed",
    "title": "Testing: Optionally run tests on externally installed packages",
    "number": 28701,
    "milestone": null,
    "labels": [
        "external-packages",
        "tests",
        "commands",
        "stand-alone-tests"
    ],
    "id": 1120156472,
    "html_url": "https://github.com/spack/spack/pull/28701",
    "assignees": [],
    "comments": 6
}