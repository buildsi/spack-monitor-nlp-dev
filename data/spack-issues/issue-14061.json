{
    "body": "TODO:\r\n\r\n- [ ] if/when this is going to be merged, I should finalize the changes to modules2tuple and get [that PR](https://github.com/dmgk/modules2tuple/pull/8) merged, then update this PR's modules2tuple package.\r\n- [ ] `spack create` screws up when it encounters the common Go application practice of attaching tarballs containing pre-built binaries to each GitHub release.   Life would be easier if we resolved #13940.\r\n- [ ] review advice about setting go version dependency based on info in go.mod file.  Ongoing discussion here: https://groups.google.com/forum/#!topic/golang-nuts/mICeiADN9V4\r\n\r\n---\r\n\r\nApplications that use Go should not download dependencies at build\r\ntime.  This commit adds documentation and tooling to that end.  It\r\nalso cleans up existing packages, continuing to support existing\r\nversions where possible and removing them when necessary.\r\n\r\nIt:\r\n\r\n- Adds a new package directive, `import_resources`, which simplifies\r\n  importing large numbers of resources.  `import_resources` reads a\r\n  JSON file containing an array of package definitions.\r\n\r\n- Adds `GoPackage`, which provides support for simple Go applications\r\n  - adds `GoPackage`;\r\n  - hooks it into `spack create`; and\r\n  - documents it in the \"Build Systems\" section.\r\n\r\n- Documents, in the \"Build Systems\" documentation for GoPackage, how\r\n  to handle:\r\n  - easy applications that use Go modules *and* vendor their\r\n    dependencies;\r\n  - slightly more complicated applications that use Go modules *but do\r\n    not* vendor their dependencies (use `go mod download` and\r\n    `modules2tuple` to generate resources that are imported via\r\n    `import_resources`); and\r\n  - difficult applications that need to be handled on a one-off basis.\r\n\r\n- Adds/updates some existing packages to the use the New World Order:\r\n  - [x] direnv -- Had a vendor dir, but it wasn't being used, the fix\r\n    is slightly tricksy.\r\n    - No change in supported versions\r\n  - [x] docui -- A new package that uses GoPackage, it does not have\r\n    vendored dependencies so it declares resources via\r\n    `import_resources`.\r\n    - New application, no previously supported versions.\r\n  - [x] fzf -- The versions that we have use Glide and don't have a\r\n    vendor dir; their Makefile populates vendor at install time.\r\n    Newer releases (0.18.0, 0.19.0) use go.mod.  This drops the older\r\n    releases as unsupportable, adds 0.1[89].0, and cleans up the\r\n    package.\r\n    - Deletes versions '0.17.5', '0.17.4', '0.17.3', '0.17.1', '0.17.0-2\r\n      '0.17.0', '0.16.11' '0.16.10' '0.16.9', '0.16.8'.\r\n    - Adds versions '0.19.0', '0.18.0'.\r\n  - [x] git-lfs -- It vendored its dependencies but they weren't being\r\n    used.  Set GO111MODULE and GOFLAGS so that they are.\r\n    - No change in supported versions.\r\n  - [x] glow -- a new package that uses GoPackage, uses modules but \r\n    does not vendor it's dependencies.\r\n    - New application, no previously supported versions.\r\n  - [x] go-md2man -- Has vendored its dependencies, but we weren't\r\n    using them; switched to GoPackage and now we are.\r\n    - No change in supported versions.\r\n  - [x] hugo -- Well mannered, uses modules and `go build` but no\r\n    vendored depdendencies; switched to GoPackage and\r\n    `import_resources`.\r\n    - No change in supported versions.\r\n  - [x] lazydocker -- A new package that uses GoPackage and has\r\n        vendored dependencies.\r\n    - New application, no previously supported versions.\r\n  - [x] lazygit -- A new package that uses GoPackage and has vendored\r\n        dependencies.\r\n    - New application, no previously supported versions.\r\n  - [x] modules2tuple -- For now, my fork of the FreeBSD tool, which\r\n    can generate resource statements; it uses go.mod and has no\r\n    dependencies.\r\n    - When the dust settles my changes will be merged upstream and\r\n      this package should be updated to point there.\r\n    - New application, no previously supported versions.\r\n  - [x] rclone -- Well behaved, uses go.mod and has vendor its\r\n    dependencies; switched to GoPackage.\r\n    - No change in supported versions.\r\n  - [x] singularity - releases from 3.2.0-> seem to be well behaved\r\n    wrt modules.  I've taken the liberty to drop 3.1.1 because\r\n    making it work is messy.\r\n    - Deletes '3.1.1'.\r\n  - [x] skopeo -- Recent versions support modules and have vendored\r\n    things.  I've constrained go to @1.11 and disabled the older\r\n    versions...\r\n    - Deletes '0.1.37' and '0.1.36'.\r\n  - [x] umoci -- They have a vendor dir and @0.4.3: have go.mod, but\r\n    they don't appear to use it in their build.  This touches up their\r\n    Makefile so that go runs in module mode and makes the install do\r\n    the right thing.  BUT, only for 0.4.3:.\r\n    - Deletes '0.4.2', '0.4.1', and '0.4.0'.\r\n\r\nAs applications adopt the Go modules system and become easier to deal\r\nwith, the community will need to decide how to deprecate and remove\r\nsupport for old, non-conforming versions.\r\n\r\nCloses #13023\r\nCloses #13973",
    "user": "hartzell",
    "url": "https://api.github.com/repos/spack/spack/issues/14061",
    "updated_at": "2021-02-09 07:28:47",
    "created_at": "2019-12-09 21:42:37",
    "closed_at": "None",
    "state": "open",
    "title": "Improved support for Go based packages",
    "number": 14061,
    "milestone": null,
    "labels": [
        "documentation",
        "directives",
        "build-systems",
        "go"
    ],
    "id": 535355511,
    "html_url": "https://github.com/spack/spack/pull/14061",
    "assignees": [
        "scheibelp"
    ],
    "comments": 25
}