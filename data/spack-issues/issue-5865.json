{
    "body": "Steps to reproduce:\r\n```\r\n$ spack install libelf\r\n==> Installing libelf\r\n==> Fetching http://www.mr511.de/software/libelf-0.8.13.tar.gz\r\n######################################################################## 100.0%\r\n==> Staging archive: /home/certik/repos/spack/var/spack/stage/libelf-0.8.13-vrhrruxrmpu3poh7zztvpybbttfgsxg7/libelf-0.8.13.tar.gz\r\n==> Created stage in /home/certik/repos/spack/var/spack/stage/libelf-0.8.13-vrhrruxrmpu3poh7zztvpybbttfgsxg7\r\n==> No patches needed for libelf\r\n==> Building libelf [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Executing phase: 'install'\r\n==> Successfully installed libelf\r\n  Fetch: 1.21s.  Build: 4.18s.  Total: 5.39s.\r\n[+] /home/certik/repos/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-7.2.0/libelf-0.8.13-vrhrruxrmpu3poh7zztvpybbttfgsxg7\r\n```\r\nApply the following patch:\r\n```diff\r\ndiff --git a/var/spack/repos/builtin/packages/libelf/package.py b/var/spack/repos/builtin/packages/libelf/package.py\r\nindex 56c4f19..0bf4fbe 100644\r\n--- a/var/spack/repos/builtin/packages/libelf/package.py\r\n+++ b/var/spack/repos/builtin/packages/libelf/package.py\r\n@@ -46,4 +46,4 @@ class Libelf(AutotoolsPackage):\r\n         return args\r\n\r\n     def install(self, spec, prefix):\r\n-        make('install', parallel=False)\r\n+        make('installXXX', parallel=False)\r\n```\r\nthen the changes are not picked up and the hash is not updated:\r\n```\r\n$ spack install libelf\r\n==> libelf is already installed in /home/certik/repos/spack/opt/spack/linux-ubuntu16.04-x86_64/gcc-7.2.0/libelf-0.8.13-vrhrruxrmpu3poh7zztvpybbttfgsxg7\r\n```\r\nTo make spack pickup the changes, one must do:\r\n```\r\n$ spack uninstall libelf\r\n$ spack install libelf\r\n==> Installing libelf\r\n==> Using cached archive: /home/certik/repos/spack/var/spack/cache/libelf/libelf-0.8.13.tar.gz\r\n==> Staging archive: /home/certik/repos/spack/var/spack/stage/libelf-0.8.13-vrhrruxrmpu3poh7zztvpybbttfgsxg7/libelf-0.8.13.tar.gz\r\n==> Created stage in /home/certik/repos/spack/var/spack/stage/libelf-0.8.13-vrhrruxrmpu3poh7zztvpybbttfgsxg7\r\n==> No patches needed for libelf\r\n==> Building libelf [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' 'installXXX'\r\n\r\n1 error found in build log:\r\n     [ ... ]\r\n     371   making all in po\r\n     372   make[1]: Entering directory '/home/certik/tmp/spack-stage/spack-stage-8pfgyO/libelf-0.8.13/po'\r\n     373   make[1]: Nothing to be done for 'all'.\r\n     374   make[1]: Leaving directory '/home/certik/tmp/spack-stage/spack-stage-8pfgyO/libelf-0.8.13/po'\r\n     375   ==> Executing phase: 'install'\r\n     376   ==> 'make' 'installXXX'\r\n  >> 377   make: *** No rule to make target 'installXXX'.  Stop.\r\n\r\nSee build log for details:\r\n  /home/certik/repos/spack/var/spack/stage/libelf-0.8.13-vrhrruxrmpu3poh7zztvpybbttfgsxg7/libelf-0.8.13/spack-build.out\r\n```\r\nNow the changes are picked up (and so the build fails), but the hash is still the old one... \r\n\r\n@tgamblin, in Hashdist, the hash contains the build script as well, so if you change it, the hash changes, which allows you to install several versions of the same package, just differing with how you build it.",
    "user": "certik",
    "url": "https://api.github.com/repos/spack/spack/issues/5865",
    "updated_at": "2017-10-23 14:05:57",
    "created_at": "2017-10-22 15:10:45",
    "closed_at": "2017-10-23 10:14:32",
    "state": "closed",
    "title": "spack does not pickup changes to package.py and the hash is not updated",
    "number": 5865,
    "milestone": null,
    "labels": [],
    "id": 267472513,
    "html_url": "https://github.com/spack/spack/issues/5865",
    "assignees": [],
    "comments": 5
}