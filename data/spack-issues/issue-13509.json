{
    "body": "CC: @fryeguy52 \r\n\r\nTag: snl-atdm-issue\r\n\r\nWhen I upgraded to Spack 0.13.0, if you tell spack to build python but it is not able to actually built it because another package build fails, then spack still tries to use that package (it would appear automatically).\r\n\r\nFor example, I ran `spack install` which tried to build:\r\n\r\n```\r\n==> Concretized snl-atdm-tools arch=linux-rhel6-x86_64\r\n -   7kjcq22  snl-atdm-tools@snl-atdm-0.1.0%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   jolfhsi      ^autoconf@2.69%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   z4usolp          ^m4@1.4.18%gcc@7.2.0 patches=3877ab548f88597ab2327a2230ee048d2d07ace1062efe81fc92e91b7f39cd00,fc9b61654a3ba1a8d6cd78ce087e7c96366c290bc8d2c299f09828d793b853c8 +sigsegv arch=linux-rhel6-x86_64\r\n -   ulj5yaz              ^libsigsegv@2.12%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   rvc7wh4          ^perl@5.26.2%gcc@7.2.0+cpanm patches=0eac10ed90aeb0459ad8851f88081d439a4e41978e586ec743069e8b059370ac +shared+threads arch=linux-rhel6-x86_64\r\n -   7yddwkq              ^gdbm@1.18.1%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   kw32bm5                  ^readline@8.0%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   dqth77n                      ^ncurses@6.1%gcc@7.2.0~symlinks~termlib arch=linux-rhel6-x86_64\r\n -   qmt4kcm                          ^pkgconf@1.6.3%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   r3sudpm      ^automake@1.16.1%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   dmkkwab      ^cmake@3.15.4%gcc@7.2.0~doc+ncurses+openssl+ownlibs~qt arch=linux-rhel6-x86_64\r\n -   7e4sofy          ^openssl@1.1.1d%gcc@7.2.0+systemcerts arch=linux-rhel6-x86_64\r\n -   aqhxxoj              ^zlib@1.2.11%gcc@7.2.0+optimize+pic+shared arch=linux-rhel6-x86_64\r\n -   izajihb      ^diffutils@3.7%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   yevortw          ^libiconv@1.16%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   ezbbcix      ^git@2.20.1%gcc@7.2.0~tcltk arch=linux-rhel6-x86_64\r\n -   sbhfryx          ^curl@7.63.0%gcc@7.2.0~darwinssl~gssapi~libssh~libssh2~nghttp2 arch=linux-rhel6-x86_64\r\n -   z2qfmtc          ^expat@2.2.9%gcc@7.2.0+libbsd arch=linux-rhel6-x86_64\r\n -   5ncvr6g              ^libbsd@0.9.1%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   zzbkzji          ^gettext@0.20.1%gcc@7.2.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-rhel6-x86_64\r\n -   zlyhddn              ^bzip2@1.0.8%gcc@7.2.0+shared arch=linux-rhel6-x86_64\r\n -   p5gcyal              ^libxml2@2.9.9%gcc@7.2.0~python arch=linux-rhel6-x86_64\r\n -   4mfrw3e                  ^xz@5.2.4%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   ea6lvla              ^tar@1.31%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   njk2pzu          ^libtool@2.4.6%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   aofumyv          ^pcre@8.42%gcc@7.2.0+jit+multibyte+utf arch=linux-rhel6-x86_64\r\n -   vx2iy34      ^ninja-fortran@1.9.0.2.g99df1%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   bfndwzi          ^python@2.7.15%gcc@7.2.0+bz2+ctypes+dbm+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4~uuid+zlib arch=linux-rhel6-x86_64\r\n -   3kyw4xp              ^libffi@3.2.1%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n -   6fozjh5              ^sqlite@3.30.1%gcc@7.2.0~column_metadata+fts~functions~rtree arch=linux-rhel6-x86_64\r\n -   rjakshk      ^util-macros@1.19.1%gcc@7.2.0 arch=linux-rhel6-x86_64\r\n```\r\n\r\nbut there was a build error in the package 'perl' reported in #13505 so it never got to actually build python@2.1.15.  But when I go  to run the spack command after this:\r\n\r\n```\r\n./atdm-spack/spack/bin/spack compiler find --scope site\r\n```\r\n\r\nit dies with:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"./atdm-spack/spack/bin/spack\", line 64, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/home/rabartl/Spack.base4/atdm-spack/spack/lib/spack/spack/main.py\", line 653, in main\r\n    ev.activate(env, args.use_env_repo)\r\n  File \"/home/rabartl/Spack.base4/atdm-spack/spack/lib/spack/spack/environment.py\", line 163, in activate\r\n    cmds += env.add_default_view_to_shell(shell)\r\n  File \"/home/rabartl/Spack.base4/atdm-spack/spack/lib/spack/spack/environment.py\", line 1074, in add_default_view_to_shell\r\n    spec, self.default_view))\r\n  File \"/home/rabartl/Spack.base4/atdm-spack/spack/lib/spack/spack/environment.py\", line 1055, in environment_modifications_for_spec\r\n    spec, context='run'\r\n  File \"/home/rabartl/Spack.base4/atdm-spack/spack/lib/spack/spack/build_environment.py\", line 759, in modifications_from_dependencies\r\n    dpkg.setup_dependent_package(pkg.module, spec)\r\n  File \"/home/rabartl/Spack.base4/atdm-spack/spack/var/spack/repos/builtin/packages/python/package.py\", line 729, in setup_dependent_package\r\n    module.setup_py = Executable(\r\n  File \"/home/rabartl/Spack.base4/atdm-spack/spack/var/spack/repos/builtin/packages/python/package.py\", line 526, in command\r\n    \r\nRuntimeError: Unable to locate python command in /home/rabartl/Spack.base4/atdm-spack/spack/opt/spack/linux-rhel6-x86_64/gcc-7.2.0/python-2.7.15-bfndwzimloeo5odtb656tkcsid4jzg42/bin\r\n```\r\n\r\nWhat is spack doing that it things that this python actually got installed?  This is new behavior for spack.\r\n\r\nHow can I work around this for now?  This is a major impediment to upgrading spack to version 0.13.0.\r\n\r\n\r\n\r\n\r\n",
    "user": "bartlettroscoe",
    "url": "https://api.github.com/repos/spack/spack/issues/13509",
    "updated_at": "2019-11-07 18:56:57",
    "created_at": "2019-10-30 17:16:44",
    "closed_at": "2019-11-06 21:45:45",
    "state": "closed",
    "title": "Spack trying to use a python that it was told to build but never actually built",
    "number": 13509,
    "milestone": null,
    "labels": [
        "bug",
        "snl-atdm"
    ],
    "id": 514844095,
    "html_url": "https://github.com/spack/spack/issues/13509",
    "assignees": [
        "scheibelp"
    ],
    "comments": 5
}