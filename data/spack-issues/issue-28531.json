{
    "body": "`tau %clang` requires `cmake` for the `LLVM Plugin` (according to output below)\r\n\r\nWithout this PR, this is the error you see trying to `spack install tau%clang +mpi +python` for example:\r\n\r\n```\r\n$> spack install tau%clang +mpi +python\r\n...\r\n==> Installing tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3\r\n==> No binary for tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3 found: installing from source\r\n==> Warning: microarchitecture specific optimizations are not supported yet on mixed compiler toolchains [check clang@13.0.0 for further details]\r\n==> Fetching https://mirror.spack.io/_source-cache/archive/27/27e73c395dd2a42b91591ce4a76b88b1f67663ef13aa19ef4297c68f45d946c2.tar.gz\r\n==> No patches needed for tau\r\n==> tau: Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16' 'install'\r\n\r\n15 errors found in build log:\r\n     94      TAU: PDT: Using binary rewriting capabilities from PEBIL in tau_pebil_rewrite\r\n     95      ====================================================\r\n     96       Copy /tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/tools/src/contrib/CubeReader.jar to /spack/opt/spack/linux-ubuntu20.04-x86_64/clang\r\n             -13.0.0/tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/x86_64/lib\r\n     97      ====================================================\r\n     98      ... done\r\n     99      ***********************************************************************\r\n  >> 100     grep: ./utils/FixMakefile.info: No such file or directory\r\n  >> 101     grep: ./utils/FixMakefile.sed: No such file or directory\r\n     102     NOTE: Saving configuration environment to /tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/.configure_env/b9693f2a7407817ef7ec08632f9276c4\r\n     103     NOTE: flang compiler for Linux options used\r\n     104     NOTE: using newer flang compiler-based instrumentation option\r\n     105     NOTE: Using CLANG C++ compiler\r\n     106     NOTE: Enabled Profiling. Compiling with -DPROFILING_ON\r\n     107     NOTE: Building POSIX I/O wrapper\r\n\r\n     ...\r\n\r\n     224     rm -Rf build\r\n     225     make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/plugins/llvm'\r\n     226     make[1]: Entering directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/instrument'\r\n     227     /bin/rm -f simple.o simple\r\n     228     make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/instrument'\r\n     229     make[1]: Entering directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/threads'\r\n  >> 230     Makefile:16: /tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/x86_64/lib/Makefile.tau-clang-papi-mpi-pthread-python-pdt: No such file or d\r\n             irectory\r\n  >> 231     make[1]: *** No rule to make target '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/x86_64/lib/Makefile.tau-clang-papi-mpi-pthread-pytho\r\n             n-pdt'.  Stop.\r\n     232     make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/threads'\r\n     233     make[1]: Entering directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/cthreads'\r\n  >> 234     Makefile:16: /tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/x86_64/lib/Makefile.tau-clang-papi-mpi-pthread-python-pdt: No such file or d\r\n             irectory\r\n  >> 235     make[1]: *** No rule to make target '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/x86_64/lib/Makefile.tau-clang-papi-mpi-pthread-pytho\r\n             n-pdt'.  Stop.\r\n     236     make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/cthreads'\r\n     237     make[1]: Entering directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/fortran'\r\n     238     /bin/rm -f hello.o hello\r\n     239     make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/fortran'\r\n     240     make[1]: Entering directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/f90'\r\n     241     /bin/rm -f cubes.o cubes\r\n     242     make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/f90'\r\n     243     make[1]: Entering directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/pi'\r\n  >> 244     Makefile:16: /tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/x86_64/lib/Makefile.tau-clang-papi-mpi-pthread-python-pdt: No such file or d\r\n             irectory\r\n  >> 245     make[1]: *** No rule to make target '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/x86_64/lib/Makefile.tau-clang-papi-mpi-pthread-pytho\r\n             n-pdt'.  Stop.\r\n     246     make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/pi'\r\n     247     make[1]: Entering directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/NPB2.3'\r\n     248     rm -f core\r\n     249     rm -f *~ */core */*~ */*.o */npbparams.h */*.obj */*.exe\r\n     250     rm -f MPI_dummy/test MPI_dummy/libmpi.a\r\n     251     rm -f sys/setparams sys/makesuite sys/setparams.h\r\n     252     make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/NPB2.3'\r\n     253     make[1]: Entering directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/autoinstrument'\r\n  >> 254     Makefile:16: /tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/x86_64/lib/Makefile.tau-clang-papi-mpi-pthread-python-pdt: No such file or d\r\n             irectory\r\n  >> 255     make[1]: *** No rule to make target '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/x86_64/lib/Makefile.tau-clang-papi-mpi-pthread-pytho\r\n             n-pdt'.  Stop.\r\n     256     make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/autoinstrument'\r\n     257     make[1]: Entering directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/reduce'\r\n  >> 258     Makefile:16: /tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/x86_64/lib/Makefile.tau-clang-papi-mpi-pthread-python-pdt: No such file or d\r\n             irectory\r\n  >> 259     make[1]: *** No rule to make target '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/x86_64/lib/Makefile.tau-clang-papi-mpi-pthread-pytho\r\n             n-pdt'.  Stop.\r\n     260     make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/examples/reduce'\r\n     261     touch .clean\r\n     262     Determining Configuration...\r\n     263     System previously configured as a x86_64\r\n     264     *********** RECURSIVELY MAKING SUBDIRECTORIES ***********\r\n     265     *** COMPILING src/TraceInput DIRECTORY\r\n\r\n     ...\r\n\r\n     2504    make[2]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/plugins/examples'\r\n     2505    make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/plugins'\r\n     2506    *** COMPILING plugins/llvm DIRECTORY\r\n     2507    make[1]: Entering directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/plugins/llvm'\r\n     2508    bash -c \"if [ ! -d build ] ; then mkdir build ; fi\"\r\n     2509    cd build &&   .. -DLLVM_DIR=/bootstrap/base/install/linux-ubuntu20.04-x86_64/gcc-11.1.0/llvm-doe-13.0.0-a362ln4xexebtq577wxqgbxhsdehcn77/ -G 'Unix Makefiles' -DCMAKE_INSTALL_P\r\n             REFIX=/spack/opt/spack/linux-ubuntu20.04-x86_64/clang-13.0.0/tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/x86_64/lib/shared-clang-papi-mpi-pthread-python-pdt/plugins -DCMAKE_CXX_\r\n             COMPILER=/usr/bin/g++ && make -j install\r\n  >> 2510    /bin/sh: 1: ..: Permission denied\r\n  >> 2511    make[1]: *** [Makefile:11: install] Error 127\r\n     2512    make[1]: Leaving directory '/tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-src/plugins/llvm'\r\n  >> 2513    make: *** [Makefile:192: install] Error 2\r\n\r\nSee build log for details:\r\n  /tmp/root/spack-stage/spack-stage-tau-2.31-jdpuebpp6gzcolg3d62k6b4vsc2zana3/spack-build-out.txt\r\n```\r\n\r\nAnd from the build log:\r\n```\r\n...\r\nDefault C++ compiler will be clang++\r\n./configure: line 85: cmake: command not found\r\n./configure: line 86: cmake: command not found\r\nCMAKE VERSION:\r\nWHICH CMAKE:\r\nERROR: cmake version 3.14+ is required for LLVM plugin. Trying module load cmake.\r\nLmod has detected the following error: The following module(s) are unknown:\r\n\"cmake\"\r\n...\r\n```\r\n\r\n@wspear @sameershende ",
    "user": "eugeneswalker",
    "url": "https://api.github.com/repos/spack/spack/issues/28531",
    "updated_at": "2022-01-25 17:18:57",
    "created_at": "2022-01-21 01:32:15",
    "closed_at": "2022-01-25 17:18:57",
    "state": "closed",
    "title": "tau: %clang needs cmake for build",
    "number": 28531,
    "milestone": null,
    "labels": [
        "dependencies",
        "update-package",
        "e4s"
    ],
    "id": 1109954190,
    "html_url": "https://github.com/spack/spack/pull/28531",
    "assignees": [],
    "comments": 0
}