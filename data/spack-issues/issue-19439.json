{
    "body": "Once a spack built python linked to an external openssl (the system wide one) is loaded (whether by itself or as a dependent or in a environment) spack commands fail. \r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\nsajid@LAPTOP-CDJT2P3R /m/c/U/sajid> which python3\r\n/usr/bin/python3\r\nsajid@LAPTOP-CDJT2P3R /m/c/U/sajid> spack find -lv python\r\n==> 1 installed package\r\n-- linux-ubuntu20.04-zen2 / gcc@9.3.0 ---------------------------\r\nxvkj7ej python@3.8.6+bz2+ctypes+dbm~debug+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93189bc278fbc37a50ed7f183bd8aaf249a8e1670a465f0db6bb4f8cf87\r\nsajid@LAPTOP-CDJT2P3R /m/c/U/sajid> spack load /xvk\r\nsajid@LAPTOP-CDJT2P3R /m/c/U/sajid> spack find --loaded\r\nTraceback (most recent call last):\r\n  File \"/home/sajid/packages/spack/bin/spack\", line 63, in <module>\r\n    import spack.main  # noqa\r\n  File \"/home/sajid/packages/spack/lib/spack/spack/main.py\", line 31, in <module>\r\n    import spack.architecture\r\n  File \"/home/sajid/packages/spack/lib/spack/spack/architecture.py\", line 69, in <module>\r\n    import spack.compiler\r\n  File \"/home/sajid/packages/spack/lib/spack/spack/compiler.py\", line 20, in <module>\r\n    import spack.spec\r\n  File \"/home/sajid/packages/spack/lib/spack/spack/spec.py\", line 105, in <module>\r\n    import spack.repo\r\n  File \"/home/sajid/packages/spack/lib/spack/spack/repo.py\", line 34, in <module>\r\n    import spack.caches\r\n  File \"/home/sajid/packages/spack/lib/spack/spack/caches.py\", line 15, in <module>\r\n    import spack.fetch_strategy\r\n  File \"/home/sajid/packages/spack/lib/spack/spack/fetch_strategy.py\", line 41, in <module>\r\n    import spack.util.web as web_util\r\n  File \"/home/sajid/packages/spack/lib/spack/spack/util/web.py\", line 15, in <module>\r\n    import ssl\r\n  File \"/home/sajid/packages/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/python-3.8.6-xvkj7ejpc5ox2wb2zuiiszucpsy5h62q/lib/python3.8/ssl.py\", line 98, in <module>\r\n    import _ssl             # if we can't import it, let the error propagate\r\nModuleNotFoundError: No module named '_ssl'\r\nsajid@LAPTOP-CDJT2P3R /m/c/U/sajid>\r\n```\r\n\r\n### Error Message\r\nStacktrace is as shown above.\r\n\r\n### Information on your system\r\n\r\n```\r\nsajid@LAPTOP-CDJT2P3R ~/p/spack (develop)> git shortlog -n1\r\niarspider (1):\r\n      Lhapdf extends python (#19398)\r\n\r\nsajid@LAPTOP-CDJT2P3R ~/p/spack (develop)> spack debug report\r\n* **Spack:** 0.11.2-9270-d9bb90d06\r\n* **Python:** 3.8.2\r\n* **Platform:** linux-ubuntu20.04-zen2\r\nsajid@LAPTOP-CDJT2P3R ~/p/spack (develop)>\r\n```\r\n\r\n```\r\nsajid@LAPTOP-CDJT2P3R ~> cat .spack/packages.yaml\r\npackages:\r\n  perl:\r\n    externals:\r\n    - spec: perl@5.30.0~cpanm+shared+threads\r\n      prefix: /\r\n  openssl:\r\n    externals:\r\n    - spec: openssl@1.1.1f\r\n      prefix: /\r\n  cmake:\r\n    externals:\r\n    - spec: cmake@3.16.3\r\n      prefix: /\r\nsajid@LAPTOP-CDJT2P3R ~>\r\n```\r\n\r\n```\r\nsajid@LAPTOP-CDJT2P3R ~> cat .spack/linux/compilers.yaml\r\ncompilers:\r\n- compiler:\r\n    spec: gcc@9.3.0\r\n    paths:\r\n      cc: /usr/bin/gcc\r\n      cxx: /usr/bin/g++\r\n      f77: /usr/bin/gfortran\r\n      fc: /usr/bin/gfortran\r\n    flags: {}\r\n    operating_system: ubuntu20.04\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n- compiler:\r\n    spec: 'clang@11.0.0\r\n\r\n      Target:'\r\n    paths:\r\n      cc: /home/sajid/packages/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/llvm-11.0.0-rvxghsel3dq2v35ynccuo5jjkfrokxlr/bin/clang\r\n      cxx: /home/sajid/packages/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/llvm-11.0.0-rvxghsel3dq2v35ynccuo5jjkfrokxlr/bin/clang++\r\n      f77:\r\n      fc:\r\n    flags: {}\r\n    operating_system: ubuntu20.04\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\nsajid@LAPTOP-CDJT2P3R ~>\r\n```\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output\r\n\r\nRelated https://github.com/spack/spack/issues/13902\r\n\r\nPS : I've seen this bug on multiple platforms recently.\r\n\r\nPPS : `spack load llvm && spack compiler find` for a spack built `llvm` gives an erroneous entry in `compilers.yaml` (see the above for clang's `spec`). Is this a known bug ?\r\n\r\n<!-- We encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively!\r\n\r\nIf you want to ask a question about the tool (how to use it, what it can currently do, etc.), try the `#general` channel on our Slack first. We have a welcoming community and chances are you'll get your reply faster and without opening an issue.\r\n\r\nOther than that, thanks for taking the time to contribute to Spack! -->\r\n",
    "user": "s-sajid-ali",
    "url": "https://api.github.com/repos/spack/spack/issues/19439",
    "updated_at": "2020-10-21 22:09:39",
    "created_at": "2020-10-21 13:27:58",
    "closed_at": "2020-10-21 21:20:45",
    "state": "closed",
    "title": "Spack built python does not link to ssl",
    "number": 19439,
    "milestone": null,
    "labels": [
        "bug",
        "python",
        "triage"
    ],
    "id": 726488602,
    "html_url": "https://github.com/spack/spack/issues/19439",
    "assignees": [],
    "comments": 6
}