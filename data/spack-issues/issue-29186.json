{
    "body": "### Steps to reproduce\r\n\r\nBinary relocation of some packages with spack smoke tests does not relocate strings needed for the tests.\r\n\r\nFor example, `superlu-dist` built in a long path, cached, and then installed to a short path:\r\n\r\n```\r\n$> grep -Inr placeholder $(spack location -i superlu-dist)/.spack/test\r\n...\r\n/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/superlu-dist-7.2.0-mml2dkzs2j4wmfjw3hgqwxtgsg7pcooc/.spack/test/make.inc:63:CXX          = /spack/opt/spack/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholde/linux-ubuntu20.04-x86_64/gcc-9.3.0/mpich-3.4.2-b2hsqqqnsiodzp3kw63u425osorilfty/bin/mpic++\r\n/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/superlu-dist-7.2.0-mml2dkzs2j4wmfjw3hgqwxtgsg7pcooc/.spack/test/make.inc:72:LOADER       = /spack/opt/spack/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholde/linux-ubuntu20.04-x86_64/gcc-9.3.0/mpich-3.4.2-b2hsqqqnsiodzp3kw63u425osorilfty/bin/mpic++\r\n```\r\n\r\nAs a result:\r\n```\r\n$> spack test run superlu-dist\r\n...\r\n==> Spack test vsvxgi2wnywtn4zo2n7dlufn7motg6l7\r\n==> Testing package superlu-dist-7.2.0-mml2dkz\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16' 'pddrive'\r\n\r\n1 error found in test log:\r\n     4     ==> [2022-02-24-07:47:58.575778] FILTER FILE: /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/superlu-dist-7.2.0-mml2dkzs2j4wmfjw3hgqwxtg\r\n           sg7pcooc/.spack/test/make.inc [replacing \"^LIBS.+\\+=.+\"]\r\n     5     ==> [2022-02-24-07:47:58.719216] FILTER FILE: /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/superlu-dist-7.2.0-mml2dkzs2j4wmfjw3hgqwxtg\r\n           sg7pcooc/.spack/test/make.inc [replacing \"^LIBS[^\\+]+=.+\"]\r\n     6     ==> [2022-02-24-07:47:58.722301] FILTER FILE: /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/superlu-dist-7.2.0-mml2dkzs2j4wmfjw3hgqwxtg\r\n           sg7pcooc/.spack/test/make.inc [replacing \"^LOADOPTS.+\"]\r\n     7     ==> [2022-02-24-07:47:58.723600] 'make' '-j16' 'pddrive'\r\n     8     /spack/opt/spack/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_pla\r\n           ceholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholde/linux-ubuntu20.04-x86_64/\r\n           gcc-9.3.0/mpich-3.4.2-b2hsqqqnsiodzp3kw63u425osorilfty/bin/mpicc -O3 -DNDEBUG -I/spack/opt/spack/__spack_path_placeholder__/__spack_path_plac\r\n           eholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholde\r\n           r__/__spack_path_placeholder__/__spack_path_placeholde/linux-ubuntu20.04-x86_64/gcc-9.3.0/metis-5.1.0-vds2a7ehbmqig5t4e5albl6ivgtl4mvm/includ\r\n           e -I/spack/opt/spack/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path\r\n           _placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholde/linux-ubuntu20.04-x86\r\n           _64/gcc-9.3.0/parmetis-4.0.3-545mtgbbbzffl3mdpx67jubb5r7cgzjg/include -DUSE_VENDOR_BLAS  -std=c99 -fPIC   -I/spack/opt/spack/__spack_path_pla\r\n           ceholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placehold\r\n           er__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholde/linux-ubuntu20.04-x86_64/gcc-9.3.0/superlu-dist-7.2.0-mml2\r\n           dkzs2j4wmfjw3hgqwxtgsg7pcooc/include -c pddrive.c\r\n     9     make: /spack/opt/spack/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_pa\r\n           th_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholder__/__spack_path_placeholde/linux-ubuntu20.04-x\r\n           86_64/gcc-9.3.0/mpich-3.4.2-b2hsqqqnsiodzp3kw63u425osorilfty/bin/mpicc: Command not found\r\n  >> 10    make: *** [Makefile:170: pddrive.o] Error 127\r\n\r\nSee test log for details:\r\n  /root/.spack/test/vsvxgi2wnywtn4zo2n7dlufn7motg6l7/superlu-dist-7.2.0-mml2dkz-test-out.txt\r\n```\r\n\r\n@wspear @tldahlgren @balay @pghysels @liuyangzhua\r\n\r\n### Error message\r\n\r\n_No response_\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.17.1\r\n* **Python:** 3.9.5\r\n* **Platform:** linux-ubuntu20.04-zen2\r\n* **Concretizer:** clingo\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "eugeneswalker",
    "url": "https://api.github.com/repos/spack/spack/issues/29186",
    "updated_at": "2022-02-24 18:24:30",
    "created_at": "2022-02-24 15:51:10",
    "closed_at": "None",
    "state": "open",
    "title": "Binary relocation doesn't relocate paths needed for Spack smoke tests",
    "number": 29186,
    "milestone": null,
    "labels": [
        "bug",
        "impact-medium",
        "binary-packages",
        "stand-alone-tests"
    ],
    "id": 1149451875,
    "html_url": "https://github.com/spack/spack/issues/29186",
    "assignees": [],
    "comments": 1
}