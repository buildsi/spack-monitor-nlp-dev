{
    "body": "### Steps to reproduce\n\nThis is something that I have noticed on unrelated project: when I use the default `/usr/bin/make` it has the following behavior:\r\n```console\r\nlfortran/integration_tests(cpp14) $ make -j   \r\nmake[1]: /Library/Developer/CommandLineTools/usr/bin/make: Permission denied\r\nmake[1]: /Library/Developer/CommandLineTools/usr/bin/make: Permission denied\r\nmake[1]: *** [CMakeFiles/return_04.dir/all] Error 1\r\nmake[1]: *** Waiting for unfinished jobs....\r\nmake[1]: *** [CMakeFiles/sin_03.dir/all] Error 1\r\nmake[1]: /Library/Developer/CommandLineTools/usr/bin/make: Permission denied\r\nmake[1]: /Library/Developer/CommandLineTools/usr/bin/make: Permission denied\r\nmake[1]: *** [CMakeFiles/sin_01.dir/all] Error 1\r\nmake[1]: *** [CMakeFiles/abs_03.dir/all] Error 1\r\n[  0%] Building Fortran object CMakeFiles/class_02.dir/class_02.f90.o\r\n[  0%] Linking Fortran executable class_02\r\n[  0%] Built target class_02\r\nmake: *** [all] Error 2\r\nlfortran/integration_tests(cpp14) $ make -j3\r\nmake[1]: /Library/Developer/CommandLineTools/usr/bin/make: Permission denied\r\nmake[1]: /Library/Developer/CommandLineTools/usr/bin/make: Permission denied\r\nmake[1]: *** [CMakeFiles/sin_03.dir/all] Error 1\r\nmake[1]: *** Waiting for unfinished jobs....\r\nmake[1]: *** [CMakeFiles/sin_01.dir/all] Error 1\r\n[  0%] Building Fortran object CMakeFiles/abs_03.dir/abs_03.f90.o\r\n[  1%] Linking Fortran executable abs_03\r\n[  1%] Built target abs_03\r\nmake: *** [all] Error 2\r\nlfortran/integration_tests(cpp14) $ make -j2\r\nmake[1]: /Library/Developer/CommandLineTools/usr/bin/make: Permission denied\r\nmake[1]: /Library/Developer/CommandLineTools/usr/bin/make: Permission denied\r\nmake[1]: *** [CMakeFiles/sin_03.dir/all] Error 1\r\nmake[1]: *** Waiting for unfinished jobs....\r\nmake[1]: *** [CMakeFiles/sin_01.dir/all] Error 1\r\nmake: *** [all] Error 2\r\nlfortran/integration_tests(cpp14) $ make -j1\r\n[  0%] Building Fortran object CMakeFiles/sin_03.dir/sin_03.f90.o\r\n[  0%] Linking Fortran executable sin_03\r\n[  0%] Built target sin_03\r\n[  0%] Building Fortran object CMakeFiles/sin_01.dir/sin_01.f90.o\r\n[  0%] Linking Fortran executable sin_01\r\n[  0%] Built target sin_01\r\n[  1%] Built target abs_03\r\n[  1%] Built target class_02\r\n[  1%] Building Fortran object CMakeFiles/return_04.dir/return_04.f90.o\r\n[  2%] Linking Fortran executable return_04\r\n[  2%] Built target return_04\r\n[  2%] Building Fortran object CMakeFiles/return_02.dir/return_02.f90.o\r\n[  3%] Linking Fortran executable return_02\r\n[  3%] Built target return_02\r\n[  3%] Building Fortran object CMakeFiles/return_01.dir/return_01.f90.o\r\n[  3%] Linking Fortran executable return_01\r\n[  3%] Built target return_01\r\n...\r\n```\r\n\r\nBut if I use the `make` from Conda, then it works just fine in parallel.\r\n\r\nI am reporting this as a standalone issue, because this seems to be happening on both of my two macs, the MacBook Pro 2019 (Intel) and 2020 (M1). As a consequence, this then triggers hard to debug errors, in particular:\r\n\r\n* #25598\r\n* https://github.com/spack/spack/issues/26667#issuecomment-940520983\r\n\r\nThey are all caused by the fact that Spack calls the make from macOS with -j8 (or whatever) and it fails with permission issues. However you can't tell that they are coming from make itself! Very hard to debug.\r\n\r\nIt's probably some permission issue, but what could it be? It would be nice to figure out, now when we have isolated the bug.\r\n\r\nAnd a workaround is also super simple: just use `spack install -j1`.  Now, it gets tricky, because due to this Spack also does not bootstrap, but one can just see what packages it is trying to build, and then build them directly with `spack install -j1 zlib` and such. That way it seems one can build everything.\n\n### Error message\n\nN/A\n\n### Information on your system\n\nN/A\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "certik",
    "url": "https://api.github.com/repos/spack/spack/issues/26669",
    "updated_at": "2021-10-16 12:20:10",
    "created_at": "2021-10-11 23:51:26",
    "closed_at": "None",
    "state": "open",
    "title": "Builtin make on macOS often does not work with any -j besides -j1 (Permission denied)",
    "number": 26669,
    "milestone": null,
    "labels": [
        "bug",
        "macOS",
        "makefile",
        "triage"
    ],
    "id": 1023219298,
    "html_url": "https://github.com/spack/spack/issues/26669",
    "assignees": [],
    "comments": 16
}