{
    "body": "This PR changes spack to use the full hash as the key for binary mirrors (and, as such, requires #26952), while continuing to use the DAG hash as the key for installs.  \r\n\r\nSome expected benefits of using the full hash to key buildcaches:\r\n\r\n- There's a one-to-many relationship between DAG hash and full hashes, so before this change, only one of those full hashes could be present in a binary mirror at one time.\r\n- Keying buildcaches by full hash will remove need to splice `spec.json` files in the process of updating a buildcache index, speeding up the process and making it less error-prone.\r\n\r\nSome questions/issues raised by this PR:\r\n\r\n- [ ] What's the best way to handle (or not) backwards compatibility with buildcaches generated by older spacks, e.g.:\r\n  * [ ] We need to figure out what to do about bootstrapping mirrors, which currently contain binaries using the DAG hash (file naming and in the index), and #26952 makes it an error if spack encounters a buildcache index keyed by DAG hash.\r\n  * [ ] Also, gitlab pipelines using this branch fail on existing binary mirrors due to above issue.\r\n- [ ] With this change, we will no longer be able to support users *not* providing `--require-full-hash-match` in the same way we supported before, unless the mirror containing the target binary pkg has an index.  To be clear, this is the case where you would otherwise be satisfied with only the DAG hash matching, and would not want to constrain the installation further by insisting on full hash match.  We have ensured this functionality is preserved by testing it with  `lib/spack/spack/test/cmd/install.py::test_cache_install_full_hash_match`, which is now failing.  ",
    "user": "scottwittenburg",
    "url": "https://api.github.com/repos/spack/spack/issues/27492",
    "updated_at": "2021-12-16 20:41:14",
    "created_at": "2021-11-16 20:34:18",
    "closed_at": "None",
    "state": "open",
    "title": "Buildcaches: Use full hash as key for buildcache and ci ",
    "number": 27492,
    "milestone": null,
    "labels": [
        "modules",
        "tests",
        "commands",
        "environments",
        "binary-packages"
    ],
    "id": 1055295561,
    "html_url": "https://github.com/spack/spack/pull/27492",
    "assignees": [],
    "comments": 42
}