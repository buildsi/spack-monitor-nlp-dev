{
    "body": "### Steps to reproduce\n\nDevelop version of spack, and ubuntu 16.04\r\n\r\n```console\r\n$ spack install pkgconf\r\n```\r\nHere is an exact Dockerfile to reproduce it\r\n```dockerfile\r\nFROM ubuntu:16.04@sha256:454054f5bbd571b088db25b662099c6c7b3f0cb78536a2077d54adc48f00cd68\r\n\r\n# docker build -t ghcr.io/rse-radiuss/ubuntu:<version> .\r\n\r\nARG uptodate_github_commit_spack__spack__develop=4e1fdfeb18c7ce02a09103cff2b556cf15feee49\r\nENV spack_commit=${uptodate_github_commit_spack__spack__develop}\r\nENV DEBIAN_FRONTEND=noninteractive\r\nENV TZ=America/Los_Angeles\r\n\r\nLABEL maintainer=\"David Beckingsale <david@llnl.gov>,@vsoch\"\r\n\r\nRUN apt-get -qq update && \\\r\n    apt-get -qq install -y --no-install-recommends \\\r\n      build-essential \\\r\n      ca-certificates \\\r\n      curl \\\r\n      dh-autoreconf \\\r\n      git \\\r\n      gnupg2 \\\r\n      libssl-dev \\\r\n      ninja-build \\\r\n      python-dev \\ \r\n      python3-pip \\\r\n      python3-setuptools \\\r\n      sudo \\\r\n      valgrind \\\r\n      vim \\\r\n      wget\r\n\r\n# Install spack\r\nWORKDIR /opt\r\nRUN git clone https://github.com/spack/spack && \\\r\n    cd spack && \\\r\n    git reset --hard ${spack_commit}\r\nENV PATH=/opt/spack/bin:$PATH\r\n\r\n# Use the autamus build cache for maybe faster install?\r\nRUN python3 -m pip install botocore boto3 && \\\r\n    spack mirror add autamus s3://autamus-cache && \\\r\n    curl http://s3.amazonaws.com/autamus-cache/build_cache/_pgp/FFEB24B0A9D81F6D5597F9900B59588C86C41BE7.pub > key.pub && \\\r\n    spack gpg trust key.pub\r\n```\r\nTo build and run\r\n```bas\r\n$ docker build -t pancakes .\r\n$ docker run -it pancakes\r\n# spack install pkgconf\r\n```\r\n\n\n### Error message\n\n```console\r\nroot@1437bf099b36:/opt# spack install pkgconf\r\n==> Installing pkgconf-1.8.0-wrfzcxiwuxp6n35gbncfhkne3rorsypj\r\n==> Error: Failed to install pkgconf due to SyntaxError: invalid syntax (auth.py, line 121)\r\n==> Error: invalid syntax (auth.py, line 121)\r\n```\r\n\r\nI think the Python is too old - and the package should have a constraint:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/opt/spack/bin/spack\", line 100, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/opt/spack/lib/spack/spack/main.py\", line 814, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/opt/spack/lib/spack/spack/main.py\", line 527, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/opt/spack/lib/spack/spack/cmd/install.py\", line 473, in install\r\n    install_specs(args, kwargs, zip(abstract_specs, specs))\r\n  File \"/opt/spack/lib/spack/spack/cmd/install.py\", line 274, in install_specs\r\n    builder.install()\r\n  File \"/opt/spack/lib/spack/spack/installer.py\", line 1612, in install\r\n    self._install_task(task)\r\n  File \"/opt/spack/lib/spack/spack/installer.py\", line 1144, in _install_task\r\n    full_hash_match):\r\n  File \"/opt/spack/lib/spack/spack/installer.py\", line 279, in _install_from_cache\r\n    pkg, explicit, unsigned=unsigned, full_hash_match=full_hash_match)\r\n  File \"/opt/spack/lib/spack/spack/installer.py\", line 405, in _try_install_from_binary_cache\r\n    pkg.spec, full_hash_match=full_hash_match)\r\n  File \"/opt/spack/lib/spack/spack/binary_distribution.py\", line 1547, in get_mirrors_for_spec\r\n    mirrors=mirrors_to_check)\r\n  File \"/opt/spack/lib/spack/spack/binary_distribution.py\", line 1465, in try_direct_fetch\r\n    _, _, fs = web_util.read_from_url(buildcache_fetch_url_json)\r\n  File \"/opt/spack/lib/spack/spack/util/web.py\", line 127, in read_from_url\r\n    response = _urlopen(req, timeout=_timeout, context=context)\r\n  File \"/opt/spack/lib/spack/spack/util/web.py\", line 526, in _urlopen\r\n    return opener(req, *args, **kwargs)\r\n  File \"/usr/lib/python3.5/urllib/request.py\", line 466, in open\r\n    response = self._open(req, data)\r\n  File \"/usr/lib/python3.5/urllib/request.py\", line 484, in _open\r\n    '_open', req)\r\n  File \"/usr/lib/python3.5/urllib/request.py\", line 444, in _call_chain\r\n    result = func(*args)\r\n  File \"/opt/spack/lib/spack/spack/s3_handler.py\", line 66, in s3_open\r\n    url, headers, stream = _s3_open(orig_url)\r\n  File \"/opt/spack/lib/spack/spack/s3_handler.py\", line 44, in _s3_open\r\n    s3 = s3_util.create_s3_session(parsed)\r\n  File \"/opt/spack/lib/spack/spack/util/s3.py\", line 31, in create_s3_session\r\n    from boto3 import Session\r\n  File \"/usr/local/lib/python3.5/dist-packages/boto3/__init__.py\", line 16, in <module>\r\n    from boto3.session import Session\r\n  File \"/usr/local/lib/python3.5/dist-packages/boto3/session.py\", line 17, in <module>\r\n    import botocore.session\r\n  File \"/usr/local/lib/python3.5/dist-packages/botocore/session.py\", line 30, in <module>\r\n    import botocore.client\r\n  File \"/usr/local/lib/python3.5/dist-packages/botocore/client.py\", line 16, in <module>\r\n    from botocore.args import ClientArgsCreator\r\n  File \"/usr/local/lib/python3.5/dist-packages/botocore/args.py\", line 26, in <module>\r\n    from botocore.signers import RequestSigner\r\n  File \"/usr/local/lib/python3.5/dist-packages/botocore/signers.py\", line 19, in <module>\r\n    import botocore.auth\r\n  File \"/usr/local/lib/python3.5/dist-packages/botocore/auth.py\", line 121\r\n    pairs.append(f'{quoted_key}={quoted_value}')\r\n                                              ^\r\nSyntaxError: invalid syntax\r\n```\r\nFormat strings weren't introduced into a bit after 3.5.\n\n### Information on your system\n\nSee the Dockerfile above, that's the system :) And this:\r\n\r\n```\r\n# spack debug report\r\n* **Spack:** 0.16.3-4791-4e1fdfe\r\n* **Python:** 3.5.2\r\n* **Platform:** linux-ubuntu16.04-skylake\r\n* **Concretizer:** clingo\r\n```\r\n\r\nThese issue text boxes are pretty groovy!\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "vsoch",
    "url": "https://api.github.com/repos/spack/spack/issues/26641",
    "updated_at": "2021-10-12 23:39:40",
    "created_at": "2021-10-10 04:17:53",
    "closed_at": "2021-10-12 23:27:36",
    "state": "closed",
    "title": "pkgconf fails install under ubuntu 16.04 because Python doesn't support format strings",
    "number": 26641,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1021875415,
    "html_url": "https://github.com/spack/spack/issues/26641",
    "assignees": [],
    "comments": 7
}