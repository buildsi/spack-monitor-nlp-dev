{
    "body": "### Steps to reproduce\n\n```console\r\n$ spack --config-scope /apps/SPACK/0.17.0/etc/spack/user/ config get repos\r\nrepos:\r\n- $WORK/USER-SPACK/user-repo\r\n- /apps/SPACK/0.17.0/rrze-repo\r\n- $spack/var/spack/repos/builtin\r\n\r\n### $WORK/USER-SPACK/user-repo as defined in the specific config scope is there\r\n### adding -d or -L as command line arguments make $WORK/USER-SPACK/user-repo disappear\r\n\r\n$ spack -L --config-scope /apps/SPACK/0.17.0/etc/spack/user/ config get repos\r\nrepos:\r\n- /apps/SPACK/0.17.0/rrze-repo\r\n- $spack/var/spack/repos/builtin\r\n\r\n### $WORK/USER-SPACK/user-repo is missing!\r\n\r\n$ spack -d --config-scope /apps/SPACK/0.17.0/etc/spack/user/ config get repos\r\n==> [2021-11-07-20:54:02.108793] Imported config from built-in commands\r\n==> [2021-11-07-20:54:02.110781] Imported config from built-in commands\r\n==> [2021-11-07-20:54:02.111175] Reading config file /apps/SPACK/0.17.0/etc/spack/defaults/repos.yaml\r\n==> [2021-11-07-20:54:02.113025] Reading config file /apps/SPACK/0.17.0/etc/spack/repos.yaml\r\nrepos:\r\n- /apps/SPACK/0.17.0/rrze-repo\r\n- $spack/var/spack/repos/builtin\r\n\r\n### $WORK/USER-SPACK/user-repo is missing!\r\n\r\n$ cat /apps/SPACK/0.17.0/etc/spack/user/repos.yaml \r\nrepos:\r\n  - $WORK/USER-SPACK/user-repo\r\n\r\n# repos.yaml in the main installation directory of spack\r\n$ cat /apps/SPACK/0.17.0/etc/spack/repos.yaml \r\nrepos:\r\n  - /apps/SPACK/0.17.0/rrze-repo\r\n```\n\n### Error message\n\nno error message but settings from the ``--config-scope DIR`` are lost with 0.17.0 when ``-d``, or ``-L`` are specified.\r\n\r\nIf the specific yaml files are moves to ``~/.spack/linux/`` their setting is picked up even when ``-d``, or ``-L`` are specified - no output shown here as that's not a solution.\r\n\r\nSeems like the issue from #13754 reappeared with 0.17.0.\r\n\r\n```console\r\n$ spack --config-scope /apps/SPACK/0.17.0/etc/spack/user/ config blame repos\r\n---                                                  repos:\r\n/apps/SPACK/0.17.0/etc/spack/user/repos.yaml:6       - $WORK/USER-SPACK/user-repo\r\n/apps/SPACK/0.17.0/etc/spack/repos.yaml:6            - /apps/SPACK/0.17.0/rrze-repo\r\n/apps/SPACK/0.17.0/etc/spack/defaults/repos.yaml:14  - $spack/var/spack/repos/builtin\r\n\r\n$ spack -L --config-scope /apps/SPACK/0.17.0/etc/spack/user/ config blame repos\r\n---                                                  repos:\r\n/apps/SPACK/0.17.0/etc/spack/repos.yaml:6            - /apps/SPACK/0.17.0/rrze-repo\r\n/apps/SPACK/0.17.0/etc/spack/defaults/repos.yaml:14  - $spack/var/spack/repos/builtin\r\n```\r\n\r\nIn spack-0.16.3 everything still seemed to be fine; i.e. same output with/without -d and -L\r\n```console\r\n$ /apps/SPACK/0.16.3/bin/spack --config-scope /apps/SPACK/0.17.0/etc/spack/user/ config blame repos\r\n---                                                  repos:\r\n/apps/SPACK/0.17.0/etc/spack/user/repos.yaml:6       - $WORK/USER-SPACK/user-repo\r\n/apps/SPACK/0.16.3/etc/spack/repos.yaml:6            - /apps/SPACK/0.16.3/rrze-repo\r\n/apps/SPACK/0.16.3/etc/spack/defaults/repos.yaml:14  - $spack/var/spack/repos/builtin\r\n\r\n$ /apps/SPACK/0.16.3/bin/spack -L --config-scope /apps/SPACK/0.17.0/etc/spack/user/ config blame repos\r\n---                                                  repos:\r\n/apps/SPACK/0.17.0/etc/spack/user/repos.yaml:6       - $WORK/USER-SPACK/user-repo\r\n/apps/SPACK/0.16.3/etc/spack/repos.yaml:6            - /apps/SPACK/0.16.3/rrze-repo\r\n/apps/SPACK/0.16.3/etc/spack/defaults/repos.yaml:14  - $spack/var/spack/repos/builtin\r\n\r\n$ /apps/SPACK/0.16.3/bin/spack -d --config-scope /apps/SPACK/0.17.0/etc/spack/user/ config blame repos\r\n==> [2021-11-07-21:23:45.983828] Imported config from built-in commands\r\n==> [2021-11-07-21:23:45.985530] Imported config from built-in commands\r\n==> [2021-11-07-21:23:45.985985] Reading config file /apps/SPACK/0.16.3/etc/spack/defaults/repos.yaml\r\n==> [2021-11-07-21:23:45.987559] Reading config file /apps/SPACK/0.16.3/etc/spack/repos.yaml\r\n==> [2021-11-07-21:23:45.988474] Reading config file /apps/SPACK/0.17.0/etc/spack/user/repos.yaml\r\n---                                                  repos:\r\n/apps/SPACK/0.17.0/etc/spack/user/repos.yaml:6       - $WORK/USER-SPACK/user-repo\r\n/apps/SPACK/0.16.3/etc/spack/repos.yaml:6            - /apps/SPACK/0.16.3/rrze-repo\r\n/apps/SPACK/0.16.3/etc/spack/defaults/repos.yaml:14  - $spack/var/spack/repos/builtin\r\n```\n\n### Information on your system\n\n* **Spack:** 0.17.0\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-almalinux8-zen3\r\n* **Concretizer:** clingo\r\n\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "tz-rrze",
    "url": "https://api.github.com/repos/spack/spack/issues/27262",
    "updated_at": "2021-11-07 20:28:32",
    "created_at": "2021-11-07 20:27:51",
    "closed_at": "None",
    "state": "open",
    "title": "--config-scope ignored when -d or -L are specified in spack-0.17.0",
    "number": 27262,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1046841926,
    "html_url": "https://github.com/spack/spack/issues/27262",
    "assignees": [],
    "comments": 0
}