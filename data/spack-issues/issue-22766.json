{
    "body": "If you use `spack load` to load any package that uses `spack.util.environment.from_sourcing_file` (**including all Intel packages**), or any package that _depends_ on one of these packages, Spack emits the aforementioned erroneous warning message. We should remove this warning.\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install intel-mkl\r\n$ spack load intel-mkl\r\n```\r\n\r\n### Error Message\r\n\r\n```console\r\n$ spack load intel-mkl\r\n==> Warning: Quotes in command arguments can confuse scripts like configure.\r\n  The following arguments may cause problems when executed:\r\n      source /dev/null &> /dev/null && python3 -c \"import os, json; print(json.dumps(dict(os.environ)))\"\r\n  Quotes aren't needed because spack doesn't use a shell.\r\n  Consider removing them\r\n==> Warning: Quotes in command arguments can confuse scripts like configure.\r\n  The following arguments may cause problems when executed:\r\n      source /opt/intel/compilers_and_libraries_2020.0.166/mac/mkl/bin/mklvars.sh intel64 &> /dev/null && python3 -c \"import os, json; print(json.dumps(dict(os.environ)))\"\r\n  Quotes aren't needed because spack doesn't use a shell.\r\n  Consider removing them\r\n```\r\n\r\n```console\r\n$ spack -d load intel-mkl\r\n==> [2021-04-03-12:58:51.404517] Imported load from built-in commands\r\n==> [2021-04-03-12:58:51.406030] Imported load from built-in commands\r\n==> [2021-04-03-12:58:51.408626] Reading config file /Users/Adam/spack/etc/spack/defaults/config.yaml\r\n==> [2021-04-03-12:58:51.445309] Reading config file /Users/Adam/.spack/config.yaml\r\n==> [2021-04-03-12:58:51.448786] DATABASE LOCK TIMEOUT: 3s\r\n==> [2021-04-03-12:58:51.448919] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2021-04-03-12:58:51.697714] Reading config file /Users/Adam/spack/etc/spack/defaults/repos.yaml\r\n==> [2021-04-03-12:58:54.283298] Reading config file /Users/Adam/spack/etc/spack/defaults/modules.yaml\r\n==> [2021-04-03-12:58:54.300375] Reading config file /Users/Adam/spack/etc/spack/defaults/darwin/modules.yaml\r\n==> [2021-04-03-12:58:54.306236] Reading config file /Users/Adam/.spack/modules.yaml\r\n==> [2021-04-03-12:58:54.552076] Reading config file /Users/Adam/.spack/darwin/compilers.yaml\r\n==> [2021-04-03-12:58:54.582045] normalize_path.normalize_suite_dir:\ttrying /opt/intel/compilers_and_libraries_2020.0.166\r\n==> [2021-04-03-12:58:54.583319] normalize_path.normalize_suite_dir:\tfound 1:\r\n  ['/opt/intel/compilers_and_libraries_2020.0.166']\r\n==> [2021-04-03-12:58:54.584315] normalize_path.normalize_suite_dir:\t/opt/intel/compilers_and_libraries_2020.0.166\r\n==> [2021-04-03-12:58:54.585610] file_to_source.normalize_path:\t/opt/intel/compilers_and_libraries_2020.0.166/mac/mkl/bin/mklvars.sh\r\n==> [2021-04-03-12:58:54.585712] sourcing /opt/intel/compilers_and_libraries_2020.0.166/mac/mkl/bin/mklvars.sh\r\n==> [2021-04-03-12:58:54.587316] Warning: Quotes in command arguments can confuse scripts like configure.\r\n  The following arguments may cause problems when executed:\r\n      source /dev/null &> /dev/null && python3 -c \"import os, json; print(json.dumps(dict(os.environ)))\"\r\n  Quotes aren't needed because spack doesn't use a shell.\r\n  Consider removing them\r\n==> [2021-04-03-12:58:54.587617] '/bin/bash' '-c' 'source /dev/null &> /dev/null && python3 -c \"import os, json; print(json.dumps(dict(os.environ)))\"'\r\n==> [2021-04-03-12:58:54.742466] Warning: Quotes in command arguments can confuse scripts like configure.\r\n  The following arguments may cause problems when executed:\r\n      source /opt/intel/compilers_and_libraries_2020.0.166/mac/mkl/bin/mklvars.sh intel64 &> /dev/null && python3 -c \"import os, json; print(json.dumps(dict(os.environ)))\"\r\n  Quotes aren't needed because spack doesn't use a shell.\r\n  Consider removing them\r\n==> [2021-04-03-12:58:54.742856] '/bin/bash' '-c' 'source /opt/intel/compilers_and_libraries_2020.0.166/mac/mkl/bin/mklvars.sh intel64 &> /dev/null && python3 -c \"import os, json; print(json.dumps(dict(os.environ)))\"'\r\n==> [2021-04-03-12:58:55.186467] '/Users/Adam/spack/opt/spack/darwin-catalina-x86_64/apple-clang-12.0.0/python-3.8.8-hb53qjrjzg2glssozy2xoppjczwuh2bs/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_h_filename; print(get_config_h_filename())'\r\n==> [2021-04-03-12:58:55.371812] '/Users/Adam/spack/opt/spack/darwin-catalina-x86_64/apple-clang-12.0.0/python-3.8.8-hb53qjrjzg2glssozy2xoppjczwuh2bs/bin/python3.8' '-c' 'from distutils.sysconfig import get_config_var; print(get_config_var('\"'\"'prefix'\"'\"'))'\r\n```\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.16.1-2031-d978d72e19\r\n* **Python:** 3.8.7\r\n* **Platform:** darwin-catalina-ivybridge\r\n* **Concretizer:** clingo\r\n\r\n### Additional information\r\n\r\nBasically, the command we are running is:\r\n```console\r\n$ '/bin/bash' '-c' 'source /opt/intel/compilers_and_libraries_2020.0.166/mac/mkl/bin/mklvars.sh intel64 &> /dev/null && python3 -c \"import os, json; print(json.dumps(dict(os.environ)))\"'\r\n```\r\nWhile it's true that the outer set of single quotes is not necessary, the inner set of double quotes is necessary for the command to work. This seems like a false positive. I think the easiest solution is to add a \"ignore_quotes\" kwarg to the `Executable.__call__` method.\r\n\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [x] I have run the failing commands in debug mode and reported the output",
    "user": "adamjstewart",
    "url": "https://api.github.com/repos/spack/spack/issues/22766",
    "updated_at": "2021-04-06 05:13:55",
    "created_at": "2021-04-03 18:03:05",
    "closed_at": "2021-04-06 05:13:55",
    "state": "closed",
    "title": "Quotes aren't needed because spack doesn't use a shell. Consider removing them",
    "number": 22766,
    "milestone": null,
    "labels": [
        "bug",
        "intel",
        "error-messages",
        "impact-low",
        "user-experience",
        "run-environment"
    ],
    "id": 849710333,
    "html_url": "https://github.com/spack/spack/issues/22766",
    "assignees": [],
    "comments": 0
}