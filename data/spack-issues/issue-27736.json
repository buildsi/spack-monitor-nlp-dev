{
    "body": "### Steps to reproduce\n\n```\r\n$spack config edit compilers\r\nupdate cflags, cxxflags and fflags with any flag value say '-O3 -fPIC'\r\n\r\n--snip--\r\n- compiler:\r\n    spec: gcc@11.2.0\r\n    paths:\r\n      cc: /home/amd/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/gcc-11.2.0-36ugcqpr5laqaukcht5ldyi6eh4e4ddu/bin/gcc\r\n      cxx: /home/amd/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/gcc-11.2.0-36ugcqpr5laqaukcht5ldyi6eh4e4ddu/bin/g++\r\n      f77: /home/amd/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/gcc-11.2.0-36ugcqpr5laqaukcht5ldyi6eh4e4ddu/bin/gfortran\r\n      fc: /home/amd/spack/opt/spack/linux-ubuntu20.04-zen2/gcc-9.3.0/gcc-11.2.0-36ugcqpr5laqaukcht5ldyi6eh4e4ddu/bin/gfortran\r\n    flags:\r\n      cflags: -O3 -fPIC\r\n      cxxflags: -O3 -fPIC\r\n      fflags: -O3 -fPIC\r\n    operating_system: ubuntu20.04\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n--snip--\r\n\r\nPass 'c' and 'cxx' flags to spack install command for any spack product\r\nsay:\r\n spack install sqlite cflags=\"-w\" cxxflags=\"-w\" fflags=\"-w\"\r\n```\r\n\n\n### Error message\n\n```\r\n\r\n$ spack --debug --stacktrace install sqlite cflags=\"-w\" cxxflags=\"-w\" fflags=\"-w\"\r\nlib/spack/spack/cmd/__init__.py:123 ==> [2021-12-01-11:36:05.147719] Imported install from built-in commands\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:05.149329] Reading config file /home/amd/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/cmd/__init__.py:123 ==> [2021-12-01-11:36:05.162727] Imported install from built-in commands\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:05.171718] Reading config file /home/amd/spack/etc/spack/defaults/bootstrap.yaml\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:05.177781] Reading config file /home/amd/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/database.py:373 ==> [2021-12-01-11:36:05.190519] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:377 ==> [2021-12-01-11:36:05.190631] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:05.190958] Reading config file /home/amd/spack/etc/spack/defaults/bootstrap.yaml\r\nlib/spack/spack/database.py:373 ==> [2021-12-01-11:36:05.195618] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:377 ==> [2021-12-01-11:36:05.195732] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/bootstrap.py:636 ==> [2021-12-01-11:36:05.195845] [BOOTSTRAP CONFIG SCOPE] name=_builtin\r\nlib/spack/spack/bootstrap.py:652 ==> [2021-12-01-11:36:05.196129] [BOOTSTRAP CONFIG SCOPE] name=defaults, path=/home/amd/spack/etc/spack/defaults\r\nlib/spack/spack/bootstrap.py:653 ==> [2021-12-01-11:36:05.196220] [BOOTSTRAP CONFIG SCOPE] name=defaults/linux, path=/home/amd/spack/etc/spack/defaults/linux\r\nlib/spack/spack/bootstrap.py:652 ==> [2021-12-01-11:36:05.196309] [BOOTSTRAP CONFIG SCOPE] name=bootstrap, path=/home/amd/.spack/bootstrap/config\r\nlib/spack/spack/bootstrap.py:653 ==> [2021-12-01-11:36:05.196391] [BOOTSTRAP CONFIG SCOPE] name=bootstrap/linux, path=/home/amd/.spack/bootstrap/config/linux\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:05.196743] Reading config file /home/amd/.spack/bootstrap/config/linux/compilers.yaml\r\nlib/spack/spack/bootstrap.py:763 ==> [2021-12-01-11:36:05.217430] [BOOTSTRAP ROOT SPEC] clingo-bootstrap@spack+python %gcc target=x86_64\r\nlib/spack/spack/bootstrap.py:482 ==> [2021-12-01-11:36:05.217533] [BOOTSTRAP MODULE clingo] Try importing from Python\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:05.217741] Reading config file /home/amd/spack/etc/spack/defaults/bootstrap.yaml\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:05.292413] Reading config file /home/amd/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/bootstrap.py:98 ==> [2021-12-01-11:36:21.105665] [BOOTSTRAP MODULE clingo] The installed spec \"clingo-bootstrap@spack+python %gcc target=x86_64 ^python@3.8 /kt74l7kjzrlp3cgtj2576o33mhsrgyrw\" provides the \"clingo\" Python module\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:21.106005] Reading config file /home/amd/spack/etc/spack/defaults/repos.yaml\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:21.134718] Reading config file /home/amd/.spack/linux/compilers.yaml\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:21.147125] Reading config file /home/amd/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/config.py:1007 ==> [2021-12-01-11:36:21.158502] Reading config file /home/amd/spack/etc/spack/defaults/packages.yaml\r\nlib/spack/spack/solver/asp.py:1932 ==> [2021-12-01-11:36:21.248433] build(sqlite)\r\nlib/spack/spack/solver/asp.py:1932 ==> [2021-12-01-11:36:21.248533] build(readline)\r\nlib/spack/spack/solver/asp.py:1932 ==> [2021-12-01-11:36:21.248616] build(zlib)\r\nlib/spack/spack/solver/asp.py:1932 ==> [2021-12-01-11:36:21.248695] build(ncurses)\r\nlib/spack/spack/solver/asp.py:1932 ==> [2021-12-01-11:36:21.248770] build(pkgconf)\r\nTraceback (most recent call last):\r\n  File \"/home/amd/spack/bin/spack\", line 100, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/home/amd/spack/lib/spack/spack/main.py\", line 881, in main\r\n    return _main(argv)\r\n  File \"/home/amd/spack/lib/spack/spack/main.py\", line 864, in _main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/home/amd/spack/lib/spack/spack/main.py\", line 534, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/home/amd/spack/lib/spack/spack/cmd/install.py\", line 394, in install\r\n    specs = spack.cmd.parse_specs(\r\n  File \"/home/amd/spack/lib/spack/spack/cmd/__init__.py\", line 166, in parse_specs\r\n    spec.concretize(tests=tests, reuse=reuse)  # implies normalize\r\n  File \"/home/amd/spack/lib/spack/spack/spec.py\", line 2639, in concretize\r\n    self._new_concretize(tests, reuse=reuse)\r\n  File \"/home/amd/spack/lib/spack/spack/spec.py\", line 2610, in _new_concretize\r\n    result = spack.solver.asp.solve([self], tests=tests, reuse=reuse)\r\n  File \"/home/amd/spack/lib/spack/spack/solver/asp.py\", line 2024, in solve\r\n    return driver.solve(\r\n  File \"/home/amd/spack/lib/spack/spack/solver/asp.py\", line 592, in solve\r\n    answers = builder.build_specs(tuples)\r\n  File \"/home/amd/spack/lib/spack/spack/solver/asp.py\", line 1958, in build_specs\r\n    self.reorder_flags()\r\n  File \"/home/amd/spack/lib/spack/spack/solver/asp.py\", line 1875, in reorder_flags\r\n    check_same_flags(spec.compiler_flags, compiler_flags)\r\n  File \"/home/amd/spack/lib/spack/spack/solver/asp.py\", line 262, in check_same_flags\r\n    assert values1 == values2\r\nAssertionError\r\n\r\n```\r\n\n\n### Information on your system\n\n$ spack debug report\r\n* **Spack:** 0.17.0-1-f92a2d688d\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-zen3\r\n* **Concretizer:** clingo\r\n\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "vkallesh",
    "url": "https://api.github.com/repos/spack/spack/issues/27736",
    "updated_at": "2021-12-01 11:45:01",
    "created_at": "2021-12-01 11:43:38",
    "closed_at": "None",
    "state": "open",
    "title": "AssertionError is seen if user update compiler.yaml file with compiler flags section and then pass 'c' and 'cxx' flags to spack install command.",
    "number": 27736,
    "milestone": null,
    "labels": [
        "bug",
        "compilers",
        "build-environment",
        "triage",
        "AMD"
    ],
    "id": 1068305501,
    "html_url": "https://github.com/spack/spack/issues/27736",
    "assignees": [],
    "comments": 0
}