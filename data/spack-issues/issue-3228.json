{
    "body": "I'm trying to install a package with the Autotools template and so I need to overwrite the method `configure_directory` given that the `configure` file is located in a `dist` subdirectory.\r\n\r\nI overwrite it in that way:\r\n\r\n```\r\n    def configure_directory(self):\r\n        return join_path(self.stage.source_path, 'dist')\r\n```\r\n\r\nwhich produces this error:\r\n\r\n```\r\n==> Building db [AutotoolsPackage]\r\n==> Executing phase : 'autoreconf'\r\n==> Error: AttributeError: 'function' object has no attribute 'startswith'\r\n/my/path/spack/lib/spack/spack/build_systems/autotools.py:173, in configure_abs_path:\r\n     169      @property\r\n     170      def configure_abs_path(self):\r\n     171          # Absolute path to configure\r\n     172          configure_abs_path = join_path(\r\n  >> 173              os.path.abspath(self.configure_directory), 'configure'\r\n     174          )\r\n     175          return configure_abs_path\r\n```\r\n\r\nThis could be helpful when solving #3214 since the error `Error: AttributeError: 'function' object has no attribute 'startswith'` does not match with remarked line.\r\n\r\nAnyway, the error is produced due to the `@property` used in the default internal definition in `build_systems/autotools.py`. As far as I understand, that forces the user to also declare this `@property` when overwriting the method, which I think could be unknown for the user. Otherwise, it fails in the following line as the `self.configure_directory` should be a method call:\r\n\r\n```\r\n  >> 173              os.path.abspath(self.configure_directory), 'configure'\r\n```\r\n\r\nHowever, when the overwritten method looks like this, it doesn't fail:\r\n\r\n```\r\n    @property\r\n    def configure_directory(self):\r\n        return join_path(self.stage.source_path, 'dist')\r\n```\r\n\r\nSo, as a proposal, I would suggest to remove the `@property` decorators in those methods that users may need to redefine as in `PythonPackage`'s.\r\n\r\nIn addition, I found out other *problem*. Just adding the temporal `@property` to my overwritten `configure_directory`, I got this error:\r\n\r\n```\r\n==> Building db [AutotoolsPackage]\r\n==> Executing phase : 'autoreconf'\r\n==> Executing phase : 'configure'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/my/path/spack/var/spack/stage/db-5.3.28-x2d7jydmn2rh3z26kiyrvrj65kxw66xf/db-5.3.28/dist/configure' '--prefix=/my/path/spack/opt/spack/linux-scientificcernslc6-x86_64/gcc-6.2.0/db-5.3.28-x2d7jydmn2rh3z26kiyrvrj65kxw66xf'\r\n/my/path/spack/lib/spack/spack/build_systems/autotools.py:268, in configure:\r\n     261      def configure(self, spec, prefix):\r\n     262          \"\"\"Runs configure with the arguments specified in :py:meth:`.configure_args`\r\n     263          and an appropriately set prefix.\r\n     264          \"\"\"\r\n     265          options = ['--prefix={0}'.format(prefix)] + self.configure_args()\r\n     266  \r\n     267          with working_dir(self.build_directory, create=True):\r\n  >> 268              inspect.getmodule(self).configure(*options)\r\n``` \r\n\r\nNot very intuitive either. In that case when running the configure, the package itself complains about the build directory, suggesting that should be different from where the configure is located. Maybe this is not a issue related to spack. The point is that overwriting the `build_directory` method, I got the same error again because of the `@property` which could be easily solved doing:\r\n\r\n```\r\n    @property\r\n    def build_directory(self):\r\n        return self.prefix\r\n```\r\n\r\nI have no experience with Autotools packages so I don't know if those problems are commons. Anyway I would like to know what do you think about.\r\n ",
    "user": "JavierCVilla",
    "url": "https://api.github.com/repos/spack/spack/issues/3228",
    "updated_at": "2018-07-17 18:28:39",
    "created_at": "2017-02-23 17:43:43",
    "closed_at": "2018-07-17 18:28:39",
    "state": "closed",
    "title": "Document how to override AutotoolsPackage methods",
    "number": 3228,
    "milestone": null,
    "labels": [
        "documentation"
    ],
    "id": 209833528,
    "html_url": "https://github.com/spack/spack/issues/3228",
    "assignees": [],
    "comments": 11
}