{
    "body": "### Steps to reproduce the issue\n\n```console\r\n$ spack spec --reuse -I py-tensorflow ^protobuf@3.18.0\r\nInput spec\r\n--------------------------------\r\n -   py-tensorflow\r\n -       ^protobuf@3.18.0\r\n\r\nConcretized\r\n--------------------------------\r\n -   py-tensorflow@2.4.1%gcc@8.5.0~android~aws~computecpp+cuda~dynamic_kernels~gcp~gdr~hdfs~ignite~ios~jemalloc~kafka~mkl~monolithic~mpi+nccl~ngraph~numa~opencl~rocm~tensorrt~verbs~xla cuda_arch=52 arch=linux-centos7-skylake_avx512\r\n[+]      ^bazel@3.7.2%gcc@8.5.0+nodepfail patches=0f6940d1cb5dc44630c9e845704da6d5188683eb706e280dafc84f5f0f76999e,3e6448a0dde42bbd72568d29c5646d370dd62ca300cdd10a630908c086844167,604423c717a5e58cdd76ba8a9ce1d313faf13885be838f4e33dd37845b3940cb,dbbf38bd17c63aa923f2433a2013d302739f8043ca427c816e8737dab05ac528 arch=linux-centos7-skylake_avx512\r\n[+]          ^openjdk@11.0.12_7%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]          ^python@3.8.12%gcc@8.5.0+bz2+ctypes+dbm~debug+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93189bc278fbc37a50ed7f183bd8aaf249a8e1670a465f0db6bb4f8cf87,4c2457325f2b608b1b6a2c63087df8c26e07db3e3d493caf36a56f0ecf6fb768,f2fd060afc4b4618fe8104c4c5d771f36dc55b1db5a4623785a4ea707ec72fb4 arch=linux-centos7-skylake_avx512\r\n[+]              ^bzip2@1.0.8%gcc@8.5.0~debug~pic+shared arch=linux-centos7-skylake_avx512\r\n[+]              ^expat@2.4.1%gcc@8.5.0+libbsd arch=linux-centos7-skylake_avx512\r\n[+]                  ^libbsd@0.11.3%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]                      ^libmd@1.0.3%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]              ^gdbm@1.19%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]                  ^readline@8.1%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]                      ^ncurses@6.2%gcc@8.5.0~symlinks+termlib abi=none arch=linux-centos7-skylake_avx512\r\n[+]              ^gettext@0.21%gcc@8.5.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-centos7-skylake_avx512\r\n[+]                  ^libiconv@1.16%gcc@8.5.0 libs=shared,static arch=linux-centos7-skylake_avx512\r\n[+]                  ^libxml2@2.9.12%gcc@8.5.0~python arch=linux-centos7-skylake_avx512\r\n[+]                      ^xz@5.2.5%gcc@8.5.0~pic libs=shared,static arch=linux-centos7-skylake_avx512\r\n[+]                      ^zlib@1.2.11%gcc@8.5.0+optimize+pic+shared arch=linux-centos7-skylake_avx512\r\n[+]                  ^tar@1.34%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]              ^libffi@3.3%gcc@8.5.0 patches=26f26c6f29a7ce9bf370ad3ab2610f99365b4bdd7b82e7c31df41a3370d685c0 arch=linux-centos7-skylake_avx512\r\n[+]              ^openssl@1.1.1l%gcc@8.5.0~docs certs=system arch=linux-centos7-skylake_avx512\r\n[+]              ^sqlite@3.36.0%gcc@8.5.0+column_metadata+fts~functions~rtree arch=linux-centos7-skylake_avx512\r\n[+]              ^util-linux-uuid@2.36.2%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]          ^zip@3.0%gcc@8.5.0 patches=14dc88014812a896e5697553025f451435f69b1b541743f853b8dcae6b4dfe27,3bc30bafdfd29f1d26d1e0c4c7217def2ff5b37a715e482f83c5fefa2aa0ecb6,5068e7cb188e520da3cced095292ace13ad5e8321419127bf2ca095e148ab65a,51f48db588b17790aaf6b901d6ca737abdb20124210cf8def17d81841c013d13,66ab4ce03f342c6624aa14be5fa43b90e5608a4f6babcc9c3680828f2c246a74,a92fc4e4f59aa2ca3e8059c6b355ecce8c8c7802cb4f118756bf06eb51455549,a95ed93de9284ff68e835387ddb9ff62414712f9b95ec8e120f02cef8f26faca,eb83fc886ded7101ad8ddf10c025b1bd4d33b594766816cce65397d4f5c6a7b9,f7d0bc42e1db9564732ae0aa1ad238b7278a3e68eb0b05e16f1cb6507df2668d,fa8312c722a1cf774af588d5534745f2231130da0f40a44bba5b394eb13a5c64 arch=linux-centos7-skylake_avx512\r\n[+]      ^cuda@10.2.89%gcc@8.5.0~dev arch=linux-centos7-skylake_avx512\r\n[+]      ^cudnn@8.2.0.53-10.2%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^flatbuffers@1.12.0%gcc@8.5.0~ipo+python+shared build_type=RelWithDebInfo arch=linux-centos7-skylake_avx512\r\n[+]      ^hdf5@1.10.7%gcc@8.5.0~cxx~fortran+hl~ipo~java~mpi+shared~szip~threadsafe+tools api=default build_type=RelWithDebInfo arch=linux-centos7-skylake_avx512\r\n[+]          ^pkgconf@1.8.0%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^nccl@2.9.9-1%gcc@8.5.0+cuda cuda_arch=none arch=linux-centos7-skylake_avx512\r\n[+]          ^rdma-core@34.0%gcc@8.5.0~ipo build_type=RelWithDebInfo arch=linux-centos7-skylake_avx512\r\n[+]              ^libnl@3.3.0%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^protobuf@3.18.0%gcc@8.5.0+shared build_type=Release arch=linux-centos7-skylake_avx512\r\n[+]      ^py-absl-py@0.13.0%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]          ^py-six@1.15.0%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^py-astunparse@1.6.3%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]          ^py-wheel@0.36.2%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]              ^py-setuptools@58.2.0%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^py-gast@0.3.3%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^py-google-pasta@0.2.0%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^py-grpcio@1.32.0%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]          ^c-ares@1.15.0%gcc@8.5.0~ipo build_type=RelWithDebInfo arch=linux-centos7-skylake_avx512\r\n[+]      ^py-h5py@2.10.0%gcc@8.5.0~mpi arch=linux-centos7-skylake_avx512\r\n[+]          ^py-numpy@1.19.5%gcc@8.5.0+blas+lapack patches=8a9d5d1b3f145c043b8b04869e7d46c6ff95c3f486d84f69693017c7e6190c7d arch=linux-centos7-skylake_avx512\r\n[+]              ^intel-mkl@2020.4.304%gcc@8.5.0~ilp64+shared threads=none arch=linux-centos7-skylake_avx512\r\n[+]      ^py-keras-preprocessing@1.1.2%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^py-opt-einsum@3.3.0%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^py-protobuf@3.17.3%gcc@8.5.0~cpp arch=linux-centos7-skylake_avx512\r\n[+]      ^py-termcolor@1.1.0%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^py-typing-extensions@3.7.4.3%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^py-wrapt@1.12.1%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]      ^swig@4.0.2%gcc@8.5.0 arch=linux-centos7-skylake_avx512\r\n[+]          ^pcre@8.44%gcc@8.5.0~jit+multibyte+utf arch=linux-centos7-skylake_avx512\r\n```\r\n\r\n```console\r\n$ spack install --reuse py-tensorflow ^protobuf@3.18.0\r\n(ignore lots of useless info)\r\ntensorflow/core/distributed_runtime/tensor_coding.cc:221:44: error: no matching function for call to 'google::protobuf::io::CodedInputStream::SetTotalBytesLimit(int, int)\r\n```\n\n### Information on your system\n\n* **Spack:** 0.17.1\r\n* **Python:** 2.7.5\r\n* **Platform:** linux-centos7-skylake_avx512\r\n* **Concretizer:** clingo\n\n### Additional information\n\n@adamjstewart @aweits \r\nIt seems like `tensorflow/core/distributed_runtime/tensor_coding.cc` calling function `google::protobuf::io::CodedInputStream::SetTotalBytesLimit` with two parameters. But `protobuf` has changed it definition to using only one parameter in [this commit](https://github.com/protocolbuffers/protobuf/commit/92a7e778e7394386f413cec28d67a07630f784b1#diff-d0961d63325c9a3f30b4769cf5d53d663bcb10d545c1125e4e7ebbd80182a992), and from the page of commit, it seems like that commit has been merged in v3.15.0.\r\n\r\nHowever, `tensorflow` cleaned up usages of deprecated `google::protobuf::io::CodedInputStream::SetTotalBytesLimit` in [this commit](https://github.com/tensorflow/tensorflow/commit/62ce49b7f775289558f66a6b3f67395333016e6e), and from the page of commit, it seems like that commit has been merged in v2.7.0. And the highest version in spack is only `v2.4.1`\r\n\r\nSo I think for the package `py-tensorflow`, we can add new version of that and also add some coflict in `package.py` to limit the version of protobuf it uses (maybe under v.3.14.0?).\r\n\r\nP.S. if add new versions, please add support for newer version of cuda, it seems only use cuda under v11.1.\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "KS0508",
    "url": "https://api.github.com/repos/spack/spack/issues/28612",
    "updated_at": "2022-02-18 20:10:01",
    "created_at": "2022-01-26 14:47:53",
    "closed_at": "2022-02-18 20:10:01",
    "state": "closed",
    "title": "Installation issue: py-tensorflow conflicts with new version of protobuf",
    "number": 28612,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1115104099,
    "html_url": "https://github.com/spack/spack/issues/28612",
    "assignees": [
        "adamjstewart"
    ],
    "comments": 2
}