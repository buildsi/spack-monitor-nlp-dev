{
    "body": "Closes https://github.com/spack/spack/issues/8616, closes https://github.com/spack/spack/issues/3204\r\n(Feel free to reopen the second issue if the goal is to not link to `mkl_rt`)\r\n\r\nNeed to resolve the F90 env variable setting first. I was able to install with --dirty and this build recipe. \r\n\r\nRefer to [1](https://github.com/scipy/scipy/issues/9080).\r\nNumpy parallel builds now work. Refer to [2](https://github.com/numpy/numpy/pull/9050).\r\n\r\n### Test matrix : \r\n(Note : [Known issues](https://github.com/numpy/numpy/issues/10060) with `intel-mkl` while testing.)\r\n\r\n\r\n| CentOS/Py 2.7.14 | Intel-MKL| OpenBLAS|\r\n| --- | --- | -- |\r\n| Intel18 | [ ] | [ ] |\r\n| GCC 7.3.0| [ Pass](http://pasted.co/61e347a6) | [Pass](http://pasted.co/7413890b) |\r\n| Clang 6.0.1| [ ] | [ ] |\r\n\r\n| CentOS/Py 3.6.6 | Intel-MKL| OpenBLAS|\r\n| --- | --- | -- |\r\n| Intel18 | [Pass](http://pasted.co/ad075173) | [ ] |\r\n| GCC 7.3.0| [Pass](http://pasted.co/a9204164) | [Pass](http://pasted.co/0a83eb11) |\r\n| Clang 6.0.1| [ ] | [ ] |\r\n\r\n\r\n| MacOS/Py 2.7.15 | Intel-MKL| OpenBLAS|\r\n| --- | --- | -- |\r\n| Intel18 | [ ] | [ ] |\r\n| GCC 7.3.0| [ ] | [ ] |\r\n| Clang 6.0.1| [ ] | [ ] |\r\n\r\n| MacOS/Py 3.6.6 | Intel-MKL| OpenBLAS|\r\n| --- | --- | -- |\r\n| Intel18 | [ ] | [ ] |\r\n| GCC 7.3.0| [ ] | [ ] |\r\n| Clang 6.0.1| [ ] | [ ] |\r\n\r\n### Bash script to automate building & testing :\r\nNote : There's an issue with `intel` compilers and `py-scipy` that requires one to explicitly set `F90`.\r\nPS : Edit the location where spack is present and git checkout statement appropriately\r\n\r\n```\r\npyver=\"3.6.6\"\r\n\r\nfor compiler in gcc@7.3.0 intel@18.0.3\r\ndo\r\n        if [ \"$compiler\" = \"intel@18.0.3\" ]\r\n        then\r\n                export F90=\"/home/sajid/packages/spack/lib/spack/env/intel/ifort\"\r\n        fi\r\n\r\n        for mathlib in openblas@0.3.2\r\n        do\r\n                cd ~/packages/spack\r\n                git checkout intel_scipy_test\r\n                cd ~\r\n                spack install py-scipy@1.1.0 ^py-numpy@1.15.0+blas+lapack ^$mathlib ^python@$pyver %$compiler\r\n                spack activate py-scipy@1.1.0 ^$mathlib ^python@$pyver %$compiler\r\n                if [ \"$mathlib\" = \"intel-mkl\" ]\r\n                then\r\n                KMP_INIT_AT_FORK=FALSE python test_numpy_scipy.py &> py$pyver.$mathlib.$compiler.txt\r\n                else\r\n                python test_numpy_scipy.py &> py$pyver.$mathlib.$compiler.txt\r\n                fi\r\n                spack load python@$pyver %$compiler\r\n                spack deactivate py-scipy@1.1.0 ^$mathlib ^python@$pyver %$compiler\r\n                spack deactivate py-numpy@1.15.0 ^$mathlib ^python@$pyver %$compiler\r\n\r\n        done\r\ndone\r\n```\r\n\r\n### Test script : \r\n```\r\n#Show python version, OS version, test numpy and scipy.                 \r\nimport sys,platform                                                     \r\nimport numpy                                                            \r\nimport scipy                                                            \r\n                                                                        \r\nif sys.version[0]>2:                                                    \r\n    print('\\n'+'Python version'+'\\n')                                   \r\n    print(sys.version)                                                  \r\n    print('\\n'+'OS info'+'\\n')                                          \r\n    print(platform.platform())                                          \r\n    print('\\n'+'Numpy BLAS/Lapack linkage'+'\\n')                        \r\n    numpy.__config__.show()                                             \r\n    print('\\n'+'Scipy BLAS/Lapack linkage'+'\\n')                        \r\n    scipy.__config__.show()                                             \r\n    print('\\n\\n')                                                       \r\n    numpy.test('full')                                                  \r\n    scipy.test('full')                                                  \r\nelse :                                                                  \r\n    print '\\n'+'Python version'+'\\n'                                    \r\n    print sys.version                                                   \r\n    print '\\n'+'OS info'+'\\n'                                           \r\n    print platform.platform()                                           \r\n    print '\\n'+'Numpy BLAS/Lapack linkage'+'\\n'                         \r\n    numpy.__config__.show()                                             \r\n    print'\\n'+'Scipy BLAS/Lapack linkage'+'\\n'                          \r\n    scipy.__config__.show()                                             \r\n    print '\\n\\n'                                                        \r\n    numpy.test('full')                                                  \r\n    scipy.test('full')                                                  \r\n```\r\n",
    "user": "s-sajid-ali",
    "url": "https://api.github.com/repos/spack/spack/issues/8817",
    "updated_at": "2019-08-06 23:20:25",
    "created_at": "2018-07-27 20:23:10",
    "closed_at": "2019-08-06 23:20:25",
    "state": "closed",
    "title": "Fix py-scipy build with intel compilers",
    "number": 8817,
    "milestone": null,
    "labels": [
        "python",
        "blas-lapack-scalapack",
        "intel"
    ],
    "id": 345355388,
    "html_url": "https://github.com/spack/spack/pull/8817",
    "assignees": [],
    "comments": 8
}