{
    "body": "@BarrySmith @tgamblin\r\n\r\nI'm trying to use spack to install the xsdk package on NERSC's cori, using the barry/xsdk branch.  Spack crashes during the last stage, installing pflotran, because it needs mercurial to fetch pflotran.  I tried using the mercurial module available on cori, which didn't work.  (See #1645 and #2811)  Then I tried having spack install mercurial for me, which it did not want to do.\r\n\r\n```\r\namklinv@cori02:~/cori/spack/bin> ./spack install mercurial\r\n==> Installing mercurial\r\n==> py-docutils is already installed in /global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/py-docutils-0.12-tmg4ex555o5ytsir6swkatqcdqy5g53i\r\n==> python is already installed in /global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/python-2.7.13-aum5cm2nu2dj6xabkwi3rzwqfuq3xtmx\r\n==> Using cached archive: /global/u1/a/amklinv/cori/spack/var/spack/cache/mercurial/mercurial-3.9.1.tar.gz\r\n==> Already staged mercurial-3.9.1-nbquc2hhudv5tioe76yq5wmoxuyuexs2 in /global/u1/a/amklinv/cori/spack/var/spack/stage/mercurial-3.9.1-nbquc2hhudv5tioe76yq5wmoxuyuexs2\r\n==> No patches needed for mercurial\r\n==> Building mercurial [Package]\r\n==> Executing phase : 'install'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j32' 'install' 'PREFIX=/global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/mercurial-3.9.1-nbquc2hhudv5tioe76yq5wmoxuyuexs2'\r\n/global/u1/a/amklinv/cori/spack/var/spack/repos/builtin/packages/mercurial/package.py:48, in install:\r\n     47       def install(self, spec, prefix):\r\n  >> 48           make('install', 'PREFIX={0}'.format(prefix))\r\n     49\r\n     50           # Configuration of HTTPS certificate authorities\r\n     51           # https://www.mercurial-scm.org/wiki/CACertificates\r\n     52           hgrc_filename = join_path(prefix.etc, 'mercurial', 'hgrc')\r\n     53           mkdirp(os.path.dirname(hgrc_filename))\r\n     54\r\n     55           with open(hgrc_filename, 'w') as hgrc:\r\n     56               if os.path.exists('/etc/ssl/certs/ca-certificates.crt'):\r\n     57                   # Debian/Ubuntu/Gentoo/Arch Linux\r\n     58                   hgrc.write('[web]\\ncacerts = /etc/ssl/certs/ca-certificates.crt')  # noqa\r\n     59               elif os.path.exists('/etc/pki/tls/certs/ca-bundle.crt'):\r\n     60                   # Fedora/RHEL/CentOS\r\n     61                   hgrc.write('[web]\\ncacerts = /etc/pki/tls/certs/ca-bundle.crt')\r\n     62               elif os.path.exists('/etc/ssl/ca-bundle.pem'):\r\n     63                   # openSUSE/SLE\r\n     64                   hgrc.write('[web]\\ncacerts = /etc/ssl/ca-bundle.pem')\r\n     65               else:\r\n     66                   tty.warn('CA certificate not found. You may not be able to '\r\n     67                            'connect to an HTTPS server. If your CA certificate '\r\n     68                            'is in a non-standard location, you should add it to '\r\n     69                            '{0}'.format(hgrc_filename))\r\n\r\nSee build log for details:\r\n  /tmp/amklinv/spack-stage/spack-stage-Dze5h5/mercurial-3.9.1/spack-build.out\r\n```\r\n```\r\namklinv@cori02:~/cori/spack/bin> cat /tmp/amklinv/spack-stage/spack-stage-Dze5h5/mercurial-3.9.1/spack-build.out\r\n==> 'make' '-j32' 'install' 'PREFIX=/global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/mercurial-3.9.1-nbquc2hhudv5tioe76yq5wmoxuyuexs2'\r\npython setup.py  build\r\nmake -C doc\r\nmake[1]: Entering directory '/tmp/amklinv/spack-stage/spack-stage-Dze5h5/mercurial-3.9.1/doc'\r\nmake[1]: Nothing to be done for 'all'.\r\nmake[1]: Leaving directory '/tmp/amklinv/spack-stage/spack-stage-Dze5h5/mercurial-3.9.1/doc'\r\ncd doc && make -j --jobserver-fds=15,16 install\r\nmake[1]: Entering directory '/tmp/amklinv/spack-stage/spack-stage-Dze5h5/mercurial-3.9.1/doc'\r\nfor i in hg.1 hgignore.5 hgrc.5 hg-ssh.8 ; do \\\r\n  subdir=`echo $i | sed -n 's/^.*\\.\\([0-9]\\)$/man\\1/p'` ; \\\r\n  mkdir -p /global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/mercurial-3.9.1-nbquc2hhudv5tioe76yq5wmoxuyuexs2/share/man/$subdir ; \\\r\n  install -c -m 644 $i /global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/mercurial-3.9.1-nbquc2hhudv5tioe76yq5wmoxuyuexs2/share/man/$subdir ; \\\r\ndone\r\nrunning build\r\nrunning build_mo\r\nmake[1]: Leaving directory '/tmp/amklinv/spack-stage/spack-stage-Dze5h5/mercurial-3.9.1/doc'\r\nrunning build_py\r\ncopying mercurial/__modulepolicy__.py -> build/lib.linux-x86_64-2.7/mercurial\r\nrunning build_ext\r\nbuilding 'mercurial.base85' extension\r\n/global/u1/a/amklinv/cori/spack/lib/spack/env/gcc/gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -O3 -Wall -Wstrict-prototypes -fPIC -I/global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/python-2.7.13-aum5cm2nu2dj6xabkwi3rzwqfuq3xtmx/include/python2.7 -c mercurial/base85.c -o build/temp.linux-x86_64-2.7/mercurial/base85.o\r\n/opt/cray/pe/craype/2.5.7/bin/cc -shared -L/global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/bzip2-1.0.6-js6dsfr4ifivstb2bdx6zv5wxddgn3u2/lib -L/global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/ncurses-6.0-ti24btafu5zwhzgzcy5in43e5weafmyr/lib -L/global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/zlib-1.2.10-aixjrovjk3dib5regbxkbxfslevn5tip/lib -L/global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/openssl-1.0.2j-xlx57k4cycp7nqpjzvqwwcwx6rmlgked/lib -L/global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/sqlite-3.8.5-7bhh4zabny4jon6rbefcl5mdd32cu3on/lib -L/global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/readline-6.3-m5k57f2ifjsleqw6tazdyrjhhuvtyjbs/lib build/temp.linux-x86_64-2.7/mercurial/base85.o -L/global/u1/a/amklinv/cori/spack/opt/spack/cray-CNL-haswell/gcc-6.2.0/python-2.7.13-aum5cm2nu2dj6xabkwi3rzwqfuq3xtmx/lib -lpython2.7 -o build/lib.linux-x86_64-2.7/mercurial/base85.so\r\nerror: command '/opt/cray/pe/craype/2.5.7/bin/cc' failed with exit status 11\r\nMakefile:55: recipe for target 'build' failed\r\nmake: *** [build] Error 1\r\n```",
    "user": "amklinv",
    "url": "https://api.github.com/repos/spack/spack/issues/2816",
    "updated_at": "2019-12-05 17:06:58",
    "created_at": "2017-01-12 14:17:08",
    "closed_at": "2019-12-05 17:06:57",
    "state": "closed",
    "title": "spack refuses to install mercurial on NERSC cori",
    "number": 2816,
    "milestone": null,
    "labels": [
        "build-error",
        "unreproducible",
        "xSDK"
    ],
    "id": 200377755,
    "html_url": "https://github.com/spack/spack/issues/2816",
    "assignees": [
        "mamelara"
    ],
    "comments": 11
}