{
    "body": "### Steps to reproduce\n\nThis arises in some environment setups with a configuration like\r\n```yaml\r\nspack:\r\n  definitions:\r\n  - mpi : [openmpi]\r\n  - packages: [gsl]\r\n  specs:\r\n  - matrix:\r\n    - [$packages]\r\n    - [$^mpi]\r\n# ...\r\n```\r\n\r\nThe problem is reproducible simply with:\r\n\r\n```console\r\n$> spack spec gsl ^ openmpi\r\n# errors....\r\n```\r\n\r\nI've tried this on various package specs (e.g. `spack spec fmt ^ openblas`) with similar error outputs. \r\n\r\nThat is (from what I can tell), if a package does not have an explicit dependency on a dependency listed in the spec, there is an error. It appears to be a constraint error, although the output is somewhat inscrutable (see below). **The expected result** here is for spack to ignore explicit dependencies in the spec that are not dependencies of the package when concertizing.\r\n\r\nThe question is, should spack be able to concertize a spec that contains unused dependencies (& if so why is this setup failing), or is giving unused dependencies not permitted? I would add that having spack ignore these explicit dependencies is very useful for writing clean environment configurations.\r\n\r\nAlso, the tutorials seem to imply that this is acceptable (e.g. https://spack-tutorial.readthedocs.io/en/latest/tutorial_stacks.html). \n\n### Error message\n\n```console\r\n$ spack -d spec gsl ^openmpi\r\n==> [2021-09-27-10:25:10.967159] Imported spec from built-in commands\r\n==> [2021-09-27-10:25:10.968902] Imported spec from built-in commands\r\nInput spec\r\n--------------------------------\r\ngsl\r\n    ^openmpi\r\n\r\nConcretized\r\n--------------------------------\r\n==> [2021-09-27-10:25:10.973701] Reading config file /home/mauneyc/devel/flecsph_local/flecsph-env/spack.yaml\r\n==> [2021-09-27-10:25:10.990103] Reading config file /home/mauneyc/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2021-09-27-10:25:11.000871] Reading config file /home/mauneyc/spack/etc/spack/defaults/config.yaml\r\n==> [2021-09-27-10:25:11.021815] DATABASE LOCK TIMEOUT: 3s\r\n==> [2021-09-27-10:25:11.021937] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2021-09-27-10:25:11.022536] Reading config file /home/mauneyc/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2021-09-27-10:25:11.032822] DATABASE LOCK TIMEOUT: 3s\r\n==> [2021-09-27-10:25:11.033119] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2021-09-27-10:25:11.033439] [BOOTSTRAP CONFIG SCOPE] name=_builtin\r\n==> [2021-09-27-10:25:11.034850] [BOOTSTRAP CONFIG SCOPE] name=defaults, path=/home/mauneyc/spack/etc/spack/defaults\r\n==> [2021-09-27-10:25:11.035166] [BOOTSTRAP CONFIG SCOPE] name=defaults/linux, path=/home/mauneyc/spack/etc/spack/defaults/linux\r\n==> [2021-09-27-10:25:11.035417] [BOOTSTRAP CONFIG SCOPE] name=system, path=/etc/spack\r\n==> [2021-09-27-10:25:11.035543] [BOOTSTRAP CONFIG SCOPE] name=system/linux, path=/etc/spack/linux\r\n==> [2021-09-27-10:25:11.035681] [BOOTSTRAP CONFIG SCOPE] name=site, path=/home/mauneyc/spack/etc/spack\r\n==> [2021-09-27-10:25:11.035825] [BOOTSTRAP CONFIG SCOPE] name=site/linux, path=/home/mauneyc/spack/etc/spack/linux\r\n==> [2021-09-27-10:25:11.035962] [BOOTSTRAP CONFIG SCOPE] name=user, path=/home/mauneyc/.spack\r\n==> [2021-09-27-10:25:11.036075] [BOOTSTRAP CONFIG SCOPE] name=user/linux, path=/home/mauneyc/.spack/linux\r\n==> [2021-09-27-10:25:11.039017] Reading config file /home/mauneyc/.spack/linux/compilers.yaml\r\n==> [2021-09-27-10:25:11.059686] [BOOTSTRAP ROOT SPEC] clingo: clingo-bootstrap@spack+python %gcc target=x86_64\r\n==> [2021-09-27-10:25:11.059825] [BOOTSTRAP MODULE clingo] Try importing from Python\r\n==> [2021-09-27-10:25:11.060131] Reading config file /home/mauneyc/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2021-09-27-10:25:11.229048] Reading config file /home/mauneyc/spack/etc/spack/defaults/config.yaml\r\n==> [2021-09-27-10:25:11.337219] [BOOTSTRAP MODULE clingo] The installed spec \"clingo-bootstrap@spack+python %gcc target=x86_64 ^python@3.9 /hmnv6gk5wha64k6r3s7hid35mzvhkuot\" provides the \"clingo\" Python module\r\n==> [2021-09-27-10:25:11.337629] Reading config file /home/mauneyc/spack/etc/spack/defaults/repos.yaml\r\n==> [2021-09-27-10:25:12.854896] Reading config file /home/mauneyc/.spack/linux/compilers.yaml\r\n==> [2021-09-27-10:25:12.869235] Reading config file /home/mauneyc/spack/etc/spack/defaults/config.yaml\r\n==> [2021-09-27-10:25:12.891244] Reading config file /home/mauneyc/spack/etc/spack/defaults/packages.yaml\r\n==> [2021-09-27-10:25:22.089714] The following constraints are unsatisfiable:\r\n  condition(1126)\r\n  condition(1573)\r\n  condition(2609)\r\n  condition_requirement(1597,\"node\",\"llvm\")\r\n  condition_requirement(1612,\"node\",\"llvm\")\r\n  dependency_condition(1126,\"libmng\",\"cmake\")\r\n  dependency_condition(1573,\"llvm\",\"cmake\")\r\n  dependency_condition(2609,\"qt\",\"libmng\")\r\n  dependency_type(1126,\"build\")\r\n  dependency_type(1573,\"build\")\r\n  dependency_type(2609,\"build\")\r\n  node(\"openmpi\")\r\n==> [2021-09-27-10:25:22.099826] UnsatisfiableSpecError: gsl ^openmpi does not satisfy unknown\r\n==> [2021-09-27-10:25:22.103516] Error: gsl ^openmpi does not satisfy unknown\r\nTraceback (most recent call last):\r\n  File \"/home/mauneyc/spack/lib/spack/spack/main.py\", line 797, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/home/mauneyc/spack/lib/spack/spack/main.py\", line 525, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/home/mauneyc/spack/lib/spack/spack/cmd/spec.py\", line 109, in spec\r\n    spec.concretize()\r\n  File \"/home/mauneyc/spack/lib/spack/spack/spec.py\", line 2624, in concretize\r\n    self._new_concretize(tests)\r\n  File \"/home/mauneyc/spack/lib/spack/spack/spec.py\", line 2597, in _new_concretize\r\n    raise spack.error.UnsatisfiableSpecError(\r\nspack.error.UnsatisfiableSpecError: gsl ^openmpi does not satisfy unknown\r\n```\n\n### Information on your system\n\n```console\r\n$> spack debug report\r\n* **Spack:** 0.16.3-4463-4d3becdfd9\r\n* **Python:** 3.9.6\r\n* **Platform:** linux-manjaro21-skylake\r\n* **Concretizer:** clingo\r\n```\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "mauneyc-LANL",
    "url": "https://api.github.com/repos/spack/spack/issues/26271",
    "updated_at": "2021-09-28 15:21:29",
    "created_at": "2021-09-27 16:41:46",
    "closed_at": "None",
    "state": "open",
    "title": "Unused dependencies in an explicit spec produces constraint(?) errors",
    "number": 26271,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1008365756,
    "html_url": "https://github.com/spack/spack/issues/26271",
    "assignees": [],
    "comments": 2
}