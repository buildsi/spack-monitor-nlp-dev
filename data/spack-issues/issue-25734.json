{
    "body": "### Steps to reproduce\r\n\r\nClingo does not work with the /usr/bin/python3 3.6 that comes with\r\nRedHat 7.x on ppc64le.  The initial bootstrapping fails with:\r\n\r\n```\r\n$ spack solve zlib  \r\n==> Error: module 'clingo' has no attribute 'Control'\r\n```\r\n\r\nI tried this on a power9 with RHEL 7.7 with /usr/bin/python3 3.6.8,\r\nrpm package python3-3.6.8-10.el7.ppc64le.\r\n\r\nHow to reproduce:\r\n\r\n1. move .spack to another name, eg: dot-spack, so you have a clean, empty setup\r\n\r\n2. make a fresh clone of spack develop\r\n\r\n3. source setup-env.sh, and edit config.yaml to set concretizer to clingo\r\n\r\n4. run: spack compiler find\r\n\r\n```\r\n$ spack compiler find\r\n==> Added 1 new compiler to /home/krentel/.spack/linux/compilers.yaml\r\n    gcc@4.8.5\r\n==> Compilers are defined in the following files:\r\n    /home/krentel/.spack/linux/compilers.yaml\r\n```\r\n\r\n5. run: spack solve zlib\r\n\r\n```\r\n$ spack solve zlib\r\n==> Error: module 'clingo' has no attribute 'Control'\r\n```\r\n\r\n----------\r\n\r\nYou can also reproduce the problem on lassen at LLNL.  The thing about\r\nLLNL machines is that they come with the StdEnv module that puts\r\nanother python from /usr/tcetmp/bin in front of your path.  If you\r\nmove that out of the way and use /usr/bin/python3, then it has the\r\nsame problem.\r\n\r\nYou could unload the StdEnv module, or add /usr/bin to the front of\r\nyour path.  Anything that puts /usr/bin/python3 before /usr/tcetmp\r\nwill get back to the bare RH 7.x python and reproduce the problem.\r\n\r\nYou can even mkdir some directory, copy /usr/bin/python3 to the new\r\ndirectory and put that in front of your path.  That pretty much\r\nconfirms the problem is python because it's the only new thing in your\r\npath.\r\n\r\nNotes:\r\n\r\n1. As I mentioned, the problem is in python3 shipped with RHEL 7.x on\r\nppc64le.  If you build a new python, even the same 3.6 rev, then it\r\nworks.\r\n\r\n2. The problem is specific to ppc64le.  It doesn't happen on x86_64,\r\neven with the same RH rev.  I haven't tried ARM.\r\n\r\n3. I haven't tried RH 8.x.  If someone can suggest a RH 8.x powerpc\r\nmachine, maybe something at LLNL or Sandia, I could try it there.\r\n\r\nI don't know if the problem is that the RH python lacks some feature,\r\nor if spack doesn't detect or use is correctly.  But if the shipped\r\npython won't work with clingo, then that adds an extra step to the\r\nbootstrap process to build a new python.\r\n\r\nI've seen this sort of problem before where the same rev of RH on\r\ndifferent architectures don't provide exactly the same set of\r\nfeatures.  (But more often with compiler features.)\r\n\r\nping @alalazo \r\n\r\n\r\n### Error message\r\n\r\n``` \r\n$ spack -d solve zlib\r\n\r\n==> [2021-09-01-12:27:21.791669] Imported solve from built-in commands\r\n==> [2021-09-01-12:27:21.793301] Imported solve from built-in commands\r\n==> [2021-09-01-12:27:21.794287] Reading config file /home/krentel/clingo/spack-repo/etc/spack/defaults/bootstrap.yaml\r\n==> [2021-09-01-12:27:21.818877] Reading config file /home/krentel/clingo/spack-repo/etc/spack/defaults/config.yaml\r\n==> [2021-09-01-12:27:21.870298] Reading config file /home/krentel/clingo/spack-repo/etc/spack/config.yaml\r\n==> [2021-09-01-12:27:21.917261] DATABASE LOCK TIMEOUT: 3s\r\n==> [2021-09-01-12:27:21.917325] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2021-09-01-12:27:21.917923] Reading config file /home/krentel/clingo/spack-repo/etc/spack/defaults/bootstrap.yaml\r\n==> [2021-09-01-12:27:21.938049] DATABASE LOCK TIMEOUT: 3s\r\n==> [2021-09-01-12:27:21.938110] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2021-09-01-12:27:21.938208] [BOOTSTRAP CONFIG SCOPE] name=_builtin\r\n==> [2021-09-01-12:27:21.938851] [BOOTSTRAP CONFIG SCOPE] name=defaults, path=/home/krentel/clingo/spack-repo/etc/spack/defaults\r\n==> [2021-09-01-12:27:21.938911] [BOOTSTRAP CONFIG SCOPE] name=defaults/linux, path=/home/krentel/clingo/spack-repo/etc/spack/defaults/linux\r\n==> [2021-09-01-12:27:21.938977] [BOOTSTRAP CONFIG SCOPE] name=system, path=/etc/spack\r\n==> [2021-09-01-12:27:21.939030] [BOOTSTRAP CONFIG SCOPE] name=system/linux, path=/etc/spack/linux\r\n==> [2021-09-01-12:27:21.939094] [BOOTSTRAP CONFIG SCOPE] name=site, path=/home/krentel/clingo/spack-repo/etc/spack\r\n==> [2021-09-01-12:27:21.939146] [BOOTSTRAP CONFIG SCOPE] name=site/linux, path=/home/krentel/clingo/spack-repo/etc/spack/linux\r\n==> [2021-09-01-12:27:21.939208] [BOOTSTRAP CONFIG SCOPE] name=user, path=/home/krentel/.spack\r\n==> [2021-09-01-12:27:21.939259] [BOOTSTRAP CONFIG SCOPE] name=user/linux, path=/home/krentel/.spack/linux\r\n==> [2021-09-01-12:27:21.962406] [BOOTSTRAP ROOT SPEC] clingo: clingo-bootstrap@spack+python %gcc target=ppc64le\r\n==> [2021-09-01-12:27:21.962470] [BOOTSTRAP MODULE clingo] Try importing from Python\r\n==> [2021-09-01-12:27:21.962851] Reading config file /home/krentel/clingo/spack-repo/etc/spack/defaults/bootstrap.yaml\r\n==> [2021-09-01-12:27:22.144795] Reading config file /home/krentel/clingo/spack-repo/etc/spack/defaults/config.yaml\r\n==> [2021-09-01-12:27:22.202184] Reading config file /home/krentel/clingo/spack-repo/etc/spack/config.yaml\r\n==> [2021-09-01-12:27:22.322394] [BOOTSTRAP MODULE clingo] The installed spec \"clingo-bootstrap@spack+python %gcc target=ppc64le ^python@3.6 /rfu4la457mdbpoffk2g5hikj2hhoek4s\" provides the \"clingo\" Python module\r\n==> [2021-09-01-12:27:22.322660] Reading config file /home/krentel/clingo/spack-repo/etc/spack/defaults/repos.yaml\r\n==> [2021-09-01-12:27:22.330052] Reading config file /home/krentel/clingo/spack-repo/etc/spack/defaults/config.yaml\r\n==> [2021-09-01-12:27:22.381029] Reading config file /home/krentel/clingo/spack-repo/etc/spack/config.yaml\r\nTraceback (most recent call last):\r\n  File \"/home/krentel/clingo/spack-repo/bin/spack\", line 100, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/home/krentel/clingo/spack-repo/lib/spack/spack/main.py\", line 797, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/home/krentel/clingo/spack-repo/lib/spack/spack/main.py\", line 525, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/home/krentel/clingo/spack-repo/lib/spack/spack/cmd/solve.py\", line 106, in solve\r\n    specs, dump=dump, models=models, timers=args.timers, stats=args.stats\r\n  File \"/home/krentel/clingo/spack-repo/lib/spack/spack/solver/asp.py\", line 1691, in solve\r\n    return driver.solve(setup, specs, dump, models, timers, stats, tests)\r\n  File \"/home/krentel/clingo/spack-repo/lib/spack/spack/solver/asp.py\", line 332, in solve\r\n    self.control = clingo.Control()\r\nAttributeError: module 'clingo' has no attribute 'Control'\r\n```\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.16.2-4111-7adacf9\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-rhel7-power9le\r\n* **Concretizer:** clingo\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "mwkrentel",
    "url": "https://api.github.com/repos/spack/spack/issues/25734",
    "updated_at": "2021-11-21 14:14:02",
    "created_at": "2021-09-01 17:36:08",
    "closed_at": "2021-09-08 18:13:37",
    "state": "closed",
    "title": "clingo fails with python 3.6 on ppc64le RHEL 7.x",
    "number": 25734,
    "milestone": null,
    "labels": [
        "bug",
        "impact-medium",
        "power",
        "bootstrap"
    ],
    "id": 985417320,
    "html_url": "https://github.com/spack/spack/issues/25734",
    "assignees": [
        "alalazo"
    ],
    "comments": 22
}