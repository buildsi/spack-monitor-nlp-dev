{
    "body": "### Steps to reproduce\n\nWith the trivial test package\r\n```python\r\nclass Test(Package):\r\n    git = \"https://github.com/olupton/spack-version-test.git\"\r\n    version('0.1', commit='00c17db520dc20f980b9faedfbfde20c5fadd7b9') #2nd commit\r\n    version('0.0', tag='v0.0') # 1st commit\r\n```\r\nwhere the git repository referred to has three commits, the oldest of which is tagged as `v0.0`, then\r\n```console\r\n$ spack spec -IL test@a1d78db0a7bb13a2f04cd76583167fbcd23b716f\r\nFrom https://github.com/olupton/spack-version-test\r\n * branch            HEAD       -> FETCH_HEAD\r\nInput spec\r\n--------------------------------\r\n -   test@a1d78db0a7bb13a2f04cd76583167fbcd23b716f\r\n\r\nConcretized\r\n--------------------------------\r\n -   jskyranh5ollyz5ko67rdlp33dbrwtwh  test@a1d78db0a7bb13a2f04cd76583167fbcd23b716f%gcc@4.8.5 arch=linux-rhel7-haswell\r\n```\r\nwhere the given hash is the third commit, results in\r\n```\r\n$ cat ~/.spack/cache/git_metadata/https/github.com/olupton/spack-version-test.git\r\n{\r\n  \"a1d78db0a7bb13a2f04cd76583167fbcd23b716f\": [\r\n    \"0.0\",\r\n    2\r\n  ]\r\n}\r\n```\r\ni.e. I understand that the commit is resolved as \"2 after 0.0\" rather than \"1 after 0.1\".\r\n\r\nI understood from https://github.com/spack/spack/pull/24639 that this was expected to work, but maybe I misunderstood something -- there is a lot of information.\r\n\r\nIn our real-world example we often tag extra Spack versions based on commits that fall between tags in the git repository.\n\n### Error message\n\nIn debug mode, the relevant part seems to be\r\n```\r\n==> [2022-01-07-17:51:13.036591] '/gpfs/bbp.cscs.ch/ssd/apps/hpc/jenkins/deploy/externals/2021-01-06/linux-rhel7-x86_64/gcc-9.3.0/git-2.31.0-4p6kbk/bin/git' '--version'\r\n==> [2022-01-07-17:51:13.046025] '/gpfs/bbp.cscs.ch/ssd/apps/hpc/jenkins/deploy/externals/2021-01-06/linux-rhel7-x86_64/gcc-9.3.0/git-2.31.0-4p6kbk/bin/git' '-c' 'advice.detachedHead=false' 'fetch' '--tags'\r\nFrom https://github.com/olupton/spack-version-test\r\n * branch            HEAD       -> FETCH_HEAD\r\n==> [2022-01-07-17:51:13.584250] '/gpfs/bbp.cscs.ch/ssd/apps/hpc/jenkins/deploy/externals/2021-01-06/linux-rhel7-x86_64/gcc-9.3.0/git-2.31.0-4p6kbk/bin/git' '-c' 'advice.detachedHead=false' 'cat-file' '-e' 'a1d78db0a7bb13a2f04cd76583167fbcd23b716f^{commit}'\r\n==> [2022-01-07-17:51:13.593786] '/gpfs/bbp.cscs.ch/ssd/apps/hpc/jenkins/deploy/externals/2021-01-06/linux-rhel7-x86_64/gcc-9.3.0/git-2.31.0-4p6kbk/bin/git' '-c' 'advice.detachedHead=false' 'for-each-ref' '--sort=creatordate' '--format' '%(objectname) %(refname)' 'refs/tags'\r\n==> [2022-01-07-17:51:13.602763] '/gpfs/bbp.cscs.ch/ssd/apps/hpc/jenkins/deploy/externals/2021-01-06/linux-rhel7-x86_64/gcc-9.3.0/git-2.31.0-4p6kbk/bin/git' '-c' 'advice.detachedHead=false' 'merge-base' '--is-ancestor' 'f2b8fdd4b152e77faf273973e2db5075dd9ecede' 'a1d78db0a7bb13a2f04cd76583167fbcd23b716f'\r\n==> [2022-01-07-17:51:13.611574] '/gpfs/bbp.cscs.ch/ssd/apps/hpc/jenkins/deploy/externals/2021-01-06/linux-rhel7-x86_64/gcc-9.3.0/git-2.31.0-4p6kbk/bin/git' '-c' 'advice.detachedHead=false' 'rev-list' 'f2b8fdd4b152e77faf273973e2db5075dd9ecede..a1d78db0a7bb13a2f04cd76583167fbcd23b716f' '--count'\r\n```\n\n### Information on your system\n\n* **Spack:** 0.17.1-744-04a95e3425\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-rhel7-skylake_avx512\r\n* **Concretizer:** clingo\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "olupton",
    "url": "https://api.github.com/repos/spack/spack/issues/28294",
    "updated_at": "2022-01-07 16:54:36",
    "created_at": "2022-01-07 16:54:36",
    "closed_at": "None",
    "state": "open",
    "title": "package@git_hash does not map onto the correct version if versions are defined by commits",
    "number": 28294,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1096491443,
    "html_url": "https://github.com/spack/spack/issues/28294",
    "assignees": [],
    "comments": 0
}