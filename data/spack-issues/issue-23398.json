{
    "body": "<!-- Explain, in a clear and concise way, the command you ran and the result you were trying to achieve.\r\nExample: \"I ran `spack find` to list all the installed packages and ...\" -->\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ ./bin/spack compilers\r\n==> Available compilers\r\n-- aocc sles15-any ----------------------------------------------\r\naocc@8.0.0  aocc@2.2.0.1  aocc@2.2.0.1\r\n\r\n-- cce sles15-any -----------------------------------------------\r\ncce@11.0.4\r\n\r\n-- gcc sles15-any -----------------------------------------------\r\ngcc@10.2.0  gcc@10.2.0  gcc@9.3.0  gcc@9.3.0  gcc@8.1.0\r\n\r\n-- intel sles15-any ---------------------------------------------\r\nintel@19.1.3.304  intel@19.1.3.304  intel@8.0.0\r\n$ cat ~/.spack/cray/compilers.yaml\r\n[...]\r\n- compiler:\r\n    spec: intel@8.0.0\r\n    paths:\r\n      cc: cc\r\n      cxx: CC\r\n      f77: ftn\r\n      fc: ftn\r\n    flags: {}\r\n    operating_system: sles15\r\n    target: any\r\n    modules:\r\n    - PrgEnv-intel\r\n    - intel/8.0.0\r\n    environment: {}\r\n    extra_rpaths: []\r\n- compiler:\r\n    spec: intel@19.1.3.304\r\n    paths:\r\n      cc: cc\r\n      cxx: CC\r\n      f77: ftn\r\n      fc: ftn\r\n    flags: {}\r\n    operating_system: sles15\r\n    target: any\r\n    modules:\r\n    - PrgEnv-intel\r\n    - intel/19.1.3.304\r\n    environment: {}\r\n    extra_rpaths: []\r\n- compiler:\r\n    spec: intel@19.1.3.304\r\n    paths:\r\n      cc: cc\r\n      cxx: CC\r\n      f77: ftn\r\n      fc: ftn\r\n    flags: {}\r\n    operating_system: sles15\r\n    target: any\r\n    modules:\r\n    - PrgEnv-intel\r\n    - intel/19.1.3.304\r\n    environment: {}\r\n    extra_rpaths: []\r\n```\r\n\r\nthe module `intel/8.0.0` does not exist:\r\n\r\n```\r\n$  module avail\r\n[...]\r\n   PrgEnv-intel/8.0.0 (L)    cray-libsci/21.04.1.1 (L)    intel/19.1.3.304       (L,D)\r\n   aocc/2.2.0.1       (D)    cray-pmi-lib/6.0.10          iobuf/2.0.10\r\n   atp/3.13.1                cray-pmi/6.0.10              papi/6.0.0.6\r\n   cce/11.0.4                cray-python/3.8.5.0          perftools-base/21.02.0 (L)\r\n   cpe/21.04                 cray-stat/4.10.1             valgrind4hpc/2.11.1\r\n   cray-R/4.0.3.0     (D)    craype/2.7.6          (L)\r\n   cray-ccdb/4.11.1          craypkg-gen/1.3.14\r\n\r\n--------------------------- /opt/cray/pe/lmod/modulefiles/craype-targets/default ----------------------------\r\n   craype-accel-amd-gfx908    craype-hugepages16M     craype-hugepages32M     craype-network-none\r\n   craype-accel-host          craype-hugepages1G      craype-hugepages4M      craype-network-ofi  (L)\r\n   craype-accel-nvidia70      craype-hugepages256M    craype-hugepages512M    craype-network-ucx\r\n   craype-accel-nvidia80      craype-hugepages2G      craype-hugepages64M     craype-x86-milan\r\n   craype-hugepages128M       craype-hugepages2M      craype-hugepages8M      craype-x86-rome     (L)\r\n\r\n------------------------------------------- /opt/cray/modulefiles -------------------------------------------\r\n   cray-lustre-client/2.12.4.2_cray_18_g0120bae-7.0.1.0_2.17__g0120bae110.shasta\r\n   cray-shasta-mlnx-firmware/1.0.8\r\n   cray-ucx/2.7.0-1\r\n   dvs/2.12_4.0.102-7.0.1.0_8.1__g30d29e7a\r\n   libfabric/1.11.0.4.67                                                         (L)\r\n   xpmem/2.2.40-7.0.1.0_1.9__g1d7a24d.shasta                                     (L)\r\n\r\n--------------------------------------------- /opt/modulefiles ----------------------------------------------\r\n   aocc/2.2.0.1      darshan/3.2.1    gcc/9.3.0     intel/19.1.3.304\r\n   cray-R/4.0.3.0    gcc/8.1.0        gcc/10.2.0\r\n```\r\n\r\nMy guess is that this goes unnoticed because a) for most compilers the compiler version is bigger than the PrgEnv version (except for aocc where this gets annoying) and b) because loading modules gets ignored (see #21253) amd loading a PrgEnv pulls in the compiler module automatically.\r\n\r\n### Information on your system\r\n\r\nHPE Cray EX \"Alps (Eiger)\" at CSCS.\r\n\r\n### Additional information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [x] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [x] I have searched the issues of this repo and believe this is not a duplicate\r\n- [ ] I have run the failing commands in debug mode and reported the output\r\n\r\n```\r\n$ ./bin/spack debug report\r\n* **Spack:** 0.16.1-2477-1cc5058d90\r\n* **Python:** 3.6.12\r\n* **Platform:** cray-sles15-zen2\r\n* **Concretizer:** original\r\n* ```\r\n",
    "user": "dev-zero",
    "url": "https://api.github.com/repos/spack/spack/issues/23398",
    "updated_at": "2021-05-03 14:23:33",
    "created_at": "2021-05-03 14:16:56",
    "closed_at": "None",
    "state": "open",
    "title": "`spack compilers` gets compiler version from PrgEnv version rather than compiler",
    "number": 23398,
    "milestone": null,
    "labels": [
        "bug",
        "cray",
        "triage"
    ],
    "id": 874615060,
    "html_url": "https://github.com/spack/spack/issues/23398",
    "assignees": [],
    "comments": 0
}