{
    "body": "Caffe's CMake finds different installations of dependency resulting in link issues. Here is example where I install dependencies in `new_spack_path` and Caffe find some from `old_path`: \r\n\r\n```\r\n==> openblas is already installed in /some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/openblas-0.2.20-tgtgdmq2\r\n==> Installing caffe\r\n==> Using cached archive: /gpfs/bbp.cscs.ch/scratch/gss/bgq/kumbhar-adm/SPACK_HOME/var/spack/cache/caffe/caffe-1.0.tar.gz\r\n==> Already staged caffe-1.0-5oxpymqlimusuqdvzvrtv4llf66i3hr2 in /gpfs/bbp.cscs.ch/home/kumbhar-adm/SPACK_HOME/spack/var/spack/stage/caffe-1.0-5oxpymqlimusuqdvzvrtv4llf66i3hr2\r\n==> No patches needed for caffe\r\n==> Building caffe [CMakePackage]\r\n==> Executing phase: 'cmake'\r\n==> 'cmake' '/gpfs/bbp.cscs.ch/home/kumbhar-adm/SPACK_HOME/spack/var/spack/stage/caffe-1.0-5oxpymqlimusuqdvzvrtv4llf66i3hr2/caffe-1.0' '-G' 'Unix Makefiles' '-DCMAKE_INSTALL_PREFIX:PATH=/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/caffe-1.0-5oxpymql' '-DCMAKE_BUILD_TYPE:STRING=RelWithDebInfo' '-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON' '-DCMAKE_INSTALL_RPATH_USE_LINK_PATH:BOOL=FALSE' '-DCMAKE_INSTALL_RPATH:STRING=/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/caffe-1.0-5oxpymql/lib:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/caffe-1.0-5oxpymql/lib64:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/boost-1.63.0-v7d3x5l5/lib:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/bzip2-1.0.6-npjovari/lib:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/python-2.7.13-dhkjobme/lib:/usr/lib:/usr/lib:/usr/lib:/usr/lib:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/zlib-1.2.11-cabzx2gn/lib:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/gflags-2.1.2-tfqqvp7z/lib:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/glog-0.3.5-owsws472/lib:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/hdf5-1.8.16-xchtpxec/lib:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/libszip-2.1.1-ythud6pf/lib:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/lmdb-0.9.21-nkcy3nck/lib:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/openblas-0.2.20-tgtgdmq2/lib:/usr/lib64:/usr/lib64:/usr/lib64:/usr/lib64:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/cuda-8.0.44-pgyvlyab/lib64:/some_path/new_spack_path/install/linux-rhel6-x86_64/gcc-5.3.0/protobuf-3.4.0-omw3vxeb/lib64' '-DBLAS=open' '-DCPU_ONLY=False' '-DUSE_CUDNN=True' '-DBUILD_python=True' '-DBUILD_python_layer=True' '-DBUILD_matlab=False' '-DUSE_OPENCV=False' '-DUSE_LEVELDB=False' '-DUSE_LMDB=True' '-Dpython_version=2'\r\n-- Boost version: 1.63.0\r\n-- Found the following Boost libraries:\r\n--   system\r\n\u2026\r\n-- Found gflags  (include: /some_path/old_path/install/linux-rhel6-x86_64/gcc-5.3.0/gflags-2.1.2-tfqqvp7z/include, library: /some_path/old_path/install/linux-rhel6-x86_64/gcc-5.3.0/gflags-2.1.2-tfqqvp7z/lib/libgflags.so)\r\n-- Found glog    (include: /some_path/old_path/install/linux-rhel6-x86_64/gcc-5.3.0/glog-0.3.5-owsws472/include, library: /some_path/old_path/install/linux-rhel6-x86_64/gcc-5.3.0/glog-0.3.5-owsws472/lib/libglog.so)\r\n-- Found PROTOBUF Compiler: /some_path/old_path/install/linux-rhel6-x86_64/gcc-5.3.0/protobuf-3.4.0-omw3vxeb/bin/protoc\r\n-- HDF5: Using hdf5 compiler wrapper to determine C configuration\r\n-- HDF5: Using hdf5 compiler wrapper to determine CXX configuration\r\n-- Found lmdb    (include: /some_path/old_path/install/linux-rhel6-x86_64/gcc-5.3.0/lmdb-0.9.21-nkcy3nck/include, library: /some_path/old_path/install/linux-rhel6-x86_64/gcc-5.3.0/lmdb-0.9.21-nkcy3nck/lib/liblmdb.so)\r\nCUDA detected: 8.0\r\n-- Added CUDA NVCC flags for: sm_35\r\n-- Found OpenBLAS libraries: /some_path/old_path/install/linux-rhel6-x86_64/gcc-5.3.0/openblas-0.2.20-tgtgdmq2/lib/libopenblas.so\r\n-- Found OpenBLAS include: /some_path/old_path/install/linux-rhel6-x86_64/gcc-5.3.0/openblas-0.2.20-tgtgdmq2/include\r\n```\r\n\r\nthis change make sure all CMake/ENV variables are set.\r\n\r\nCheck Caffe [CMake Modules](https://github.com/BVLC/caffe/tree/master/cmake/Modules).",
    "user": "pramodskumbhar",
    "url": "https://api.github.com/repos/spack/spack/issues/5328",
    "updated_at": "2017-09-10 23:54:17",
    "created_at": "2017-09-10 15:04:01",
    "closed_at": "2017-09-10 23:14:22",
    "state": "closed",
    "title": "Improve caffe dependency detection with extra CMake flags",
    "number": 5328,
    "milestone": null,
    "labels": [],
    "id": 256516209,
    "html_url": "https://github.com/spack/spack/pull/5328",
    "assignees": [],
    "comments": 0
}