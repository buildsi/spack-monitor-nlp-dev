{
    "body": "### Steps to reproduce the issue\n\n@arjun-raj-kuppala @haampie @srekolam\r\n\r\nTrying to install ROCm 4.2.0 inside a Spack environment on a 24 core server with 64GiB RAM, 16 GiB `/tmp`.\r\n\r\n`spack.yaml`\r\n```\r\nspack:\r\n  concretization: separately\r\n  packages:\r\n    all:\r\n      compiler: [gcc@10.3.0]\r\n  specs:\r\n  - matrix:\r\n    - ['%gcc@10.3.0^cmake@3.17.5']\r\n    - [atmi@4.2.0, comgr@4.2.0, hip@4.2.0, hipblas@4.2.0, hipcub@4.2.0, hipfft@4.2.0,\r\n      hipfort@4.2.0, hipify-clang@4.2.0, hip-rocclr@4.2.0, hipsparse@4.2.0, hsakmt-roct@4.2.0,\r\n      hsa-rocr-dev@4.2.0, llvm-amdgpu@4.2.0, migraphx@4.2.0, miopengemm@4.2.0, miopen-hip@4.2.0,\r\n      miopen-opencl@4.2.0, mivisionx@4.2.0, rccl@4.2.0, rdc@4.2.0, rocalution@4.2.0,\r\n      rocblas@4.2.0, rocfft@4.2.0, rocm-bandwidth-test@4.2.0, rocm-clang-ocl@4.2.0,\r\n      rocm-cmake@4.2.0, rocm-dbgapi@4.2.0, rocm-debug-agent@4.2.0, rocm-gdb@4.2.0,\r\n      rocminfo@4.2.0, rocm-opencl@4.2.0, rocm-openmp-extras@4.2.0, rocm-smi-lib@4.2.0,\r\n      rocm-tensile@4.2.0, rocm-validation-suite@4.2.0, rocprim@4.2.0, rocprofiler-dev@4.2.0,\r\n      rocrand@4.2.0, rocsolver@4.2.0, rocsparse@4.2.0, rocthrust@4.2.0, roctracer-dev@4.2.0] # rocm-device-libs@4.2.0,\r\n  view: true\r\n```\r\nresults in\r\n```\r\n$ spack install -j20\r\n[\u2026]\r\n==> Installing rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok                                                                                         [37/152]\r\n==> No binary for rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok found: installing from source\r\n==> Warning: Suspicious requests to set or unset 'CXX' found\r\n==> Warning:            env.set('CXX', os.path.join(link_dir, compiler.link_paths['cxx'])) at /sw/vulcan-CentOS7/hlrs/non-spack/misc/spack.2021-06-16/spack.de\r\nvelop/lib/spack/spack/build_environment.py:257\r\n==> Warning:    --->     at /sw/vulcan-CentOS7/hlrs/non-spack/misc/spack.2021-06-16/spack.develop/var/spack/repos/builtin/packages/rocblas/package.py:82\r\n==> Using cached archive: /tmp/spack/hpcoft30/src/_source-cache/archive/54/547f6d5d38a41786839f01c5bfa46ffe9937b389193a8891f251e276a1a47fb0.tar.gz\r\n==> Using cached archive: /tmp/spack/hpcoft30/src/_source-cache/git//ROCmSoftwarePlatform/Tensile.git/3438af228dc812768b20a068b0285122f327fa5b.tar.gz\r\n==> Warning: Fetching from mirror without a checksum!\r\n  This package is normally checked out from a version control system, but it has been archived on a spack mirror.  This means we cannot know a checksum for th\r\ne tarball in advance. Be sure that your connection to this mirror is secure!\r\n==> Moving resource stage\r\n        source : /tmp/spack/hpcoft30/build/resource-Tensile-tcrmmycbthlflr5xqq2xfxdfpaxft3ok/spack-src/\r\n        destination : /tmp/spack/hpcoft30/build/spack-stage-rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok/spack-src/Tensile\r\n==> No patches needed for rocblas\r\n==> rocblas: Executing phase: 'cmake'\r\n==> rocblas: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j20'\r\n\r\n3 errors found in build log:\r\n     1008        return Popen(process_obj)\r\n     1009      File \"/opt/hlrs/spack/2021-09-30/python/3.8.11-gcc-10.3.0-3abeedd2/lib/python3.8/multiprocessing/popen_fork.py\", line 19, in __init__\r\n     1010        self._launch(process_obj)\r\n     1011      File \"/opt/hlrs/spack/2021-09-30/python/3.8.11-gcc-10.3.0-3abeedd2/lib/python3.8/multiprocessing/popen_fork.py\", line 70, in _launch\r\n     1012        self.pid = os.fork()\r\n     1013    OSError: [Errno 12] Cannot allocate memory\r\n  >> 1014    make[2]: *** [Tensile/library/TensileLibrary.dat] Error 1\r\n     1015    make[2]: Leaving directory `/tmp/spack/hpcoft30/build/spack-stage-rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok/spack-build-tcrmmyc'\r\n  >> 1016    make[1]: *** [library/src/CMakeFiles/TENSILE_LIBRARY_TARGET.dir/all] Error 2\r\n     1017    make[1]: Leaving directory `/tmp/spack/hpcoft30/build/spack-stage-rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok/spack-build-tcrmmyc'\r\n  >> 1018    make: *** [all] Error 2\r\n\r\nSee build log for details:\r\n  /tmp/spack/hpcoft30/build/spack-stage-rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok/spack-build-out.txt\r\n\r\n==> Warning: Skipping build of hipblas-4.2.0-igpxkkncnsb6fk64i7qq3c2sihzpwbgf since rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok failed\r\n==> Warning: Skipping build of miopen-hip-4.2.0-fcrcxdxgevk5x2tpulmdsyf6yclxkfx4 since rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok failed\r\n==> Warning: Skipping build of migraphx-4.2.0-lpj3nxlbodkdys4s2ttnc64v5yrkkwb3 since miopen-hip-4.2.0-fcrcxdxgevk5x2tpulmdsyf6yclxkfx4 failed\r\n==> Warning: Skipping build of miopen-hip-4.2.0-yqcjyia2y4z2rnshyqzqcfa6cmwardzi since rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok failed\r\n==> Warning: Skipping build of rocsolver-4.2.0-uod4w6pjo7vezpficidsa75wcctqvuxb since rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok failed\r\n==> Warning: Skipping build of rocm-validation-suite-4.2.0-hr2a7hn6rtyd7dz2g2quz7yqohbrttv6 since rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok failed\r\n==> Warning: Skipping build of rocalution-4.2.0-z6kjsfpahpsjdqi4pqoin7x6bg2dn42s since rocblas-4.2.0-tcrmmycbthlflr5xqq2xfxdfpaxft3ok failed\r\n==> Error: Terminating after first install failure: ProcessError: Command exited with status 2:\r\n    'make' '-j20'\r\n```\n\n### Information on your system\n\n```\r\n$ spack debug report\r\n* **Spack:** 0.16.3-4541-9e70fc6\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-centos7-x86_64\r\n* **Concretizer:** original\r\n```\r\n[spack-build-out.txt](https://github.com/spack/spack/files/7265591/spack-build-out.txt)\r\n\r\n[spack-build-env.txt](https://github.com/spack/spack/files/7265596/spack-build-env.txt)\r\n\r\n\n\n### Additional information\n\n_No response_\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "UweSauter",
    "url": "https://api.github.com/repos/spack/spack/issues/26400",
    "updated_at": "2021-10-08 15:58:59",
    "created_at": "2021-10-01 08:54:54",
    "closed_at": "2021-10-08 15:18:46",
    "state": "closed",
    "title": "Installation issue: rocblas@4.2.0%gcc@10.3.0 fails with \"OSError: [Errno 12] Cannot allocate memory\"",
    "number": 26400,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1013085637,
    "html_url": "https://github.com/spack/spack/issues/26400",
    "assignees": [
        "srekolam"
    ],
    "comments": 25
}