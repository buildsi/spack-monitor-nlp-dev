{
    "body": "Since Spack currently always uses the default version of a dependency during spec normalization, I often add explicit dependencies to packages on install to prevent unnecessary package installs.  For example, if I need to install `a^b+debug` and `c^b`, I'll typically install `a^b+debug` and `c^b+debug` to prevent an unnecessary install of `b~debug`.  Unfortunately, I've found that doing this can make packages unusable as dependencies by other packages.\n\nIn the error case that I was able to find, I wanted to install the following set of packages in an empty Spack repository:\n- `qt@4.8.6+webkit`\n- `vtk@6.1.0~opengl2`, which depends on `qt`\n- `visit@2.10.2`, which depends on `qt@4.8.6` and `vtk@6.1.0~opengl2`\n\nIn order to prevent redundant installs, I attempted to install each of the Qt-dependent packages with an explicit `^qt@4.8.6+webkit` dependency in the order listed above.  This caused the `visit@2.10.2` install to attempt to install a new instance of `vtk@6.1.0~opengl2` that required new instances of the `libxcb` and `qt` packages.  I haven't allowed this new `vtk@6.1.0~opengl2` to fully install yet, but I found that the `libxcb` installed in this way has a different hash than the `libxcb` installed through `qt@4.8.6+webkit` but is otherwise identical (even querying either one of the hashes with `spack find` yields both installs).\n\nI also tried to install `visit@2.10.2 ^\"/pidklxj\" ^qt@4.8.6+webkit` (where `/pidklxj` is the hash for the `vtk@6.1.0~opengl2 ^qt@4.8.6+webkit` install), but encountered the following error:\n\n```\n==> Error: Specs\n  vtk@6.1.0%gcc@4.4.7~opengl2 arch=linux-redhat6-x86_64\n      ^cmake@3.6.0%gcc@4.4.7~doc+ncurses+openssl~qt arch=linux-redhat6-x86_64\n          ^ncurses@6.0%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^openssl@1.0.2h%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^zlib@1.2.8%gcc@4.4.7 arch=linux-redhat6-x86_64\n      ^qt@4.8.6%gcc@4.4.7~gtk~krellpatch~mesa+webkit arch=linux-redhat6-x86_64\n          ^bison@3.0.4%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^m4@1.4.17%gcc@4.4.7+sigsegv arch=linux-redhat6-x86_64\n                  ^libsigsegv@2.10%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^dbus@1.11.2%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^expat@2.1.0%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^flex@2.6.0%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^fontconfig@2.11.1%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^freetype@2.5.3%gcc@4.4.7 arch=linux-redhat6-x86_64\n                  ^libpng@1.6.16%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^libxml2@2.9.2%gcc@4.4.7~python arch=linux-redhat6-x86_64\n                  ^xz@5.2.2%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^glib@2.49.4%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^gettext@0.19.8.1%gcc@4.4.7+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-redhat6-x86_64\n                  ^bzip2@1.0.6%gcc@4.4.7 arch=linux-redhat6-x86_64\n                  ^tar@1.29%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^libffi@3.2.1%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^pcre@8.38%gcc@4.4.7+utf arch=linux-redhat6-x86_64\n              ^pkg-config@0.29.1%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^gperf@3.0.4%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^icu4c@54_1%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^jpeg@9b%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^libmng@2.0.2%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^lcms@2.6%gcc@4.4.7 arch=linux-redhat6-x86_64\n                  ^libtiff@4.0.3%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^libxcb@1.11.1%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^libpthread-stubs@0.3%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^libxau@1.0.8%gcc@4.4.7 arch=linux-redhat6-x86_64\n                  ^xproto@7.0.29%gcc@4.4.7 arch=linux-redhat6-x86_64\n                      ^xorg-util-macros@1.19.0%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^python@2.7.12%gcc@4.4.7~tk~ucs4 arch=linux-redhat6-x86_64\n                  ^readline@6.3%gcc@4.4.7 arch=linux-redhat6-x86_64\n                  ^sqlite@3.8.5%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^xcb-proto@1.11%gcc@4.4.7 arch=linux-redhat6-x86_64\n and\n  vtk@6.1.0%gcc@4.4.7~opengl2 arch=linux-redhat6-x86_64\n      ^qt@4.8.6%gcc@4.4.7~gtk~krellpatch~mesa+webkit arch=linux-redhat6-x86_64\n          ^dbus@1.11.2%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^expat@2.1.0%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^fontconfig@2.11.1%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^freetype@2.5.3%gcc@4.4.7 arch=linux-redhat6-x86_64\n                  ^libpng@1.6.16%gcc@4.4.7 arch=linux-redhat6-x86_64\n                      ^zlib@1.2.8%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^libxml2@2.9.2%gcc@4.4.7~python arch=linux-redhat6-x86_64\n                  ^xz@5.2.2%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^glib@2.49.4%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^gettext@0.19.8.1%gcc@4.4.7+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-redhat6-x86_64\n                  ^bzip2@1.0.6%gcc@4.4.7 arch=linux-redhat6-x86_64\n                  ^ncurses@6.0%gcc@4.4.7 arch=linux-redhat6-x86_64\n                  ^tar@1.29%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^libffi@3.2.1%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^pcre@8.38%gcc@4.4.7+utf arch=linux-redhat6-x86_64\n          ^gperf@3.0.4%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^icu4c@54_1%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^jpeg@9b%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^libmng@2.0.2%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^lcms@2.6%gcc@4.4.7 arch=linux-redhat6-x86_64\n                  ^libtiff@4.0.3%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^libxcb@1.11.1%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^libpthread-stubs@0.3%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^libxau@1.0.8%gcc@4.4.7 arch=linux-redhat6-x86_64\n                  ^xproto@7.0.29%gcc@4.4.7 arch=linux-redhat6-x86_64\n                      ^xorg-util-macros@1.19.0%gcc@4.4.7 arch=linux-redhat6-x86_64\n              ^xcb-proto@1.11%gcc@4.4.7 arch=linux-redhat6-x86_64\n          ^openssl@1.0.2h%gcc@4.4.7 arch=linux-redhat6-x86_64\nhave the same SHA-1 prefix!\n```\n\nIt's apparent in this output that the installs are pretty much identical with the only real difference being the `libxcb` dependency, which isn't as fully filled out in the second case since `python` is included earlier in the `visit@2.10.2` dependency list.\n\n@tgamblin, @becker33: Is this difference in how the specification is being filled out causing these problems?  If not, what else do you suppose could be causing this problem?  Thanks in advance to all that provide input.\n",
    "user": "xjrc",
    "url": "https://api.github.com/repos/spack/spack/issues/1559",
    "updated_at": "2017-04-12 16:07:32",
    "created_at": "2016-08-18 18:33:10",
    "closed_at": "2017-04-11 22:32:42",
    "state": "closed",
    "title": "Spack Bug : Adding Explicit Dependency to Package Can Make it Unusable by Dependents",
    "number": 1559,
    "milestone": null,
    "labels": [
        "bug",
        "dependencies"
    ],
    "id": 171969470,
    "html_url": "https://github.com/spack/spack/issues/1559",
    "assignees": [],
    "comments": 15
}