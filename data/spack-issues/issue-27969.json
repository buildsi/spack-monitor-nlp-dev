{
    "body": "### Steps to reproduce the issue\n\n`legion@21.03.0 +cuda cuda_arch=80` build fails using:\r\n* `spack@develop` (f6802b733a8889e73edeaa6c80d2077ee86bc490 from `Mon Dec 13 11:45:31 2021 +0100`)\r\n* Ubuntu 20.04, GCC 9.3.0\r\n* CUDA 11.5.1\r\n\r\n**Concrete spec:** [legion.spec.json.txt](https://github.com/spack/spack/files/7706487/legion.spec.json.txt)\r\n\r\n**Concretization**\r\n```\r\nlegion@21.03.0%gcc@9.3.0~bindings~bounds_checks+cuda~cuda_hijack~cuda_unsupported_compiler~enable_tls~fortran~gasnet_debug~hdf5~hwloc~ipo~kokkos+libdl~native~openmp~papi~privilege_checks~python~redop_complex~shared~spy+zlib build_type=RelWithDebInfo conduit=none cuda_arch=80 gasnet_root=none max_dims=3 max_fields=512 network=none output_level=warning arch=linux-ubuntu20.04-x86_64\r\n    ^cmake@3.21.4%gcc@9.3.0~doc+ncurses+openssl+ownlibs~qt build_type=Release arch=linux-ubuntu20.04-x86_64\r\n        ^ncurses@6.2%gcc@9.3.0~symlinks+termlib abi=none arch=linux-ubuntu20.04-x86_64\r\n            ^pkgconf@1.8.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^openssl@1.1.1l%gcc@9.3.0~docs certs=system arch=linux-ubuntu20.04-x86_64\r\n            ^perl@5.34.0%gcc@9.3.0+cpanm+shared+threads arch=linux-ubuntu20.04-x86_64\r\n                ^berkeley-db@18.1.40%gcc@9.3.0+cxx~docs+stl patches=b231fcc4d5cff05e5c3a4814f6a5af0e9a966428dc2176540d2c05aff41de522 arch=linux-ubuntu20.04-x86_64\r\n                ^bzip2@1.0.8%gcc@9.3.0~debug~pic+shared arch=linux-ubuntu20.04-x86_64\r\n                    ^diffutils@3.8%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                        ^libiconv@1.16%gcc@9.3.0 libs=shared,static arch=linux-ubuntu20.04-x86_64\r\n                ^gdbm@1.19%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^readline@8.1%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^zlib@1.2.11%gcc@9.3.0+optimize+pic+shared arch=linux-ubuntu20.04-x86_64\r\n    ^cuda@11.5.1%gcc@9.3.0~dev arch=linux-ubuntu20.04-x86_64\r\n        ^libxml2@2.9.12%gcc@9.3.0~python arch=linux-ubuntu20.04-x86_64\r\n            ^xz@5.2.5%gcc@9.3.0+pic libs=shared,static arch=linux-ubuntu20.04-x86_64\r\n```\r\n\r\n**Installation**\r\n```\r\n$> spack install -f ./legion.spec.json\r\n...\r\n==> Installing legion-21.03.0-kyna3pchzpxqzzzjpvqszu3c543kbpij\r\n==> No binary for legion-21.03.0-kyna3pchzpxqzzzjpvqszu3c543kbpij found: installing from source\r\n==> No patches needed for legion\r\n==> legion: Executing phase: 'cmake'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    'cmake' '-G' 'Unix Makefiles' '-DCMAKE_INSTALL_PREFIX:STRING=/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/legion-21.03.0-kyna3pchzpxqzzzjpvqszu3c543kbpij' '-DCMAKE_BUILD_TYPE:STRING=RelWithDebInfo' '-DCMAKE_INTERPROCEDURAL_OPTIMIZATION:BOOL=OFF' '-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON' '-DCMAKE_INSTALL_RPATH_USE_LINK_PATH:BOOL=OFF' '-DCMAKE_INSTALL_RPATH:STRING=/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/legion-21.03.0-kyna3pchzpxqzzzjpvqszu3c543kbpij/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/legion-21.03.0-kyna3pchzpxqzzzjpvqszu3c543kbpij/lib64;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libxml2-2.9.12-xlbi5rk675mptoyjnuff4q3e2lajs2wr/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libiconv-1.16-zth4ohvj7y3p532iqjw7fptg3kkn3ixv/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/xz-5.2.5-mq4ikt5q4zttamuxqkqe66jlftjbvkf4/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/zlib-1.2.11-ufqpqnpj5gjkfx5sd2o3twwveuowcz2b/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cuda-11.5.1-7zovxzh23daik22jdh4kb5l4gobp5ojt/lib64' '-DCMAKE_PREFIX_PATH:STRING=/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cuda-11.5.1-7zovxzh23daik22jdh4kb5l4gobp5ojt;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libxml2-2.9.12-xlbi5rk675mptoyjnuff4q3e2lajs2wr;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/xz-5.2.5-mq4ikt5q4zttamuxqkqe66jlftjbvkf4;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cmake-3.21.4-55vqjfj2bk55ga4fj3erj5tpzugh3t3b;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/zlib-1.2.11-ufqpqnpj5gjkfx5sd2o3twwveuowcz2b;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libiconv-1.16-zth4ohvj7y3p532iqjw7fptg3kkn3ixv' '-DLegion_EMBED_GASNet=OFF' '-DBUILD_SHARED_LIBS=OFF' '-DLegion_USE_CUDA=ON' '-DLegion_GPU_REDUCTIONS=ON' '-DLegion_CUDA_ARCH=80' '-DLegion_HIJACK_CUDART=OFF' '-DLegion_USE_LIBDL=ON' '-DLegion_USE_ZLIB=ON' '-DLegion_MAX_DIM=3' '-DLegion_MAX_FIELDS=512' '/tmp/root/spack-stage/spack-stage-legion-21.03.0-kyna3pchzpxqzzzjpvqszu3c543kbpij/spack-src'\r\n\r\n1 error found in build log:\r\n     45    -- Found Threads: TRUE\r\n     46    -- Found CUDA: /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cuda-11.5.1-7zovxzh23daik22jdh4kb5l4gobp5ojt (found version \"11.5\")\r\n     47    -- Found ZLIB: /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/zlib-1.2.11-ufqpqnpj5gjkfx5sd2o3twwveuowcz2b/lib/libz.so (found version \"1.2.11\")\r\n     48    -- Performing Test COMPILER_SUPORTS_OVERLOADED_VIRTUAL_WARNING\r\n     49    -- Performing Test COMPILER_SUPORTS_OVERLOADED_VIRTUAL_WARNING - Success\r\n     50    -- Configuring done\r\n  >> 51    CMake Error: The following variables are used in this project, but they are set to NOTFOUND.\r\n     52    Please set them or make sure they are set and tested correctly in the CMake files:\r\n     53    CUDA_CUDA_LIBRARY (ADVANCED)\r\n     54        linked by target \"RealmRuntime\" in directory /tmp/root/spack-stage/spack-stage-legion-21.03.0-kyna3pchzpxqzzzjpvqszu3c543kbpij/spack-src/runtime\r\n     55\r\n     56    -- Generating done\r\n     57    CMake Generate step failed.  Build files cannot be regenerated correctly.\r\n```\n\n### Information on your system\n\n* **Spack:** 0.17.0-477-98c3cbda9c\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-cascadelake\r\n* **Concretizer:** clingo\n\n### Additional information\n\n[spack-build-env.txt](https://github.com/spack/spack/files/7706506/spack-build-env.txt)\r\n[spack-build-out.txt](https://github.com/spack/spack/files/7706507/spack-build-out.txt)\r\n[spack-build-01-cmake-out.txt](https://github.com/spack/spack/files/7706508/spack-build-01-cmake-out.txt)\r\n\r\n@pmccormick\r\n@streichler\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "eugeneswalker",
    "url": "https://api.github.com/repos/spack/spack/issues/27969",
    "updated_at": "2021-12-14 16:27:22",
    "created_at": "2021-12-13 19:48:42",
    "closed_at": "2021-12-14 16:27:21",
    "state": "closed",
    "title": "legion +cuda build fails: CMake: CUDA_CUDA_LIBRARY: variables used in this project but are set to NOTFOUND",
    "number": 27969,
    "milestone": null,
    "labels": [
        "build-error",
        "cuda",
        "e4s"
    ],
    "id": 1078924018,
    "html_url": "https://github.com/spack/spack/issues/27969",
    "assignees": [],
    "comments": 2
}