{
    "body": "`module refresh` only generates tcl modules despite the following being in my `~/.spack/modules.yaml`:\r\n\r\n```yaml\r\nenable::\r\n    -lmod\r\n```\r\n(Full config pasted further down)\r\n\r\nI was able to temporarily work around this issue by running `spack module refresh --module-type lmod --delete-tree` but based on the [modules tutorial](https://spack.readthedocs.io/en/latest/tutorial_modules.html?highlight=lmod#core-compiler-mpi), this does not seem like it should be necessary.\r\n\r\n### Expected Result\r\n\r\n```console\r\n\u2192 spack module refresh\r\n==> You are about to regenerate lmod module files for:\r\n-- linux-rhel7-x86_64 / gcc@4.8.5 -------------------------------\r\nmfi7l5m autoconf@2.69    oyomxdk gettext@0.19.8.1  ffzbok4 libxml2@2.9.8            qfrwdna openssl@1.0.2o  5nqkfcn tcl@8.6.8\r\nyk6ievw automake@1.16.1  r4e6p7x git@2.17.1        w5itwt6 lmod@7.7.29              vwvgnbn pcre@8.42       ecjbujt tmux@2.7\r\nqrd3gzl bzip2@1.0.6      5ugdsox libbsd@0.8.6      ltnggmf lua@5.3.4                py2bqlz pcre@8.42       rh7gav6 xz@5.2.4\r\n4wxypys curl@7.60.0      yprcni4 libevent@2.0.21   7nr5d5a lua-luafilesystem@1_6_3  ka6syh2 perl@5.26.2     vhzh5cf zlib@1.2.11\r\n6idl5st emacs@26.1       vlje6ju libiconv@1.15     tp6kijo lua-luaposix@33.4.0      7yuszxv pkgconf@1.4.2\r\nom6ee3r expat@2.2.5      3byxblk libsigsegv@2.11   ffrwz2d m4@1.4.18                sfsamtu readline@7.0\r\nbfjm7it gdbm@1.14.1      hnkxexo libtool@2.4.6     wkyck36 ncurses@6.1              ucx2vrv tar@1.30\r\n==> Do you want to proceed? [y/n]\r\n```\r\nNote the generation of `lmod modules`\r\n### Actual Result\r\n\r\n```console\r\n\u2192 spack module refresh\r\n==> You are about to regenerate tcl module files for:\r\n-- linux-rhel7-x86_64 / gcc@4.8.5 -------------------------------\r\nmfi7l5m autoconf@2.69    oyomxdk gettext@0.19.8.1  ffzbok4 libxml2@2.9.8            qfrwdna openssl@1.0.2o  5nqkfcn tcl@8.6.8\r\nyk6ievw automake@1.16.1  r4e6p7x git@2.17.1        w5itwt6 lmod@7.7.29              vwvgnbn pcre@8.42       ecjbujt tmux@2.7\r\nqrd3gzl bzip2@1.0.6      5ugdsox libbsd@0.8.6      ltnggmf lua@5.3.4                py2bqlz pcre@8.42       rh7gav6 xz@5.2.4\r\n4wxypys curl@7.60.0      yprcni4 libevent@2.0.21   7nr5d5a lua-luafilesystem@1_6_3  ka6syh2 perl@5.26.2     vhzh5cf zlib@1.2.11\r\n6idl5st emacs@26.1       vlje6ju libiconv@1.15     tp6kijo lua-luaposix@33.4.0      7yuszxv pkgconf@1.4.2\r\nom6ee3r expat@2.2.5      3byxblk libsigsegv@2.11   ffrwz2d m4@1.4.18                sfsamtu readline@7.0\r\nbfjm7it gdbm@1.14.1      hnkxexo libtool@2.4.6     wkyck36 ncurses@6.1              ucx2vrv tar@1.30\r\n==> Do you want to proceed? [y/n]\r\n```\r\nNote the generation of `tcl modules`\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n# Clean clone of spack\r\n# Edit ~/.spack/modules.yaml (see exact config further down)\r\n$ spack install lmod emacs tmux # these are the packages that I happened to install first. I believe only lmod is necessary\r\n$ spack module refresh\r\n```\r\n\r\n### Information on your system\r\n\r\nThis includes:\r\n\r\n 1. which platform you are using\r\n\r\n`Red Hat 7.5 (LLNL-managed desktop)`\r\n\r\n 2. any relevant configuration detail (custom `packages.yaml` or `modules.yaml`, etc.)\r\n\r\nMy modules.yaml:\r\n```yaml\r\nmodules:\r\n  enable::\r\n    - lmod\r\n  lmod:\r\n    core_compilers:\r\n      - 'gcc@4.8.5'\r\n    hierarchy:\r\n      - mpi\r\n```\r\nOutput of `spack config get modules`:\r\n```yaml\r\nmodules:\r\n  enable:\r\n  - lmod\r\n  prefix_inspections:\r\n    bin:\r\n    - PATH\r\n    man:\r\n    - MANPATH\r\n    share/man:\r\n    - MANPATH\r\n    share/aclocal:\r\n    - ACLOCAL_PATH\r\n    lib:\r\n    - LIBRARY_PATH\r\n    - LD_LIBRARY_PATH\r\n    lib64:\r\n    - LIBRARY_PATH\r\n    - LD_LIBRARY_PATH\r\n    include:\r\n    - CPATH\r\n    lib/pkgconfig:\r\n    - PKG_CONFIG_PATH\r\n    lib64/pkgconfig:\r\n    - PKG_CONFIG_PATH\r\n    ? ''\r\n    : - CMAKE_PREFIX_PATH\r\n  lmod:\r\n    hierarchy:\r\n    - mpi\r\n    hash_length: 7\r\n    verbose: false\r\n    core_compilers:\r\n    - gcc@4.8.5\r\n```",
    "user": "SteVwonder",
    "url": "https://api.github.com/repos/spack/spack/issues/8646",
    "updated_at": "2018-07-24 18:27:18",
    "created_at": "2018-07-05 21:19:30",
    "closed_at": "2018-07-24 18:27:18",
    "state": "closed",
    "title": "module refresh will not generate lmod files despite config",
    "number": 8646,
    "milestone": null,
    "labels": [
        "modules"
    ],
    "id": 338729516,
    "html_url": "https://github.com/spack/spack/issues/8646",
    "assignees": [
        "alalazo"
    ],
    "comments": 3
}