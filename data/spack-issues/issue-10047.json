{
    "body": "This PR addresses a bug discovered in #10025. For `cdo`, the [downloads page](https://code.mpimet.mpg.de/projects/cdo/files) contains two types of links, one with `/download` in the path that downloads the tarball, and one without that brings you to a page with the same link. Currently, `spack.util.web.find_versions_of_archive` behaves non-deterministically, and depending on which version of Python you use, you may get very different results:\r\n```console\r\n$ python3 $(which spack) checksum cdo\r\n==> Found 10 versions of cdo:\r\n  \r\n  1.9.6rc4  https://code.mpimet.mpg.de/attachments/18911/cdo-1.9.6rc4.tar.gz\r\n  1.9.5     https://code.mpimet.mpg.de/attachments/download/18264/cdo-1.9.5.tar.gz\r\n  1.9.4     https://code.mpimet.mpg.de/attachments/download/17374/cdo-1.9.4.tar.gz\r\n  1.9.3     https://code.mpimet.mpg.de/attachments/download/16435/cdo-1.9.3.tar.gz\r\n  1.9.2     https://code.mpimet.mpg.de/attachments/download/16035/cdo-1.9.2.tar.gz\r\n  1.9.1     https://code.mpimet.mpg.de/attachments/15653/cdo-1.9.1.tar.gz\r\n  1.9.0     https://code.mpimet.mpg.de/attachments/15187/cdo-1.9.0.tar.gz\r\n  1.8.2     https://code.mpimet.mpg.de/attachments/download/14686/cdo-1.8.2.tar.gz\r\n  1.7.2     https://code.mpimet.mpg.de/attachments/download/12760/cdo-1.7.2.tar.gz\r\n  1.6.4     https://code.mpimet.mpg.de/attachments/8376/cdo-1.6.4.tar.gz\r\n\r\n==> How many would you like to checksum? (default is 1, q to abort) q\r\n==> Error: Aborted.\r\n$ python2 $(which spack) checksum cdo\r\n==> Found 10 versions of cdo:\r\n  \r\n  1.9.6rc4  https://code.mpimet.mpg.de/attachments/18911/cdo-1.9.6rc4.tar.gz\r\n  1.9.5     https://code.mpimet.mpg.de/attachments/18264/cdo-1.9.5.tar.gz\r\n  1.9.4     https://code.mpimet.mpg.de/attachments/download/17374/cdo-1.9.4.tar.gz\r\n  1.9.3     https://code.mpimet.mpg.de/attachments/download/16435/cdo-1.9.3.tar.gz\r\n  1.9.2     https://code.mpimet.mpg.de/attachments/16035/cdo-1.9.2.tar.gz\r\n  1.9.1     https://code.mpimet.mpg.de/attachments/download/15653/cdo-1.9.1.tar.gz\r\n  1.9.0     https://code.mpimet.mpg.de/attachments/15187/cdo-1.9.0.tar.gz\r\n  1.8.2     https://code.mpimet.mpg.de/attachments/14686/cdo-1.8.2.tar.gz\r\n  1.7.2     https://code.mpimet.mpg.de/attachments/12760/cdo-1.7.2.tar.gz\r\n  1.6.4     https://code.mpimet.mpg.de/attachments/8376/cdo-1.6.4.tar.gz\r\n\r\n==> How many would you like to checksum? (default is 1, q to abort) q\r\n==> Error: Aborted.\r\n```\r\nWith this PR, Spack sorts the URLs before searching, meaning that the behavior is at least deterministic and the same across all versions of Python:\r\n```console\r\n$ python3 $(which spack) checksum cdo\r\n==> Found 10 versions of cdo:\r\n  \r\n  1.9.6rc4  https://code.mpimet.mpg.de/attachments/download/18911/cdo-1.9.6rc4.tar.gz\r\n  1.9.5     https://code.mpimet.mpg.de/attachments/download/18264/cdo-1.9.5.tar.gz\r\n  1.9.4     https://code.mpimet.mpg.de/attachments/download/17374/cdo-1.9.4.tar.gz\r\n  1.9.3     https://code.mpimet.mpg.de/attachments/download/16435/cdo-1.9.3.tar.gz\r\n  1.9.2     https://code.mpimet.mpg.de/attachments/download/16035/cdo-1.9.2.tar.gz\r\n  1.9.1     https://code.mpimet.mpg.de/attachments/download/15653/cdo-1.9.1.tar.gz\r\n  1.9.0     https://code.mpimet.mpg.de/attachments/download/15187/cdo-1.9.0.tar.gz\r\n  1.8.2     https://code.mpimet.mpg.de/attachments/download/14686/cdo-1.8.2.tar.gz\r\n  1.7.2     https://code.mpimet.mpg.de/attachments/download/12760/cdo-1.7.2.tar.gz\r\n  1.6.4     https://code.mpimet.mpg.de/attachments/download/8376/cdo-1.6.4.tar.gz\r\n\r\n==> How many would you like to checksum? (default is 1, q to abort) q\r\n==> Error: Aborted.\r\n$ python2 $(which spack) checksum cdo\r\n==> Found 10 versions of cdo:\r\n  \r\n  1.9.6rc4  https://code.mpimet.mpg.de/attachments/download/18911/cdo-1.9.6rc4.tar.gz\r\n  1.9.5     https://code.mpimet.mpg.de/attachments/download/18264/cdo-1.9.5.tar.gz\r\n  1.9.4     https://code.mpimet.mpg.de/attachments/download/17374/cdo-1.9.4.tar.gz\r\n  1.9.3     https://code.mpimet.mpg.de/attachments/download/16435/cdo-1.9.3.tar.gz\r\n  1.9.2     https://code.mpimet.mpg.de/attachments/download/16035/cdo-1.9.2.tar.gz\r\n  1.9.1     https://code.mpimet.mpg.de/attachments/download/15653/cdo-1.9.1.tar.gz\r\n  1.9.0     https://code.mpimet.mpg.de/attachments/download/15187/cdo-1.9.0.tar.gz\r\n  1.8.2     https://code.mpimet.mpg.de/attachments/download/14686/cdo-1.8.2.tar.gz\r\n  1.7.2     https://code.mpimet.mpg.de/attachments/download/12760/cdo-1.7.2.tar.gz\r\n  1.6.4     https://code.mpimet.mpg.de/attachments/download/8376/cdo-1.6.4.tar.gz\r\n\r\n==> How many would you like to checksum? (default is 1, q to abort) q\r\n==> Error: Aborted.\r\n```\r\n@michaelkuhn ",
    "user": "adamjstewart",
    "url": "https://api.github.com/repos/spack/spack/issues/10047",
    "updated_at": "2019-10-20 01:43:15",
    "created_at": "2018-12-07 00:03:02",
    "closed_at": "2018-12-10 13:36:56",
    "state": "closed",
    "title": "Make downloads from list_url deterministic",
    "number": 10047,
    "milestone": null,
    "labels": [
        "fetching"
    ],
    "id": 388450079,
    "html_url": "https://github.com/spack/spack/pull/10047",
    "assignees": [],
    "comments": 2
}