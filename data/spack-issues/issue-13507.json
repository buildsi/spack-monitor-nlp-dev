{
    "body": "CC: @fryeguy52 \r\n\r\nTag: snl-atdm-issue\r\n\r\nI used spack to build gcc@7.2.0 using the native RHEL6 gcc@4.4.7 which gave the compilers.yaml entry:\r\n\r\n```\r\n- compiler:\r\n    paths:\r\n      cc: /home/rabartl/Spack.base4/atdm-spack/spack/opt/spack/linux-rhel6-core2/gcc-4.4.7/gcc-7.2.0-zzfkclh52gj6uzf4p64a3jbk2wo4id3i/bin/gcc\r\n      cxx: /home/rabartl/Spack.base4/atdm-spack/spack/opt/spack/linux-rhel6-core2/gcc-4.4.7/gcc-7.2.0-zzfkclh52gj6uzf4p64a3jbk2wo4id3i/bin/g++\r\n      f77: /home/rabartl/Spack.base4/atdm-spack/spack/opt/spack/linux-rhel6-core2/gcc-4.4.7/gcc-7.2.0-zzfkclh52gj6uzf4p64a3jbk2wo4id3i/bin/gfortran\r\n      fc: /home/rabartl/Spack.base4/atdm-spack/spack/opt/spack/linux-rhel6-core2/gcc-4.4.7/gcc-7.2.0-zzfkclh52gj6uzf4p64a3jbk2wo4id3i/bin/gfortran\r\n    operating_system: rhel6\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n    flags: {}\r\n    spec: gcc@7.2.0\r\n```\r\n\r\nThen, using the file:\r\n\r\n<details>\r\n\r\n<summary><b>spack-yaml</b></summary>\r\n\r\n```\r\n# Spack env file for building ATDM spack tools packages\r\nspack:\r\n  specs: [\r\n    snl-atdm-tools ,\r\n    ]\r\n  packages:\r\n    all:\r\n      compiler: [gcc@7.2.0]\r\n  modules:\r\n    tcl:\r\n      hash_length: 0\r\n      naming_scheme: spack-${PACKAGE}/${VERSION}\r\n      whitelist: [python, perl, cmake, ninja-fortran, git, autoconf, automake, m4, libtool, tar, diffutils, util-macros]\r\n      blacklist: ['%gcc@7.2.0']\r\n      all:\r\n        conflict:\r\n          - ${PACKAGE}\r\n        filter:\r\n          environment_blacklist: [CPATH, LIBRARY_PATH]\r\n        environment:\r\n          set:\r\n            ${PACKAGE}_ROOT: ${PREFIX}\r\n      verbose: false\r\n\r\n  include:\r\n    - common_options.yaml\r\n```\r\n</details>\r\n\r\nI tried `spack install` and it gave the error:\r\n\r\n```\r\n==> Installing m4\r\n==> Searching for binary cache of m4\r\n==> Finding buildcaches in /ascldap/users/rabartl/Spack.base4/atdm-spack/atdm-spack-tarball-mirror/build_cache\r\n==> No binary for m4 found: installing from source\r\n==> Using cached archive: /home/rabartl/Spack.base4/atdm-spack/spack/var/spack/cache/_source-cache/archive/ab/ab2633921a5cd38e48797bf5521ad259bdc4b979078034a3b790d7fec5493fab.tar.gz\r\n==> Using cached archive: /home/rabartl/Spack.base4/atdm-spack/spack/var/spack/cache/_source-cache/archive/fc/fc9b61654a3ba1a8d6cd78ce087e7c96366c290bc8d2c299f09828d793b853c8\r\n==> Staging archive: /tmp/rabartl/spack-stage/spack-stage-m4-1.4.18-npxsaugxhjz6girqfz7yzv4jfbneza6d/m4-1.4.18.tar.gz\r\n==> Created stage in /tmp/rabartl/spack-stage/spack-stage-m4-1.4.18-npxsaugxhjz6girqfz7yzv4jfbneza6d\r\n==> Applied patch /home/rabartl/Spack.base4/atdm-spack/spack/var/spack/repos/builtin/packages/m4/gnulib-pgi.patch\r\n==> Applied patch https://src.fedoraproject.org/rpms/m4/raw/5d147168d4b93f38a4833f5dd1d650ad88af5a8a/f/m4-1.4.18-glibc-change-work-around.patch\r\n==> Building m4 [AutotoolsPackage]\r\n==> Executing phase: 'autoreconf'\r\n==> Executing phase: 'configure'\r\n==> Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j20'\r\n\r\n12 errors found in build log:\r\n     563      CC       filenamecat.o\r\n     564      CC       filenamecat-lgpl.o\r\n     565      CC       fopen-safer.o\r\n     566      CC       freading.o\r\n     567      CC       getprogname.o\r\n     568    /tmp/cch5UXCA.s: Assembler messages:\r\n  >> 569    /tmp/cch5UXCA.s:60: Error: no such instruction: `shlx %rdi,%rax,%rd\r\n            i'\r\n  >> 570    /tmp/cch5UXCA.s:268: Error: no such instruction: `shlx %rdi,%rax,%r\r\n            di'\r\n  >> 571    /tmp/cch5UXCA.s:313: Error: no such instruction: `shlx %rdi,%rax,%r\r\n            di'\r\n  >> 572    make[3]: *** [c-ctype.o] Error 1\r\n     573    make[3]: *** Waiting for unfinished jobs....\r\n     574    /tmp/ccAJ3DAA.s: Assembler messages:\r\n  >> 575    /tmp/ccAJ3DAA.s:767: Error: no such instruction: `shrx %eax,24(%rsi\r\n            ),%eax'\r\n  >> 576    /tmp/ccAJ3DAA.s:843: Error: no such instruction: `shrx %ecx,24(%rsi\r\n            ),%ecx'\r\n  >> 577    make[3]: *** [gl_avltree_oset.o] Error 1\r\n     578    /tmp/cc1SkWzB.s: Assembler messages:\r\n  >> 579    /tmp/cc1SkWzB.s:27: Error: no such instruction: `rorx $55,%rax,%rax\r\n            '\r\n  >> 580    make[3]: *** [clean-temp.o] Error 1\r\n     581    make[3]: Leaving directory `/tmp/rabartl/spack-stage/spack-stage-m4\r\n            -1.4.18-npxsaugxhjz6girqfz7yzv4jfbneza6d/spack-src/spack-build/lib'\r\n  >> 582    make[2]: *** [all] Error 2\r\n     583    make[2]: Leaving directory `/tmp/rabartl/spack-stage/spack-stage-m4\r\n            -1.4.18-npxsaugxhjz6girqfz7yzv4jfbneza6d/spack-src/spack-build/lib'\r\n  >> 584    make[1]: *** [all-recursive] Error 1\r\n     585    make[1]: Leaving directory `/tmp/rabartl/spack-stage/spack-stage-m4\r\n            -1.4.18-npxsaugxhjz6girqfz7yzv4jfbneza6d/spack-src/spack-build'\r\n  >> 586    make: *** [all] Error 2\r\n\r\nSee build log for details:\r\n  /tmp/rabartl/spack-stage/spack-stage-m4-1.4.18-npxsaugxhjz6girqfz7yzv4jfbneza6d/spack-build-out.txt\r\n\r\n\r\nreal\t0m40.036s\r\nuser\t0m26.897s\r\nsys\t0m10.030s\r\n```\r\n\r\nI am going to try to get around this by pointing to 'm4' and may other such packages already installed on the system.  (As I stated in #13198, the most fragile aspect of spack is building low-level packages that are already on most systems.)\r\n\r\n\r\n\r\n\r\n",
    "user": "bartlettroscoe",
    "url": "https://api.github.com/repos/spack/spack/issues/13507",
    "updated_at": "2020-03-04 17:04:36",
    "created_at": "2019-10-30 15:47:29",
    "closed_at": "2020-03-04 17:04:36",
    "state": "closed",
    "title": "m4 package does not build with spack verion 0.13.0 on RHEL6 using spack-built gcc@7.2.0",
    "number": 13507,
    "milestone": null,
    "labels": [
        "build-error",
        "snl-atdm"
    ],
    "id": 514779060,
    "html_url": "https://github.com/spack/spack/issues/13507",
    "assignees": [],
    "comments": 11
}