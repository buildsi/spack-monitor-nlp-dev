{
    "body": "### Steps to reproduce\r\n\r\nCommand in Dockerfile (generated by `spack containerize`):\r\n```\r\nRUN spack -ddd spec hdf5+mpi\r\n```\r\n\r\n\r\n\r\n### Error message\r\n\r\nOutput:\r\n```\r\n...\r\nTraceback (most recent call last):\r\n  File \"/opt/spack/bin/spack\", line 98, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/opt/spack/lib/spack/spack/main.py\", line 882, in main\r\n    return _main(argv)\r\n  File \"/opt/spack/lib/spack/spack/main.py\", line 865, in _main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/opt/spack/lib/spack/spack/main.py\", line 535, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/opt/spack/lib/spack/spack/cmd/spec.py\", line 114, in spec\r\n    spec.concretize(**concretize_kwargs)\r\n  File \"/opt/spack/lib/spack/spack/spec.py\", line 2648, in concretize\r\n    self._new_concretize(tests, reuse=reuse)\r\n  File \"/opt/spack/lib/spack/spack/spec.py\", line 2619, in _new_concretize\r\n    result = spack.solver.asp.solve([self], tests=tests, reuse=reuse)\r\n  File \"/opt/spack/lib/spack/spack/solver/asp.py\", line 2044, in solve\r\n    return driver.solve(\r\n  File \"/opt/spack/lib/spack/spack/solver/asp.py\", line 543, in solve\r\n    solver_setup.setup(self, specs, tests=tests, reuse=reuse)\r\n  File \"/opt/spack/lib/spack/spack/solver/asp.py\", line 1665, in setup\r\n    possible = spack.package.possible_dependencies(\r\n  File \"/opt/spack/lib/spack/spack/package.py\", line 2785, in possible_dependencies\r\n    if spack.repo.path.is_virtual(pos.name):\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 681, in is_virtual\r\n    return have_name and pkg_name in self.provider_index\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 529, in provider_index\r\n    self._provider_index.merge(repo.provider_index)\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 953, in provider_index\r\n    return self.index['providers']\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 359, in __getitem__\r\n    self._build_all_indexes()\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 374, in _build_all_indexes\r\n    self.indexes[name] = self._build_index(name, indexer)\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 404, in _build_index\r\n    indexer.update(namespaced_name)\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 286, in update\r\n    if spack.repo.path.is_virtual(name, use_index=False):\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 684, in is_virtual\r\n    self.get_pkg_class(pkg_name).virtual)\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 647, in get_pkg_class\r\n    return self.repo_for_pkg(pkg_name).get_pkg_class(pkg_name)\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 1107, in get_pkg_class\r\n    module = self._get_pkg_module(pkg_name)\r\n  File \"/opt/spack/lib/spack/spack/repo.py\", line 1079, in _get_pkg_module\r\n    module = simp.load_source(fullname, file_path,\r\n  File \"/opt/spack/lib/spack/spack/util/imp/importlib_importer.py\", line 48, in load_source\r\n    return loader.load_module()\r\n  File \"<frozen importlib._bootstrap_external>\", line 522, in _check_name_wrapper\r\n  File \"<frozen importlib._bootstrap_external>\", line 1027, in load_module\r\n  File \"<frozen importlib._bootstrap_external>\", line 852, in load_module\r\n  File \"<frozen importlib._bootstrap>\", line 265, in _load_module_shim\r\n  File \"<frozen importlib._bootstrap>\", line 702, in _load\r\n  File \"<frozen importlib._bootstrap>\", line 671, in _load_unlocked\r\n  File \"<frozen importlib._bootstrap_external>\", line 848, in exec_module\r\n  File \"<frozen importlib._bootstrap>\", line 219, in _call_with_frames_removed\r\n  File \"/opt/spack/var/spack/repos/builtin/packages/qt/package.py\", line 17, in <module>\r\n    \r\n  File \"/opt/spack/lib/spack/spack/version.py\", line 181, in __init__\r\n    raise ValueError(\"Bad characters in version string: %s\" % string)\r\nValueError: Bad characters in version string: 5.4.109+\r\nThe command 'docker-shell spack -ddd spec hdf5+mpi' returned a non-zero code: 1\r\n```\r\n\r\n### Information on your system\r\n\r\nSpack is run in Gitlab CI's Docker-in-Docker mode within an Ubuntu20.04 container. \r\n\r\nFull output is available [here](https://gitlab.com/pirt/pirt-container/-/jobs/1879445701). Note that this mechanism was working fine last month. \r\n\r\n`spack debug report`\r\n```\r\n* **Spack:** 0.17.0\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-haswell\r\n* **Concretizer:** clingo\r\n```\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [X] I have run the failing commands in debug mode and reported the output\r\n\r\n## Extras\r\nKernel version numbers can have a `+` at the end under some circumstances as per [this](https://stackoverflow.com/questions/19333918/dont-add-to-linux-kernel-version) and it might have to be removed when calling `Version()` on the output of `platform.release`. Could we instead parse the first three sets of integers from the linux kernel version?  ",
    "user": "s-sajid-ali",
    "url": "https://api.github.com/repos/spack/spack/issues/27960",
    "updated_at": "2021-12-17 16:46:09",
    "created_at": "2021-12-13 17:22:32",
    "closed_at": "None",
    "state": "open",
    "title": "spack cannot parse special characters in kernel versions",
    "number": 27960,
    "milestone": null,
    "labels": [
        "bug",
        "versions",
        "impact-low"
    ],
    "id": 1078790305,
    "html_url": "https://github.com/spack/spack/issues/27960",
    "assignees": [],
    "comments": 0
}