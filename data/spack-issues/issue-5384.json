{
    "body": "`spack install` can now reinstall a spec even if it has dependents, via the `--overwrite` option. This option moves the current installation in a temporary directory. If the reinstallation is successful the temporary is removed, otherwise a rollback is performed.\r\n\r\nThis PR permits to reinstall a 'faulty' production installation even if dependents are already in place.  A common use case is `python`. Its package doesn't fail if some builtin modules cannot be built, and if the build of an entire environment is automated you may discover the missing modules after a fair amount of python packages have already been installed.\r\n\r\n##### Example\r\n\r\nAn example of use:\r\n```console\r\n$ spack install zlib\r\n==> zlib is already installed in /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn\r\n\r\n$ spack install --overwrite zlib\r\n==> The following package will be reinstalled:\r\n\r\n-- linux-ubuntu14.04-x86_64 / gcc@4.8 ---------------------------\r\nurcxcax zlib@1.2.11%gcc+pic+shared\r\n\r\n==> Do you want to proceed? [y/N] y\r\n==> Installing zlib\r\n==> Using cached archive: /home/mculpo/PycharmProjects/spack/var/spack/cache/zlib/zlib-1.2.11.tar.gz\r\n==> Staging archive: /home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/zlib-1.2.11.tar.gz\r\n==> Created stage in /home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn\r\n==> Building zlib [Package]\r\n==> Executing phase: 'install'\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/mculpo/PycharmProjects/spack/share/spack/modules/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax\r\nspec : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/mculpo/PycharmProjects/spack/share/spack/dotkit/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax.dk\r\nspec : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64\r\n==> Successfully installed zlib\r\n  Fetch: 0.01s.  Build: 2.23s.  Total: 2.24s.\r\n[+] /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn\r\n```\r\nA debug run gives more information on what is going on:\r\n```console\r\n$ spack -d install --overwrite -y zlib\r\n==> Reading config file /home/mculpo/PycharmProjects/spack/etc/spack/defaults/packages.yaml\r\n==> Reading config file /home/mculpo/PycharmProjects/spack/etc/spack/packages.yaml\r\n==> READ LOCK: /home/mculpo/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Acquiring]\r\n==> READ LOCK: /home/mculpo/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Acquired]\r\n==> READ LOCK: /home/mculpo/.spack/cache/providers/.builtin-index.yaml.lock[0:0] [Released]\r\n==> Reading config file /home/mculpo/PycharmProjects/spack/etc/spack/compilers.yaml\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Acquired]\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\n==> TEMPORARY DIRECTORY CREATED [/tmp/tmplXrF5G]\r\n==> DIRECTORY MOVED [src=/home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn, dest=/tmp/tmplXrF5G]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquiring]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquired]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Released]\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquiring]\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquired]\r\n==> READ LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Released]\r\n==> Installing zlib dependencies\r\n==> Installing zlib\r\n==> Reading config file /home/mculpo/.spack/mirrors.yaml\r\n==> Reading config file /home/mculpo/.spack/linux/mirrors.yaml\r\n==> Using cached archive: /home/mculpo/PycharmProjects/spack/var/spack/cache/zlib/zlib-1.2.11.tar.gz\r\n==> Staging archive: /home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/zlib-1.2.11.tar.gz\r\n==> '/bin/tar' '-xf' '/home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/zlib-1.2.11.tar.gz'\r\n==> Created stage in /home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn\r\n==> Building zlib [Package]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/var/spack/stage/.lock[5277869744181012648:1] [Acquiring]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/var/spack/stage/.lock[5277869744181012648:1] [Acquired]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquiring]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Acquired]\r\n==> Executing phase: 'install'\r\n==> Installing /tmp/pytest-of-mculpo/pytest-113/test_keep_exceptions0/tmp/spack-stage/spack-stage-cU93jY/zlib-1.2.11/spack-build.out to /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/.spack/build.out\r\n==> Installing /tmp/pytest-of-mculpo/pytest-113/test_keep_exceptions0/tmp/spack-stage/spack-stage-cU93jY/zlib-1.2.11/spack-build.env to /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/.spack/build.env\r\n==> Installing /home/mculpo/PycharmProjects/spack/var/spack/repos/builtin/packages/zlib/w_patch.patch to /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/.spack/repos/builtin/packages/zlib\r\n==> Installing /home/mculpo/PycharmProjects/spack/var/spack/repos/builtin/packages/zlib/package.py to /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn/.spack/repos/builtin/packages/zlib\r\n==> \tWRITE : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64 /urcxcax [/home/mculpo/PycharmProjects/spack/share/spack/modules/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax]\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/mculpo/PycharmProjects/spack/share/spack/modules/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax\r\nspec : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64\r\n==> \tWRITE : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64 /urcxcax [/home/mculpo/PycharmProjects/spack/share/spack/dotkit/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax.dk]\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/mculpo/PycharmProjects/spack/share/spack/dotkit/linux-ubuntu14.04-x86_64/zlib-1.2.11-gcc-4.8-urcxcax.dk\r\nspec : zlib@1.2.11%gcc@4.8+pic+shared arch=linux-ubuntu14.04-x86_64\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/prefix_lock[5918495726630493497:1] [Released]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/var/spack/stage/.lock[5277869744181012648:1] [Released]\r\n==> Successfully installed zlib\r\n  Fetch: 0.00s.  Build: 1.70s.  Total: 1.71s.\r\n[+] /home/mculpo/PycharmProjects/spack/opt/spack/linux-ubuntu14.04-x86_64/gcc-4.8/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Acquiring]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Acquired]\r\n==> WRITE LOCK: /home/mculpo/PycharmProjects/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\n==> link /home/mculpo/PycharmProjects/spack/var/spack/stage/zlib-1.2.11-urcxcax46s5hfm7dd7utrrnpt42z6czn -> /tmp/pytest-of-mculpo/pytest-113/test_keep_exceptions0/tmp/spack-stage/spack-stage-M4FBpL\r\n==> TEMPORARY DIRECTORY DELETED [/tmp/tmplXrF5G]\r\n```",
    "user": "alalazo",
    "url": "https://api.github.com/repos/spack/spack/issues/5384",
    "updated_at": "2017-10-24 19:33:03",
    "created_at": "2017-09-17 08:01:13",
    "closed_at": "2017-10-24 19:32:31",
    "state": "closed",
    "title": "'spack install' can overwrite an existing installation",
    "number": 5384,
    "milestone": null,
    "labels": [],
    "id": 258287134,
    "html_url": "https://github.com/spack/spack/pull/5384",
    "assignees": [],
    "comments": 3
}