{
    "body": "I am trying to use space on a Linux system where the command lsb_release returns nothing. This breaks spack.\r\n\r\n-----\r\n\r\nOn the Los Alamos system the trinitite HPC system (a cray linux system) has a version of `lsb_release` in `/usr/bin` that returns\r\n```\r\nLSB Version:\tn/a\r\n```\r\nwhen I use spack this causes a cascade of error, even during sourcing `$SPACK_ROOT/share/spack/setup-env.csh`\r\n\r\nThe result of the sourcing this file is\r\n```\r\nnid00012> source $SPACK_ROOT/share/spack/setup-env.csh\r\nTraceback (most recent call last):\r\n  File \"/usr/projects/eap//spack/spack/bin/spack\", line 80, in <module>\r\n    import spack.main  # noqa\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/__init__.py\", line 84, in <module>\r\n    import spack.repository\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/repository.py\", line 52, in <module>\r\n    import spack.spec\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/spec.py\", line 119, in <module>\r\n    import spack.compilers as compilers\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/compilers/__init__.py\", line 36, in <module>\r\n    import spack.config\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/config.py\", line 212, in <module>\r\n    _platform = spack.architecture.platform().name\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/llnl/util/lang.py\", line 182, in __call__\r\n    self.cache[args] = self.func(*args)\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/architecture.py\", line 499, in platform\r\n    return platform_cls()\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/platforms/cray.py\", line 91, in __init__\r\n    front_distro = CrayFrontend()\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/operating_systems/linux_distro.py\", line 40, in __init__\r\n    from external.distro import linux_distribution\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/external/distro.py\", line 1057, in <module>\r\n    _distro = LinuxDistribution()\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/external/distro.py\", line 596, in __init__\r\n    if include_lsb else {}\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/external/distro.py\", line 935, in _get_lsb_release_info\r\n    raise subprocess.CalledProcessError(code, cmd, stdout)\r\nsubprocess.CalledProcessError: Command 'lsb_release -a' returned non-zero exit status 2\r\nTraceback (most recent call last):\r\n  File \"/usr/projects/eap//spack/spack/bin/spack\", line 80, in <module>\r\n    import spack.main  # noqa\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/__init__.py\", line 84, in <module>\r\n    import spack.repository\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/repository.py\", line 52, in <module>\r\n    import spack.spec\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/spec.py\", line 119, in <module>\r\n    import spack.compilers as compilers\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/compilers/__init__.py\", line 36, in <module>\r\n    import spack.config\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/config.py\", line 212, in <module>\r\n    _platform = spack.architecture.platform().name\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/llnl/util/lang.py\", line 182, in __call__\r\n    self.cache[args] = self.func(*args)\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/architecture.py\", line 499, in platform\r\n    return platform_cls()\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/platforms/cray.py\", line 91, in __init__\r\n    front_distro = CrayFrontend()\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/operating_systems/linux_distro.py\", line 40, in __init__\r\n    from external.distro import linux_distribution\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/external/distro.py\", line 1057, in <module>\r\n    _distro = LinuxDistribution()\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/external/distro.py\", line 596, in __init__\r\n    if include_lsb else {}\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/external/distro.py\", line 935, in _get_lsb_release_info\r\n    raise subprocess.CalledProcessError(code, cmd, stdout)\r\nsubprocess.CalledProcessError: Command 'lsb_release -a' returned non-zero exit status 2\r\nTraceback (most recent call last):\r\n  File \"/usr/projects/eap//spack/spack/bin/spack\", line 80, in <module>\r\n    import spack.main  # noqa\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/__init__.py\", line 84, in <module>\r\n    import spack.repository\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/repository.py\", line 52, in <module>\r\n    import spack.spec\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/spec.py\", line 119, in <module>\r\n    import spack.compilers as compilers\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/compilers/__init__.py\", line 36, in <module>\r\n    import spack.config\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/config.py\", line 212, in <module>\r\n    _platform = spack.architecture.platform().name\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/llnl/util/lang.py\", line 182, in __call__\r\n    self.cache[args] = self.func(*args)\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/architecture.py\", line 499, in platform\r\n    return platform_cls()\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/platforms/cray.py\", line 91, in __init__\r\n    front_distro = CrayFrontend()\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/spack/operating_systems/linux_distro.py\", line 40, in __init__\r\n    from external.distro import linux_distribution\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/external/distro.py\", line 1057, in <module>\r\n    _distro = LinuxDistribution()\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/external/distro.py\", line 596, in __init__\r\n    if include_lsb else {}\r\n  File \"/usr/projects/eap/spack/spack-0.11.2/lib/spack/external/distro.py\", line 935, in _get_lsb_release_info\r\n    raise subprocess.CalledProcessError(code, cmd, stdout)\r\nsubprocess.CalledProcessError: Command 'lsb_release -a' returned non-zero exit status 2\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\nFind a system where `lsb_release` doesn't return any information. This will break spack.\r\n\r\n### Information on your system\r\n\r\nThis includes:\r\nTrinitite is a an unclassified computing cluster for ASC code developers who target the Trinity platform. Cray CLE, based on SLES. The compute nodes run a Lightweight Operating System (LWOS), while both the (external) front-end nodes and (internal) login nodes run the fully featured OS. The Cray User Guide is a useful document for users and developers. See the Cray Documentation for complete information.     2 front-end nodes, external to the interconnect\r\n\r\n    100 compute nodes with Intel Haswell processor, and\r\n    100 compute nodes with an Intel Knights Landing (KNL) processor\r\n\r\n    32 CPU cores per Haswell compute node (2x hyperthreads each), and\r\n    68 CPU cores per KNL (4x hyperthreads each)\r\n\r\n    Haswell, per node: 128 GB Memory,\r\n    KNL, per node: 16 GB Multi-Channel Dynamic Random Access Memory (MCDRAM), aka. High-bandwidth memory (HBM)\r\n    96 GB Double Data Rate Random Acess Memory (DDRAM)\r\n\r\n    Peak speed = 100 HSW nodes * 32 cores * 2.3 GHz * 8 Flops/clock = 59 TFlops\r\n    + 100 KNL nodes * 68 cores * 1.4 GHz * 2 FMAs/core * 16 ops/clock/FMA = 305 Tflops\r\n    for a grand total of 364 TFlops*. \r\n\r\nI searched your documentation, but didn't find anything about this routine (lsb_release). Is there a workaround for this issue?\r\n",
    "user": "JohnWGrove",
    "url": "https://api.github.com/repos/spack/spack/issues/8568",
    "updated_at": "2018-06-29 15:49:30",
    "created_at": "2018-06-25 16:05:29",
    "closed_at": "2018-06-28 20:39:23",
    "state": "closed",
    "title": "Is spack usage without lsb_release?",
    "number": 8568,
    "milestone": null,
    "labels": [
        "cray",
        "platform-support",
        "shell-support"
    ],
    "id": 335471916,
    "html_url": "https://github.com/spack/spack/issues/8568",
    "assignees": [],
    "comments": 10
}