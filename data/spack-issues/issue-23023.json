{
    "body": "<!-- Thanks for taking the time to report this build failure. To proceed with the report please:\r\n\r\n1. Title the issue \"Installation issue: <name-of-the-package>\".\r\n2. Provide the information required below.\r\n\r\nWe encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively! -->\r\n\r\n### Steps to reproduce the issue\r\n\r\n<!-- Fill in the exact spec you are trying to build and the relevant part of the error message -->\r\n```console\r\n$ spack install charmpp build-target=charm++ backend=ucx pmi=pmix +smp +production\r\n...\r\n  >> 3    Error: cannot find /apps/spack/0.16.1/apps/gcc-10.3.0/openmpi-\r\n          3.1.6-kubz/lib!\r\n```\r\n\r\n### Information on your system\r\n\r\nSLES 15 SP2\r\nSpack version 0.16.1\r\n\r\n### Additional information\r\n\r\nThe issue is that the build script used by the Charm++ build process is hardcoded to use \"lib\" as the location for the libraries. However, on SLES 15, the default library directory is \"lib64\". \r\n\r\nLooking at champp's package.py, setting the --basedir build option for Charm++ is not working due to the use of \"lib64\".\r\ne.g.:\r\n\r\n```python\r\n         if \"pmi=pmix\" in spec:\r\n             options.append(\"ompipmix\")\r\n             options.extend([\"--basedir=%s\" % spec[\"openmpi\"].prefix])\r\n\r\n        if \"backend=ucx\" in spec:\r\n             options.extend([\"--basedir=%s\" % spec[\"ucx\"].prefix])\r\n```\r\n\r\nI fixed the build issue after changing --basedir to --incdir and --libdir:\r\n\r\n```python\r\n         if \"pmi=pmix\" in spec:\r\n             options.append(\"ompipmix\")\r\n             #options.extend([\"--basedir=%s\" % spec[\"openmpi\"].prefix])\r\n             options.extend([\r\n                 '--incdir={0}'.format(incdir)\r\n                 for incdir in spec[\"mpi\"].headers.directories\r\n             ])\r\n             options.extend([\r\n                 '--libdir={0}'.format(libdir)\r\n                 for libdir in spec[\"mpi\"].libs.directories\r\n             ])\r\n\r\n         if \"backend=ucx\" in spec:\r\n             #options.extend([\"--basedir=%s\" % spec[\"ucx\"].prefix])\r\n             ucx_incdir = join_path(spec[\"ucx\"].prefix, \"include\")\r\n             options.extend([\"--incdir=%s\" % ucx_incdir])\r\n             options.extend(['--libdir={0}'.format(libdir)\r\n                 for libdir in find_libraries(\r\n                         [\"libucs\"],\r\n                         root=spec[\"ucx\"].prefix,\r\n                         shared=True, recursive=True\r\n                     ).directories\r\n             ])\r\n\r\n```\r\n\r\nFor info - diff output:\r\n```\r\ndiff package.py package.py.new\r\n239c239,247\r\n<             options.extend([\"--basedir=%s\" % spec[\"openmpi\"].prefix])\r\n---\r\n>             #options.extend([\"--basedir=%s\" % spec[\"openmpi\"].prefix])\r\n>             options.extend([\r\n>                 '--incdir={0}'.format(incdir)\r\n>                 for incdir in spec[\"mpi\"].headers.directories\r\n>             ])\r\n>             options.extend([\r\n>                 '--libdir={0}'.format(libdir)\r\n>                 for libdir in spec[\"mpi\"].libs.directories\r\n>             ])\r\n254c262,271\r\n<             options.extend([\"--basedir=%s\" % spec[\"ucx\"].prefix])\r\n---\r\n>             #options.extend([\"--basedir=%s\" % spec[\"ucx\"].prefix])\r\n>             ucx_incdir = join_path(spec[\"ucx\"].prefix, \"include\")\r\n>             options.extend([\"--incdir=%s\" % ucx_incdir])\r\n>             options.extend(['--libdir={0}'.format(libdir)\r\n>                 for libdir in find_libraries(\r\n>                         [\"libucs\"],\r\n>                         root=spec[\"ucx\"].prefix,\r\n>                         shared=True, recursive=True\r\n>                     ).directories\r\n>             ])\r\n```",
    "user": "th1818",
    "url": "https://api.github.com/repos/spack/spack/issues/23023",
    "updated_at": "2021-04-16 01:04:53",
    "created_at": "2021-04-16 01:04:53",
    "closed_at": "None",
    "state": "open",
    "title": "Installation issue: charmpp",
    "number": 23023,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 859367135,
    "html_url": "https://github.com/spack/spack/issues/23023",
    "assignees": [],
    "comments": 0
}