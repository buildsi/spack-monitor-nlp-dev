{
    "body": "### Steps to reproduce the issue\n\nThe issue is that atlas will not build with certain CPU configurations, but the clapack external-blas variant does not appear to be enabled. clapack also has a hard dependency on atlas for some reason, which is as this issue illustrates, a finicky dependency.\r\n\r\n```\r\n[cchang@el2 Packages]$ spack install clapack\r\n==> Installing atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq\r\n==> No binary for atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq found: installing from source\r\n...\r\n==> atlas: Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '../configure' '--prefix=/lustre/eaglefs/projects/hpcapps/cchang/spack2/opt/spack/linux-centos7-skylake_avx512/gcc-8.4.0/atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq' '--shared' '-b' '64' '-t' '-1' '-C' 'ic' '/lustre/eaglefs/projects/hpcapps/cchang/spack2/lib/spack/env/gcc/gcc' '-C' 'if' '/lustre/eaglefs/projects/hpcapps/cchang/spack2/lib/spack/env/gcc/gfortran' '--with-netlib-lapack-tarfile=/scratch/cchang/spack-stage/resource-lapack-o6o7dqrkkgzxbncuspoos5jh643iyinq/lapack-3.5.0.tgz'\r\n\r\n8 errors found in build log:\r\n     1     ==> atlas: Executing phase: 'install'\r\n     2     ==> [2021-11-11-12:17:27.264389] '../configure' '--prefix=/lustre/eaglefs/projects/hpcapps/cchang/spack2/opt/spack/linux-centos7-skylake_avx512/gcc-8.4.\r\n           0/atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq' '--shared' '-b' '64' '-t' '-1' '-C' 'ic' '/lustre/eaglefs/projects/hpcapps/cchang/spack2/lib/spack/env/\r\n           gcc/gcc' '-C' 'if' '/lustre/eaglefs/projects/hpcapps/cchang/spack2/lib/spack/env/gcc/gfortran' '--with-netlib-lapack-tarfile=/scratch/cchang/spack-stage\r\n           /resource-lapack-o6o7dqrkkgzxbncuspoos5jh643iyinq/lapack-3.5.0.tgz'\r\n     3     gcc -I/lustre/eaglefs/scratch/cchang/spack-stage/spack-stage-atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq/spack-src/spack-build/..//CONFIG/include  -g \r\n           -w -DATL_DYLIBS -c /lustre/eaglefs/scratch/cchang/spack-stage/spack-stage-atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq/spack-src/spack-build/..//CONFIG\r\n           /src/atlconf_misc.c\r\n     4     gcc -I/lustre/eaglefs/scratch/cchang/spack-stage/spack-stage-atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq/spack-src/spack-build/..//CONFIG/include  -g \r\n           -w -DATL_DYLIBS -o xconfig /lustre/eaglefs/scratch/cchang/spack-stage/spack-stage-atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq/spack-src/spack-build/..\r\n           //CONFIG/src/config.c atlconf_misc.o\r\n     5     ./xconfig -d s /lustre/eaglefs/scratch/cchang/spack-stage/spack-stage-atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq/spack-src/spack-build/../ -d b /lust\r\n           re/eaglefs/scratch/cchang/spack-stage/spack-stage-atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq/spack-src/spack-build  -D c -DATL_DYLIBS -b 64 -t -1 -C \r\n           ic /lustre/eaglefs/projects/hpcapps/cchang/spack2/lib/spack/env/gcc/gcc -C if /lustre/eaglefs/projects/hpcapps/cchang/spack2/lib/spack/env/gcc/gfortran \r\n           -Si lapackref 1\r\n     6     ERROR: enum fam=3, chip=2, model=85, mach=0\r\n  >> 7     make[3]: *** [atlas_run] Error 44\r\n  >> 8     make[2]: *** [IRunArchInfo_x86] Error 2\r\n     9     ERROR: enum fam=3, chip=2, model=85, mach=0\r\n  >> 10    make[3]: *** [atlas_run] Error 44\r\n  >> 11    make[2]: *** [IRunArchInfo_x86] Error 2\r\n     12    ERROR: enum fam=3, chip=2, model=85, mach=0\r\n  >> 13    make[3]: *** [atlas_run] Error 44\r\n  >> 14    make[2]: *** [IRunArchInfo_x86] Error 2\r\n     15    ERROR: enum fam=3, chip=2, model=85, mach=0\r\n  >> 16    make[3]: *** [atlas_run] Error 44\r\n  >> 17    make[2]: *** [IRunArchInfo_x86] Error 2\r\n     18    It appears you have cpu throttling enabled, which makes timings\r\n     19    unreliable and an ATLAS install nonsensical.\r\n     20    \r\n     21    OS-controlled CPU throttling is so course grained, that timings become\r\n     22    essentially random.  What this means for an ATLAS install is that ATLAS\r\n     23    cannot tell the difference between a good and bad kernel, and so the\r\n\r\nSee build log for details:\r\n  /scratch/cchang/spack-stage/spack-stage-atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq/spack-build-out.txt\r\n\r\n==> Warning: Skipping build of clapack-3.2.1-w5mftwkub5j3yuz5xypooxyvv4vgwlkr since atlas-3.10.3-o6o7dqrkkgzxbncuspoos5jh643iyinq failed\r\n==> Error: clapack-3.2.1-w5mftwkub5j3yuz5xypooxyvv4vgwlkr: Package was not installed\r\n==> Error: Installation request failed.  Refer to reported errors for failing package(s).\r\n\r\n[cchang@el2 Packages]$ spack install clapack external-blas=off\r\n==> Error: invalid values for variant \"external-blas\" in package \"clapack\": ['off']\r\n\r\n[cchang@el2 Packages]$ spack info clapack\r\nMakefilePackage:   clapack\r\n\r\nDescription:\r\n    CLAPACK is a f2c'ed version of LAPACK. The CLAPACK library was built...\r\nVariants:\r\n    Name [Default]        When    Allowed values    Description\r\n    ==================    ====    ==============    ======================================\r\n\r\n    external-blas [on]    --      on, off           Build with external BLAS (ATLAS here).\r\n```\n\n### Information on your system\n\n```\r\n[cchang@el2 Packages]$ spack debug report\r\n* **Spack:** 0.16.3-5239-79f754a\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-centos7-skylake_avx512\r\n* **Concretizer:** clingo\r\n```\n\n### Additional information\n\n[spack-build-env.txt](https://github.com/spack/spack/files/7522836/spack-build-env.txt)\r\n[spack-build-out.txt](https://github.com/spack/spack/files/7522838/spack-build-out.txt)\r\n\r\n\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "chchang6",
    "url": "https://api.github.com/repos/spack/spack/issues/27368",
    "updated_at": "2021-11-11 19:36:47",
    "created_at": "2021-11-11 19:36:47",
    "closed_at": "None",
    "state": "open",
    "title": "Installation issue: clapack",
    "number": 27368,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1051298759,
    "html_url": "https://github.com/spack/spack/issues/27368",
    "assignees": [],
    "comments": 0
}