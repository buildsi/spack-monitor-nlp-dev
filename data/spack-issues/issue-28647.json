{
    "body": "### Steps to reproduce\r\n\r\nI have module autoload set in `$spack/etc/spack/modules.yaml`:\r\n```\r\nmodules:\r\n  tcl:\r\n    all:\r\n      autoload: direct\r\n```\r\nThe generated module files were not generating the load commands. Doing a `git bisect` I traced this to PR #28357. That PR sets the following in `$spack/etc/spack/defauts/modules.yaml`:\r\n```\r\n    tcl:\r\n      all:\r\n        autoload: none\r\n```\r\nIf I comment that out then autoload works as before. So, it seems that this is a scoping issue where the site scope for that setting is not overriding the defaults scope.\r\n\r\n### Error message\r\n\r\n```console\r\n$ spack --debug module tcl refresh pango\r\n==> [2022-01-27-14:53:44.850017] Imported module from built-in commands\r\n==> [2022-01-27-14:53:44.853593] Imported module from built-in commands\r\n==> [2022-01-27-14:53:44.854880] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/defaults/config.yaml\r\n==> [2022-01-27-14:53:44.873679] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/config.yaml\r\n==> [2022-01-27-14:53:44.875227] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2022-01-27-14:53:44.882778] DATABASE LOCK TIMEOUT: 3s\r\n==> [2022-01-27-14:53:44.882836] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2022-01-27-14:53:45.141539] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/defaults/repos.yaml\r\n==> [2022-01-27-14:53:45.143396] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/repos.yaml\r\n==> [2022-01-27-14:53:46.829655] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/defaults/modules.yaml\r\n==> [2022-01-27-14:53:46.842327] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/defaults/linux/modules.yaml\r\n==> [2022-01-27-14:53:46.845140] Reading config file /etc/spack/modules.yaml\r\n==> [2022-01-27-14:53:46.858897] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/modules.yaml\r\n==> [2022-01-27-14:53:46.863150] You are about to regenerate tcl module files for:\r\n\r\n-- linux-centos7-cascadelake / gcc@10.3.0 -----------------------\r\nfxw6t7g pango@1.42.0  tbsqhjh pango@1.42.0\r\n\r\n-- linux-centos7-cascadelake / gcc@11.2.0 -----------------------\r\nu3kljml pango@1.42.0  3jj4cqc pango@1.42.0  bzddjda pango@1.42.0  oeeqisx pango@1.42.0\r\n\r\n==> [2022-01-27-14:53:46.867625] Do you want to proceed? [y/n] y\r\n==> [2022-01-27-14:53:49.283477] Regenerating tcl module files\r\n==> [2022-01-27-14:53:50.577505]        WRITE: pango@1.42.0%gcc@10.3.0~X arch=linux-centos7-cascadelake/fxw6t7g [/opt/packages/gpjohnsn/spack/share/spack/modules/linux-centos7-cascadelake/pango-1.42.0-gcc-10.3.0-fxw6t7g]\r\n==> [2022-01-27-14:53:50.654980] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/compilers.yaml\r\n==> [2022-01-27-14:53:50.688684] Reading config file /Users/gpjohnsn/.spack/linux/compilers.yaml\r\n==> [2022-01-27-14:53:50.789441] '/opt/packages/gpjohnsn/spack/opt/spack/linux-centos7-cascadelake/gcc-10.3.0/python-3.9.9-btwqzwipuu2uzmryvenueome2z5vcm5s/bin/python3.9' '-c' '\r\nimport json\r\nfrom sysconfig import (\r\n    get_config_vars,\r\n    get_config_h_filename,\r\n    get_makefile_filename,\r\n    get_paths,\r\n)\r\n\r\nconfig = get_config_vars()\r\nconfig['\"'\"'config_h_filename'\"'\"'] = get_config_h_filename()\r\nconfig['\"'\"'makefile_filename'\"'\"'] = get_makefile_filename()\r\nconfig.update(get_paths())\r\n\r\nprint(json.dumps(config))\r\n'\r\n==> [2022-01-27-14:53:50.904756] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/defaults/packages.yaml\r\n==> [2022-01-27-14:53:50.933247] Reading config file /opt/packages/gpjohnsn/spack/etc/spack/packages.yaml\r\n==> [2022-01-27-14:53:50.940741]        WRITE: pango@1.42.0%gcc@11.2.0~X arch=linux-centos7-cascadelake/u3kljml [/opt/packages/gpjohnsn/spack/share/spack/modules/linux-centos7-cascadelake/pango-1.42.0-gcc-11.2.0-u3kljml]\r\n==> [2022-01-27-14:53:50.962596] '/opt/packages/gpjohnsn/spack/opt/spack/linux-centos7-cascadelake/gcc-11.2.0/python-3.9.9-j2qadxa25fkfwvn6t63w7xigwaolxgkp/bin/python3.9' '-c' '\r\nimport json\r\nfrom sysconfig import (\r\n    get_config_vars,\r\n    get_config_h_filename,\r\n    get_makefile_filename,\r\n    get_paths,\r\n)\r\n\r\nconfig = get_config_vars()\r\nconfig['\"'\"'config_h_filename'\"'\"'] = get_config_h_filename()\r\nconfig['\"'\"'makefile_filename'\"'\"'] = get_makefile_filename()\r\nconfig.update(get_paths())\r\n\r\nprint(json.dumps(config))\r\n'\r\n==> [2022-01-27-14:53:51.019406]        WRITE: pango@1.42.0%gcc@11.2.0~X arch=linux-centos7-cascadelake/3jj4cqc [/opt/packages/gpjohnsn/spack/share/spack/modules/linux-centos7-cascadelake/pango-1.42.0-gcc-11.2.0-3jj4cqc]\r\n==> [2022-01-27-14:53:51.044593] '/opt/packages/gpjohnsn/spack/opt/spack/linux-centos7-cascadelake/gcc-11.2.0/python-3.9.9-2diu3gkkzln3flspoqufqtqftngurfn5/bin/python3.9' '-c' '\r\nimport json\r\nfrom sysconfig import (\r\n    get_config_vars,\r\n    get_config_h_filename,\r\n    get_makefile_filename,\r\n    get_paths,\r\n)\r\n\r\nconfig = get_config_vars()\r\nconfig['\"'\"'config_h_filename'\"'\"'] = get_config_h_filename()\r\nconfig['\"'\"'makefile_filename'\"'\"'] = get_makefile_filename()\r\nconfig.update(get_paths())\r\n\r\nprint(json.dumps(config))\r\n'\r\n==> [2022-01-27-14:53:51.099304]        WRITE: pango@1.42.0%gcc@10.3.0+X arch=linux-centos7-cascadelake/tbsqhjh [/opt/packages/gpjohnsn/spack/share/spack/modules/linux-centos7-cascadelake/pango-1.42.0-gcc-10.3.0-tbsqhjh]\r\n==> [2022-01-27-14:53:51.183272]        WRITE: pango@1.42.0%gcc@11.2.0+X arch=linux-centos7-cascadelake/bzddjda [/opt/packages/gpjohnsn/spack/share/spack/modules/linux-centos7-cascadelake/pango-1.42.0-gcc-11.2.0-bzddjda]\r\n==> [2022-01-27-14:53:51.206261] '/opt/packages/gpjohnsn/spack/opt/spack/linux-centos7-cascadelake/gcc-11.2.0/python-3.9.9-r43khkvg24rfp7rz2i2ip2xjlkuz5p2t/bin/python3.9' '-c' '\r\nimport json\r\nfrom sysconfig import (\r\n    get_config_vars,\r\n    get_config_h_filename,\r\n    get_makefile_filename,\r\n    get_paths,\r\n)\r\n\r\nconfig = get_config_vars()\r\nconfig['\"'\"'config_h_filename'\"'\"'] = get_config_h_filename()\r\nconfig['\"'\"'makefile_filename'\"'\"'] = get_makefile_filename()\r\nconfig.update(get_paths())\r\n\r\nprint(json.dumps(config))\r\n'\r\n==> [2022-01-27-14:53:51.269101]        WRITE: pango@1.42.0%gcc@11.2.0+X arch=linux-centos7-cascadelake/oeeqisx [/opt/packages/gpjohnsn/spack/share/spack/modules/linux-centos7-cascadelake/pango-1.42.0-gcc-11.2.0-oeeqisx]\r\n```\r\n### Information on your system\r\n\r\n* **Spack:** 0.17.1-918-9a23fbb\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-centos7-cascadelake\r\n* **Concretizer:** clingo\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "glennpj",
    "url": "https://api.github.com/repos/spack/spack/issues/28647",
    "updated_at": "2022-01-31 22:56:34",
    "created_at": "2022-01-27 20:58:24",
    "closed_at": "2022-01-31 22:56:33",
    "state": "closed",
    "title": "module autoloading not working",
    "number": 28647,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1116731004,
    "html_url": "https://github.com/spack/spack/issues/28647",
    "assignees": [],
    "comments": 7
}