{
    "body": "**spack install intel-parallel-studio does not (fully) respect ~tbb ~mkl, i.e. TBB is still installed and TBBROOT as well as I_MPI_ROOT, FI_PROVIDER are set. TBB is also included in CPATH, LD_LIBRARY_PATH and LIBRARY_PATH**\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install intel-parallel-studio@composer.2019.3  % intel@19.0.3 ~tbb ~mpi ~mkl ~ipp ~daal\r\n...\r\n/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6\r\n$ spack find -v -f  /ity7pi3oqm\r\n==> 1 installed package\r\n-- linux-centos7-x86_64 / intel@19.0.3 --------------------------\r\nintel-parallel-studio@composer.2019.3%intel~advisor~clck~daal~gdb~ilp64~inspector~ipp~itac~mkl~mpi~newdtags+rpath+shared~tbb threads=none ~vtune\r\n$ module show intel-paralle-studio/composer.2019.3-intel19.0.3-ity7pi3\r\n...\r\nprepend-path    CPATH   /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/pstl/include:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/tbb/include:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/tbb/include\r\nprepend-path    LD_LIBRARY_PATH /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/libfabric/lib:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/lib/release:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/lib:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/compiler/lib/intel64_lin:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/libfabric/lib:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/lib/release:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/lib:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/tbb/lib/intel64/gcc4.7:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/tbb/lib/intel64/gcc4.7\r\nprepend-path    LIBRARY_PATH    /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/libfabric/lib:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/libfabric/lib:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/tbb/lib/intel64/gcc4.7:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/tbb/lib/intel64/gcc4.7\r\nsetenv          TBBROOT /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/tbb\r\n...\r\nprepend-path    CLASSPATH       /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/lib/mpi.jar:/apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/lib/mpi.jar\r\nprepend-path    FI_PROVIDER_PATH        /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/libfabric/lib/prov\r\nsetenv          I_MPI_ROOT      /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi\r\nprepend-path    MANPATH /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/man\r\nprepend-path    MANPATH /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/man\r\nprepend-path    PATH    /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/bin\r\nprepend-path    PATH    /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/libfabric/bin\r\nprepend-path    PATH    /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/bin\r\nprepend-path    PATH    /apps/SPACK-Stage1/opt/linux-centos7-x86_64/intel-19.0.3/intel-parallel-studio-composer.2019.3-ity7pi3oqmqzjpguwiho3lm7i7vfuiu6/compilers_and_libraries_2019.3.199/linux/mpi/intel64/libfabric/bin\r\n```\r\n\r\n(I'm not sure why all MPI lines appear twice in the module file ... - they are actually there twice; it's not a copy&paste error)\r\n\r\n### Expected behavior\r\n\r\nTBB should not appear at all in the module file (and also should not be on the file system - but $TBBROOT contains the full TBB installation as with +tbb)\r\n\r\nFor MPI it might be less obvious as even the Composer edition comes with the MPI runtime. However, when you want to combine the Intel compilers with other MPIs and use the SPACK provided modules outside of SPACK, the current situation causes trouble as the selected mpirun/mpiexec depends on the order modules are loaded.\r\n\r\n### Information on your system\r\n\r\n* CentOS 7.6\r\n* SPACK is currently used in a chain configuration with the chain using a checkout from April 8th (db98f16) while the upstream is much older (but that hopefully should be irrelevant as there are no relevant packages in the upstream)",
    "user": "tz-rrze",
    "url": "https://api.github.com/repos/spack/spack/issues/11144",
    "updated_at": "2019-07-20 00:44:23",
    "created_at": "2019-04-09 16:04:14",
    "closed_at": "None",
    "state": "open",
    "title": "install intel-parallel-studio does not (fully) respect ~tbb ~mpi",
    "number": 11144,
    "milestone": null,
    "labels": [
        "bug",
        "modules",
        "intel",
        "triage"
    ],
    "id": 431050377,
    "html_url": "https://github.com/spack/spack/issues/11144",
    "assignees": [
        "tgamblin"
    ],
    "comments": 1
}