{
    "body": "Fixes #3204\r\nFixes #5327\r\nFixes #6634\r\nFixes #7687\r\nFixes #8616\r\nCloses #8817\r\nFixes #10361\r\nFixes #12237 \r\n\r\nThis PR makes the following changes:\r\n\r\n- [x] Adds numpy 1.17.0 (which drops Python 2 support)\r\n- [x] Reverts #10383 which was causing problems with the numexpr installation (https://github.com/pydata/numexpr/issues/340)\r\n- [x] Fixes a bug where numpy would pick up the first BLAS/LAPACK it found, regardless of what was asked for (https://github.com/numpy/numpy/issues/14146)\r\n- [x] Fixes a bug where numpy would pick up BLAS/LAPACK even if `~blas~lapack` was requested\r\n- [x] Sets directory containing header files\r\n- [x] Fixes GCC 4.8 build (https://github.com/numpy/numpy/issues/14182)\r\n- [x] Fixes ATLAS build on macOS (#12237)\r\n- [x] Adds latest version of ATLAS\r\n- [x] Adds support for `blis`\r\n- [x] Adds support for `libflame`\r\n- [x] Adds support for `veclibfort`\r\n\r\nObviously, any big change to the numpy package, which has already gone through a lot of turmoil, will require extensive testing. Here are the platforms and configurations I would like to test before merging this:\r\n\r\n### macOS 10.14.5, Clang 10.0.1\r\n- [x] `+blas+lapack ^intel-mkl`\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\n[mkl]\r\nlibraries = mkl_rt\r\nlibrary_dirs = /opt/intel/compilers_and_libraries_2019.4.233/mac/mkl/lib:/usr/lib\r\nrpath = /opt/intel/compilers_and_libraries_2019.4.233/mac/mkl/lib:/usr/lib\r\ninclude_dirs = /opt/intel/compilers_and_libraries_2019.4.233/mac/mkl/include\r\n$ otool -l $(find . -name '*.so') | sort | uniq\r\n...\r\n         name /usr/lib/libSystem.B.dylib (offset 24)\r\n         name @rpath/libmkl_rt.dylib (offset 24)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/bzip2-1.0.8-llnc6sqphf7yp4drig6njzzkxctjwfse/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/expat-2.2.5-ivx3l77irr7xnft6v2xduzqier7zlct3/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/gdbm-1.18.1-pvjwideh43qybd2ifi65gjxq2dd6p4nj/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/libffi-3.2.1-rmioaofogfk7efvt3cpb3d433sevjnaf/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/ncurses-6.1-nhodl3ckldkmn6nfzgtymzlsn7mm3htq/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/openssl-1.1.1b-z6erpibfcvzxo5chnvovu3qmet4dzuuv/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/py-numpy-1.17.0-pwyhmfnrnpg264vfofzhyizizwyamjvu/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/py-numpy-1.17.0-pwyhmfnrnpg264vfofzhyizizwyamjvu/lib64 (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/python-3.7.4-jqlxzxpwzdhmrirodxanluofnce5o3ab/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/readline-7.0-kn3u3qhqwktlvjpr47ism2uqqgstvvf2/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/sqlite-3.28.0-mijtevf42dqzctgyaizz44skbyqwxgol/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/xz-5.2.4-snwzcouby3x3ztkutupqzmqwbbxh2tur/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/zlib-1.2.11-nqnlnxddpa4qfz5cnf4grnct57ds25ks/lib (offset 12)\r\n         path /opt/intel/compilers_and_libraries_2019.4.233/mac/mkl/lib (offset 12)\r\n         path /opt/intel/lib (offset 12)\r\n```\r\n- [ ] `+blas~lapack ^blis+cblas` (fails due to rpath problems: https://github.com/numpy/numpy/issues/14180)\r\n```console\r\n$ cat site.cfg\r\n[blis]\r\nlibraries = blis\r\nlibrary_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/blis-0.6.0-5adedbjl73c76sqq3izc7d3qxyzksr3t/lib\r\nrpath = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/blis-0.6.0-5adedbjl73c76sqq3izc7d3qxyzksr3t/lib\r\ninclude_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/blis-0.6.0-5adedbjl73c76sqq3izc7d3qxyzksr3t/include\r\n```\r\n- [x] `+blas+lapack ^openblas`\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\n[openblas]\r\nlibraries = openblas\r\nlibrary_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/openblas-0.3.6-3yts3o25cqf437oxaa4qzfhiw3swc7j2/lib\r\nrpath = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/openblas-0.3.6-3yts3o25cqf437oxaa4qzfhiw3swc7j2/lib\r\ninclude_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/openblas-0.3.6-3yts3o25cqf437oxaa4qzfhiw3swc7j2/include\r\n$ otool -l $(find . -name '*.so') | sort | uniq\r\n...\r\n         name /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/openblas-0.3.6-3yts3o25cqf437oxaa4qzfhiw3swc7j2/lib/libopenblas_sandybridge-r0.3.6.dylib (offset 24)\r\n         name /usr/lib/libSystem.B.dylib (offset 24)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/bzip2-1.0.8-llnc6sqphf7yp4drig6njzzkxctjwfse/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/expat-2.2.5-ivx3l77irr7xnft6v2xduzqier7zlct3/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/gdbm-1.18.1-pvjwideh43qybd2ifi65gjxq2dd6p4nj/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/libffi-3.2.1-rmioaofogfk7efvt3cpb3d433sevjnaf/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/ncurses-6.1-nhodl3ckldkmn6nfzgtymzlsn7mm3htq/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/openblas-0.3.6-3yts3o25cqf437oxaa4qzfhiw3swc7j2/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/openssl-1.1.1b-z6erpibfcvzxo5chnvovu3qmet4dzuuv/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/py-numpy-1.17.0-tt562t4vqgt2jc6j4gkk5rdj6mbakig2/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/py-numpy-1.17.0-tt562t4vqgt2jc6j4gkk5rdj6mbakig2/lib64 (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/python-3.7.4-jqlxzxpwzdhmrirodxanluofnce5o3ab/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/readline-7.0-kn3u3qhqwktlvjpr47ism2uqqgstvvf2/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/sqlite-3.28.0-mijtevf42dqzctgyaizz44skbyqwxgol/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/xz-5.2.4-snwzcouby3x3ztkutupqzmqwbbxh2tur/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/zlib-1.2.11-nqnlnxddpa4qfz5cnf4grnct57ds25ks/lib (offset 12)\r\n```\r\n- [ ] `~blas+lapack ^libflame@master` (unable to build libflame: #12193)\r\n- [ ] `+blas+lapack ^atlas` (weird build error: https://github.com/numpy/numpy/issues/14212)\r\n```console\r\n$ cat site.cfg\r\n[atlas]\r\nlibraries = satlas\r\nlibrary_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/atlas-3.10.3-j53o6sg7cswtaak6duqdofi7emddfg6z/lib\r\nrpath = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/atlas-3.10.3-j53o6sg7cswtaak6duqdofi7emddfg6z/lib\r\ninclude_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/atlas-3.10.3-j53o6sg7cswtaak6duqdofi7emddfg6z/include\r\n```\r\n- [x] `+blas+lapack ^veclibfort` (I think veclib is enough, veclibfort is not required)\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\n[accelerate]\r\nlibraries = vecLibFort\r\nlibrary_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/veclibfort-0.4.2-ucgnmbinqkiftt2h2roihqbxezvbiwpv/lib\r\nrpath = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/veclibfort-0.4.2-ucgnmbinqkiftt2h2roihqbxezvbiwpv/lib\r\n$ otool -l $(find . -name '*.so') | sort | uniq\r\n...\r\n         name /usr/lib/libSystem.B.dylib (offset 24)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/bzip2-1.0.8-llnc6sqphf7yp4drig6njzzkxctjwfse/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/expat-2.2.5-ivx3l77irr7xnft6v2xduzqier7zlct3/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/gdbm-1.18.1-pvjwideh43qybd2ifi65gjxq2dd6p4nj/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/libffi-3.2.1-rmioaofogfk7efvt3cpb3d433sevjnaf/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/ncurses-6.1-nhodl3ckldkmn6nfzgtymzlsn7mm3htq/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/openssl-1.1.1b-z6erpibfcvzxo5chnvovu3qmet4dzuuv/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/py-numpy-1.17.0-bvtdp3tqpak7snvkhnfsutkshtrjk2ri/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/py-numpy-1.17.0-bvtdp3tqpak7snvkhnfsutkshtrjk2ri/lib64 (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/python-3.7.4-jqlxzxpwzdhmrirodxanluofnce5o3ab/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/readline-7.0-kn3u3qhqwktlvjpr47ism2uqqgstvvf2/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/sqlite-3.28.0-mijtevf42dqzctgyaizz44skbyqwxgol/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/veclibfort-0.4.2-ucgnmbinqkiftt2h2roihqbxezvbiwpv/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/xz-5.2.4-snwzcouby3x3ztkutupqzmqwbbxh2tur/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/zlib-1.2.11-nqnlnxddpa4qfz5cnf4grnct57ds25ks/lib (offset 12)\r\n```\r\n- [x] `+blas+lapack ^netlib-lapack`\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\n[blas]\r\nlibraries = blas\r\nlibrary_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/netlib-lapack-3.8.0-r242vagzpssq7r5za4wfnfha5hrtcj7d/lib\r\nrpath = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/netlib-lapack-3.8.0-r242vagzpssq7r5za4wfnfha5hrtcj7d/lib\r\ninclude_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/netlib-lapack-3.8.0-r242vagzpssq7r5za4wfnfha5hrtcj7d/include\r\n[lapack]\r\nlibraries = lapack\r\nlibrary_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/netlib-lapack-3.8.0-r242vagzpssq7r5za4wfnfha5hrtcj7d/lib\r\nrpath = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/netlib-lapack-3.8.0-r242vagzpssq7r5za4wfnfha5hrtcj7d/lib\r\ninclude_dirs = /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/netlib-lapack-3.8.0-r242vagzpssq7r5za4wfnfha5hrtcj7d/include\r\n$ otool -l $(find . -name '*.so') | sort | uniq\r\n...\r\n         name /usr/lib/libSystem.B.dylib (offset 24)\r\n         name @rpath/libblas.3.dylib (offset 24)\r\n         name @rpath/libcblas.3.dylib (offset 24)\r\n         name @rpath/liblapack.3.dylib (offset 24)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/bzip2-1.0.8-llnc6sqphf7yp4drig6njzzkxctjwfse/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/expat-2.2.5-ivx3l77irr7xnft6v2xduzqier7zlct3/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/gdbm-1.18.1-pvjwideh43qybd2ifi65gjxq2dd6p4nj/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/libffi-3.2.1-rmioaofogfk7efvt3cpb3d433sevjnaf/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/ncurses-6.1-nhodl3ckldkmn6nfzgtymzlsn7mm3htq/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/netlib-lapack-3.8.0-r242vagzpssq7r5za4wfnfha5hrtcj7d/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/openssl-1.1.1b-z6erpibfcvzxo5chnvovu3qmet4dzuuv/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/py-numpy-1.17.0-z6fmbjnxdegdbxzavacnimooqg3obs6n/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/py-numpy-1.17.0-z6fmbjnxdegdbxzavacnimooqg3obs6n/lib64 (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/python-3.7.4-jqlxzxpwzdhmrirodxanluofnce5o3ab/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/readline-7.0-kn3u3qhqwktlvjpr47ism2uqqgstvvf2/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/sqlite-3.28.0-mijtevf42dqzctgyaizz44skbyqwxgol/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/xz-5.2.4-snwzcouby3x3ztkutupqzmqwbbxh2tur/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/zlib-1.2.11-nqnlnxddpa4qfz5cnf4grnct57ds25ks/lib (offset 12)\r\n```\r\n- [x] `~blas~lapack`\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\ncat: ./lib/python3.7/site-packages/numpy/distutils/site.cfg: No such file or directory\r\n$ otool -l $(find . -name '*.so') | sort | uniq\r\n...\r\n         name /usr/lib/libSystem.B.dylib (offset 24)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/bzip2-1.0.8-llnc6sqphf7yp4drig6njzzkxctjwfse/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/expat-2.2.5-ivx3l77irr7xnft6v2xduzqier7zlct3/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/gdbm-1.18.1-pvjwideh43qybd2ifi65gjxq2dd6p4nj/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/libffi-3.2.1-rmioaofogfk7efvt3cpb3d433sevjnaf/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/ncurses-6.1-nhodl3ckldkmn6nfzgtymzlsn7mm3htq/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/openssl-1.1.1b-z6erpibfcvzxo5chnvovu3qmet4dzuuv/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/py-numpy-1.17.0-gkuufd4mljdukrciubhmvpxuiflny22x/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/py-numpy-1.17.0-gkuufd4mljdukrciubhmvpxuiflny22x/lib64 (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/python-3.7.4-jqlxzxpwzdhmrirodxanluofnce5o3ab/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/readline-7.0-kn3u3qhqwktlvjpr47ism2uqqgstvvf2/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/sqlite-3.28.0-mijtevf42dqzctgyaizz44skbyqwxgol/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/xz-5.2.4-snwzcouby3x3ztkutupqzmqwbbxh2tur/lib (offset 12)\r\n         path /Users/Adam/spack/opt/spack/darwin-mojave-x86_64/clang-10.0.1-apple/zlib-1.2.11-nqnlnxddpa4qfz5cnf4grnct57ds25ks/lib (offset 12)\r\n```\r\n\r\n### Linux CentOS 7, GCC 4.8.5\r\n- [x] `+blas+lapack ^intel-mkl`\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\n[mkl]\r\nlibraries = mkl_rt\r\nlibrary_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/intel-mkl-2019.3.199-dwmyyb66bsnoisor6fmvcx4j6akq7cgg/compilers_and_libraries_2019.3.199/linux/mkl/lib/intel64:/lib64\r\nrpath = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/intel-mkl-2019.3.199-dwmyyb66bsnoisor6fmvcx4j6akq7cgg/compilers_and_libraries_2019.3.199/linux/mkl/lib/intel64:/lib64\r\ninclude_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/intel-mkl-2019.3.199-dwmyyb66bsnoisor6fmvcx4j6akq7cgg/compilers_and_libraries_2019.3.199/linux/mkl/include\r\n$ ldd -r $(find . -name '*.so') | sort | uniq\r\n...\r\n\tlibmkl_rt.so => /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/intel-mkl-2019.3.199-dwmyyb66bsnoisor6fmvcx4j6akq7cgg/compilers_and_libraries_2019.3.199/linux/mkl/lib/intel64/libmkl_rt.so (0x00007f516259e000)\r\n```\r\n- [ ] `+blas~lapack ^blis+cblas` (fails due to rpath problems: numpy/numpy#14180)\r\n```console\r\n$ cat site.cfg\r\n[blis]\r\nlibraries = blis\r\nlibrary_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/blis-0.6.0-k46gjp3oke6i2z2c3jmhgnfexc3jpkqw/lib\r\nrpath = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/blis-0.6.0-k46gjp3oke6i2z2c3jmhgnfexc3jpkqw/lib\r\ninclude_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/blis-0.6.0-k46gjp3oke6i2z2c3jmhgnfexc3jpkqw/include\r\n```\r\n- [x] `+blas+lapack ^openblas`\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\n[openblas]\r\nlibraries = openblas\r\nlibrary_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/openblas-0.3.6-2wdlwxcbb44em2a2eukduuaqxteko3of/lib\r\nrpath = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/openblas-0.3.6-2wdlwxcbb44em2a2eukduuaqxteko3of/lib\r\ninclude_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/openblas-0.3.6-2wdlwxcbb44em2a2eukduuaqxteko3of/include\r\n$ ldd -r $(find . -name \"*.so\") | sort | uniq\r\n...\r\n\tlibopenblas.so.0 => /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/openblas-0.3.6-2wdlwxcbb44em2a2eukduuaqxteko3of/lib/libopenblas.so.0 (0x00007f1a7769f000)\r\n```\r\n- [ ] `~blas+lapack ^libflame@master` (numpy does not pick up libflame: https://github.com/numpy/numpy/issues/14205)\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\n[flame]\r\nlibraries = flame\r\nlibrary_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/libflame-master-xmo2dhpugpfgb4zetev2lcccvdgybjog/lib\r\nrpath = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/libflame-master-xmo2dhpugpfgb4zetev2lcccvdgybjog/lib\r\ninclude_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/libflame-master-xmo2dhpugpfgb4zetev2lcccvdgybjog/include\r\n```\r\n- [x] `+blas+lapack ^atlas`\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\n[atlas]\r\nlibraries = satlas\r\nlibrary_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/atlas-3.10.2-a32yghlhsmlartth4vxyrn2cswzbotlu/lib\r\nrpath = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/atlas-3.10.2-a32yghlhsmlartth4vxyrn2cswzbotlu/lib\r\ninclude_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/atlas-3.10.2-a32yghlhsmlartth4vxyrn2cswzbotlu/include\r\n$ ldd -r $(find . -name \"*.so\") | sort | uniq\r\n...\r\n\t/home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/atlas-3.10.2-a32yghlhsmlartth4vxyrn2cswzbotlu/lib/libsatlas.so (0x00007f4ebaf1e000)\r\n```\r\n- [x] `+blas+lapack ^netlib-lapack`\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\n[blas]\r\nlibraries = blas\r\nlibrary_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/netlib-lapack-3.8.0-c5uo7hykg6txcixdohlsmixphc5ikf4b/lib64\r\nrpath = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/netlib-lapack-3.8.0-c5uo7hykg6txcixdohlsmixphc5ikf4b/lib64\r\ninclude_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/netlib-lapack-3.8.0-c5uo7hykg6txcixdohlsmixphc5ikf4b/include\r\n[lapack]\r\nlibraries = lapack\r\nlibrary_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/netlib-lapack-3.8.0-c5uo7hykg6txcixdohlsmixphc5ikf4b/lib64\r\nrpath = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/netlib-lapack-3.8.0-c5uo7hykg6txcixdohlsmixphc5ikf4b/lib64\r\ninclude_dirs = /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/netlib-lapack-3.8.0-c5uo7hykg6txcixdohlsmixphc5ikf4b/include\r\n$ ldd -r $(find . -name \"*.so\") | sort | uniq\r\n...\r\n\tlibblas.so.3 => /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/netlib-lapack-3.8.0-c5uo7hykg6txcixdohlsmixphc5ikf4b/lib64/libblas.so.3 (0x00007f0034177000)\r\n\tlibcblas.so.3 => /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/netlib-lapack-3.8.0-c5uo7hykg6txcixdohlsmixphc5ikf4b/lib64/libcblas.so.3 (0x00007f00343cf000)\r\n\tliblapack.so.3 => /home/adamjs5/spack/opt/spack/linux-centos7-x86_64/gcc-4.8.5/netlib-lapack-3.8.0-c5uo7hykg6txcixdohlsmixphc5ikf4b/lib64/liblapack.so.3 (0x00007f726f796000)\r\n```\r\n- [x] `~blas~lapack`\r\n```console\r\n$ cat ./lib/python3.7/site-packages/numpy/distutils/site.cfg\r\ncat: ./lib/python3.7/site-packages/numpy/distutils/site.cfg: No such file or directory\r\n$ ldd -r $(find . -name '*.so') | sort | uniq\r\n...\r\nno linkage to blas/lapack\r\n```\r\n\r\n### Caveats\r\n- I only plan on testing the latest version of numpy, this PR may break older versions\r\n- I only plan on testing Python 3, as numpy no longer supports Python 2\r\n- I only plan on testing supported BLAS/LAPACK configurations, not BLAS providers like `essl` or `netlib-xblas`\r\n- I don't plan on testing mixed BLAS/LAPACK configurations, like `^blis ^libflame`, but they should work\r\n- This PR does not try to tackle the many build problems that Intel users face. That can be saved for another PR\r\n\r\n@scheibelp @huqy @robbmcleod @scottwittenburg @s-sajid-ali",
    "user": "adamjstewart",
    "url": "https://api.github.com/repos/spack/spack/issues/12170",
    "updated_at": "2019-09-18 20:31:18",
    "created_at": "2019-07-28 20:27:49",
    "closed_at": "2019-08-06 23:20:25",
    "state": "closed",
    "title": "Overhaul numpy package",
    "number": 12170,
    "milestone": null,
    "labels": [
        "new-version",
        "python",
        "blas-lapack-scalapack"
    ],
    "id": 473782793,
    "html_url": "https://github.com/spack/spack/pull/12170",
    "assignees": [],
    "comments": 12
}