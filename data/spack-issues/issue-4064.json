{
    "body": "I have a jenkins jobs that builds all of my things every night.\r\n\r\nThe build at Apr 30, 2017 2:28:42 AM succeeded, using `develop` at 0a9beccc4a4d7336e002d1fbcc2cf77c2d41ecbb.\r\n\r\nLast night's build failed while building `direnv` and I'm trying to understand why and what might have changed.  I tried another build this morning and it also failed.\r\n\r\nWhen I cd'ed into the workspace of the failed build and ran\r\n\r\n```\r\nspack stage direnv\r\npushd /path/to/stage/dir/goes/here\r\nspack env direnv bash\r\ncd direnv-2.11.3\r\ngo build\r\n```\r\n\r\nit fails with\r\n\r\n```\r\n_/scratch/hartzelg/spack-cime-sc1-working-dir/workspace/sc1-daily-build/spack/var/spack/stage/direnv-2.11.3-wixlanate5jvl752xxua5j5wzprohhvn/direnv-2.11.3\r\n./log.go:47: undefined: log.Output\r\n```\r\n\r\nThat line's a simple:\r\n\r\n```\r\n        log.Output(2, msg)\r\n```\r\n\r\nOut of habit I checked which go compiler I was using and found that I was invoking the old bootstrap compiler:\r\n\r\n```\r\n$ which go\r\n/scratch/hartzelg/spack-cime-sc1-working-dir/workspace/sc1-daily-build/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/go-bootstrap-1.4-bootstrap-20161024-bjdc3swkpiscyoysx5hu6oxleaovrtt5/bin/go\r\n```\r\n\r\nSure enough, it's been prepended to `$PATH`:\r\n\r\n```\r\n$ (module purge; spack env direnv | egrep '^PATH=' | perl -lape 's/:/\\n/g')\r\nPATH=.\r\n/blah/blah/blah/spack/lib/spack/env\r\n/blah/blah/blah/spack/lib/spack/env/case-insensitive\r\n/blah/blah/blah/spack/lib/spack/env/gcc\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/go-bootstrap-1.4-bootstrap-20161024-bjdc3swkpiscyoysx5hu6oxleaovrtt5/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/gdbm-1.13-5o4l6t7ovwa74n4l4kc6dh4l2vj55geq/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/perl-5.24.1-6eeiyzpngdxb3qhtfxeh277qe6sau4ip/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/pcre-8.40-rnjaow53pneai2d23pgrq7wzeg2k5p5/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/gettext-0.19.8.1-qtf3fmomputuj4vsql5e5pjokhwqvitr/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/expat-2.2.0-zv7petry2d3upbwlfq2mig7njqwae7ef/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/openssl-1.0.2k-5s7cetd6mdyveeiqqas6rtcwjvyp3afq/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/curl-7.53.1-5abaxzgglvlebmkn777wx56fzoit6qmk/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/automake-1.15-zbemo7uxhl54iactqivinmc4ufzpt4gi/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/m4-1.4.18-ipesuzrivyks743qv7licjfyrqyvxsifkdkpsvt25b3f/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/libtool-2.4.6-vwgxyfslc5ia6zlesisvn2e3mwvpduaz/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/libiconv-1.15-dbp3qyi2m6silluqhrrig6ku55guewic/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/tar-1.29-famxnoser4n2j4blic4fknc7py4htkq5/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/ncurses-6.0-43qxlcy2renpowsmlfbhqfek2bcm/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/xz-5.2.guvl5civei5atlkimcrjg6ctpukc6/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/bzip2-1.0.6-egkg2fbrc3-ehlxwhosxgdfbduwx3nk5zzxmo4qhmaq/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/pkg-config-0.29.2-cuidxoskfchduid5ebedi/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/autoconf-2.69-6lvs34zg44gjie4yonsck6lfd4sbobu5/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/git-2.12.1-nv53m34ehjvxcf23ox7bf223a66p7wkk/bin\r\n/blah/blah/blah/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/go-1.8.1-w2kg27p5h6z6bh4pgjcparpochlqhfwx/bin\r\n/blah/blah/blah/spack/bin\r\n/usr/local/bin\r\n/usr/bin\r\n/opt/ibutils/bin\r\n/usr/local/sbin\r\n/usr/sbin\r\n```\r\n\r\ndirenv has a build dependency on go, go has a build dependency on go-bootstrap.\r\n\r\n\r\nHere's the base environment in which spack is running:\r\n\r\n```\r\n$ (module purge; echo ${PATH} | perl -lape 's/:/\\n/g')\r\n/blah/blah/blah/spack/bin\r\n/usr/local/bin\r\n/usr/bin\r\n/opt/ibutils/bin\r\n/usr/local/sbin\r\n/usr/sbin\r\n```\r\n\r\nOn a possibly related note, I noticed that the version of go that has been installed is `go@1.8.1`, in spite of having it pinned to `go@1.8` in my `packages.yaml` file.\r\n\r\n```yaml\r\n  go:\r\n    version: [1.8]\r\n    # tests have two false positives, user_namespaces and threads/exceptions\r\n    variants: ~test\r\n```\r\n\r\n",
    "user": "hartzell",
    "url": "https://api.github.com/repos/spack/spack/issues/4064",
    "updated_at": "2017-05-04 01:41:26",
    "created_at": "2017-05-01 18:23:37",
    "closed_at": "2017-05-04 01:41:26",
    "state": "closed",
    "title": "My CI builds broke, something changed with build dependencies or ...",
    "number": 4064,
    "milestone": null,
    "labels": [
        "build-environment"
    ],
    "id": 225490193,
    "html_url": "https://github.com/spack/spack/issues/4064",
    "assignees": [],
    "comments": 23
}