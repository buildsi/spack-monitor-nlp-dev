{
    "body": "### Steps to reproduce\n\nFirst, hack some package to make sure that it fails to install. For example:\r\n```diff\r\ndiff --git a/var/spack/repos/builtin/packages/libsigsegv/package.py b/var/spack/repos/builtin/packages/libsigsegv/package.py\r\nindex bee12e25b9..8c5425ebb6 100644\r\n--- a/var/spack/repos/builtin/packages/libsigsegv/package.py\r\n+++ b/var/spack/repos/builtin/packages/libsigsegv/package.py\r\n@@ -20,7 +20,7 @@ class Libsigsegv(AutotoolsPackage, GNUMirrorPackage):\r\n     test_requires_compiler = True\r\n \r\n     def configure_args(self):\r\n-        return ['--enable-shared']\r\n+        return ['--enable-shared', '--foo']\r\n \r\n     extra_install_tests = 'tests/.libs'\r\n```\r\nThen, try to install a package that depends on this using `--only=dependencies`:\r\n```console\r\n$ spack install --only=dependencies m4\r\n```\n\n### Error message\n\nSpack _should_ set the exit code to 1 in this situation since the requested installation failed. If there are additional dependencies that weren't able to be installed, Spack _should_ warn that these packages were skipped due to a failed install. However, neither of these happen:\r\n```console\r\n$ spack install --only=dependencies m4\r\n==> Installing libsigsegv-2.12-fu7ahf7fobfke2yiht3m72edlfryshot\r\n==> No binary for libsigsegv-2.12-fu7ahf7fobfke2yiht3m72edlfryshot found: installing from source\r\n/Users/Adam/spack/lib/spack/spack/target.py:137: UserWarning: microarchitecture specific optimizations are not supported yet on mixed compiler toolchains [check apple-clang@12.0.0 for further details]\r\n  warnings.warn(msg.format(compiler))\r\n==> Fetching https://mirror.spack.io/_source-cache/archive/3a/3ae1af359eebaa4ffc5896a1aee3568c052c99879316a1ab57f8fe1789c390b6.tar.gz\r\n==> No patches needed for libsigsegv\r\n==> libsigsegv: Executing phase: 'autoreconf'\r\n==> libsigsegv: Executing phase: 'configure'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/var/folders/21/hwq39zyj4g36x6zjfyl5l8080000gn/T/Adam/spack-stage/spack-stage-libsigsegv-2.12-fu7ahf7fobfke2yiht3m72edlfryshot/spack-src/configure' '--prefix=/Users/Adam/spack/opt/spack/darwin-catalina-ivybridge/apple-clang-12.0.0/libsigsegv-2.12-fu7ahf7fobfke2yiht3m72edlfryshot' '--enable-shared' '--foo'\r\n\r\n1 error found in build log:\r\n     3    ==> [2022-01-09-11:52:34.015795] '/var/folders/21/hwq39zyj4g36x6zjfyl5l8080000gn/T/Adam/spack-stage/spack-stage-libsigsegv-2.12-fu7ahf7fobfke2yiht3m72edlfrysho\r\n          t/spack-src/configure' '--prefix=/Users/Adam/spack/opt/spack/darwin-catalina-ivybridge/apple-clang-12.0.0/libsigsegv-2.12-fu7ahf7fobfke2yiht3m72edlfryshot' '--\r\n          enable-shared' '--foo'\r\n  >> 4    configure: error: unrecognized option: `--foo'\r\n     5    Try `/var/folders/21/hwq39zyj4g36x6zjfyl5l8080000gn/T/Adam/spack-stage/spack-stage-libsigsegv-2.12-fu7ahf7fobfke2yiht3m72edlfryshot/spack-src/configure --help'\r\n           for more information\r\n\r\nSee build log for details:\r\n  /var/folders/21/hwq39zyj4g36x6zjfyl5l8080000gn/T/Adam/spack-stage/spack-stage-libsigsegv-2.12-fu7ahf7fobfke2yiht3m72edlfryshot/spack-build-out.txt\r\n\r\n$ echo $?\r\n0\r\n```\n\n### Information on your system\n\n* **Spack:** 0.17.0-786-0277067e5f\r\n* **Python:** 3.8.12\r\n* **Platform:** darwin-catalina-ivybridge\r\n* **Concretizer:** clingo\r\n\r\n@tldahlgren I feel like I've seen this issue reported before but couldn't find one when searching. I feel like we've discussed this issue before when you were working on parallel build support.\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "adamjstewart",
    "url": "https://api.github.com/repos/spack/spack/issues/28335",
    "updated_at": "2022-01-09 18:00:55",
    "created_at": "2022-01-09 18:00:55",
    "closed_at": "None",
    "state": "open",
    "title": "spack install --only=dependencies returns incorrect exit code",
    "number": 28335,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1097261938,
    "html_url": "https://github.com/spack/spack/issues/28335",
    "assignees": [],
    "comments": 0
}