{
    "body": "If one diffs the concretized specs of `spack spec dealii@develop` and `spack spec dealii@develop~python+mpi ^boost+python` there is a zero difference apart from the `python` variant of the root node (`dealii`) -- this is expected and a desired behaviour. In other words dags should be identical and so their hashes.\n\nHowever after successfully installing \n\n```\n$ spack install dealii@develop\n==> dealii is already installed in /Users/davydden/spack/opt/spack/darwin-elcapitan-x86_64/clang-7.3.0-apple/dealii-develop-if6ztag7fopoe7vcppk2sidqe44j7u7b\n```\n\n the second build actually starts with re-installing `hwloc` and then, supposedly, `openmpi` and the rest:\n\n```\n$ spack install dealii@develop~python+mpi ^boost+python\n==> Installing dealii\n==> metis is already installed in /Users/davydden/spack/opt/spack/darwin-elcapitan-x86_64/clang-7.3.0-apple/metis-5.1.0-sawhq7id7lig7enw7qhexuj423xk6eq7\n==> Installing trilinos\n==> Installing superlu-dist\n==> Installing openmpi\n==> Installing hwloc\n==> libpciaccess is already installed in /Users/davydden/spack/opt/spack/darwin-elcapitan-x86_64/clang-7.3.0-apple/libpciaccess-0.13.4-plgdrjeje7tk63kv65wuhptmi5rhbugr\n==> Can not find version 1.11.3 in url_list\n==> Already downloaded /Users/davydden/spack/var/spack/stage/hwloc-1.11.3-jtkwa4li2oxkedg6j4fc2p2in2tlf3hb/hwloc-1.11.3.tar.gz\n==> Already staged hwloc-1.11.3-jtkwa4li2oxkedg6j4fc2p2in2tlf3hb in /Users/davydden/spack/var/spack/stage/hwloc-1.11.3-jtkwa4li2oxkedg6j4fc2p2in2tlf3hb\n==> No patches needed for hwloc\n==> Building hwloc\n```\n\nSomething is certainly wrong here. \n\nCould it be that hashes are dependent on **normalized** specs, which are different here:\n\n```\nInput spec\n------------------------------\n  dealii@develop+mpi~python\n      ^boost+python\n\nNormalized\n------------------------------\n  dealii@develop+mpi~python\n      ^astyle@2.04\n      ^blas\n      ^boost@1.59.0:+iostreams+mpi+python+serialization+system+thread\n          ^bzip2\n          ^mpi\n          ^python\n              ^ncurses\n              ^openssl\n                  ^zlib\n              ^readline\n              ^sqlite\n      ^cmake\n      ^lapack\n      ^muparser\n      ^numdiff\n          ^gettext\n      ^suite-sparse\n      ^tbb\n```\n\nvs\n\n```\nInput spec\n------------------------------\n  dealii@develop\n\nNormalized\n------------------------------\n  dealii@develop\n      ^astyle@2.04\n      ^blas\n      ^bzip2\n      ^cmake\n      ^lapack\n      ^muparser\n      ^numdiff\n          ^gettext\n      ^suite-sparse\n      ^tbb\n      ^zlib\n```\n\nBelow is the Conretized specs (again, the only difference between the two is `~python` vs `+python` of the root node):\n\n```\nConcretized\n------------------------------\n  dealii@develop%clang@7.3.0-apple+arpack~doc+gsl+hdf5+metis+mpi+netcdf+oce+p4est+petsc~python+slepc+trilinos arch=darwin-elcapitan-x86_64\n      ^arpack-ng@3.4.0%clang@7.3.0-apple+mpi+shared arch=darwin-elcapitan-x86_64\n          ^cmake@3.6.0%clang@7.3.0-apple~doc+ncurses+openssl~qt arch=darwin-elcapitan-x86_64\n              ^ncurses@6.0%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n              ^openssl@1.0.2h%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n                  ^zlib@1.2.8%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n          ^openblas@0.2.18%clang@7.3.0-apple+fpic~openmp+shared arch=darwin-elcapitan-x86_64\n          ^openmpi@2.0.0%clang@7.3.0-apple~mxm~pmi~psm~psm2~slurm~sqlite3~thread_multiple~tm~verbs+vt arch=darwin-elcapitan-x86_64\n              ^hwloc@1.11.3%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n                  ^libpciaccess@0.13.4%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n                      ^libtool@2.4.6%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n                          ^m4@1.4.17%clang@7.3.0-apple+sigsegv arch=darwin-elcapitan-x86_64\n                              ^libsigsegv@2.10%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^astyle@2.04%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^boost@1.61.0%clang@7.3.0-apple+atomic+chrono+date_time~debug+filesystem~graph~icu_support+iostreams+locale+log+math+mpi+multithreaded+program_options+python+random+regex+serialization+shared+signals+singlethreaded+system+test+thread+timer+wave arch=darwin-elcapitan-x86_64\n          ^bzip2@1.0.6%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n          ^python@2.7.12%clang@7.3.0-apple~tk~ucs4 arch=darwin-elcapitan-x86_64\n              ^readline@6.3%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n              ^sqlite@3.8.5%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^gsl@2.1%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^hdf5@1.10.0-patch1%clang@7.3.0-apple+cxx~debug+fortran+mpi+shared~szip~threadsafe arch=darwin-elcapitan-x86_64\n      ^metis@5.1.0%clang@7.3.0-apple~debug~gdb~idx64~real64+shared arch=darwin-elcapitan-x86_64\n      ^muparser@2.2.5%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^netcdf@4.4.1%clang@7.3.0-apple~hdf4+mpi arch=darwin-elcapitan-x86_64\n          ^curl@7.49.1%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^netcdf-cxx@4.2%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^numdiff@5.8.1%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n          ^gettext@0.19.8.1%clang@7.3.0-apple+bzip2+curses+git~libunistring+libxml2+tar+xz arch=darwin-elcapitan-x86_64\n              ^libxml2@2.9.2%clang@7.3.0-apple~python arch=darwin-elcapitan-x86_64\n                  ^xz@5.2.2%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n              ^tar@1.28%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^oce@0.17.2%clang@7.3.0-apple+tbb arch=darwin-elcapitan-x86_64\n          ^tbb@4.4.4%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^p4est@1.1%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n          ^autoconf@2.69%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n          ^automake@1.15%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n          ^lua@5.3.2%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^petsc@3.7.2%clang@7.3.0-apple+boost~complex~debug+double+hdf5+hypre+metis+mpi+mumps+shared+superlu-dist arch=darwin-elcapitan-x86_64\n          ^hypre@2.10.1%clang@7.3.0-apple~internal-superlu~shared arch=darwin-elcapitan-x86_64\n          ^mumps@5.0.1%clang@7.3.0-apple+complex+double+float~idx64~metis+mpi~parmetis~ptscotch~scotch+shared arch=darwin-elcapitan-x86_64\n              ^netlib-scalapack@2.0.2%clang@7.3.0-apple~fpic+shared arch=darwin-elcapitan-x86_64\n          ^parmetis@4.0.3%clang@7.3.0-apple~debug~gdb+shared arch=darwin-elcapitan-x86_64\n          ^superlu-dist@5.0.0%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n      ^slepc@3.7.1%clang@7.3.0-apple+arpack arch=darwin-elcapitan-x86_64\n      ^suite-sparse@4.5.3%clang@7.3.0-apple+tbb arch=darwin-elcapitan-x86_64\n      ^trilinos@12.6.4%clang@7.3.0-apple+boost~debug+hdf5+hypre+metis+mumps~python+shared+suite-sparse+superlu-dist arch=darwin-elcapitan-x86_64\n          ^glm@0.9.7.1%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n          ^matio@1.5.2%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n          ^swig@3.0.10%clang@7.3.0-apple arch=darwin-elcapitan-x86_64\n              ^pcre@8.38%clang@7.3.0-apple+utf arch=darwin-elcapitan-x86_64\n```\n",
    "user": "davydden",
    "url": "https://api.github.com/repos/spack/spack/issues/1457",
    "updated_at": "2016-12-29 22:44:00",
    "created_at": "2016-08-05 13:41:21",
    "closed_at": "2016-12-29 22:44:00",
    "state": "closed",
    "title": "Hashes of nodes change with a variant of the root node for exactly the same DAG",
    "number": 1457,
    "milestone": null,
    "labels": [
        "bug",
        "needs-response",
        "hashes",
        "specs"
    ],
    "id": 169609780,
    "html_url": "https://github.com/spack/spack/issues/1457",
    "assignees": [],
    "comments": 27
}