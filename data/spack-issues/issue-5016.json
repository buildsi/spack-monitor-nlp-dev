{
    "body": "Currently, if you get a build error in Spack, you get this:\r\n\r\n```console\r\n$ spack install elfutils\r\n==> Installing elfutils\r\n==> Using cached archive: /Users/gamblin2/src/spack/var/spack/cache/elfutils/elfutils-0.163.tar.bz2\r\n==> Staging archive: /Users/gamblin2/src/spack/var/spack/stage/elfutils-0.163-qyris2qgf3oq4fob5ss6hsfijy4crd6a/elfutils-0.163.tar.bz2\r\n==> Created stage in /Users/gamblin2/src/spack/var/spack/stage/elfutils-0.163-qyris2qgf3oq4fob5ss6hsfijy4crd6a\r\n==> No patches needed for elfutils\r\n==> Building elfutils [AutotoolsPackage]\r\n==> Executing phase : 'autoreconf'\r\n==> Executing phase : 'configure'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/Users/gamblin2/src/spack/var/spack/stage/elfutils-0.163-qyris2qgf3oq4fob5ss6hsfijy4crd6a/elfutils-0.163/configure' '--prefix=/Users/gamblin2/src/spack/opt/spack/darwin-sierra-x86_64/clang-7.0.2-apple/elfutils-0.163-qyris2qgf3oq4fob5ss6hsfijy4crd6a' '--enable-maintainer-mode'\r\n/Users/gamblin2/src/spack/lib/spack/spack/build_systems/autotools.py:268, in configure:\r\n     260      def configure(self, spec, prefix):\r\n     261          \"\"\"Runs configure with the arguments specified in\r\n     262          :py:meth:`~.AutotoolsPackage.configure_args`\r\n     263          and an appropriately set prefix.\r\n     264          \"\"\"\r\n     265          options = ['--prefix={0}'.format(prefix)] + self.configure_args()\r\n     266  \r\n     267          with working_dir(self.build_directory, create=True):\r\n  >> 268              inspect.getmodule(self).configure(*options)\r\n\r\nSee build log for details:\r\n  /private/var/folders/0s/q_y0zhfj6xdd5n7rn780zz6h001qr7/T/pytest-of-gamblin2/pytest-194/test_keep_exceptions0/tmp/spack-stage/spack-stage-wLLSsa/elfutils-0.163/spack-build.out\r\n```\r\n\r\nSpack is trying to be helpful by showing Python context for the package, but *usually* you don't get a Python error.  You get some type of build error, and you just want to look at the build log.  Also, with our various build system classes, the Python context is often in a class the user knows nothing about (like the `configure` method in `AutotoolsPackage` shown here), and doesn't really tell you what the issue is.\r\n\r\nThis PR changes the behavior.  If the error raised is a `ProcessError` from some script or tool invoked by the build process (e.g., `make` or `configure`), we'll show errors from the build log instead.  If the error is some other error (e.g. one that actually comes from Python code) we'll show Python context.  So, here's the new output:\r\n\r\n```console\r\n$ spack install elfutils\r\n==> Installing elfutils\r\n==> Using cached archive: /Users/gamblin2/src/spack/var/spack/cache/elfutils/elfutils-0.163.tar.bz2\r\n==> Already staged elfutils-0.163-qyris2qgf3oq4fob5ss6hsfijy4crd6a in /Users/gamblin2/src/spack/var/spack/stage/elfutils-0.163-qyris2qgf3oq4fob5ss6hsfijy4crd6a\r\n==> No patches needed for elfutils\r\n==> Building elfutils [AutotoolsPackage]\r\n==> Executing phase : 'autoreconf'\r\n==> Executing phase : 'configure'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/Users/gamblin2/src/spack/var/spack/stage/elfutils-0.163-qyris2qgf3oq4fob5ss6hsfijy4crd6a/elfutils-0.163/configure' '--prefix=/Users/gamblin2/src/spack/opt/spack/darwin-sierra-x86_64/clang-7.0.2-apple/elfutils-0.163-qyris2qgf3oq4fob5ss6hsfijy4crd6a' '--enable-maintainer-mode'\r\n\r\n2 errors in build log:\r\n     [ ... ]\r\n     12    checking build system type... x86_64-apple-darwin16.6.0\r\n     13    checking host system type... x86_64-apple-darwin16.6.0\r\n     14    checking for gcc... /Users/gamblin2/src/spack/lib/spack/env/clang/clang\r\n     15    checking whether the C compiler works... yes\r\n     16    checking for C compiler default output file name... a.out\r\n     17    checking for suffix of executables...\r\n  >> 18    checking whether we are cross compiling... configure: error: in `/private/var/folders/0s/q_y0zhfj6xdd5n7rn780zz6h001qr7/T/pytest-of-gamblin2/pytest-194/test_keep_exceptions0/tmp/spack-stage/spack-stage-wLLSsa/elfutils-0.163':\r\n  >> 19    configure: error: cannot run C compiled programs.\r\n\r\nSee build log for details:\r\n  /private/var/folders/0s/q_y0zhfj6xdd5n7rn780zz6h001qr7/T/pytest-of-gamblin2/pytest-194/test_keep_exceptions0/tmp/spack-stage/spack-stage-wLLSsa/elfutils-0.163/spack-build.out\r\n```\r\n\r\nUsers now get a chunk of the build log with the error lines highlighted.  If there are multiple errors, each will be shown with 6 lines of context before and after (with `[...]` in between the sections).  If color is enabled, the errors are highlighted in red.\r\n\r\nHopefully this means people won't need to take the extra step of opening the build log in their editor to see what happened, even if they didn't use `spack install -v`.\r\n\r\nTasks:\r\n- [x] Add some code to parse build logs for errors\r\n- [x] Make install failures display the errors from the build log if the error came from the build and not from Python.\r\n- [x] Add some color support so that the highlighted error lines for both Python and build errors are shown in red.\r\n- [x] Tests",
    "user": "tgamblin",
    "url": "https://api.github.com/repos/spack/spack/issues/5016",
    "updated_at": "2017-11-12 00:48:02",
    "created_at": "2017-08-07 23:21:43",
    "closed_at": "2017-08-22 23:14:39",
    "state": "closed",
    "title": "Show build log on build failure",
    "number": 5016,
    "milestone": "v0.11.0",
    "labels": [
        "build-environment",
        "tests",
        "error-messages"
    ],
    "id": 248558158,
    "html_url": "https://github.com/spack/spack/pull/5016",
    "assignees": [],
    "comments": 10
}