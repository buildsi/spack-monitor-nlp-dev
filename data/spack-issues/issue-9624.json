{
    "body": "I followed the documentation on [autoloading direct dependencies for packages dependent on python](https://spack.readthedocs.io/en/latest/module_file_support.html?highlight=autoload#autoload-dependencies) and now every package has it's direct dependencies autoloaded. (This happens for both lmod and tcl modules).\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ git clone https://github.com/spack/spack.git\r\n$ # follow the documented instructions linked above to add `^python: autoload: 'direct'` to `~/.spack/modules.yaml`\r\n$ spack install emacs\r\n$ module load emacs-26.1-gcc-4.8.5-6idl5st\r\n$ ml\r\n\r\nCurrently Loaded Modules:\r\n  1) pcre-8.42-gcc-4.8.5-vwvgnbn   2) ncurses-6.1-gcc-4.8.5-wkyck36   3) zlib-1.2.11-gcc-4.8.5-vhzh5cf   4) emacs-26.1-gcc-4.8.5-6idl5st\r\n```\r\n\r\n### Error Message\r\n\r\nSee above for the current, unexpected out (note that emacs and its direct dependencies are loaded).\r\nSee below for the expected output (note the lack of emacs' direct dependencies). This is the same output that I get if I don't include the `^python: autoload: 'direct'` that is suggested in the documentation.\r\n```console\r\n$ git clone https://github.com/spack/spack.git\r\n$ # follow the documented instructions linked above to add `^python: autoload: 'direct'` to `~/.spack/modules.yaml`\r\n$ spack install emacs\r\n$ module load emacs-26.1-gcc-4.8.5-6idl5st\r\n$ ml\r\n\r\nCurrently Loaded Modules:\r\n  1) emacs-26.1-gcc-4.8.5-6idl5st\r\n```\r\n\r\n### Information on your system\r\n\r\n 1. I'm running RHEL7\r\n 2. \r\n```\r\n\u2192 spack config blame modules\r\n---                                                                         modules:\r\n~/.spack/modules.yaml:17                                         enable:\r\n~/.spack/modules.yaml:18                                         - lmod\r\n~/.spack/modules.yaml:19                                         - tcl\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:19          - dotkit\r\n~/Repositories/spack/etc/spack/defaults/linux/modules.yaml:17    prefix_inspections:\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:21            bin:\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:22            - PATH\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:23            man:\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:24            - MANPATH\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:25            share/man:\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:26            - MANPATH\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:27            share/aclocal:\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:28            - ACLOCAL_PATH\r\n~/Repositories/spack/etc/spack/defaults/linux/modules.yaml:18      lib:\r\n~/Repositories/spack/etc/spack/defaults/linux/modules.yaml:19      - LD_LIBRARY_PATH\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:30            - LIBRARY_PATH\r\n~/Repositories/spack/etc/spack/defaults/linux/modules.yaml:20      lib64:\r\n~/Repositories/spack/etc/spack/defaults/linux/modules.yaml:21      - LD_LIBRARY_PATH\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:32            - LIBRARY_PATH\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:33            include:\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:34            - CPATH\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:35            lib/pkgconfig:\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:36            - PKG_CONFIG_PATH\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:37            lib64/pkgconfig:\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:38            - PKG_CONFIG_PATH\r\n~/Repositories/spack/etc/spack/defaults/modules.yaml:40            ? ''\r\n~/.spack/modules.yaml:23                                           : - CMAKE_PREFIX_PATH\r\n~/.spack/modules.yaml:26                                         lmod:\r\n~/.spack/modules.yaml:27                                           hierarchy:\r\n~/.spack/modules.yaml:27                                           - mpi\r\n~/.spack/modules.yaml:27                                           blacklist_implicits: False\r\n~/.spack/modules.yaml:27                                           verbose: False\r\n~/.spack/modules.yaml:24                                           hash_length: 7\r\n~/.spack/modules.yaml:25                                           core_compilers:\r\n~/.spack/modules.yaml:28                                           - gcc@4.8.5\r\n~/.spack/modules.yaml:29                                           ^python:\r\n~/.spack/modules.yaml:20                                             autoload: direct\r\n~/.spack/modules.yaml:21                                         tcl:\r\n~/.spack/modules.yaml:22                                           ^python:\r\n~/.spack/modules.yaml:22                                             autoload: direct\r\n~/.spack/modules.yaml:22                                           blacklist_implicits: False\r\n~/.spack/modules.yaml:22                                           verbose: False\r\n\r\n```",
    "user": "SteVwonder",
    "url": "https://api.github.com/repos/spack/spack/issues/9624",
    "updated_at": "2018-10-25 21:56:03",
    "created_at": "2018-10-24 18:23:10",
    "closed_at": "2018-10-25 21:56:03",
    "state": "closed",
    "title": "Documented feature of conditionally autoloading dependencies doesn't work",
    "number": 9624,
    "milestone": null,
    "labels": [
        "bug",
        "modules"
    ],
    "id": 373614942,
    "html_url": "https://github.com/spack/spack/issues/9624",
    "assignees": [
        "alalazo"
    ],
    "comments": 5
}