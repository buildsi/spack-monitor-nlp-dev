{
    "body": "### Steps to reproduce the issue\n\nTrying to install `py-h5py` which needs `py-pkgconfig`. The installation of `py-pkgconfig` fails with\r\n```console\r\n$  spack install -v py-pkgconfig\r\n...\r\n  File \"/usr/local/opt/python@3.9/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py\", line 127, in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 972, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 228, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 972, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 228, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 972, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 228, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 984, in _find_and_load_unlocked\r\nModuleNotFoundError: No module named 'poetry'\r\n```\r\nPackage `py-poetry-core` is installed, which is what these packages want, according to their dependency list. Trying to install `py-poetry` to fix this leads to the same error for one of the `py-poetry` dependencies, `py-crashtest`:\r\n```\r\n...\r\n  File \"/usr/local/opt/python@3.9/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py\", line 127, in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 972, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 228, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 972, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 228, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 972, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 228, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 984, in _find_and_load_unlocked\r\nModuleNotFoundError: No module named 'poetry'\r\n```\r\nSo, you can't install `py-poetry` because it needs `py-poetry` installed it seems.\r\n\r\nThere is some limited information here, where pipenv fails with the same error (at least for their release version, but fixed in master): https://github.com/pypa/pipenv/issues/4218\r\n\r\nAny suggestions on how to fix that? Was that introduced with https://github.com/spack/spack/pull/27798? Are there other upcoming developments that I could pull in? I don't really want to install poetry using homebrew, because this installs a lot more into the otherwise clean python3 installation. Note: my python was installed via homebrew, but I didn't want to add any packages there, do the rest with spack.\n\n### Error message\n\n```\r\n  File \"/usr/local/opt/python@3.9/Frameworks/Python.framework/Versions/3.9/lib/python3.9/importlib/__init__.py\", line 127, in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 972, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 228, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 972, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 228, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 972, in _find_and_load_unlocked\r\n  File \"<frozen importlib._bootstrap>\", line 228, in _call_with_frames_removed\r\n  File \"<frozen importlib._bootstrap>\", line 1030, in _gcd_import\r\n  File \"<frozen importlib._bootstrap>\", line 1007, in _find_and_load\r\n  File \"<frozen importlib._bootstrap>\", line 984, in _find_and_load_unlocked\r\nModuleNotFoundError: No module named 'poetry'\r\n```\r\n\n\n### Information on your system\n\n```\r\n* **Spack:** 0.17.1-1147-15f83b6e93\r\n* **Python:** 3.9.10\r\n* **Platform:** darwin-monterey-x86_64\r\n* **Concretizer:** clingo\r\n```\r\n\r\nPython 3.10 installed via homebrew, all other packages in a spack env.\n\n### Additional information\n\n[spack-build-env.txt](https://github.com/spack/spack/files/8173693/spack-build-env.txt)\r\n[spack-build-out.txt](https://github.com/spack/spack/files/8173694/spack-build-out.txt)\r\n\r\nNo maintainers for any of these packages.\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "climbfuji",
    "url": "https://api.github.com/repos/spack/spack/issues/29308",
    "updated_at": "2022-03-05 20:04:18",
    "created_at": "2022-03-02 23:54:51",
    "closed_at": "None",
    "state": "open",
    "title": "Installation issue: py-pkgconfig needs py-poetry, not py-poetry-core?",
    "number": 29308,
    "milestone": null,
    "labels": [
        "build-error",
        "unreproducible"
    ],
    "id": 1157813907,
    "html_url": "https://github.com/spack/spack/issues/29308",
    "assignees": [
        "adamjstewart"
    ],
    "comments": 4
}