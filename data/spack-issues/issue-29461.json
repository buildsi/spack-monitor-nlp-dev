{
    "body": "### Steps to reproduce\n\nFirst, create Dockerfile.\r\n\r\n```\r\nFROM registry.access.redhat.com/ubi8:latest\r\nLABEL version=\"2.7\"\r\n\r\nENV DOCKERFILE_BASE=rhel              \\\r\n    DOCKERFILE_DISTRO=rhel            \\\r\n    DOCKERFILE_DISTRO_VERSION=8       \\\r\n    DEBIAN_FRONTEND=noninteractive    \\\r\n    CURRENTLY_BUILDING_DOCKER_IMAGE=1 \\\r\n    SPACK_ROOT=/opt/spack             \\\r\n    container=docker\r\n\r\n# Prepare typical development environment\r\nRUN dnf update -y \\\r\n && dnf install -y \\\r\n        automake \\\r\n        cmake \\\r\n        curl \\\r\n        findutils \\\r\n        gcc-c++ \\\r\n        gcc \\\r\n        gcc-gfortran \\\r\n        git \\\r\n        gnupg2 \\\r\n        hostname \\\r\n        iproute \\\r\n        #Lmod \\\r\n        make \\\r\n        patch \\\r\n        python36 \\\r\n        python36-devel \\\r\n        python39 \\\r\n        python39-pip \\\r\n        python39-setuptools \\\r\n        python39-devel \\\r\n        tcl \\\r\n        unzip \\\r\n        which \\\r\n        ca-certificates \\\r\n        tar \\\r\n        gzip \\\r\n        unzip \\\r\n        bzip2 \\\r\n        xz \\\r\n        zstd \\\r\n        zlib \\\r\n        gpg \\\r\n        libX11-devel \\\r\n        m4 \\\r\n && pip-3.9 install --trusted-host pypi.org --trusted-host files.pythonhosted.org --proxy foo:80 boto3 \\\r\n && rm -rf /var/cache/dnf /var/cache/yum \\\r\n && dnf clean all\r\n\r\n# Prepare tools for proxy use and certificate trust \r\nRUN update-ca-trust extract\r\n# RUN printf \"insecure\\nproxy = foo:80\\nnoproxy = bar\" > ~/.curlrc\r\n\r\n# Clone Spack\r\nRUN mkdir -p $SPACK_ROOT\r\nRUN git clone https://github.com/spack/spack.git --single-branch --branch v0.17 $SPACK_ROOT\r\n\r\n# Symbolically link Spack within the container\r\nRUN ln -s $SPACK_ROOT/share/spack/docker/entrypoint.bash \\\r\n          /usr/local/bin/docker-shell \\\r\n && ln -s $SPACK_ROOT/share/spack/docker/entrypoint.bash \\\r\n          /usr/local/bin/interactive-shell \\\r\n && ln -s $SPACK_ROOT/share/spack/docker/entrypoint.bash \\\r\n          /usr/local/bin/spack-env\r\n\r\n# Spack cleaning\r\nRUN mkdir -p /root/.spack \\\r\n && cp $SPACK_ROOT/share/spack/docker/modules.yaml \\\r\n        /root/.spack/modules.yaml \\\r\n && rm -rf /root/*.* /run/nologin $SPACK_ROOT/.git\r\n\r\n# Workaround issue\r\n# https://superuser.com/questions/1241548/\r\n#     xubuntu-16-04-ttyname-failed-inappropriate-ioctl-for-device#1253889\r\nRUN [ -f ~/.profile ]                                               \\\r\n && sed -i 's/mesg n/( tty -s \\\\&\\\\& mesg n || true )/g' ~/.profile \\\r\n || true\r\n\r\n# Prepare entry environment \r\nWORKDIR /root\r\nSHELL [\"docker-shell\"]\r\nENTRYPOINT [\"/bin/bash\", \"/opt/spack/share/spack/docker/entrypoint.bash\"]\r\nCMD [\"interactive-shell\"]\r\n```\r\n\r\nThen, go into the container and get it to bootstrap the concretizer.\r\n\r\n```console\r\n# time spack -d spec zlib\r\n```\r\n\r\nI would like for it to use the pre-built Clingo binaries but it, instead, will bootstrap it from source. I verified that I can `curl` on the URL given in the output (see below).\r\n\r\n```console\r\n# curl -O https://mirror.spack.io/bootstrap/github-actions/v0.1/build_cache/index.json\r\n```\r\n\r\nI am not sure what to check next.\n\n### Error message\n\n```console\r\n[root@749ee77d34a4 ~]# time spack -d spec zlib\r\n==> [2022-03-11-15:08:36.047624] Imported spec from built-in commands\r\n==> [2022-03-11-15:08:36.048598] Imported spec from built-in commands\r\nInput spec\r\n--------------------------------\r\nzlib\r\n\r\nConcretized\r\n--------------------------------\r\n==> [2022-03-11-15:08:36.050371] Reading config file /opt/spack/etc/spack/defaults/config.yaml\r\n==> [2022-03-11-15:08:36.076159] Reading config file /opt/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2022-03-11-15:08:36.088481] Reading config file /opt/spack/etc/spack/defaults/config.yaml\r\n==> [2022-03-11-15:08:36.111342] DATABASE LOCK TIMEOUT: 3s\r\n==> [2022-03-11-15:08:36.111438] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2022-03-11-15:08:36.111876] Reading config file /opt/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2022-03-11-15:08:36.121550] DATABASE LOCK TIMEOUT: 3s\r\n==> [2022-03-11-15:08:36.121638] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2022-03-11-15:08:36.121730] [BOOTSTRAP CONFIG SCOPE] name=_builtin\r\n==> [2022-03-11-15:08:36.122149] [BOOTSTRAP CONFIG SCOPE] name=defaults, path=/opt/spack/etc/spack/defaults\r\n==> [2022-03-11-15:08:36.122187] [BOOTSTRAP CONFIG SCOPE] name=defaults/linux, path=/opt/spack/etc/spack/defaults/linux\r\n==> [2022-03-11-15:08:36.122220] [BOOTSTRAP CONFIG SCOPE] name=bootstrap, path=/root/.spack/bootstrap/config\r\n==> [2022-03-11-15:08:36.122245] [BOOTSTRAP CONFIG SCOPE] name=bootstrap/linux, path=/root/.spack/bootstrap/config/linux\r\n==> [2022-03-11-15:08:36.211959] '/usr/bin/gfortran' '--version'\r\n==> [2022-03-11-15:08:36.212317] '/usr/bin/gfortran' '--version'\r\n==> [2022-03-11-15:08:36.213451] '/usr/bin/gfortran' '--version'\r\n==> [2022-03-11-15:08:36.213091] '/usr/bin/gfortran' '--version'\r\n==> [2022-03-11-15:08:36.223385] '/bin/gfortran' '--version'\r\n==> [2022-03-11-15:08:36.224020] '/bin/gfortran' '--version'\r\n==> [2022-03-11-15:08:36.227796] '/bin/gfortran' '--version'\r\n==> [2022-03-11-15:08:36.228574] '/bin/gfortran' '--version'\r\n==> [2022-03-11-15:08:36.233372] '/usr/bin/gcc' '--version'\r\n==> [2022-03-11-15:08:36.236916] '/usr/bin/g++' '--version'\r\n==> [2022-03-11-15:08:36.238407] '/usr/bin/gfortran' '-dumpversion'                                                                    [240/429]\r\n==> [2022-03-11-15:08:36.238692] '/usr/bin/gfortran' '-dumpversion'\r\n==> [2022-03-11-15:08:36.247768] '/usr/bin/gcc' '-dumpversion'\r\n==> [2022-03-11-15:08:36.248953] '/usr/bin/gfortran' '-dumpfullversion'\r\n==> [2022-03-11-15:08:36.254286] '/usr/bin/gcc' '-dumpfullversion'\r\n==> [2022-03-11-15:08:36.257069] '/usr/bin/gfortran' '-dumpfullversion'\r\n==> [2022-03-11-15:08:36.263145] '/bin/gfortran' '-dumpversion'\r\n==> [2022-03-11-15:08:36.266171] '/bin/gfortran' '-dumpversion'\r\n==> [2022-03-11-15:08:36.267630] '/bin/gfortran' '-dumpfullversion'\r\n==> [2022-03-11-15:08:36.268398] '/bin/gcc' '--version'\r\n==> [2022-03-11-15:08:36.278656] '/bin/gfortran' '-dumpfullversion'\r\n==> [2022-03-11-15:08:36.282507] '/bin/gcc' '-dumpversion'\r\n==> [2022-03-11-15:08:36.285364] '/usr/bin/g++' '-dumpversion'\r\n==> [2022-03-11-15:08:36.287114] '/bin/gcc' '-dumpfullversion'\r\n==> [2022-03-11-15:08:36.293967] '/usr/bin/g++' '-dumpfullversion'\r\n==> [2022-03-11-15:08:36.298842] '/bin/g++' '--version'\r\n==> [2022-03-11-15:08:36.302904] '/bin/g++' '-dumpversion'\r\n==> [2022-03-11-15:08:36.307230] '/bin/g++' '-dumpfullversion'\r\n==> [2022-03-11-15:08:36.310628] Couldn't get version for compiler /usr/bin/gfortran\r\n==> [2022-03-11-15:08:36.310797] Couldn't get version for compiler /bin/gfortran\r\n==> [2022-03-11-15:08:36.311047] Couldn't get version for compiler /usr/bin/gfortran\r\n==> [2022-03-11-15:08:36.311095] Couldn't get version for compiler /bin/gfortran\r\n==> [2022-03-11-15:08:36.311916] Error while executing candidate compiler /usr/bin/cc\r\nTypeError: expected string or bytes-like object\r\n==> [2022-03-11-15:08:36.312650] Error while executing candidate compiler /bin/cc\r\nTypeError: expected string or bytes-like object\r\n==> [2022-03-11-15:08:36.312924] Couldn't get version for compiler /usr/bin/gfortran\r\n==> [2022-03-11-15:08:36.314017] Couldn't get version for compiler /bin/gfortran\r\n==> [2022-03-11-15:08:36.314253] Couldn't get version for compiler /usr/bin/gfortran\r\n==> [2022-03-11-15:08:36.314440] Couldn't get version for compiler /bin/gfortran\r\n==> [2022-03-11-15:08:36.344380] [BOOTSTRAP ROOT SPEC] clingo-bootstrap@spack+python %gcc target=x86_64\r\n==> [2022-03-11-15:08:36.344549] [BOOTSTRAP MODULE clingo] Try importing from Python\r\n==> [2022-03-11-15:08:36.345232] Reading config file /opt/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2022-03-11-15:08:36.356481] Bootstrapping clingo from pre-built binaries\r\n==> [2022-03-11-15:08:36.358846] Reading config file /opt/spack/etc/spack/defaults/config.yaml\r\n==> [2022-03-11-15:08:36.385430] Reading config file /opt/spack/etc/spack/defaults/mirrors.yaml\r\n==> [2022-03-11-15:08:36.787761] Fetching index from https://mirror.spack.io/bootstrap/github-actions/v0.1/build_cache/index.json\r\n==> [2022-03-11-15:08:37.280058] DATABASE LOCK TIMEOUT: 3s\r\n==> [2022-03-11-15:08:37.280196] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2022-03-11-15:08:37.309394] Imported buildcache from built-in commands\r\n==> [2022-03-11-15:08:37.313504] Imported buildcache from built-in commands\r\n==> [2022-03-11-15:08:52.763543] AttributeError: 'NoneType' object has no attribute 'add_default_arg'\r\n==> [2022-03-11-15:08:52.768052] Reading config file /opt/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2022-03-11-15:08:52.781193] Reading config file /root/.spack/bootstrap/config/linux/bootstrap.yaml\r\n==> [2022-03-11-15:08:52.789451] Bootstrapping clingo from sources\r\n==> [2022-03-11-15:08:52.821702] '/bin/cmake' '--version'\r\n\r\n```\n\n### Information on your system\n\n```console\r\n# spack debug report\r\n* **Spack:** 0.17.0\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-rhel8-haswell\r\n* **Concretizer:** clingo\r\n```\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "amagela",
    "url": "https://api.github.com/repos/spack/spack/issues/29461",
    "updated_at": "2022-03-11 16:43:53",
    "created_at": "2022-03-11 16:43:53",
    "closed_at": "None",
    "state": "open",
    "title": "Cannot bootstrap clingo from pre-built binaries within UBI-8",
    "number": 29461,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1166633462,
    "html_url": "https://github.com/spack/spack/issues/29461",
    "assignees": [],
    "comments": 0
}