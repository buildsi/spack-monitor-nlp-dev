{
    "body": "I tried to install mathematica from the builtin recipe using a fresh installation of spack v0.13.0 with all default settings on Ubuntu 18.04. First, I got an error when spack was trying to copy the log file.\r\n\r\n```console\r\n$ spack -d install mathematica\r\n...\r\nlib/spack/spack/fetch_strategy.py:312 ==> [2019-11-13-11:32:44.728155] Fetching file:///home/ubuntu/downloads/Mathematica_12.0.0_LINUX.sh                                                                                                                     [150/811]\r\nlib/spack/spack/util/executable.py:159 ==> [2019-11-13-11:32:44.728941] '/usr/bin/curl' '-C' '-' '-o' '/tmp/ubuntu/spack-stage/spack-stage-mathematica-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu/Mathematica_12.0.0_LINUX.sh.part' '-f' '-D' '-' '-L' 'file:///home/ubunt\r\nu/downloads/Mathematica_12.0.0_LINUX.sh' '-#'\r\n############################################################################################################################ 100.0%\r\nlib/spack/spack/fetch_strategy.py:404 ==> [2019-11-13-11:34:42.632324] Staging unexpanded archive /tmp/ubuntu/spack-stage/spack-stage-mathematica-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu/Mathematica_12.0.0_LINUX.sh in /tmp/ubuntu/spack-stage/spack-stage-mathematic\r\na-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu/spack-src\r\nlib/spack/spack/stage.py:517 ==> [2019-11-13-11:34:42.633283] Created stage in /tmp/ubuntu/spack-stage/spack-stage-mathematica-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu\r\nlib/spack/spack/package.py:1129 ==> [2019-11-13-11:34:42.633872] No patches needed for mathematica\r\nlib/spack/spack/package.py:1667 ==> [2019-11-13-11:34:42.634350] Building mathematica [Package]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-13-11:34:42.635159] WRITE LOCK: /tmp/ubuntu/spack-stage/.lock[992830639569496916:1] [Acquiring]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-13-11:34:42.635983] WRITE LOCK: /tmp/ubuntu/spack-stage/.lock[992830639569496916:1] [Acquired]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-13-11:34:42.636686] WRITE LOCK: /sapps/spack/opt/spack/.spack-db/prefix_lock[4736572689609369841:1] [Acquiring]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-13-11:34:42.637375] WRITE LOCK: /sapps/spack/opt/spack/.spack-db/prefix_lock[4736572689609369841:1] [Acquired]\r\nlib/spack/spack/package.py:1708 ==> [2019-11-13-11:34:42.641480] Executing phase: 'install'\r\nlib/spack/spack/package.py:1883 ==> [2019-11-13-11:38:51.887352] FileNotFoundError: [Errno 2] No such file or directory: '/sapps/spack/opt/spack/linux-ubuntu18.04-haswell/gcc-7.4.0/mathematica-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu/.spack/repos'\r\nlib/spack/llnl/util/filesystem.py:353 ==> [2019-11-13-11:38:51.914965] Installing /tmp/ubuntu/spack-stage/spack-stage-mathematica-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu/spack-build-out.txt to /sapps/spack/opt/spack/linux-ubuntu18.04-haswell/gcc-7.4.0/mathematica\r\n-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu/.spack/spack-build-out.txt\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-13-11:38:51.917088] WRITE LOCK: /sapps/spack/opt/spack/.spack-db/prefix_lock[4736572689609369841:1] [Released]\r\nlib/spack/llnl/util/lock.py:334 ==> [2019-11-13-11:38:51.917919] WRITE LOCK: /tmp/ubuntu/spack-stage/.lock[992830639569496916:1] [Released]\r\nlib/spack/spack/error.py:55 ==> [2019-11-13-11:38:51.964598] Error: FileNotFoundError: [Errno 2] No such file or directory: '/sapps/spack/opt/spack/linux-ubuntu18.04-haswell/gcc-7.4.0/mathematica-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu/.spack/spack-build-out.txt'\r\n\r\n/sapps/spack/lib/spack/spack/package.py:1885, in log:\r\n       1882            # FIXME : this potentially catches too many things...\r\n       1883            tty.debug(e)\r\n       1884\r\n  >>   1885        # Archive the whole stdout + stderr for the package\r\n       1886        install(self.log_path, self.install_log_path)\r\n       1887\r\n       1888        # Archive the environment used for the build\r\n\r\nSee build log for details:\r\n  /tmp/ubuntu/spack-stage/spack-stage-mathematica-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu/spack-build-out.txt\r\n```\r\n\r\nIf I create the `.spack` directory manually in the recipe, i.e.,\r\n```python\r\ninstall_spack_dir = os.path.dirname(self.install_log_path)\r\nos.makedirs(install_spack_dir, exist_ok=True)\r\n```\r\n the installation is successful but the package is not registered because `spec.yaml` is not present in the installation directory.\r\n\r\n```console\r\n$  spack -d install mathematica\r\n...\r\n==> [2019-11-13-13:19:55.052692] Warning: Dependency missing: may be deprecated or corrupted:\r\n  /sapps/spack/opt/spack/linux-ubuntu18.04-haswell/gcc-7.4.0/mathematica-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu\r\n  Install prefix exists but contains no spec.yaml:\r\n      /sapps/spack/opt/spack/linux-ubuntu18.04-haswell/gcc-7.4.0/mathematica-12.0.0-qn3v7car65i6g3dtjgcbha5giejbjpgu\r\n==> [2019-11-13-13:19:55.053337] WRITE LOCK: /sapps/spack/opt/spack/.spack-db/lock[0:0] [Released]\r\n$ spack uninstall mathematica\r\n==> Error: mathematica does not match any installed packages.\r\n```\r\n\r\nInterestingly, the problems do not occur if I use a dummy installation script that simply creates the prefix. Then everything works as expected.",
    "user": "brisk022",
    "url": "https://api.github.com/repos/spack/spack/issues/13718",
    "updated_at": "2020-04-13 19:13:07",
    "created_at": "2019-11-13 13:33:54",
    "closed_at": "2020-04-13 19:13:07",
    "state": "closed",
    "title": "Errors installing Mathematica",
    "number": 13718,
    "milestone": null,
    "labels": [
        "bug",
        "build-error"
    ],
    "id": 522226679,
    "html_url": "https://github.com/spack/spack/issues/13718",
    "assignees": [],
    "comments": 3
}