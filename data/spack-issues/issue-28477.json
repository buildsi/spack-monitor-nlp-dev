{
    "body": "### Steps to reproduce the issue\n\nI am running into an issue with spack build of petsc+suite-sparse not finding suite-sparse during configuration:\r\n```console\r\n$ spack install petsc@3.16.1%gcc +X~batch+cgns~complex~cuda~debug+double~exodusii+fftw+giflib+hdf5+hpddm+hwloc+hypre~int64+jpeg~knl~kokkos+libpng+libyaml+memkind+metis~mkl-pardiso+mmg~moab+mpfr+mpi+mumps+openmp+p4est+parmmg+ptscotch+random123~rocm+saws+scalapack+shared+strumpack+suite-sparse+superlu-dist+tetgen+trilinos~valgrind clanguage=C\r\n\r\n==> petsc: Executing phase: 'install'\r\n[...]\r\nTESTING: check from config.libraries(/tmp/spackswinst/spack-stage/spack-stage-petsc-3.16.1-2x264ehnsj62g4u62324ejuibtsm3pns/spack-src/config/BuildSystem/config/libraries.py:157)\r\n*******************************************************************************\r\n         UNABLE to CONFIGURE with GIVEN OPTIONS    (see configure.log for details):\r\n-------------------------------------------------------------------------------\r\n--with-suitesparse-lib=['/cvmfs/hpcsw.umd.edu/spack-software/2021.11.29/linux-rhel8-zen2/gcc-9.4.0/suite-sparse-5.10.1-inp5rksh67qsfoggzgikqxw6sulxkqep/lib/libumfpack.so', '/cvmfs/hpcsw.umd.edu/spack-software/2021.11.29/linux-rhel8-zen2/gcc-9.4.0/suite-sparse-5.10.1-inp5rksh67qsfoggzgikqxw6sulxkqep/lib/libklu.so', '/cvmfs/hpcsw.umd.edu/spack-software/2021.11.29/linux-rhel8-zen2/gcc-9.4.0/suite-sparse-5.10.1-inp5rksh67qsfoggzgikqxw6sulxkqep/lib/libcholmod.so', '/cvmfs/hpcsw.umd.edu/spack-software/2021.11.29/linux-rhel8-zen2/gcc-9.4.0/suite-sparse-5.10.1-inp5rksh67qsfoggzgikqxw6sulxkqep/lib/libbtf.so', '/cvmfs/hpcsw.umd.edu/spack-software/2021.11.29/linux-rhel8-zen2/gcc-9.4.0/suite-sparse-5.10.1-inp5rksh67qsfoggzgikqxw6sulxkqep/lib/libccolamd.so', '/cvmfs/hpcsw.umd.edu/spack-software/2021.11.29/linux-rhel8-zen2/gcc-9.4.0/suite-sparse-5.10.1-inp5rksh67qsfoggzgikqxw6sulxkqep/lib/libcolamd.so', '/cvmfs/hpcsw.umd.edu/spack-software/2021.11.29/linux-rhel8-zen2/gcc-9.4.0/suite-sparse-5.10.1-inp5rksh67qsfoggzgikqxw6sulxkqep/lib/libcamd.so', '/cvmfs/hpcsw.umd.edu/spack-software/2021.11.29/linux-rhel8-zen2/gcc-9.4.0/suite-sparse-5.10.1-inp5rksh67qsfoggzgikqxw6sulxkqep/lib/libamd.so', '/cvmfs/hpcsw.umd.edu/spack-software/2021.11.29/linux-rhel8-zen2/gcc-9.4.0/suite-sparse-5.10.1-inp5rksh67qsfoggzgikqxw6sulxkqep/lib/libsuitesparseconfig.so'] and\r\n--with-suitesparse-include=['/cvmfs/hpcsw.umd.edu/spack-software/2021.11.29/linux-rhel8-zen2/gcc-9.4.0/suite-sparse-5.10.1-inp5rksh67qsfoggzgikqxw6sulxkqep/include'] did not work\r\n*******************************************************************************\r\n```\r\n\r\nDelving into this for the root cause, the configure.log shows the following error when trying to compile a test code:\r\n```console\r\nPossible ERROR while running linker: exit code 1\r\nstderr:\r\n/tmp/petsc-poqahanb/config.libraries/conftest.o: In function `_check_SuiteSparseQR_C_solve':\r\nconftest.c:(.text+0x3d): undefined reference to `SuiteSparseQR_C_solve'\r\ncollect2: error: ld returned 1 exit status\r\nLinker output before filtering:\r\n\r\n/tmp/petsc-poqahanb/config.libraries/conftest.o: In function `_check_SuiteSparseQR_C_solve':\r\nconftest.c:(.text+0x3d): undefined reference to `SuiteSparseQR_C_solve'\r\ncollect2: error: ld returned 1 exit status\r\n:\r\nLinker output after filtering:\r\n\r\n/tmp/petsc-poqahanb/config.libraries/conftest.o: In function `_check_SuiteSparseQR_C_solve':\r\nconftest.c:(.text+0x3d): undefined reference to `SuiteSparseQR_C_solve'\r\n```\r\n\r\nThe SuiteSparseQR_C_solve symbol can be found in libspqr.so from suite-sparse, but the spack recipe is not passing that specific library to the petsc build system via the --with-suitesparse-lib flag.\r\n\r\n\n\n### Information on your system\n\n```console\r\n$ spack debug report\r\n* **Spack:** 0.17.0-319-5dce4d79bd\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-rhel8-zen2\r\n* **Concretizer:** clingo\r\n```\n\n### Additional information\n\n- [configure.log](https://github.com/spack/spack/files/7890096/configure.log)\r\n- [spack-build-env.txt](https://github.com/spack/spack/files/7890097/spack-build-env.txt)\r\n- [spack-build-out.txt](https://github.com/spack/spack/files/7890098/spack-build-out.txt)\r\n\r\nMaintainers of petsc: @balay, @barrysmith, @jedbrown\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "payerle",
    "url": "https://api.github.com/repos/spack/spack/issues/28477",
    "updated_at": "2022-01-18 18:20:40",
    "created_at": "2022-01-18 15:15:07",
    "closed_at": "2022-01-18 18:20:40",
    "state": "closed",
    "title": "Installation issue: petsc",
    "number": 28477,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1107028347,
    "html_url": "https://github.com/spack/spack/issues/28477",
    "assignees": [],
    "comments": 0
}