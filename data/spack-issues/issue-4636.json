{
    "body": "When installing PETSc with intel compiler 17.0.4 and intel-mpi 2017.3 the installation fails with:\r\n```\r\n==> Error: ProcessError: Command exited with status 1:\r\n    './configure' '--prefix=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/petsc-3.7.6-miu2koexiqlfny562mxj73mts3bgcjbx' '--with-ssl=0' '--with-x=0' '--download-c2html=0' '--download-sowing=0' '--download-hwloc=0' '--with-cc=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mpi-2017.3-dfphq6kavje2olnichisvjjndtridrok/compilers_and_libraries/linux/mpi/intel64/bin/mpiicc' '--with-cxx=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mpi-2017.3-dfphq6kavje2olnichisvjjndtridrok/compilers_and_libraries/linux/mpi/intel64/bin/mpiicpc' '--with-fc=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mpi-2017.3-dfphq6kavje2olnichisvjjndtridrok/compilers_and_libraries/linux/mpi/intel64/bin/mpiifort' '--with-precision=double' '--with-scalar-type=real' '--with-shared-libraries=1' '--with-debugging=0' '--with-64-bit-indices=0' '--with-blas-lapack-lib=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mkl-2017.3.196-jyjmyutcol3veyt4bazftyqkxxzmfd7o/lib/intel64/libmkl_intel_lp64.so /blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mkl-2017.3.196-jyjmyutcol3veyt4bazftyqkxxzmfd7o/lib/intel64/libmkl_core.so /blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mkl-2017.3.196-jyjmyutcol3veyt4bazftyqkxxzmfd7o/lib/intel64/libmkl_intel_thread.so /lib64/libpthread.so /lib64/libm.so /lib64/libdl.so' '--with-scalapack-lib=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mkl-2017.3.196-jyjmyutcol3veyt4bazftyqkxxzmfd7o/lib/intel64/libmkl_scalapack_lp64.so /blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/intel-mkl-2017.3.196-jyjmyutcol3veyt4bazftyqkxxzmfd7o/lib/intel64/libmkl_blacs_intelmpi_lp64.so' '--with-scalapack=1' '--with-metis=1' '--with-metis-dir=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/metis-5.1.0-fdje6ja5dohqquxqmbpxjcter3vjyc7f' '--with-boost=0' '--with-hdf5=1' '--with-hdf5-dir=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/hdf5-1.10.1-vzncl5hvkrdioypigebpug7uw3hbto5z' '--with-hypre=1' '--with-hypre-dir=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/hypre-2.11.2-trdb366y6tblvrsrl6ayny5fchl3d5ox' '--with-parmetis=1' '--with-parmetis-dir=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/parmetis-4.0.3-2g7u7p2tq4krqcvsc6msdacfhiobcbe5' '--with-mumps=0' '--with-trilinos=0' '--with-superlu_dist-include=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/superlu-dist-5.1.3-dljju447aeatnvhvmdizfjq7vxtwt7r2/include' '--with-superlu_dist-lib=/blues/gpfs/home/software/spack-0.10.1/opt/spack/linux-centos7-x86_64/intel-17.0.4/superlu-dist-5.1.3-dljju447aeatnvhvmdizfjq7vxtwt7r2/lib/libsuperlu_dist.a' '--with-superlu_dist=1'\r\n/blues/gpfs/home/software/spack-0.10.1/var/spack/repos/builtin/packages/petsc/package.py:228, in install:\r\n     162      def install(self, spec, prefix):\r\n     163          options = ['--with-ssl=0',\r\n     164                     '--with-x=0',\r\n     165                     '--download-c2html=0',\r\n     166                     '--download-sowing=0',\r\n     167                     '--download-hwloc=0']\r\n     168          options.extend(self.mpi_dependent_options())\r\n     169          options.extend([\r\n     170              '--with-precision=%s' % (\r\n     171                  'double' if '+double' in spec else 'single'),\r\n     172              '--with-scalar-type=%s' % (\r\n     173                  'complex' if '+complex' in spec else 'real'),\r\n     174              '--with-shared-libraries=%s' % ('1' if '+shared' in spec else '0'),\r\n     175              '--with-debugging=%s' % ('1' if '+debug' in spec else '0'),\r\n     176              '--with-64-bit-indices=%s' % ('1' if '+int64' in spec else '0')\r\n     177          ])\r\n     178          # Make sure we use exactly the same Blas/Lapack libraries\r\n     179          # across the DAG. To that end list them explicitly\r\n     180          lapack_blas = spec['lapack'].libs + spec['blas'].libs\r\n     181          options.extend([\r\n     182              '--with-blas-lapack-lib=%s' % lapack_blas.joined()\r\n     183          ])\r\n     184  \r\n     185          if 'trilinos' in spec:\r\n     186              options.append('--with-cxx-dialect=C++11')\r\n     187  \r\n     188          # Help PETSc pick up Scalapack from MKL:\r\n     189          if 'scalapack' in spec:\r\n     190              scalapack = spec['scalapack'].libs\r\n     191              options.extend([\r\n     192                  '--with-scalapack-lib=%s' % scalapack.joined(),\r\n     193                  '--with-scalapack=1'\r\n     194              ])\r\n     195          else:\r\n     196              options.extend([\r\n     197                  '--with-scalapack=0'\r\n     198              ])\r\n     199  \r\n     200          # Activates library support if needed\r\n     201          for library in ('metis', 'boost', 'hdf5', 'hypre', 'parmetis',\r\n     202                          'mumps', 'trilinos'):\r\n     203              options.append(\r\n     204                  '--with-{library}={value}'.format(\r\n     205                      library=library, value=('1' if library in spec else '0'))\r\n     206              )\r\n     207              if library in spec:\r\n     208                  options.append(\r\n     209                      '--with-{library}-dir={path}'.format(\r\n     210                          library=library, path=spec[library].prefix)\r\n     211                  )\r\n     212          # PETSc does not pick up SuperluDist from the dir as they look for\r\n     213          # superlu_dist_4.1.a\r\n     214          if 'superlu-dist' in spec:\r\n     215              options.extend([\r\n     216                  '--with-superlu_dist-include=%s' %\r\n     217                  spec['superlu-dist'].prefix.include,\r\n     218                  '--with-superlu_dist-lib=%s' %\r\n     219                  join_path(spec['superlu-dist'].prefix.lib,\r\n     220                            'libsuperlu_dist.a'),\r\n     221                  '--with-superlu_dist=1'\r\n     222              ])\r\n     223          else:\r\n     224              options.append(\r\n     225                  '--with-superlu_dist=0'\r\n     226              )\r\n     227  \r\n  >> 228          configure('--prefix=%s' % prefix, *options)\r\n     229  \r\n     230          # PETSc has its own way of doing parallel make.\r\n     231          make('MAKE_NP=%s' % make_jobs, parallel=False)\r\n     232          make(\"install\")\r\n     233  \r\n     234          # solve Poisson equation in 2D to make sure nothing is broken:\r\n     235          if ('mpi' in spec) and self.run_tests:\r\n     236              with working_dir('src/ksp/ksp/examples/tutorials'):\r\n     237                  env['PETSC_DIR'] = self.prefix\r\n     238                  cc = Executable(spec['mpi'].mpicc)\r\n     239                  cc('ex50.c', '-I%s' % prefix.include, '-L%s' % prefix.lib,\r\n     240                     '-lpetsc', '-lm', '-o', 'ex50')\r\n     241                  run = Executable(join_path(spec['mpi'].prefix.bin, 'mpirun'))\r\n     242                  run('ex50', '-da_grid_x', '4', '-da_grid_y', '4')\r\n     243                  if 'superlu-dist' in spec:\r\n     244                      run('ex50',\r\n     245                          '-da_grid_x', '4',\r\n     246                          '-da_grid_y', '4',\r\n     247                          '-pc_type', 'lu',\r\n     248                          '-pc_factor_mat_solver_package', 'superlu_dist')\r\n     249  \r\n     250                  if 'mumps' in spec:\r\n     251                      run('ex50',\r\n     252                          '-da_grid_x', '4',\r\n     253                          '-da_grid_y', '4',\r\n     254                          '-pc_type', 'lu',\r\n     255                          '-pc_factor_mat_solver_package', 'mumps')\r\n     256  \r\n     257                  if 'hypre' in spec:\r\n     258                      run('ex50',\r\n     259                          '-da_grid_x', '4',\r\n     260                          '-da_grid_y', '4',\r\n     261                          '-pc_type', 'hypre',\r\n     262                          '-pc_hypre_type', 'boomeramg')\r\n\r\nSee build log for details:\r\n  /tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/spack-build.out\r\n```\r\nlooking at the spack-build.out does not provide any clues. \r\nA lot of testing messages, here are some of the last ones:\r\n```\r\nTESTING: alternateConfigureLibrary from config.packages.Triangle(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/package.py:742)\r\nTESTING: alternateConfigureLibrary from config.packages.boost(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/package.py:742)\r\nTESTING: alternateConfigureLibrary from config.packages.tetgen(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/package.py:742)\r\nTESTING: locateCMake from config.packages.cmake(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/packages/cmake.py:33)\r\nTESTING: alternateConfigureLibrary from config.packages.alquimia(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/package.py:742)\r\nTESTING: alternateConfigureLibrary from config.packages.unittestcpp(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/package.py:742)\r\nTESTING: configureScalarType from PETSc.options.scalarTypes(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/PETSc/options/scalarTypes.py:37)\r\nTESTING: configurePrecision from PETSc.options.scalarTypes(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/PETSc/options/scalarTypes.py:77)\r\nTESTING: alternateConfigureLibrary from config.packages.opencl(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/package.py:742)\r\nTESTING: alternateConfigureLibrary from config.packages.viennacl(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/package.py:742)\r\nTESTING: alternateConfigureLibrary from config.packages.fblaslapack(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/package.py:742)\r\nTESTING: alternateConfigureLibrary from config.packages.f2cblaslapack(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/package.py:742)\r\nTESTING: configureLibrary from config.packages.BlasLapack(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/packages/BlasLapack.py:333)\r\nTESTING: checkLib from config.packages.BlasLapack(/tmp/ssergien/spack-stage/spack-stage-BSum7H/petsc-3.7.6/config/BuildSystem/config/packages/BlasLapack.py:106)\r\n```\r\n",
    "user": "ssergien",
    "url": "https://api.github.com/repos/spack/spack/issues/4636",
    "updated_at": "2017-08-16 17:21:08",
    "created_at": "2017-06-29 01:15:33",
    "closed_at": "2017-08-16 17:21:08",
    "state": "closed",
    "title": "spec['blas'].libs missing OpenMP libraries for intel-mkl%intel+openmp",
    "number": 4636,
    "milestone": null,
    "labels": [
        "build-error",
        "blas-lapack-scalapack",
        "intel"
    ],
    "id": 239340239,
    "html_url": "https://github.com/spack/spack/issues/4636",
    "assignees": [],
    "comments": 14
}