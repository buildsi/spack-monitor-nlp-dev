{
    "body": "imlib2 (https://sourceforge.net/projects/enlightenment/files/imlib2-src/1.7.1/) uses pkg-config. Without pkg-config it tries to use the system pkg-config at /usr/bin/pkg-config. This leads to errors such as \r\n```\r\n#14 1923.9   >> 95    configure: error: in `/tmp/root/spack-stage/spack-stage-imlib2-1.6.1\r\n#14 1923.9            -7c5wakn4gyfz6q34uwlt5n4zjucw2w7e/spack-src':\r\n#14 1923.9   >> 96    configure: error: The pkg-config script could not be found or is too\r\n#14 1923.9             old.  Make sure it\r\n#14 1923.9      97    is in your PATH or set the PKG_CONFIG environment variable to the fu\r\n#14 1923.9            ll\r\n#14 1923.9      98    path to pkg-config.\r\n```\r\nwhen pkg-config cannot be found. This test system, based on amd64/debian:testing-20210408-slim, had a pkg-config installed by spack but not system-wide available and was therefore not made available to the imlib2 build withou the explicit build dependency.\r\n\r\nWhile here, I also updated to include imlib2@1.7.0 and imlib2@1.7.1.\r\n\r\nImlib2 has direct dependents feh, giblib, scrot, w3m. I tested building each of these against both imlib2@1.7.0 and imlib2@1.7.1 on a current spack develop 37ad6a862 with %gcc@10.3.0 on linux-ubuntu21.04-skylake with the following results:\r\n- feh ^imlib2@1.7.0: builds fine\r\n- feh ^imlib2@1.7.1: builds fine\r\n- giblib ^imlib2@1.7.0: builds fine\r\n- giblib ^imlib2@1.7.1: builds fine\r\n- w3m ^imlib2@1.7.0: builds fine\r\n- w3m ^imlib2@1.7.1: builds fine\r\n- scrot ^imlib2@1.7.0 as well as scrot ^imlib2@1.7.1\r\n```\r\n==> Installing scrot-1.5-3w66dp7mmv3cjpuywwbe652iduve2ayl\r\n==> No binary for scrot-1.5-3w66dp7mmv3cjpuywwbe652iduve2ayl found: installing from source\r\n==> Fetching https://mirror.spack.io/_source-cache/archive/87/87afba3998aac097f13231f3b0452c21188bf4b5cc6ac0747693a1da1a0ae40f.tar.gz\r\n==> No patches needed for scrot\r\n==> scrot: Executing phase: 'autoreconf'\r\n==> Error: AttributeError: module 'spack.pkg.builtin.scrot' has no attribute 'autoreconf'\r\n\r\n/home/wdconinc/git/spack/lib/spack/spack/build_systems/autotools.py:277, in autoreconf:\r\n        274            # --install, --verbose, --force\r\n        275            autoreconf_args = ['-ivf']\r\n        276            autoreconf_args += self.autoreconf_search_path_args\r\n  >>    277            autoreconf_args += self.autoreconf_extra_args\r\n        278            m.autoreconf(*autoreconf_args)\r\n\r\nSee build log for details:\r\n  /home/wdconinc/.spack/stage/spack-stage-scrot-1.5-3w66dp7mmv3cjpuywwbe652iduve2ayl/spack-build-out.txt\r\n```\r\nwhich seems to be a bug in autotools that is not relevant her.\r\n\r\nChangelogs for imlib2 @1.7.0 and 1.7.1 for the benefit of maintainer @TheQueasle\r\n```\r\n***\r\n*** Version 1.7.1 ***\r\n***\r\n\r\nDaniel Kolesa (1):\r\n      Fix big endian build\r\n\r\nKim Woelders (6):\r\n      rend.c: Fix __imlib_generic_render() when jump != 0\r\n      grab.c: Support 30bpp display in __imlib_GrabXImageToRGBA()\r\n      WEBP loader: Add initial signature check\r\n      XPM loader: Get transparency right when doing header-only loading\r\n      Silence a couple of sign-compare warnings\r\n      1.7.1\r\n\r\n\r\n***\r\n*** Version 1.7.0 ***\r\n***\r\n\r\nAlexander Volkov (3):\r\n      GIF loader: Don't close file descriptor twice\r\n      Introduce imlib_load_image_from_fd()\r\n      Don't rescan loaders\r\n\r\nKim Woelders (49):\r\n      XPM loader: Major speedup for cpp > 2\r\n      imlib2_load: Properly check non-full loads (load data too)\r\n      imlib2_load: Use getopt()\r\n      imlib2_load: Add repeated load option\r\n      Simplify __imlib_FileExtension()\r\n      Refactor many __imlib_File...() functions to use common __imlib_FileStat()\r\n      Drop the __imlib_IsRealFile() file check in __imlib_File...() functions\r\n      image.c: Add some space for readability\r\n      image.c: Remove some unnecessary clearing of calloc'ed structs\r\n      image.c: Rework some obscure file name stuff in __imlib_SaveImage()\r\n      image.c: Don't strdup() real_name when not necessary in __imlib_LoadImage()\r\n      image.c: Use real_file to get file time\r\n      image.c: Introduce __imlib_ErrorFromErrno()\r\n      image.c: Use loader return value, not im->w to determine load success\r\n      Loader cleanups\r\n      Saver cleanups\r\n      image.c/h: Cleanups\r\n      image.c: Move image tag functions to separate file\r\n      image.c: Move loader functions to separate file\r\n      image.c: Enable non-dirty pixmap cache cleaning\r\n      image.c: Minor refactoring of pixmap cache cleaners\r\n      image.c: Move data_memory_func assignment to better place\r\n      imlib2_view: Various tweaks\r\n      Fix loader cleanup breakage (gif)\r\n      image.c: Remove redundant pixmap unref\r\n      image.c: Add infrastructure to simplify progress handling\r\n      Loaders: Simplify/fix progress handling\r\n      Savers: Simplify progress handling\r\n      Introduce __imlib_LoadEmbedded()\r\n      Introduce __imlib_LoaderSetFormats()\r\n      Make ImlibLoader struct opaque\r\n      autogen.sh: Add -n as alternative to NOCONFIGURE\r\n      Fix enum conversion warnings (gcc10)\r\n      JPG, PNG loaders: Avoid clobber warnings\r\n      Add a couple of consts\r\n      TIFF loader: Minor speedup\r\n      ID3 loader: Some mostly cosmetic rearrangements\r\n      GZ, BZ2 loaders: Accept more file names\r\n      __imlib_FileExtension: Use basename if there are no dots\r\n      Revert \"JPG, PNG loaders: Avoid clobber warnings\"\r\n      JPG, PNG loaders: Avoid clobber warnings - Take N+1\r\n      Add infrastructure for new loader entry - load2()\r\n      Move loaders to load2()\r\n      Reduce number of stat() calls during load\r\n      configure.ac: Drop initial config.cache removal\r\n      imlib2_load: Optionally use imlib_load_image_fd()\r\n      Fix build without X11\r\n      Remove a couple of unused includes\r\n      1.7.0\r\n\r\nTobias Stoeckmann (2):\r\n      ICO loader: Do not crash on invalid files\r\n      ICO loader: Handle malloc failures\r\n```",
    "user": "wdconinc",
    "url": "https://api.github.com/repos/spack/spack/issues/25030",
    "updated_at": "2021-09-25 16:00:22",
    "created_at": "2021-07-22 04:05:56",
    "closed_at": "2021-08-02 07:53:19",
    "state": "closed",
    "title": "[imlib2] depends_on pkg-config, type = build; and new versions",
    "number": 25030,
    "milestone": null,
    "labels": [
        "new-version",
        "dependencies",
        "update-package"
    ],
    "id": 950281514,
    "html_url": "https://github.com/spack/spack/pull/25030",
    "assignees": [
        "haampie"
    ],
    "comments": 4
}