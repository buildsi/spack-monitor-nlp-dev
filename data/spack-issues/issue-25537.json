{
    "body": "### Steps to reproduce\n\nI've created an environment including ALL R packages (through `$ spack add $(spack list r-*)`) with the following config:\r\n```yaml\r\nspack:\r\n  concretization: together\r\n  config:\r\n    concretizer: clingo\r\n  view: true\r\n  packages:\r\n    r:\r\n      variants: +X+rmath\r\n  specs:\r\n  ...\r\n```\r\nI'd like to concretize everything together in order to have one single package version if possible.\n\n### Error message\n\nHowever, I get the following error when concretizing:\r\n\r\n```bash\r\n$ spack -d --stacktrace concretize\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2021-08-20-14:03:48.623104] Imported concretize from built-in commands\r\nlib/spack/spack/cmd/__init__.py:122 ==> [2021-08-20-14:03:48.623944] Imported concretize from built-in commands\r\nlib/spack/spack/config.py:989 ==> [2021-08-20-14:03:48.854255] Reading config file /usr/local/spack/var/spack/environments/r-4/spack.yaml\r\nlib/spack/spack/config.py:989 ==> [2021-08-20-14:03:48.999403] Reading config file /usr/local/spack/etc/spack/defaults/bootstrap.yaml\r\nlib/spack/spack/config.py:989 ==> [2021-08-20-14:03:49.015392] Reading config file /usr/local/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/database.py:371 ==> [2021-08-20-14:03:49.050570] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:375 ==> [2021-08-20-14:03:49.051072] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/config.py:989 ==> [2021-08-20-14:03:49.052297] Reading config file /usr/local/spack/etc/spack/defaults/bootstrap.yaml\r\nlib/spack/spack/database.py:371 ==> [2021-08-20-14:03:49.069085] DATABASE LOCK TIMEOUT: 3s\r\nlib/spack/spack/database.py:375 ==> [2021-08-20-14:03:49.069577] PACKAGE LOCK TIMEOUT: No timeout\r\nlib/spack/spack/bootstrap.py:402 ==> [2021-08-20-14:03:49.070025] [BOOTSTRAP CONFIG SCOPE] name=_builtin\r\nlib/spack/spack/bootstrap.py:414 ==> [2021-08-20-14:03:49.071512] [BOOTSTRAP CONFIG SCOPE] name=defaults, path=/usr/local/spack/etc/spack/defaults\r\nlib/spack/spack/bootstrap.py:415 ==> [2021-08-20-14:03:49.072101] [BOOTSTRAP CONFIG SCOPE] name=defaults/linux, path=/usr/local/spack/etc/spack/defaults/linux\r\nlib/spack/spack/bootstrap.py:414 ==> [2021-08-20-14:03:49.072614] [BOOTSTRAP CONFIG SCOPE] name=system, path=/etc/spack\r\nlib/spack/spack/bootstrap.py:415 ==> [2021-08-20-14:03:49.073029] [BOOTSTRAP CONFIG SCOPE] name=system/linux, path=/etc/spack/linux\r\nlib/spack/spack/bootstrap.py:414 ==> [2021-08-20-14:03:49.073473] [BOOTSTRAP CONFIG SCOPE] name=site, path=/usr/local/spack/etc/spack\r\nlib/spack/spack/bootstrap.py:415 ==> [2021-08-20-14:03:49.073825] [BOOTSTRAP CONFIG SCOPE] name=site/linux, path=/usr/local/spack/etc/spack/linux\r\nlib/spack/spack/bootstrap.py:414 ==> [2021-08-20-14:03:49.074145] [BOOTSTRAP CONFIG SCOPE] name=user, path=/usr/local/spack/.spack\r\nlib/spack/spack/bootstrap.py:415 ==> [2021-08-20-14:03:49.074502] [BOOTSTRAP CONFIG SCOPE] name=user/linux, path=/usr/local/spack/.spack/linux\r\nlib/spack/spack/bootstrap.py:465 ==> [2021-08-20-14:03:49.100824] [BOOTSTRAP ROOT SPEC] clingo: clingo-bootstrap@spack+python %gcc target=x86_64\r\nlib/spack/spack/bootstrap.py:300 ==> [2021-08-20-14:03:49.101364] [BOOTSTRAP MODULE clingo] Try importing from Python\r\nlib/spack/spack/config.py:989 ==> [2021-08-20-14:03:49.102323] Reading config file /usr/local/spack/etc/spack/defaults/bootstrap.yaml\r\nlib/spack/spack/config.py:989 ==> [2021-08-20-14:03:49.203053] Reading config file /usr/local/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/bootstrap.py:85 ==> [2021-08-20-14:03:49.319866] [BOOTSTRAP MODULE clingo] The installed spec \"clingo-bootstrap@spack+python %gcc target=x86_64 ^python@3.8 /kt74l7kjzrlp3cgtj2576o33mhsrgyrw\" provides the \"clingo\" Python module\r\nlib/spack/spack/config.py:989 ==> [2021-08-20-14:03:49.320304] Reading config file /usr/local/spack/etc/spack/defaults/repos.yaml\r\nlib/spack/spack/config.py:989 ==> [2021-08-20-14:03:52.286540] Reading config file /usr/local/spack/.spack/linux/compilers.yaml\r\nlib/spack/spack/config.py:989 ==> [2021-08-20-14:03:52.293348] Reading config file /usr/local/spack/etc/spack/defaults/config.yaml\r\nlib/spack/spack/config.py:989 ==> [2021-08-20-14:03:52.506650] Reading config file /usr/local/spack/etc/spack/defaults/packages.yaml\r\nlib/spack/spack/solver/asp.py:203 ==> [2021-08-20-14:04:20.836976] The following constraints are unsatisfiable:\r\n  condition(3292)\r\n  condition(4055)\r\n  condition(6655)\r\n  dependency_condition(3292,\"r-aer\",\"r-car\")\r\n  dependency_condition(4055,\"r-car\",\"r-pbkrtest\")\r\n  dependency_condition(6655,\"r-pbkrtest\",\"r-lme4\")\r\n  dependency_type(3292,\"build\")\r\n  dependency_type(4055,\"build\")\r\n  dependency_type(6655,\"build\")\r\n  imposed_constraint(6655,\"version_satisfies\",\"r-lme4\",\"1.1.10:\")\r\n  root(\"r-aer\")\r\nlib/spack/spack/concretize.py:737 ==> [2021-08-20-14:04:20.842562] Error: Unsatisfiable spec.\r\nTraceback (most recent call last):\r\n  File \"/usr/local/spack/lib/spack/spack/main.py\", line 797, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/usr/local/spack/lib/spack/spack/main.py\", line 525, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/usr/local/spack/lib/spack/spack/cmd/concretize.py\", line 37, in concretize\r\n    concretized_specs = env.concretize(force=args.force, tests=tests)\r\n  File \"/usr/local/spack/lib/spack/spack/environment.py\", line 1134, in concretize\r\n    return self._concretize_together(tests=tests)\r\n  File \"/usr/local/spack/lib/spack/spack/environment.py\", line 1173, in _concretize_together\r\n    concrete_specs = spack.concretize.concretize_specs_together(\r\n  File \"/usr/local/spack/lib/spack/spack/concretize.py\", line 728, in concretize_specs_together\r\n    return _concretize_specs_together_new(*abstract_specs, **kwargs)\r\n  File \"/usr/local/spack/lib/spack/spack/concretize.py\", line 737, in _concretize_specs_together_new\r\n    tty.die(\"Unsatisfiable spec.\")\r\n  File \"/usr/local/spack/lib/spack/llnl/util/tty/__init__.py\", line 275, in die\r\n    sys.exit(1)\r\nSystemExit: 1\r\n```\r\nAccording to [#23307](https://github.com/spack/spack/pull/23307), this was already fixed, although it seems to persist.\r\n\n\n### Information on your system\n\n* **Spack:** 0.16.2-3961-d52a1b8279\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-skylake\r\n* **Concretizer:** clingo\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [x] I have run the failing commands in debug mode and reported the output",
    "user": "jacorvar",
    "url": "https://api.github.com/repos/spack/spack/issues/25537",
    "updated_at": "2021-09-01 21:12:55",
    "created_at": "2021-08-20 12:11:40",
    "closed_at": "2021-09-01 21:12:55",
    "state": "closed",
    "title": "Cannot concretize ALL R packages together with clingo",
    "number": 25537,
    "milestone": null,
    "labels": [
        "bug",
        "concretization",
        "triage",
        "concretizer-use-case"
    ],
    "id": 975553160,
    "html_url": "https://github.com/spack/spack/issues/25537",
    "assignees": [
        "alalazo"
    ],
    "comments": 2
}