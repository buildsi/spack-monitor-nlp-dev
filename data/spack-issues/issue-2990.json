{
    "body": "With a copy of spack/devel cloned yesterday, `cmake@3.6.1` fails to build on my usual CentOS7 devel machine (though it has melted down and been reimaged).  It built previously, but I've been doing other things for the past few weeks and can't easily identify when it broke.\r\n\r\nThere seems to be some incompatibility with OpenSSL (which perhaps should be providing type info for`ctx`).  I was attempting to install it as:\r\n\r\n```\r\nspack install cmake@3.6.1\r\n```\r\n\r\nI'm not worried, I'm going to bump up to `cmake@3.7.2`, which seems to build just fine.\r\n\r\n@tgamblin or ..., please feel free to close this unless it piques your interest.\r\n\r\n**BUT**, just in case someone else stumbles into this, here are the bits around the errors from `.../spack-stage/spack-stage-I4GjA0/cmake-3.6.1/spack-build.out`.\r\n\r\n```\r\n[ 52%] Building C object Utilities/cmcurl/lib/CMakeFiles/cmcurl.dir/inet_pton.c.o\r\nScanning dependencies of target cmsysTestsCxx\r\nIn file included from /tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_cryptor.c:32:0:\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_cryptor_private.h:107:17: error: field \u2018ctx\u2019 has incomplete type\r\n  EVP_CIPHER_CTX ctx;\r\n                 ^\r\nmake[2]: *** [Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_cryptor.c.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\n[ 52%] Building C object Source/kwsys/CMakeFiles/cmsysTestDynload.dir/testDynload.c.o\r\n```\r\n\r\nand \r\n\r\n```\r\n[ 56%] Building CXX object Source/kwsys/CMakeFiles/cmsysTestsCxx.dir/testDynamicLoader.cxx.o\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_hmac.c: In function \u2018__hmac_sha1_cleanup\u2019:\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_hmac.c:203:24: error: dereferencing pointer to incomplete type \u2018archive_hmac_sha1_ctx {aka struct hmac_ctx_st}\u2019\r\n  memset(ctx, 0, sizeof(*ctx));\r\n                        ^\r\nmake[2]: *** [Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_hmac.c.o] Error 1\r\n[ 56%] Building C object Utilities/cmcurl/lib/CMakeFiles/cmcurl.dir/tftp.c.o\r\n[ 56%] Building C object Utilities/cmcurl/lib/CMakeFiles/cmcurl.dir/splay.c.o\r\n```\r\n\r\nand finally\r\n\r\n```\r\n[ 64%] Building C object Utilities/cmcurl/lib/CMakeFiles/cmcurl.dir/vtls/axtls.c.o\r\n[ 64%] Building C object Utilities/cmcurl/lib/CMakeFiles/cmcurl.dir/vtls/cyassl.c.o\r\nIn file included from /tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_read_support_format_zip.c:58:0:\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_cryptor_private.h:107:17: error: field \u2018ctx\u2019 has incomplete type\r\n  EVP_CIPHER_CTX ctx;\r\n                 ^\r\n[ 64%] Building C object Utilities/cmcurl/lib/CMakeFiles/cmcurl.dir/vtls/schannel.c.o\r\n[ 65%] Building C object Utilities/cmcurl/lib/CMakeFiles/cmcurl.dir/vtls/gskit.c.o\r\n[ 65%] Building C object Utilities/cmcurl/lib/CMakeFiles/cmcurl.dir/vtls/darwinssl.c.o\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_read_support_format_zip.c:206:24: error: field \u2018hctx\u2019 has incomplete type\r\n  archive_hmac_sha1_ctx hctx;\r\n                        ^\r\nmake[2]: *** [Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_read_support_format_zip.c.o] Error 1\r\n[ 65%] Built target cmsysTestDynload\r\nIn file included from /tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_write_set_format_zip.c:52:0:\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_cryptor_private.h:107:17: error: field \u2018ctx\u2019 has incomplete type\r\n  EVP_CIPHER_CTX ctx;\r\n                 ^\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_write_set_format_zip.c:142:24: error: field \u2018hctx\u2019 has incomplete type\r\n  archive_hmac_sha1_ctx hctx;\r\n                        ^\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_write_set_format_zip.c: In function \u2018is_winzip_aes_encryption_supported\u2019:\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmlibarchive/libarchive/archive_write_set_format_zip.c:1650:24: error: storage size of \u2018hctx\u2019 isn\u2019t known\r\n  archive_hmac_sha1_ctx hctx;\r\n                        ^\r\nmake[2]: *** [Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/archive_write_set_format_zip.c.o] Error 1\r\nmake[1]: *** [Utilities/cmlibarchive/libarchive/CMakeFiles/cmlibarchive.dir/all] Error 2\r\nmake[1]: *** Waiting for unfinished jobs....\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmcurl/lib/vtls/openssl.c: In function \u2018get_cert_chain\u2019:\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmcurl/lib/vtls/openssl.c:2482:13: error: dereferencing pointer to incomplete type \u2018X509 {aka struct x509_st}\u2019\r\n     cinf = x->cert_info;\r\n             ^\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmcurl/lib/vtls/openssl.c:2484:30: error: dereferencing pointer to incomplete type \u2018X509_CINF {aka struct x509_cinf_st}\u2019\r\n     j = asn1_object_dump(cinf->signature->algorithm, bufp, CERTBUFFERSIZE);\r\n                              ^\r\n/tmp/hartzelg/spack-stage/spack-stage-I4GjA0/cmake-3.6.1/Utilities/cmcurl/lib/vtls/openssl.c:2510:20: error: dereferencing pointer to incomplete type \u2018EVP_PKEY {aka struct evp_pkey_st}\u2019\r\n       switch(pubkey->type) {\r\n                    ^\r\nmake[2]: *** [Utilities/cmcurl/lib/CMakeFiles/cmcurl.dir/vtls/openssl.c.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\nmake[1]: *** [Utilities/cmcurl/lib/CMakeFiles/cmcurl.dir/all] Error 2\r\n[ 65%] Linking CXX executable cmsysTestsCxx\r\n[ 65%] Built target cmsysTestsCxx\r\nmake: *** [all] Error 2\r\n```",
    "user": "hartzell",
    "url": "https://api.github.com/repos/spack/spack/issues/2990",
    "updated_at": "2017-02-03 22:35:16",
    "created_at": "2017-02-01 18:30:33",
    "closed_at": "2017-02-03 22:35:16",
    "state": "closed",
    "title": "cmake@3.6.1 fails to build, cmake@3.7.2",
    "number": 2990,
    "milestone": null,
    "labels": [],
    "id": 204666196,
    "html_url": "https://github.com/spack/spack/issues/2990",
    "assignees": [],
    "comments": 4
}