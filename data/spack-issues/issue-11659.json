{
    "body": "Spack will not concretize py-matplotlib and python together without explicit version constraints. Recent versions of matplotlib require python 3.5+, but it seems to conflict with a non-existing constraint \"spec asked for 2.7.16\".\r\n\r\nChanging the `python` dependency to `python@3.5:` fixes the issue, but I feel like this should not be necessary.\r\n\r\n### Steps to reproduce the issue\r\n\r\nHere is the minimal package file I tested.\r\n\r\n```python\r\nfrom spack import *\r\n\r\n\r\nclass TestPackage(Package):\r\n    git = \"http://github.com/codeandkey/dotfiles\"\r\n    version('develop', branch='master')\r\n\r\n    depends_on('python')\r\n    depends_on('py-matplotlib')\r\n```\r\n\r\n### Error Message\r\n```console\r\n==> Error: An unsatisfiable version constraint has been detected for spec:\r\n    python@2.7.16%gcc@4.8.5+bz2+ctypes+dbm+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tkinter~ucs4~uuid+zlib arch=linux-rhel7-x86_64\r\n        ^bzip2@1.0.6%gcc@4.8.5+shared arch=linux-rhel7-x86_64\r\n            ^diffutils@3.7%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n        ^expat\r\n        ^gdbm\r\n            ^readline\r\n                ^ncurses\r\n                    ^pkgconf@1.6.0%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n        ^libffi\r\n        ^openssl\r\n            ^perl@5.14.0:\r\n            ^zlib@1.2.11%gcc@4.8.5+optimize+pic+shared arch=linux-rhel7-x86_64\r\n        ^sqlite@3.0.8:\r\n\r\n\r\nwhile trying to concretize the partial spec:\r\n\r\n    py-matplotlib@3.0.2%gcc@4.8.5~animation+image~ipython~latex~qt+tk arch=linux-rhel7-x86_64\r\n        ^freetype@2.9.1%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n            ^bzip2@1.0.6%gcc@4.8.5+shared arch=linux-rhel7-x86_64\r\n                ^diffutils@3.7%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n            ^libpng@1.6.34%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n               ^zlib@1.2.11%gcc@4.8.5+optimize+pic+shared arch=linux-rhel7-x86_64                                                                                                                                                                                  [21/760]\r\n            ^pkgconf@1.6.0%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n        ^pil\r\n        ^py-dateutil@2.7.5%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n            ^py-setuptools@41.0.1%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n                ^python@2.7.16%gcc@4.8.5+bz2+ctypes+dbm+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3+ssl~tkinter~ucs4~uuid+zlib arch=linux-rhel7-x86_64\r\n                    ^expat\r\n                    ^gdbm\r\n                        ^readline\r\n                            ^ncurses\r\n                    ^libffi\r\n                    ^openssl\r\n                        ^perl@5.14.0:\r\n                    ^sqlite@3.0.8:\r\n            ^py-setuptools-scm\r\n            ^py-six@1.12.0%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n        ^py-functools32@3.2.3-2%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n        ^py-subprocess32@3.2.7%gcc@4.8.5 arch=linux-rhel7-x86_64\r\n        ^qhull@2015.2%gcc@4.8.5 build_type=RelWithDebInfo arch=linux-rhel7-x86_64\r\n            ^cmake@3.14.4%gcc@4.8.5~doc+ncurses+openssl+ownlibs~qt arch=linux-rhel7-x86_64\r\n                ^gnutls@3.6.8%gcc@4.8.5+guile+zlib arch=linux-rhel7-x86_64\r\n                    ^gettext@0.19.8.1%gcc@4.8.5+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-rhel7-x86_64\r\n                        ^libxml2\r\n                            ^libiconv\r\n                            ^xz\r\n                        ^tar\r\n                    ^guile\r\n                        ^bdw-gc@7.0:\r\n                        ^gmp@4.2:\r\n                            ^autoconf\r\n                                ^m4@1.4.6:\r\n                            ^automake\r\n                          ^libtool@1.5.6:\r\n                        ^libunistring@0.9.3:\r\n                    ^nettle@3.4.1:\r\n        ^tk@8.3:\r\n            ^libx11\r\n                ^inputproto\r\n                    ^util-macros\r\n                ^kbproto\r\n                ^libxcb@1.1.92:\r\n                    ^libpthread-stubs\r\n                    ^libxau@0.99.2:\r\n                        ^xproto@7.0.17:\r\n                    ^libxdmcp\r\n                    ^xcb-proto\r\n                ^xextproto\r\n                ^xtrans\r\n            ^tcl@8.6:\r\n\r\npy-matplotlib requires python version 3.5:, but spec asked for 2.7.16\r\n```\r\n-----",
    "user": "codeandkey",
    "url": "https://api.github.com/repos/spack/spack/issues/11659",
    "updated_at": "2020-11-02 20:21:42",
    "created_at": "2019-06-07 17:27:13",
    "closed_at": "2020-11-02 20:21:42",
    "state": "closed",
    "title": "Concretizing failure between  python and py-matplotlib",
    "number": 11659,
    "milestone": null,
    "labels": [
        "bug",
        "concretization",
        "impact-high",
        "python3"
    ],
    "id": 453617970,
    "html_url": "https://github.com/spack/spack/issues/11659",
    "assignees": [
        "tgamblin"
    ],
    "comments": 3
}