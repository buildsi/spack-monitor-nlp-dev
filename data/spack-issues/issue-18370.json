{
    "body": "<!-- Thanks for taking the time to report this build failure. To proceed with the report please:\r\n\r\n1. Title the issue \"Installation issue: <name-of-the-package>\".\r\n2. Provide the information required below.\r\n\r\nWe encourage you to try, as much as possible, to reduce your problem to the minimal example that still reproduces the issue. That would help us a lot in fixing it quickly and effectively! -->\r\n\r\n### Steps to reproduce the issue\r\n\r\n<!-- Fill in the exact spec you are trying to build and the relevant part of the error message -->\r\n```console\r\n$ spack install qt\r\n```\r\n\r\nwith an external qt install as in our CI (#18642)\r\n```\r\nspack config add packages:opengl:paths:opengl@4.1:/usr/X11R6\r\n```\r\n\r\nfails with\r\n```\r\n2020-08-28T02:56:56.9860450Z [+] /Users/runner/work/spack/spack/opt/spack/darwin-catalina-x86_64/apple-clang-11.0.3/py-ipykernel-5.1.1-hxmeesoggzdzyhjczzdtfeguqpjzwk5k\r\n2020-08-28T02:56:57.7652100Z ==> Installing qt\r\n2020-08-28T02:56:57.7652340Z ==> No binary for qt found: installing from source\r\n2020-08-28T02:58:40.9692410Z ==> Warning: microarchitecture specific optimizations are not supported yet on mixed compiler toolchains [check apple-clang@11.0.3 for further details]\r\n2020-08-28T02:58:40.9694820Z ==> Warning: Copying Xcode from /Applications/Xcode_11.6.app to /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/runner/spack-stage/xcode-select/apple-clang/11.0.3 in order to add spack wrappers to it. Please do not interrupt.\r\n2020-08-28T02:58:40.9789700Z ==> Error: AttributeError: Query of package 'opengl' for 'libs' failed\r\n2020-08-28T02:58:40.9789900Z \tprefix : /usr/X11R6\r\n2020-08-28T02:58:40.9791750Z \tspec : opengl@4.1%apple-clang@11.0.3 arch=darwin-catalina-x86_64\r\n2020-08-28T02:58:40.9791950Z \tqueried as : opengl\r\n2020-08-28T02:58:40.9792060Z \textra parameters : []\r\n2020-08-28T02:58:40.9792120Z \r\n2020-08-28T02:58:40.9792240Z /Users/runner/work/spack/spack/lib/spack/spack/build_environment.py:863, in child_process:\r\n2020-08-28T02:58:40.9792370Z         860            tb_string = traceback.format_exc()\r\n2020-08-28T02:58:40.9792480Z         861\r\n2020-08-28T02:58:40.9792620Z         862            # build up some context from the offending package so we can\r\n2020-08-28T02:58:40.9792740Z   >>    863            # show that, too.\r\n2020-08-28T02:58:40.9792860Z         864            package_context = get_package_context(tb)\r\n2020-08-28T02:58:40.9792970Z         865\r\n2020-08-28T02:58:40.9793080Z         866            build_log = None\r\n2020-08-28T02:58:40.9793150Z \r\n2020-08-28T02:58:40.9793200Z \r\n2020-08-28T02:58:41.0313570Z ==> Warning: Skipping build of py-pyqt5 since qt failed\r\n2020-08-28T02:58:41.0314200Z ==> Warning: Skipping build of py-qtconsole since py-pyqt5 failed\r\n2020-08-28T02:58:41.0314670Z ==> Warning: Skipping build of py-jupyter since py-qtconsole failed\r\n2020-08-28T02:58:41.0315160Z ==> Error: Terminating after first install failure: AttributeError: Query of package 'opengl' for 'libs' failed\r\n2020-08-28T02:58:41.0315310Z \tprefix : /usr/X11R6\r\n2020-08-28T02:58:41.0315750Z \tspec : opengl@4.1%apple-clang@11.0.3 arch=darwin-catalina-x86_64\r\n2020-08-28T02:58:41.0315870Z \tqueried as : opengl\r\n2020-08-28T02:58:41.0316600Z \textra parameters : []\r\n2020-08-28T02:58:41.0316730Z /Users/runner/work/spack/spack/lib/spack/spack/build_environment.py:863, in child_process:\r\n2020-08-28T02:58:41.0316860Z         860            tb_string = traceback.format_exc()\r\n2020-08-28T02:58:41.0316970Z         861\r\n2020-08-28T02:58:41.0317100Z         862            # build up some context from the offending package so we can\r\n2020-08-28T02:58:41.0317220Z   >>    863            # show that, too.\r\n2020-08-28T02:58:41.0317340Z         864            package_context = get_package_context(tb)\r\n2020-08-28T02:58:41.0317450Z         865\r\n2020-08-28T02:58:41.0317560Z         866            build_log = None\r\n2020-08-28T02:58:41.0317620Z \r\n2020-08-28T02:58:41.0317720Z Traceback (most recent call last):\r\n2020-08-28T02:58:41.0319350Z   File \"/Users/runner/work/spack/spack/lib/spack/spack/build_environment.py\", line 846, in child_process\r\n2020-08-28T02:58:41.0319560Z     setup_package(pkg, dirty=dirty)\r\n2020-08-28T02:58:41.0319780Z   File \"/Users/runner/work/spack/spack/lib/spack/spack/build_environment.py\", line 722, in setup_package\r\n2020-08-28T02:58:41.0319930Z     set_build_environment_variables(pkg, build_env, dirty)\r\n2020-08-28T02:58:41.0320140Z   File \"/Users/runner/work/spack/spack/lib/spack/spack/build_environment.py\", line 336, in set_build_environment_variables\r\n2020-08-28T02:58:41.0320270Z     dep_link_dirs.extend(query.libs.directories)\r\n2020-08-28T02:58:41.0320440Z   File \"/Users/runner/work/spack/spack/lib/spack/spack/spec.py\", line 900, in __get__\r\n2020-08-28T02:58:41.0320590Z     raise AttributeError(message)\r\n2020-08-28T02:58:41.0321120Z AttributeError: Query of package 'opengl' for 'libs' failed\r\n2020-08-28T02:58:41.0321250Z \tprefix : /usr/X11R6\r\n2020-08-28T02:58:41.0321700Z \tspec : opengl@4.1%apple-clang@11.0.3 arch=darwin-catalina-x86_64\r\n2020-08-28T02:58:41.0321830Z \tqueried as : opengl\r\n2020-08-28T02:58:41.0321940Z \textra parameters : []\r\n2020-08-28T02:58:41.0321990Z \r\n2020-08-28T02:58:43.3941210Z ##[error]Process completed with exit code 1.\r\n2020-08-28T02:58:43.4034300Z Post job cleanup.\r\n2020-08-28T02:58:44.0585030Z [command]/usr/local/bin/git version\r\n2020-08-28T02:58:44.0900940Z git version 2.28.0\r\n2020-08-28T02:58:44.0975530Z [command]/usr/local/bin/git config --local --name-only --get-regexp core\\.sshCommand\r\n2020-08-28T02:58:44.1060350Z [command]/usr/local/bin/git submodule foreach --recursive git config --local --name-only --get-regexp 'core\\.sshCommand' && git config --local --unset-all 'core.sshCommand' || :\r\n2020-08-28T02:58:44.2691900Z [command]/usr/local/bin/git config --local --name-only --get-regexp http\\.https\\:\\/\\/github\\.com\\/\\.extraheader\r\n2020-08-28T02:58:44.2752070Z http.https://github.com/.extraheader\r\n2020-08-28T02:58:44.2765750Z [command]/usr/local/bin/git config --local --unset-all http.https://github.com/.extraheader\r\n2020-08-28T02:58:44.2855920Z [command]/usr/local/bin/git submodule foreach --recursive git config --local --name-only --get-regexp 'http\\.https\\:\\/\\/github\\.com\\/\\.extraheader' && git config --local --unset-all 'http.https://github.com/.extraheader' || :\r\n2020-08-28T02:58:44.4345960Z Cleaning up orphan processes\r\n```\r\n\r\n### Information on your system\r\n\r\nany recent macOS\r\n\r\n### Additional information\r\n\r\nSee:\r\nhttps://github.com/spack/spack/runs/1039421566?check_suite_focus=true\r\n\r\nI think it's caused by this line:\r\n  https://github.com/spack/spack/blob/25021ec2280cc61ec7e6ea7ea39dec773eb796c0/var/spack/repos/builtin/packages/qt/package.py#L272\r\n\r\nbecause `.libs` does not exist for a virtual package ? (but for mesa)\r\n\r\n### General information\r\n\r\n<!-- These boxes can be checked by replacing [ ] with [x] or by clicking them after submitting the issue. -->\r\n- [ ] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [ ] I have run `spack maintainers <name-of-the-package>` and @mentioned any maintainers\r\n- [ ] I have uploaded the build log and environment files\r\n- [ ] I have searched the issues of this repo and believe this is not a duplicate\r\n",
    "user": "ax3l",
    "url": "https://api.github.com/repos/spack/spack/issues/18370",
    "updated_at": "2020-09-29 00:43:57",
    "created_at": "2020-08-29 01:03:08",
    "closed_at": "2020-09-29 00:43:57",
    "state": "closed",
    "title": "macOS nightly build tests are failing",
    "number": 18370,
    "milestone": null,
    "labels": [
        "macOS",
        "build-error",
        "tests",
        "qt",
        "actions"
    ],
    "id": 688426355,
    "html_url": "https://github.com/spack/spack/issues/18370",
    "assignees": [
        "sethrj",
        "v-dobrev"
    ],
    "comments": 10
}