{
    "body": "Trying to concretize `fftw+mpi ^/{mpich-dag}` fails with unhelpful error. \r\n\r\n### Steps to reproduce the issue\r\n\r\n```\r\n[sas4990@quser10 ~]$ spack find -lv mpich\r\n==> 1 installed package\r\n-- linux-rhel7-ivybridge / gcc@8.3.0 ----------------------------\r\nbtlyk64 mpich@3.3.2 device=ch4 +hydra netmod=ucx +pci pmi=pmi2 +romio+slurm~verbs+wrapperrpath\r\n[sas4990@quser10 ~]$ spack spec -I fftw+mpi ^/btlyk64 %gcc@8.3.0\r\nInput spec\r\n--------------------------------\r\n -   fftw+mpi\r\n[+]      ^mpich@3.3.2%gcc@8.3.0 device=ch4 +hydra netmod=ucx +pci pmi=pmi2 +romio+slurm~verbs+wrapperrpath arch=linux-rhel7-ivybridge\r\n[+]          ^libpciaccess@0.13.5%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]          ^libxml2@2.9.9%gcc@8.3.0~python arch=linux-rhel7-ivybridge\r\n[+]              ^libiconv@1.16%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^xz@5.2.4%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^zlib@1.2.11%gcc@8.3.0+optimize+pic+shared arch=linux-rhel7-ivybridge\r\n[+]          ^slurm@19-05-3-2%gcc@8.3.0~gtk~hdf5~hwloc~mariadb~pmix+readline arch=linux-rhel7-ivybridge\r\n\r\nConcretized\r\n--------------------------------\r\n -   fftw@3.3.8%gcc@8.3.0+mpi~openmp~pfft_patches precision=double,float arch=linux-rhel7-ivybridge\r\n[+]      ^mpich@3.3.2%gcc@8.3.0 device=ch4 +hydra netmod=ucx +pci pmi=pmi2 +romio+slurm~verbs+wrapperrpath arch=linux-rhel7-ivybridge\r\n[+]          ^libpciaccess@0.13.5%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]          ^libxml2@2.9.9%gcc@8.3.0~python arch=linux-rhel7-ivybridge\r\n[+]              ^libiconv@1.16%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^xz@5.2.4%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^zlib@1.2.11%gcc@8.3.0+optimize+pic+shared arch=linux-rhel7-ivybridge\r\n[+]          ^slurm@19-05-3-2%gcc@8.3.0~gtk~hdf5~hwloc~mariadb~pmix+readline arch=linux-rhel7-ivybridge\r\n\r\nInput spec\r\n--------------------------------\r\n==> Error: 'NoneType' object has no attribute 'endswith'\r\n[sas4990@quser10 ~]$\r\n...\r\n```\r\n\r\n### Error Message\r\n```\r\n....\r\n -   fftw@3.3.8%gcc@8.3.0+mpi~openmp~pfft_patches precision=double,float arch=linux-rhel7-ivybridge\r\n[+]      ^mpich@3.3.2%gcc@8.3.0 device=ch4 +hydra netmod=ucx +pci pmi=pmi2 +romio+slurm~verbs+wrapperrpath arch=linux-rhel7-ivybridge\r\n[+]          ^libpciaccess@0.13.5%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]          ^libxml2@2.9.9%gcc@8.3.0~python arch=linux-rhel7-ivybridge\r\n[+]              ^libiconv@1.16%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^xz@5.2.4%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^zlib@1.2.11%gcc@8.3.0+optimize+pic+shared arch=linux-rhel7-ivybridge\r\n[+]          ^slurm@19-05-3-2%gcc@8.3.0~gtk~hdf5~hwloc~mariadb~pmix+readline arch=linux-rhel7-ivybridge\r\n\r\nInput spec\r\n--------------------------------\r\nTraceback (most recent call last):\r\n  File \"/home/sas4990/packages/spack/bin/spack\", line 64, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/main.py\", line 715, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/main.py\", line 457, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/cmd/spec.py\", line 79, in spec\r\n    print(spec.tree(**kwargs))\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/spec.py\", line 3836, in tree\r\n    if node.package.installed_upstream:\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/spec.py\", line 1157, in package\r\n    self._package = spack.repo.get(self)\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/repo.py\", line 1203, in get\r\n    return path.get(spec)\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/repo.py\", line 94, in converter\r\n    return function(self, spec_like, *args, **kwargs)\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/repo.py\", line 653, in get\r\n    return self.repo_for_pkg(spec).get(spec)\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/repo.py\", line 94, in converter\r\n    return function(self, spec_like, *args, **kwargs)\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/repo.py\", line 885, in get\r\n    raise UnknownPackageError(spec.name)\r\n  File \"/home/sas4990/packages/spack/lib/spack/spack/repo.py\", line 1293, in __init__\r\n    if name.endswith(\".yaml\"):\r\nAttributeError: 'NoneType' object has no attribute 'endswith'\r\n...\r\n```\r\n\r\nHowever, everything works if I specify all the variants to the concretizer : \r\n```\r\n[sas4990@quser10 ~]$ spack spec -I fftw ^mpich@3.3.2 device=ch4 netmod=ucx pmi=pmi2 +slurm  %gcc@8.3.0\r\nInput spec\r\n--------------------------------\r\n -   fftw\r\n -       ^mpich@3.3.2%gcc@8.3.0 device=ch4 netmod=ucx pmi=pmi2 +slurm\r\n\r\nConcretized\r\n--------------------------------\r\n -   fftw@3.3.8%gcc@8.3.0+mpi~openmp~pfft_patches precision=double,float arch=linux-rhel7-ivybridge\r\n[+]      ^mpich@3.3.2%gcc@8.3.0 device=ch4 +hydra netmod=ucx +pci pmi=pmi2 +romio+slurm~verbs+wrapperrpath arch=linux-rhel7-ivybridge\r\n[+]          ^findutils@4.6.0%gcc@8.3.0 patches=84b916c0bf8c51b7e7b28417692f0ad3e7030d1f3c248ba77c42ede5c1c5d11e,bd9e4e5cc280f9753ae14956c4e4aa17fe7a210f55dd6c84aa60b12d106d47a2 arch=linux-rhel7-ivybridge\r\n[+]              ^autoconf@2.69%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]                  ^m4@1.4.18%gcc@8.3.0 patches=3877ab548f88597ab2327a2230ee048d2d07ace1062efe81fc92e91b7f39cd00,fc9b61654a3ba1a8d6cd78ce087e7c96366c290bc8d2c299f09828d793b853c8 +sigsegv arch=linux-rhel7-ivybridge\r\n[+]                      ^libsigsegv@2.12%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]                  ^perl@5.30.0%gcc@8.3.0+cpanm+shared+threads arch=linux-rhel7-ivybridge\r\n[+]                      ^gdbm@1.18.1%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]                          ^readline@8.0%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]                              ^ncurses@6.1%gcc@8.3.0~symlinks~termlib arch=linux-rhel7-ivybridge\r\n[+]                                  ^pkgconf@1.6.3%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^automake@1.16.1%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^libtool@2.4.6%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n -               ^texinfo@6.5%gcc@8.3.0 patches=12f6edb0c6b270b8c8dba2ce17998c580db01182d871ee32b7b6e4129bd1d23a,1732115f651cff98989cb0215d8f64da5e0f7911ebf0c13b064920f088f2ffe1 arch=linux-rhel7-ivybridge\r\n[+]          ^libpciaccess@0.13.5%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^util-macros@1.19.1%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]          ^libxml2@2.9.9%gcc@8.3.0~python arch=linux-rhel7-ivybridge\r\n[+]              ^libiconv@1.16%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^xz@5.2.4%gcc@8.3.0 arch=linux-rhel7-ivybridge\r\n[+]              ^zlib@1.2.11%gcc@8.3.0+optimize+pic+shared arch=linux-rhel7-ivybridge\r\n[+]          ^slurm@19-05-3-2%gcc@8.3.0~gtk~hdf5~hwloc~mariadb~pmix+readline arch=linux-rhel7-ivybridge\r\n\r\n[sas4990@quser10 ~]$\r\n```\r\n\r\n\r\n### Information on your system\r\n\r\n 1. Platform :  `linux-rhel7-ivybridge`\r\n 2. Custom slurm in `packages.yaml`\r\n\r\nIf this is a known issue, feel free to close it. \r\n",
    "user": "s-sajid-ali",
    "url": "https://api.github.com/repos/spack/spack/issues/13834",
    "updated_at": "2019-11-22 07:42:31",
    "created_at": "2019-11-22 07:02:49",
    "closed_at": "2019-11-22 07:42:30",
    "state": "closed",
    "title": "Concretizer fails with unhelpful error message when a dag is given as dependency",
    "number": 13834,
    "milestone": null,
    "labels": [
        "bug",
        "unreproducible"
    ],
    "id": 527025256,
    "html_url": "https://github.com/spack/spack/issues/13834",
    "assignees": [],
    "comments": 2
}