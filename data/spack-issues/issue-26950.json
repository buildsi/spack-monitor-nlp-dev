{
    "body": "### Steps to reproduce\n\nI am doing a `spack install` on Perlmutter using e4s-21.08 branch \r\n\r\nWe need to add an entry for zen3 see https://github.com/spack/spack/blob/e4s-21.08/var/spack/repos/builtin/packages/kokkos/package.py#L85-L136 codebase. \r\n\r\n\r\n\r\n\n\n### Error message\n\n```\r\n==> Installing kokkos-3.4.00-a67ukykjrw7m7ixizm5jyaf5d5slvlzk\r\n==> No binary for kokkos-3.4.00-a67ukykjrw7m7ixizm5jyaf5d5slvlzk found: installing from source\r\n==> Fetching https://mirror.spack.io/_source-cache/archive/2e/2e4438f9e4767442d8a55e65d000cc9cde92277d415ab4913a96cd3ad901d317.tar.gz\r\n==> No patches needed for kokkos\r\n==> kokkos: Executing phase: 'cmake'\r\n==> Error: KeyError: 'zen3'\r\n\r\n/global/common/software/spackecp/perlmutter/e4s-21.08/spack/var/spack/repos/builtin/packages/kokkos/package.py:253, in cmake_args:\r\n        250                    kokkos_arch_name = self.spack_cuda_arch_map[cuda_arch]\r\n        251                    spack_microarches.append(kokkos_arch_name)\r\n        252\r\n  >>    253        kokkos_microarch_name = self.spack_micro_arch_map[spec.target.name]\r\n        254        if kokkos_microarch_name:\r\n        255            spack_microarches.append(kokkos_microarch_name)\r\n        256\r\n\r\nSee build log for details:\r\n  /tmp/spack-stage/siddiq90/spack-stage-kokkos-3.4.00-a67ukykjrw7m7ixizm5jyaf5d5slvlzk/spack-build-out.txt\r\n```\n\n### Information on your system\n\n```\r\nsiddiq90@login37> spack debug report\r\n* **Spack:** 0.16.2-3949-8831cb2eed\r\n* **Python:** 3.6.12\r\n* **Platform:** cray-sles15-zen3\r\n* **Concretizer:** original\r\n```\r\n\r\nThis is a copy of my spack.yaml it is still in development. \r\n```\r\nsiddiq90@login37> cat spack.yaml \r\nspack:\r\n  view: false\r\n  config:\r\n    install_missing_compilers: true\r\n    install_tree:\r\n      root: /global/common/software/spackecp/perlmutter/e4s-21.08/software\r\n    build_stage: $tempdir/spack-stage\r\n    misc_cache: $tempdir/misc_cache\r\n  mirrors:\r\n    perlmutter-e4s-21.08: /global/common/software/spackecp/mirrors/perlmutter-e4s-21.08\r\n  definitions:\r\n  - compilers:\r\n    - nvhpc@21.7\r\n  - cuda_specs:\r\n      #- amrex@21.10 +openmp +pic +shared +cuda cuda_arch=80\r\n      #- caliper@2.6.0 +cuda cuda_arch=80\r\n      - hypre@2.22.0 +openmp +cuda cuda_arch=80\r\n\r\n  - gcc_specs:\r\n    - adios2@2.7.1 +dataman +png ~mpi\r\n    - aml@0.1.0\r\n    - amrex@21.08\r\n    - arborx@1.0\r\n    - argobots@1.1\r\n    - ascent@0.7.1\r\n    - bolt@2.0\r\n    - darshan-runtime@3.3.1 scheduler=slurm ~mpi\r\n    - darshan-util@3.3.1\r\n    - papi@6.0.0.1\r\n\r\n  - gcc: ['%gcc@10.3.0']\r\n  specs:\r\n  - $compilers\r\n  - matrix:\r\n    - [$cuda_specs]\r\n    - ['%nvhpc']\r\n  - matrix:\r\n    - [$gcc_specs]\r\n    - ['%gcc']\r\n  compilers:\r\n  - compiler:\r\n      spec: gcc@10.3.0\r\n      paths:\r\n        cc: /opt/cray/pe/gcc/10.3.0/bin/gcc\r\n        cxx: /opt/cray/pe/gcc/10.3.0/bin/g++\r\n        f77: /opt/cray/pe/gcc/10.3.0/bin/gfortran\r\n        fc: /opt/cray/pe/gcc/10.3.0/bin/gfortran\r\n      operating_system: sles15\r\n      modules:\r\n      - PrgEnv-gnu/8.1.0\r\n      - gcc/10.3.0\r\n  - compiler:\r\n      spec: nvhpc@21.7\r\n      paths:\r\n        cc: /global/common/software/spackecp/perlmutter/e4s-21.08/software/cray-sles15-zen3/gcc-10.3.0/nvhpc-21.7-sauysez5f7jr7oxutaa4i7opz4cpuq2y/Linux_x86_64/21.7/compilers/bin/nvc\r\n        cxx: /global/common/software/spackecp/perlmutter/e4s-21.08/software/cray-sles15-zen3/gcc-10.3.0/nvhpc-21.7-sauysez5f7jr7oxutaa4i7opz4cpuq2y/Linux_x86_64/21.7/compilers/bin/nvc++\r\n        f77: /global/common/software/spackecp/perlmutter/e4s-21.08/software/cray-sles15-zen3/gcc-10.3.0/nvhpc-21.7-sauysez5f7jr7oxutaa4i7opz4cpuq2y/Linux_x86_64/21.7/compilers/bin/nvfortran\r\n        fc: /global/common/software/spackecp/perlmutter/e4s-21.08/software/cray-sles15-zen3/gcc-10.3.0/nvhpc-21.7-sauysez5f7jr7oxutaa4i7opz4cpuq2y/Linux_x86_64/21.7/compilers/bin/nvfortran\r\n      flags: {}\r\n      operating_system: sles15\r\n      target: any\r\n      environment: {}\r\n      extra_rpaths: []\r\n  packages:\r\n    all:\r\n      providers:\r\n        compiler: [nvhpc@21.7, gcc@10.3.0]\r\n        mpi: [mpich]\r\n        fftw: [cray-fftw]\r\n        blas: [cray-libsci]\r\n        scalapack: [cray-libsci]\r\n        pkgconfig: [pkg-config]\r\n    amrex:\r\n      variants: +openmp +pic +fortran\r\n    bzip2:\r\n      version: [1.0.6]\r\n      buildable: false\r\n      externals:\r\n      - spec: bzip2@1.0.6\r\n        prefix: /usr\r\n    cray-libsci:\r\n      buildable: false\r\n      externals:\r\n      - spec: cray-libsci@20.06.1\r\n        modules:\r\n        - cray-libsci/21.08.1.2\r\n    cuda:\r\n      buildable: false\r\n      version: [11.0.2]\r\n      externals:\r\n      - spec: cuda@11.0.2\r\n        prefix: /global/common/software/spackecp/perlmutter/e4s-21.08/software/cray-sles15-zen3/gcc-10.3.0/nvhpc-21.7-sauysez5f7jr7oxutaa4i7opz4cpuq2y/Linux_x86_64/21.7/cuda/11.0\r\n    diffutils:\r\n      version: [3.6]\r\n      buildable: false\r\n      externals:\r\n      - spec: diffutils\r\n        prefix: /usr\r\n    cmake:\r\n      buildable: false\r\n      externals:\r\n      - spec: cmake@3.20.5\r\n        modules:\r\n        - cmake/3.20.5\r\n    cray-fftw:\r\n      version: [3.3.8.8]\r\n      buildable: false\r\n      externals:\r\n      - spec: cray-fftw@3.3.8.8\r\n        modules:\r\n        - cray-fftw/3.3.8.11\r\n    hdf5:\r\n      variants: +cxx +fortran\r\n    gettext:\r\n      version: [0.19.8.1]\r\n      buildable: false\r\n      externals:\r\n      - spec: gettext\r\n        prefix: /usr\r\n    libfabric:\r\n      buildable: false\r\n      externals:\r\n      - spec: libfabric@1.11.0\r\n        modules:\r\n        - libfabric/1.11.0.4.79\r\n    mpich:\r\n      buildable: false\r\n      externals:\r\n      - spec: mpich@3.4.1\r\n        modules:\r\n        - mpich/3.4.1\r\n    m4:\r\n      buildable: false\r\n      externals:\r\n      - spec: m4@1.4.18\r\n        prefix: /usr\r\n    openssl:\r\n      buildable: false\r\n      externals:\r\n      - spec: openssl@1.1.1k\r\n        prefix: /usr\r\n    openssh:\r\n      version: [7.9p1]\r\n      buildable: false\r\n      externals:\r\n      - spec: openssh\r\n        prefix: /usr\r\n    openmpi:\r\n      version: [4.0.5]\r\n      variants: +cxx schedulers=slurm\r\n    perl:\r\n      version: [5.31.7]\r\n    python:\r\n      buildable: false\r\n      externals:\r\n      - spec: python@3.8.8\r\n        modules:\r\n        - python/3.9-anaconda-2021.05\r\n    slurm:\r\n      buildable: false\r\n      version: [20-11-5-1]\r\n      externals:\r\n      - spec: slurm\r\n        prefix: /usr\r\n    tar:\r\n      version: [1.3]\r\n      buildable: false\r\n      externals:\r\n      - spec: tar@1.30\r\n        prefix: /usr\r\n\r\n```\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "shahzebsiddiqui",
    "url": "https://api.github.com/repos/spack/spack/issues/26950",
    "updated_at": "2022-01-20 01:41:59",
    "created_at": "2021-10-26 20:21:12",
    "closed_at": "None",
    "state": "open",
    "title": "kokkos build failure on zen3 target ",
    "number": 26950,
    "milestone": null,
    "labels": [
        "bug",
        "build-error",
        "nersc"
    ],
    "id": 1036705422,
    "html_url": "https://github.com/spack/spack/issues/26950",
    "assignees": [
        "alalazo"
    ],
    "comments": 4
}