{
    "body": "### Steps to reproduce the issue\n\n`raja@0.14.0 +rocm amdgpu_target=gfx908 ~tests ~examples` build fails using:\r\n* `spack@develop` (372fc78e9869e36c54ac86bfd20e2447df0a8405 from `Tue Nov 2 19:37:23 2021 +0800`)\r\n* Ubuntu 20.04, GCC 11.1.0\r\n\r\nConcrete spec: [raja.spec.yaml.txt](https://github.com/spack/spack/files/7463283/raja.spec.yaml.txt)\r\n\r\nConcretization:\r\n```\r\nroot@instinct:/testsuite/validation_tests/raja# spack spec -I raja ~tests ~examples +rocm amdgpu_target=gfx908\r\nInput spec\r\n--------------------------------\r\n -   raja~examples+rocm~tests amdgpu_target=gfx908\r\n\r\nConcretized\r\n--------------------------------\r\n -   raja@0.14.0%gcc@11.1.0~cuda~examples+exercises~ipo~openmp+rocm+shared~tests amdgpu_target=gfx908 build_type=RelWithDebInfo cuda_arch=none arch=linux-ubuntu20.04-broadwell\r\n[+]      ^blt@0.4.1%gcc@11.1.0 arch=linux-ubuntu20.04-broadwell\r\n[+]          ^cmake@3.21.4%gcc@11.1.0~doc+ncurses+openssl+ownlibs~qt build_type=Release arch=linux-ubuntu20.04-broadwell\r\n[+]              ^ncurses@6.2%gcc@11.1.0~symlinks+termlib abi=none arch=linux-ubuntu20.04-broadwell\r\n[+]                  ^pkgconf@1.8.0%gcc@11.1.0 arch=linux-ubuntu20.04-broadwell\r\n[+]              ^openssl@1.1.1l%gcc@11.1.0~docs certs=system arch=linux-ubuntu20.04-broadwell\r\n[+]                  ^perl@5.34.0%gcc@11.1.0+cpanm+shared+threads arch=linux-ubuntu20.04-broadwell\r\n[+]                      ^berkeley-db@18.1.40%gcc@11.1.0+cxx~docs+stl patches=b231fcc4d5cff05e5c3a4814f6a5af0e9a966428dc2176540d2c05aff41de522 arch=linux-ubuntu20.04-broadwell\r\n[+]                      ^bzip2@1.0.8%gcc@11.1.0~debug~pic+shared arch=linux-ubuntu20.04-broadwell\r\n[+]                          ^diffutils@3.8%gcc@11.1.0 arch=linux-ubuntu20.04-broadwell\r\n[+]                              ^libiconv@1.16%gcc@11.1.0 libs=shared,static arch=linux-ubuntu20.04-broadwell\r\n[+]                      ^gdbm@1.19%gcc@11.1.0 arch=linux-ubuntu20.04-broadwell\r\n[+]                          ^readline@8.1%gcc@11.1.0 arch=linux-ubuntu20.04-broadwell\r\n[+]                      ^zlib@1.2.11%gcc@11.1.0+optimize+pic+shared arch=linux-ubuntu20.04-broadwell\r\n[+]      ^camp@0.2.2%gcc@11.1.0~cuda~ipo+rocm~tests amdgpu_target=gfx908 build_type=RelWithDebInfo cuda_arch=none arch=linux-ubuntu20.04-broadwell\r\n[+]          ^hip@4.3.1%gcc@11.1.0~ipo build_type=Release patches=2a4190477b7d9206b9cd8d70770ba0bc007273cbe54772efb12f9ca2e37c0392,99190b4616edb362d48f9b265c3018a3c6339481b0729d9fe46185fca25bc54b,e276c4acf3d37712b6bea306fea34f539d3c4f743471e9da208b5eb17b16ae67 arch=linux-ubuntu20.04-broadwell\r\n[+]          ^hsa-rocr-dev@4.3.1%gcc@11.1.0+image~ipo+shared build_type=Release patches=71e6851d9be8113bfb8d71b66a3171e0d0401bae5e6f161c9e7fe32558261a46 arch=linux-ubuntu20.04-broadwell\r\n[+]          ^llvm-amdgpu@4.3.1%gcc@11.1.0~ipo+openmp+rocm-device-libs build_type=Release patches=d999f3b235e655ee07f6dd2590302082feaa06d32c5c6b53aae9c5cf1e45b644 arch=linux-ubuntu20.04-broadwell\r\n```\r\n\r\n```\r\n$> spack install -f ./raja.spec.yaml\r\n...\r\n==> Installing raja-0.14.0-fiebossfygbajyn7vnqa4eipgmnvrz55\r\n==> No binary for raja-0.14.0-fiebossfygbajyn7vnqa4eipgmnvrz55 found: installing from source\r\n==> Using cached archive: /spack/var/spack/cache/_source-cache/git//LLNL/RAJA.git/v0.14.0.tar.gz\r\n==> Warning: Fetching from mirror without a checksum!\r\n  This package is normally checked out from a version control system, but it has been archived on a spack mirror.  This means we cannot know a checksum for the tarball in advance. Be sure that your connection to this mirror is secure!\r\n==> No patches needed for raja\r\n==> raja: Executing phase: 'initconfig'\r\n==> raja: Executing phase: 'cmake'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    'cmake' '-G' 'Unix Makefiles' '-DCMAKE_INSTALL_PREFIX:STRING=/spack/opt/spack/linux-ubuntu20.04-broadwell/gcc-11.1.0/raja-0.14.0-fiebossfygbajyn7vnqa4eipgmnvrz55' '-DCMAKE_BUILD_TYPE:STRING=RelWithDebInfo' '-DCMAKE_INTERPROCEDURAL_OPTIMIZATION:BOOL=OFF' '-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON' '-DCMAKE_INSTALL_RPATH_USE_LINK_PATH:BOOL=OFF' '-DCMAKE_INSTALL_RPATH:STRING=/spack/opt/spack/linux-ubuntu20.04-broadwell/gcc-11.1.0/raja-0.14.0-fiebossfygbajyn7vnqa4eipgmnvrz55/lib;/spack/opt/spack/linux-ubuntu20.04-broadwell/gcc-11.1.0/raja-0.14.0-fiebossfygbajyn7vnqa4eipgmnvrz55/lib64;/spack/opt/spack/linux-ubuntu20.04-broadwell/gcc-11.1.0/camp-0.2.2-zv57kxngu76qinqxqh74bxyji24tdfun/lib;/opt/rocm-4.3.1/hip/lib;/opt/rocm-4.3.1/lib;/opt/rocm-4.3.1/llvm/lib' '-DCMAKE_PREFIX_PATH:STRING=/spack/opt/spack/linux-ubuntu20.04-broadwell/gcc-11.1.0/camp-0.2.2-zv57kxngu76qinqxqh74bxyji24tdfun;/spack/opt/spack/linux-ubuntu20.04-broadwell/gcc-11.1.0/blt-0.4.1-rkmflkncbsozmhk7c5hzzixyjxnsu4ed;/spack/opt/spack/linux-ubuntu20.04-broadwell/gcc-11.1.0/cmake-3.21.4-vilpa44un2z7bfdqix4zjj6xflu55ljb;/opt/rocm-4.3.1/llvm;/opt/rocm-4.3.1/;/opt/rocm-4.3.1/hip' '-C' '/tmp/root/spack-stage/spack-stage-raja-0.14.0-fiebossfygbajyn7vnqa4eipgmnvrz55/spack-src/instinct-linux-ubuntu20.04-broadwell-gcc@11.1.0.cmake' '/tmp/root/spack-stage/spack-stage-raja-0.14.0-fiebossfygbajyn7vnqa4eipgmnvrz55/spack-src'\r\n\r\n18 errors found in build log:\r\n     88     -- Looking for posix_memalign - found\r\n     89     -- Looking for std::aligned_alloc\r\n     90     -- Looking for std::aligned_alloc - not found\r\n     91     -- Looking for _mm_malloc\r\n     92     -- Looking for _mm_malloc - not found\r\n     93     -- Configuring done\r\n  >> 94     CMake Error in exercises/tutorial_halfday/CMakeLists.txt:\r\n     95       HIP_ARCHITECTURES is empty for target \"ex9_matrix-transpose-local-array\".\r\n     96\r\n     97\r\n  >> 98     CMake Error in exercises/tutorial_halfday/CMakeLists.txt:\r\n     99       HIP_ARCHITECTURES is empty for target\r\n     100      \"ex8_tiled-matrix-transpose_solution\".\r\n     101\r\n     102\r\n  >> 103    CMake Error in exercises/tutorial_halfday/CMakeLists.txt:\r\n     104      HIP_ARCHITECTURES is empty for target \"ex1_vector-addition\".\r\n     105\r\n     106\r\n  >> 107    CMake Error in exercises/tutorial_halfday/CMakeLists.txt:\r\n     108      HIP_ARCHITECTURES is empty for target \"ex8_tiled-matrix-transpose\".\r\n...\r\n```\n\n### Information on your system\n\n* **Spack:** 0.16.3-5185-372fc78e98\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-broadwell\r\n* **Concretizer:** clingo\n\n### Additional information\n\n[spack-build-out.txt](https://github.com/spack/spack/files/7463293/spack-build-out.txt)\r\n[spack-build-env.txt](https://github.com/spack/spack/files/7463294/spack-build-env.txt)\r\n\r\n@davidbeckingsale @dtaller @white238 @haampie \r\n\r\n\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "eugeneswalker",
    "url": "https://api.github.com/repos/spack/spack/issues/27165",
    "updated_at": "2021-11-30 23:53:42",
    "created_at": "2021-11-02 18:45:05",
    "closed_at": "None",
    "state": "open",
    "title": "raja@0.14.0 +rocm build fails: cmake: HIP_ARCHITECTURES is empty for target",
    "number": 27165,
    "milestone": null,
    "labels": [
        "build-error",
        "e4s",
        "ROCm/hip"
    ],
    "id": 1042698431,
    "html_url": "https://github.com/spack/spack/issues/27165",
    "assignees": [],
    "comments": 1
}