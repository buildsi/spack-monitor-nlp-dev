{
    "body": "### Steps to reproduce\n\n```console\r\n$ spack gpg list # Key is available\r\ngpgconf: socketdir is '/run/user/0/gnupg'\r\n/spack/opt/spack/gpg/pubring.kbx\r\n--------------------------------\r\npub   rsa4096 2021-09-01 [SC]\r\n      F9A3E0868809828374551412E1E35A1C6F84D69D\r\nuid           [ultimate] Asher Mancinelli (GPG created for Spack) <ashermancinelli@gmail.com>\r\n$ ls /cache/build_cache/_pgp # key exists in local buildcache\r\nF9A3E0868809828374551412E1E35A1C6F84D69D.pub\r\n$ spack mirror list # Mirror exists and contains packages \r\nminio           s3://spack\r\nspack-public    https://mirror.spack.io\r\n$ spack buildcache list # s3 is working\r\n==> 1 cached build.\r\n-- linux-ubuntu18.04-haswell / gcc@7.5.0 ------------------------\r\npkgconf@1.8.0\r\n$ # GPG command used by failing spack command seems to work\r\n$ GNUPGHOME=/spack/opt/spack/gpg/ '/usr/bin/gpg' '--list-public-keys' '--with-colons' '--fingerprint' 'F9A3E0868809828374551412E1E35A1C6F84D69D'\r\ntru::1:1630537839:0:3:1:5\r\npub:u:4096:1:E1E35A1C6F84D69D:1630537392:::u:::scSC::::::23::0:\r\nfpr:::::::::F9A3E0868809828374551412E1E35A1C6F84D69D:\r\nuid:u::::1630537392::A3B3981D3131BF52CE3F912F236C5D1DF3BEA310::Asher Mancinelli (GPG created for Spack) <ashermancinelli@gmail.com>::::::::::0:\r\n$ spack --debug gpg publish -m minio F9A3E0868809828374551412E1E35A1C6F84D69D\r\n==> [2021-09-02-22:01:36.416531] Imported gpg from built-in commands\r\n==> [2021-09-02-22:01:36.418643] Imported gpg from built-in commands\r\n==> [2021-09-02-22:01:36.419643] '/usr/bin/gpg' '--version'\r\n==> [2021-09-02-22:01:36.423000] '/usr/bin/gpgconf' '--version'\r\n==> [2021-09-02-22:01:36.425094] '/usr/bin/gpgconf' '--dry-run' '--create-socketdir'\r\ngpgconf: socketdir is '/run/user/0/gnupg'\r\n==> [2021-09-02-22:01:36.427409] '/usr/bin/gpgconf' '--create-socketdir'\r\n==> [2021-09-02-22:01:36.429513] '/usr/bin/gpg' '--list-public-keys' '--with-colons' '--fingerprint' 'F9A3E0868809828374551412E1E35A1C6F84D69D'\r\n==> [2021-09-02-22:01:36.433820] Reading config file /spack/etc/spack/defaults/config.yaml\r\nTraceback (most recent call last):\r\n  File \"/spack/bin/spack\", line 100, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/spack/lib/spack/spack/main.py\", line 797, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/spack/lib/spack/spack/main.py\", line 525, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/spack/lib/spack/spack/cmd/gpg.py\", line 212, in gpg\r\n    args.func(args)\r\n  File \"/spack/lib/spack/spack/cmd/gpg.py\", line 207, in gpg_publish\r\n    mirror, keys=args.keys, regenerate_index=args.rebuild_index)\r\n  File \"/spack/lib/spack/spack/binary_distribution.py\", line 1598, in push_keys\r\n    _build_cache_keys_relative_path)\r\n  File \"/spack/lib/spack/spack/util/url.py\", line 151, in join\r\n    for x in itertools.chain((base_url, path), extra)]\r\n  File \"/spack/lib/spack/spack/util/url.py\", line 151, in <listcomp>\r\n    for x in itertools.chain((base_url, path), extra)]\r\nAttributeError: 'NoneType' object has no attribute 'geturl'\r\n```\n\n### Error message\n\n```console\r\n$ spack --debug gpg publish -m minio F9A3E0868809828374551412E1E35A1C6F84D69D\r\n==> [2021-09-02-22:01:36.416531] Imported gpg from built-in commands\r\n==> [2021-09-02-22:01:36.418643] Imported gpg from built-in commands\r\n==> [2021-09-02-22:01:36.419643] '/usr/bin/gpg' '--version'\r\n==> [2021-09-02-22:01:36.423000] '/usr/bin/gpgconf' '--version'\r\n==> [2021-09-02-22:01:36.425094] '/usr/bin/gpgconf' '--dry-run' '--create-socketdir'\r\ngpgconf: socketdir is '/run/user/0/gnupg'\r\n==> [2021-09-02-22:01:36.427409] '/usr/bin/gpgconf' '--create-socketdir'\r\n==> [2021-09-02-22:01:36.429513] '/usr/bin/gpg' '--list-public-keys' '--with-colons' '--fingerprint' 'F9A3E0868809828374551412E1E35A1C6F84D69D'\r\n==> [2021-09-02-22:01:36.433820] Reading config file /spack/etc/spack/defaults/config.yaml\r\nTraceback (most recent call last):\r\n  File \"/spack/bin/spack\", line 100, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/spack/lib/spack/spack/main.py\", line 797, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/spack/lib/spack/spack/main.py\", line 525, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/spack/lib/spack/spack/cmd/gpg.py\", line 212, in gpg\r\n    args.func(args)\r\n  File \"/spack/lib/spack/spack/cmd/gpg.py\", line 207, in gpg_publish\r\n    mirror, keys=args.keys, regenerate_index=args.rebuild_index)\r\n  File \"/spack/lib/spack/spack/binary_distribution.py\", line 1598, in push_keys\r\n    _build_cache_keys_relative_path)\r\n  File \"/spack/lib/spack/spack/util/url.py\", line 151, in join\r\n    for x in itertools.chain((base_url, path), extra)]\r\n  File \"/spack/lib/spack/spack/util/url.py\", line 151, in <listcomp>\r\n    for x in itertools.chain((base_url, path), extra)]\r\nAttributeError: 'NoneType' object has no attribute 'geturl'\r\n```\n\n### Information on your system\n\nRunning in container ubuntu:18.04 with:\r\n* **Spack:** 0.16.2-4117-03331de0f2\r\n* **Python:** 3.6.9\r\n* **Platform:** linux-ubuntu18.04-haswell\r\n* **Concretizer:** original\r\n\r\nwith host:\r\n* **Spack:** 0.16.2-4108-56ba3448db\r\n* **Python:** 3.8.3\r\n* **Platform:** darwin-catalina-skylake\r\n* **Concretizer:** clingo\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "ashermancinelli",
    "url": "https://api.github.com/repos/spack/spack/issues/25765",
    "updated_at": "2021-09-02 22:08:27",
    "created_at": "2021-09-02 22:06:21",
    "closed_at": "None",
    "state": "open",
    "title": "gpg publish command failing with `'NoneType' object has no attribute 'geturl'`",
    "number": 25765,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 987206196,
    "html_url": "https://github.com/spack/spack/issues/25765",
    "assignees": [
        "opadron"
    ],
    "comments": 1
}