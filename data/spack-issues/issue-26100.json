{
    "body": "### Steps to reproduce\n\nI have a simple environment file that fails to install on Cori. The `spack install` command hangs indefinitely.\r\nHere is the environment file:\r\n\r\n```yaml\r\nspack:\r\n  specs:\r\n  - py-meshio\r\n  concretization: together\r\n  compilers:\r\n  - compiler:\r\n      paths:\r\n        cc: cc\r\n        cxx: CC\r\n        f77: ftn\r\n        fc: ftn\r\n      operating_system: cnl7\r\n      target: any\r\n      modules:\r\n      - PrgEnv-gnu\r\n      - gcc/9.3.0\r\n      environment: {}\r\n      extra_rpaths: []\r\n      flags: {}\r\n      spec: gcc@9.3.0\r\n  packages:\r\n    all:\r\n      compiler:\r\n      - gcc@9.3.0\r\n      target:\r\n      - any\r\n      version: []\r\n      buildable: true\r\n    python:\r\n      buildable: false\r\n      version: []\r\n      target: []\r\n      compiler: []\r\n      providers: {}\r\n      externals:\r\n      - spec: python@3.8.5\r\n        modules:\r\n        - cray-python/3.8.5.0\r\n  view: true\r\n```\r\n\r\nAfter cloning spack and setting it up (including bootstrapping clingo):\r\n\r\n```\r\nspack env create myenv spack.yaml\r\nspack env activate myenv\r\nspack -d install\r\n```\r\n\r\nThe logs are as follows:\r\n\r\n```\r\n==> [2021-09-21-02:35:10.149744] Imported install from built-in commands\r\n==> [2021-09-21-02:35:10.155052] Reading config file /global/cscratch1/sd/mdorier/dwi_analysis/spack/var/spack/environments/myenv/spack.yaml\r\n==> [2021-09-21-02:35:10.355636] Imported install from built-in commands\r\n==> [2021-09-21-02:35:10.540958] Reading config file /global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2021-09-21-02:35:10.557869] Reading config file /global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/defaults/config.yaml\r\n==> [2021-09-21-02:35:10.600854] DATABASE LOCK TIMEOUT: 3s\r\n==> [2021-09-21-02:35:10.600984] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2021-09-21-02:35:10.601674] Reading config file /global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2021-09-21-02:35:10.614561] DATABASE LOCK TIMEOUT: 3s\r\n==> [2021-09-21-02:35:10.614668] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2021-09-21-02:35:10.614799] [BOOTSTRAP CONFIG SCOPE] name=_builtin\r\n==> [2021-09-21-02:35:10.615321] [BOOTSTRAP CONFIG SCOPE] name=defaults, path=/global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/defaults\r\n==> [2021-09-21-02:35:10.615396] [BOOTSTRAP CONFIG SCOPE] name=defaults/cray, path=/global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/defaults/cray\r\n==> [2021-09-21-02:35:10.615466] [BOOTSTRAP CONFIG SCOPE] name=system, path=/etc/spack\r\n==> [2021-09-21-02:35:10.615520] [BOOTSTRAP CONFIG SCOPE] name=system/cray, path=/etc/spack/cray\r\n==> [2021-09-21-02:35:10.615580] [BOOTSTRAP CONFIG SCOPE] name=site, path=/global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack\r\n==> [2021-09-21-02:35:10.615632] [BOOTSTRAP CONFIG SCOPE] name=site/cray, path=/global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/cray\r\n==> [2021-09-21-02:35:10.615693] [BOOTSTRAP CONFIG SCOPE] name=user, path=/global/homes/m/mdorier/.spack\r\n==> [2021-09-21-02:35:10.615744] [BOOTSTRAP CONFIG SCOPE] name=user/cray, path=/global/homes/m/mdorier/.spack/cray\r\n==> [2021-09-21-02:35:10.616379] Reading config file /global/homes/m/mdorier/.spack/cray/compilers.yaml\r\n==> [2021-09-21-02:35:11.032269] [BOOTSTRAP ROOT SPEC] clingo: clingo-bootstrap@spack+python %gcc target=x86_64\r\n==> [2021-09-21-02:35:11.032380] [BOOTSTRAP MODULE clingo] Try importing from Python\r\n==> [2021-09-21-02:35:11.032967] Reading config file /global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2021-09-21-02:35:11.314474] Reading config file /global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/defaults/config.yaml\r\n==> [2021-09-21-02:35:11.422333] [BOOTSTRAP MODULE clingo] The installed spec \"clingo-bootstrap@spack%gcc+python arch=linux-None-x86_64 ^python@3.6 /vcipwnf57slgoo7busvvkzjkk7vydeb5\" provides the \"clingo\" Python module\r\n==> [2021-09-21-02:35:11.423592] Reading config file /global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/defaults/repos.yaml\r\n==> [2021-09-21-02:35:14.550258] Reading config file /global/homes/m/mdorier/.spack/cray/compilers.yaml\r\n==> [2021-09-21-02:35:15.024881] Reading config file /global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/defaults/config.yaml\r\n==> [2021-09-21-02:35:15.092102] Reading config file /global/cscratch1/sd/mdorier/dwi_analysis/spack/etc/spack/defaults/packages.yaml\r\n```\r\n\r\nAt this point I cannot even kill spack with ctrl-C; I have to open a new terminal and issue a `kill -9`.\r\n\r\nHere is another spack.yaml file with the same problem, where I have removed the `python` entry from the `packages` section and added `perl`, which is another dependency of py-meshio:\r\n\r\n```yaml\r\nspack:\r\n  specs:\r\n  - py-meshio\r\n  concretization: together\r\n  compilers:\r\n  - compiler:\r\n      paths:\r\n        cc: cc\r\n        cxx: CC\r\n        f77: ftn\r\n        fc: ftn\r\n      operating_system: cnl7\r\n      target: any\r\n      modules:\r\n      - PrgEnv-gnu\r\n      - gcc/9.3.0\r\n      environment: {}\r\n      extra_rpaths: []\r\n      flags: {}\r\n      spec: gcc@9.3.0\r\n  packages:\r\n    all:\r\n      compiler:\r\n      - gcc@9.3.0\r\n      target:\r\n      - any\r\n      version: []\r\n      buildable: true\r\n    perl:\r\n      buildable: false\r\n      version: []\r\n      target: []\r\n      compiler: []\r\n      providers: {}\r\n      externals:\r\n      - spec: perl@5.26.1\r\n        prefix: /usr\r\n  view: true\r\n```\r\n\r\nIf I remove perl or python, the installation proceeds fine (at least it doesn't block like it does with the above environments). It seems to work well also if I add a package that doesn't appear in the py-meshio dependency tree.\n\n### Error message\n\n_No response_\n\n### Information on your system\n\n* **Spack:** 0.16.2-4328-45ba4d94bd\r\n* **Python:** 3.6.12\r\n* **Platform:** cray-sles15-haswell\r\n* **Concretizer:** clingo\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "mdorier",
    "url": "https://api.github.com/repos/spack/spack/issues/26100",
    "updated_at": "2021-09-21 09:44:01",
    "created_at": "2021-09-21 09:39:57",
    "closed_at": "None",
    "state": "open",
    "title": "spack install hangs on Cori with a simple environment",
    "number": 26100,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1002123229,
    "html_url": "https://github.com/spack/spack/issues/26100",
    "assignees": [
        "alalazo"
    ],
    "comments": 0
}