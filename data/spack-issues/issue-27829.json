{
    "body": "### Steps to reproduce\n\nThis issue has been reported by @haampie in DM over Slack. Using the following `compilers.yaml`:\r\n```yaml\r\ncompilers:\r\n- compiler:\r\n    spec: gcc@9.3.0\r\n    paths:\r\n      cc: /usr/bin/gcc\r\n      cxx: /usr/bin/g++\r\n      f77: /usr/bin/gfortran\r\n      fc: /usr/bin/gfortran\r\n    flags: {}\r\n    operating_system: ubuntu20.04\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n- compiler:\r\n    spec: clang@11.0.0\r\n    paths:\r\n      cc: /usr/bin/gcc\r\n      cxx: /usr/bin/g++\r\n      f77: /usr/bin/gfortran\r\n      fc: /usr/bin/gfortran\r\n    flags: {}\r\n    operating_system: ubuntu20.04\r\n    target: x86_64\r\n    modules: []\r\n    environment: {}\r\n    extra_rpaths: []\r\n```\r\nto mock having both `clang` and `gcc` the following spec:\r\n```console\r\n$ spack spec mpileaks %clang\r\n```\r\ngets concretized using mostly `gcc`.\n\n### Error message\n\n```console\r\n$ spack solve mpileaks %clang\r\n==> Best of 8 considered solutions.\r\n==> Optimization Criteria:\r\n  Priority  Criterion                                            Installed  ToBuild\r\n  1         number of packages to build (vs. reuse)                      -        0\r\n  2         deprecated versions used                                     0        0\r\n  3         version weight                                               0        0\r\n  4         number of non-default variants (roots)                       0        0\r\n  5         preferred providers for roots                                0        0\r\n  6         default values of variants not being used (roots)            0        0\r\n  7         number of non-default variants (non-roots)                   0        0\r\n  8         preferred providers (non-roots)                              0        0\r\n  9         compiler mismatches                                          0        3\r\n  10        OS mismatches                                                0        0\r\n  11        non-preferred OS's                                           0        0\r\n  12        version badness                                              0        7\r\n  13        default values of variants not being used (non-roots)        0        1\r\n  14        non-preferred compilers                                      0        1\r\n  15        target mismatches                                            0        0\r\n  16        non-preferred targets                                        0        0\r\n\r\nmpileaks@1.0%clang@11.0.0 stackstart=0 arch=linux-ubuntu20.04-icelake\r\n    ^adept-utils@1.0.1%gcc@9.3.0~ipo build_type=RelWithDebInfo arch=linux-ubuntu20.04-icelake\r\n        ^boost@1.72.0%gcc@9.3.0+atomic+chrono~clanglibcpp~container~context~coroutine+date_time~debug+exception~fiber+filesystem+graph~icu+iostreams+locale+log+math~mpi+multithreaded~numpy~pic+program_options~python+random+regex+serialization+shared+signals~singlethreaded+system~taggedlayout+test+thread+timer~versionedlayout+wave cxxstd=98 patches=e13cca1cfad7dcce9ed3d4ef989c14e464c4ea00caaf335f762e3677b35cab61 visibility=hidden arch=linux-ubuntu20.04-icelake\r\n            ^bzip2@1.0.8%gcc@9.3.0~debug~pic+shared arch=linux-ubuntu20.04-icelake\r\n                ^diffutils@3.8%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n                    ^libiconv@1.16%gcc@9.3.0 libs=shared,static arch=linux-ubuntu20.04-icelake\r\n            ^zlib@1.2.11%gcc@9.3.0+optimize+pic+shared arch=linux-ubuntu20.04-icelake\r\n        ^cmake@3.21.2%gcc@9.3.0~doc+ncurses+openssl+ownlibs~qt build_type=Release arch=linux-ubuntu20.04-icelake\r\n        ^openmpi@4.1.2%gcc@9.3.0~atomics~cuda~cxx~cxx_exceptions+gpfs~internal-hwloc~java~legacylaunchers~lustre~memchecker~pmi~pmix~singularity~sqlite3+static~thread_multiple+vt+wrapper-rpath fabrics=none schedulers=none arch=linux-ubuntu20.04-icelake\r\n            ^hwloc@2.6.0%gcc@9.3.0~cairo~cuda~gl~libudev+libxml2~netloc~nvml~opencl+pci~rocm+shared arch=linux-ubuntu20.04-icelake\r\n                ^libpciaccess@0.16%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n                    ^libtool@2.4.6%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n                        ^m4@1.4.19%gcc@9.3.0+sigsegv patches=9dc5fbd0d5cb1037ab1e6d0ecc74a30df218d0a94bdd5a02759a97f62daca573,bfdffa7c2eb01021d5849b36972c069693654ad826c1a20b53534009a4ec7a89 arch=linux-ubuntu20.04-icelake\r\n                            ^libsigsegv@2.13%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n                    ^pkgconf@1.8.0%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n                    ^util-macros@1.19.3%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n                ^libxml2@2.9.12%gcc@9.3.0~python arch=linux-ubuntu20.04-icelake\r\n                    ^xz@5.2.5%gcc@9.3.0~pic libs=shared,static arch=linux-ubuntu20.04-icelake\r\n                ^ncurses@6.2%gcc@9.3.0~symlinks+termlib abi=none arch=linux-ubuntu20.04-icelake\r\n            ^libevent@2.1.12%gcc@9.3.0+openssl arch=linux-ubuntu20.04-icelake\r\n                ^openssl@1.1.1l%gcc@9.3.0~docs certs=system arch=linux-ubuntu20.04-icelake\r\n                    ^perl@5.34.0%gcc@9.3.0+cpanm+shared+threads arch=linux-ubuntu20.04-icelake\r\n                        ^berkeley-db@18.1.40%gcc@9.3.0+cxx~docs+stl patches=b231fcc4d5cff05e5c3a4814f6a5af0e9a966428dc2176540d2c05aff41de522 arch=linux-ubuntu20.04-icelake\r\n                        ^gdbm@1.19%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n                            ^readline@8.1%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n            ^numactl@2.0.14%gcc@9.3.0 patches=4e1d78cbbb85de625bad28705e748856033eaafab92a66dffd383a3d7e00cc94,62fc8a8bf7665a60e8f4c93ebbd535647cebf74198f7afafec4c085a8825c006,ff37630df599cfabf0740518b91ec8daaf18e8f288b19adaae5364dc1f6b2296 arch=linux-ubuntu20.04-icelake\r\n                ^autoconf@2.69%gcc@9.3.0 patches=35c449281546376449766f92d49fc121ca50e330e60fefcfc9be2af3253082c2,7793209b33013dc0f81208718c68440c5aae80e7a1c4b8d336e382525af791a7,a49dd5bac3b62daa0ff688ab4d508d71dbd2f4f8d7e2a02321926346161bf3ee arch=linux-ubuntu20.04-icelake\r\n                ^automake@1.16.3%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n            ^openssh@8.7p1%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n                ^libedit@3.1-20210216%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n    ^callpath@1.0.4%gcc@9.3.0~ipo build_type=RelWithDebInfo arch=linux-ubuntu20.04-icelake\r\n        ^dyninst@12.0.1%gcc@9.3.0~ipo+openmp~stat_dysect~static build_type=RelWithDebInfo arch=linux-ubuntu20.04-icelake\r\n            ^elfutils@0.186%gcc@9.3.0~bzip2~debuginfod+nls~xz arch=linux-ubuntu20.04-icelake\r\n                ^gettext@0.21%gcc@9.3.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-ubuntu20.04-icelake\r\n                    ^tar@1.34%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n            ^intel-tbb@2020.3%gcc@9.3.0~ipo+shared+tm build_type=RelWithDebInfo cxxstd=default patches=62ba015ebd1819c45bef47411540b789b493e31ca668c4ff4cb2afcbc306b476,ce1fb16fb932ce86a82ca87cf0431d1a8c83652af9f552b264213b2ff2945d73,d62cb666de4010998c339cde6f41c7623a07e9fc69e498f2e149821c0c2c6dd0 arch=linux-ubuntu20.04-icelake\r\n            ^libiberty@2.33.1%gcc@9.3.0+pic arch=linux-ubuntu20.04-icelake\r\n        ^libdwarf@20180129%gcc@9.3.0 arch=linux-ubuntu20.04-icelake\r\n```\r\n\n\n### Information on your system\n\n* **Spack:** 0.17.0-456-fc045147aa\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-icelake\r\n* **Concretizer:** clingo\r\n\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have searched the issues of this repo and believe this is not a duplicate\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "alalazo",
    "url": "https://api.github.com/repos/spack/spack/issues/27829",
    "updated_at": "2021-12-22 10:44:34",
    "created_at": "2021-12-07 11:41:15",
    "closed_at": "None",
    "state": "open",
    "title": "ASP-based solver doesn't propagate compiler choices from cli to child nodes",
    "number": 27829,
    "milestone": null,
    "labels": [
        "bug",
        "concretization",
        "impact-medium",
        "concretizer-use-case"
    ],
    "id": 1073253051,
    "html_url": "https://github.com/spack/spack/issues/27829",
    "assignees": [
        "alalazo"
    ],
    "comments": 6
}