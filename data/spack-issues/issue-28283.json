{
    "body": "### Steps to reproduce the issue\n\n```\r\n$ spack install bazel\r\n\r\n==> Installing bazel-4.0.0-u3zmjotv372qzjcky26tggyhwic4tscq\r\n==> No binary for bazel-4.0.0-u3zmjotv372qzjcky26tggyhwic4tscq found: installing from source\r\n==> Fetching https://mirror.spack.io/_source-cache/archive/d3/d350f80e70654932db252db380d2ec0144a00e86f8d9f2b4c799ffdb48e9cdd1.zip\r\n==> Applied patch /projects/spack-contrib/spack/var/spack/repos/builtin/packages/bazel/bazelruleclassprovider-0.25.patch\r\n==> Applied patch /projects/spack-contrib/spack/var/spack/repos/builtin/packages/bazel/unix_cc_configure-3.0.patch\r\n==> Applied patch /projects/spack-contrib/spack/var/spack/repos/builtin/packages/bazel/compile-0.29.patch\r\n==> Applied patch /projects/spack-contrib/spack/var/spack/repos/builtin/packages/bazel/disabledepcheck.patch\r\n==> bazel: Executing phase: 'bootstrap'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '/usr/bin/bash' './compile.sh'\r\n\r\n8 errors found in build log:\r\n     13\r\n     14\r\n     15\r\n     16\r\n     17       Loading: 0 packages loaded\r\n     18\r\n  >> 19       DEBUG: /tmp/bazel_rgoLXkjb/out/external/bazel_toolchains/rules/rbe_repo/version_check.bzl:59:14:\r\n     20       Current running Bazel is not a release version and one was not defined explicitly in rbe_autoconfig target. Falling back to '3.1.0'\r\n     21       Loading: 0 packages loaded\r\n     22\r\n  >> 23       DEBUG: /tmp/bazel_rgoLXkjb/out/external/bazel_toolchains/rules/rbe_repo/checked_in.bzl:103:14: rbe_ubuntu1804_java11 not using checked\r\n              in configs as detect_java_home was set to True\r\n     24       Loading: 0 packages loaded\r\n     25\r\n  >> 26       DEBUG: /tmp/bazel_rgoLXkjb/out/external/bazel_toolchains/rules/rbe_repo/version_check.bzl:59:14:\r\n     27       Current running Bazel is not a release version and one was not defined explicitly in rbe_autoconfig target. Falling back to '3.1.0'\r\n     28       Loading: 0 packages loaded\r\n     29\r\n  >> 30       DEBUG: /tmp/bazel_rgoLXkjb/out/external/bazel_toolchains/rules/rbe_repo/checked_in.bzl:103:14: rbe_ubuntu1604_java8 not using checked i\r\n              n configs as detect_java_home was set to True\r\n     31       Loading: 0 packages loaded\r\n     32\r\n     33       Loading: 0 packages loaded\r\n     34           Fetching @io_bazel_skydoc; fetching\r\n     35\r\n     36\r\n\r\n     ...\r\n\r\n     99727        SPACK_TARGET_ARGS='-march=sandybridge -mtune=sandybridge' \\\r\n     99728      /bin/bash \\\r\n     99729        -c \\\r\n     99730        'source external/bazel_tools/tools/genrule/genrule-setup.sh; bazel-out/host/bin/src/create_embedded_tools \"bazel-out/k8-opt/bin/src\r\n              /embedded_tools_nojdk.zip\" bazel-out/k8-opt/bin/src/embedded_tools_nojdk.params')\r\n     99731    [1,130 / 1,148] [Prepa] Executing genrule //src:embedded_tools_nojdk\r\n     99732\r\n  >> 99733    ERROR: /tmp/mdorier/spack-stage/spack-stage-bazel-4.0.0-u3zmjotv372qzjcky26tggyhwic4tscq/spack-src/src/BUILD:309:9: Executing genrule /\r\n              /src:embedded_tools_nojdk failed: (Exit 127): bash failed: error executing command\r\n     99734      (cd /tmp/bazel_rgoLXkjb/out/execroot/io_bazel && \\\r\n     99735      exec env - \\\r\n     99736        PATH=/projects/spack-contrib/spack/opt/spack/linux-ubuntu21.04-sandybridge/gcc-10.3.0/zip-3.0-kzoo4t6fwcks5x7zq2ltp6r2ehaha3or/bin:\r\n              /projects/spack-contrib/spack/opt/spack/linux-ubuntu21.04-sandybridge/gcc-10.3.0/openjdk-11.0.12_7-5coywhserbxllsh47bwtgdfwv4kcsp5f/bin\r\n              :/projects/spack-contrib/spack/lib/spack/env/gcc:/projects/spack-contrib/spack/lib/spack/env/case-insensitive:/projects/spack-contrib/s\r\n              pack/lib/spack/env:/projects/spack-contrib/spack/bin:/projects/spack/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/\r\n              usr/games:/usr/local/games:/snap/bin:/home/mdorier/.local/bin \\\r\n     99737        SPACK_CC=/usr/bin/gcc \\\r\n     99738        SPACK_CC_RPATH_ARG=-Wl,-rpath, \\\r\n     99739        SPACK_COMPILER_SPEC=gcc@10.3.0 \\\r\n\r\n     ...\r\n\r\n     99759        SPACK_SYSTEM_DIRS=/bin:/usr/bin:/usr/local/bin:/bin64:/usr/bin64:/usr/local/bin64:/include:/usr/include:/usr/local/include:/lib:/us\r\n              r/lib:/usr/local/lib:/lib64:/usr/lib64:/usr/local/lib64:/:/usr:/usr/local \\\r\n     99760        SPACK_TARGET_ARGS='-march=sandybridge -mtune=sandybridge' \\\r\n     99761      /bin/bash -c 'source external/bazel_tools/tools/genrule/genrule-setup.sh; bazel-out/host/bin/src/create_embedded_tools \"bazel-out/k8-\r\n              opt/bin/src/embedded_tools_nojdk.zip\" bazel-out/k8-opt/bin/src/embedded_tools_nojdk.params')\r\n     99762    Execution platform: //:default_host_platform\r\n     99763    [1,131 / 1,148] checking cached actions\r\n     99764\r\n  >> 99765    /usr/bin/env: 'python': No such file or directory\r\n     99766    [1,131 / 1,148] checking cached actions\r\n     99767\r\n     99768    [1,131 / 1,148] checking cached actions\r\n     99769\r\n     99770    Target //src:bazel_nojdk failed to build\r\n     99771    [1,131 / 1,148] checking cached actions\r\n\r\n     ...\r\n\r\n     99773    INFO: Elapsed time: 444.197s, Critical Path: 16.25s\r\n     99774    [1,131 / 1,148] checking cached actions\r\n     99775\r\n     99776    INFO: 1131 processes: 22 internal, 1109 local.\r\n     99777    [1,131 / 1,148] checking cached actions\r\n     99778\r\n  >> 99779    FAILED: Build did NOT complete successfully\r\n     99780\r\n  >> 99781    FAILED: Build did NOT complete successfully\r\n     99782\r\n     99783    ERROR: Could not build Bazel\r\n```\r\n\r\nI have tried with bazel@3.4.0 and bazel@4.0.0 (the latest). Both fail (so I suspect other versions in-between will fail as well). Build logs are attached.\r\n@adamjstewart \r\n\r\n[bazel-3.4.0-build-out.txt](https://github.com/spack/spack/files/7822639/bazel-3.4.0-build-out.txt)\r\n[bazel-4.0.0-build-out.txt](https://github.com/spack/spack/files/7822643/bazel-4.0.0-build-out.txt)\n\n### Information on your system\n\n* **Spack:** 0.11.2-16007-88a7774f69\r\n* **Python:** 3.9.5\r\n* **Platform:** linux-ubuntu21.04-sandybridge\r\n* **Concretizer:** clingo\n\n### Additional information\n\n_No response_\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "mdorier",
    "url": "https://api.github.com/repos/spack/spack/issues/28283",
    "updated_at": "2022-01-06 21:16:43",
    "created_at": "2022-01-06 15:02:28",
    "closed_at": "2022-01-06 21:16:43",
    "state": "closed",
    "title": "Installation issue: bazel fails to build",
    "number": 28283,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1095403387,
    "html_url": "https://github.com/spack/spack/issues/28283",
    "assignees": [],
    "comments": 11
}