{
    "body": "Summary\r\n\r\nFollowing spack contribution guide (http://spack.readthedocs.io/en/latest/contribution_guide.html) to run \"spack test\" for unit test on develop branch, \"spack test\"  fails with the following error message:\r\n\r\n### Expected Result\r\n\r\nUnit test is running...\r\n\r\n### Actual Result\r\n```\r\n==> Reading config file /usr/workspace/wsa/wang102/temp/spack/etc/spack/defaults/modules.yaml\r\n==> Reading config file /usr/workspace/wsa/wang102/temp/spack/etc/spack/defaults/config.yaml\r\nTraceback (most recent call last):\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/bin/spack\", line 85, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/spack/main.py\", line 608, in main\r\n    return _main(command, parser, args, unknown)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/spack/main.py\", line 500, in _main\r\n    return _invoke_spack_command(command, parser, args, unknown_args)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/spack/main.py\", line 408, in _invoke_spack_command\r\n    return_val = command(parser, args, unknown_args)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/spack/cmd/test.py\", line 112, in test\r\n    return pytest.main(unknown_args + args.tests)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/config.py\", line 49, in main\r\n    config = _prepareconfig(args, plugins)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/config.py\", line 168, in _prepareconfig\r\n    pluginmanager=pluginmanager, args=args)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/vendored_packages/pluggy.py\", line 745, in __call__\r\n    return self._hookexec(self, self._nonwrappers + self._wrappers, kwargs)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/vendored_packages/pluggy.py\", line 339, in _hookexec\r\n    return self._inner_hookexec(hook, methods, kwargs)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/vendored_packages/pluggy.py\", line 334, in <lambda>\r\n    _MultiCall(methods, kwargs, hook.spec_opts).execute()\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/vendored_packages/pluggy.py\", line 613, in execute\r\n    return _wrapped_call(hook_impl.function(*args), self.execute)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/vendored_packages/pluggy.py\", line 250, in _wrapped_call\r\n    wrap_controller.send(call_outcome)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/helpconfig.py\", line 68, in pytest_cmdline_parse\r\n    config = outcome.get_result()\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/vendored_packages/pluggy.py\", line 280, in get_result\r\n    _reraise(*ex)  # noqa\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/vendored_packages/pluggy.py\", line 265, in __init__\r\n    self.result = func()\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/vendored_packages/pluggy.py\", line 614, in execute\r\n    res = hook_impl.function(*args)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/config.py\", line 957, in pytest_cmdline_parse\r\n    self.parse(args)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/config.py\", line 1121, in parse\r\n    self._preparse(args, addopts=addopts)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/config.py\", line 1084, in _preparse\r\n    self.pluginmanager.load_setuptools_entrypoints('pytest11')\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/vendored_packages/pluggy.py\", line 510, in load_setuptools_entrypoints\r\n    plugin = ep.load()\r\n  File \"/usr/tce/packages/python/python-2.7.14/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2302, in load\r\n    return self.resolve()\r\n  File \"/usr/tce/packages/python/python-2.7.14/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2308, in resolve\r\n    module = __import__(self.module_name, fromlist=['__name__'], level=0)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/_pytest/assertion/rewrite.py\", line 212, in load_module\r\n    py.builtin.exec_(co, mod.__dict__)\r\n  File \"/usr/workspace/wsa/wang102/temp/spack/lib/spack/external/py/_builtin.py\", line 221, in exec_\r\n    exec2(obj, globals, locals)\r\n  File \"<string>\", line 7, in exec2\r\n  File \"/usr/tce/packages/python/python-2.7.14/lib/python2.7/site-packages/hypothesis/extra/pytestplugin.py\", line 32, in <module>\r\n    re.sub('-.+', '', pytest.__version__).split('.')[:3]\r\nValueError: invalid literal for int() with base 10: 'unknown'\r\n```\r\n### Steps to reproduce the issue\r\n1. git clone https://github.com/spack/spack.git\r\n2. export $SPACK_ROOT=/path/to/spack/\r\n3. export PATH=$SPACK_ROOT/bin:$PATH\r\n4. source $SPACK_ROOT/share/spack/setup-env.sh\r\n5. follow contribution guide to install dependencies\r\n6. spack test\r\n\r\n### Information on your system\r\nspack: 0.11.2, development branch\r\nmachine architecture: Intel(R) Xeon(R) CPU E5-2695 v4 @ 2.10GHz\r\nOS: (Red Hat Enterprise Linux Server release 7.4 (Maipo)\r\ncompiler: Intel 18.0.2",
    "user": "twang15",
    "url": "https://api.github.com/repos/spack/spack/issues/8507",
    "updated_at": "2018-06-20 19:35:11",
    "created_at": "2018-06-18 21:23:51",
    "closed_at": "2018-06-20 19:35:11",
    "state": "closed",
    "title": "spack test fails with pytest version error",
    "number": 8507,
    "milestone": null,
    "labels": [
        "tests"
    ],
    "id": 333440135,
    "html_url": "https://github.com/spack/spack/issues/8507",
    "assignees": [],
    "comments": 14
}