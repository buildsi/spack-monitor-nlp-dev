{
    "body": "### Steps to reproduce the issue\n\nTrying to install `python %aocc@3.2.0`, it builds but fails to install.\r\nTested with both python 3.10.2 and 3.9.10.\r\n\r\n```console\r\n$ spack env create -d .\r\n==> Updating view at /home/bc/env/python-aocc/.spack-env/view\r\n==> Created environment in /home/bc/env/python-aocc\r\n==> You can activate this environment with:\r\n==>   spack env activate /home/bc/env/python-aocc\r\n$ spack env activate .\r\n$ spack add python@3.10.2 %aocc@3.2.0\r\n==> Adding python@3.10.2%aocc@3.2.0 to environment /home/bc/env/python-aocc\r\n$ spack concretize\r\n==> Starting concretization\r\n==> Environment concretized in 1.71 seconds.\r\n==> Concretized python@3.10.2%aocc@3.2.0\r\n -   o74ynhl  python@3.10.2%aocc@3.2.0+bz2+ctypes+dbm~debug+ensurepip+libxml2+lzma~nis~optimizations+pic+pyexpat+pythoncmd+readline+shared+sqlite3~ssl~tix~tkinter~ucs4+uuid+zlib patches=0d98e93,7d40923,f2fd060 arch=linux-rocky8-zen2\r\n[+]  wgogzcx      ^bzip2@1.0.8%aocc@3.2.0~debug~pic+shared arch=linux-rocky8-zen2\r\n[+]  o23a3xl          ^diffutils@3.8%aocc@3.2.0 arch=linux-rocky8-zen2\r\n[+]  uemw5kg              ^libiconv@1.16%aocc@3.2.0 libs=shared,static arch=linux-rocky8-zen2\r\n[+]  sooxcfg      ^expat@2.4.6%aocc@3.2.0+libbsd arch=linux-rocky8-zen2\r\n[+]  4vztj3p          ^libbsd@0.11.5%aocc@3.2.0 arch=linux-rocky8-zen2\r\n[+]  zvzvp2x              ^libmd@1.0.4%aocc@3.2.0 arch=linux-rocky8-zen2\r\n[+]  jlrov7c      ^gdbm@1.23%aocc@3.2.0 arch=linux-rocky8-zen2\r\n[+]  cbqy754          ^readline@8.1%aocc@3.2.0 arch=linux-rocky8-zen2\r\n[+]  bvfbvmm              ^ncurses@6.2%aocc@3.2.0~symlinks+termlib abi=none arch=linux-rocky8-zen2\r\n[+]  j5hsqox                  ^pkgconf@1.8.0%aocc@3.2.0 arch=linux-rocky8-zen2\r\n[+]  2f3jngz      ^gettext@0.21%aocc@3.2.0+bzip2+curses+git~libunistring+libxml2+tar+xz arch=linux-rocky8-zen2\r\n[+]  qplit6u          ^libxml2@2.9.12%aocc@3.2.0~python arch=linux-rocky8-zen2\r\n[+]  dzbxiwp              ^xz@5.2.5%aocc@3.2.0~pic libs=shared,static arch=linux-rocky8-zen2\r\n[+]  32whbbl              ^zlib@1.2.11%aocc@3.2.0+optimize+pic+shared arch=linux-rocky8-zen2\r\n[+]  omm37pb          ^tar@1.34%aocc@3.2.0 arch=linux-rocky8-zen2\r\n[+]  wso5ocb      ^libffi@3.4.2%aocc@3.2.0 arch=linux-rocky8-zen2\r\n[+]  3yiwpk6      ^sqlite@3.37.2%aocc@3.2.0+column_metadata+dynamic_extensions+fts~functions+rtree arch=linux-rocky8-zen2\r\n[+]  oz2etzo      ^util-linux-uuid@2.37.4%aocc@3.2.0 arch=linux-rocky8-zen2\r\n\r\n==> Updating view at /home/bc/env/python-aocc/.spack-env/view\r\n$ spack install\r\n```\r\n\n\n### Error message\n\n<details><summary>Error message</summary><pre>\r\n==> python: Executing phase: 'install'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j16' 'install'\r\n\r\n7 errors found in build log:\r\n     4170        if not compile_dir(dest, maxlevels, args.ddir,\r\n     4171      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py\", line 88, in compile_dir\r\n     4172        from concurrent.futures.process import _check_system_limits\r\n     4173      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/concurrent/futures/process.py\", line 52, in <module>\r\n     4174        import multiprocessing.connection\r\n     4175    IndexError: string index out of range\r\n  >> 4176    make: [Makefile:1550: libinstall] Error 1 (ignored)\r\n     4177    PYTHONPATH=/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10 LD_LIBRARY_PATH=/tmp/bc/spack-stage/spack-stage-python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/sp\r\n             ack-src/spack-build \\\r\n     4178    \t./python -E -Wi -O /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py \\\r\n     4179    \t-j0 -d /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10 -f \\\r\n     4180    \t-x 'bad_coding|badsyntax|site-packages|lib2to3/tests/data' \\\r\n     4181    \t/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10\r\n     4182    Traceback (most recent call last):\r\n\r\n     ...\r\n\r\n     4186        if not compile_dir(dest, maxlevels, args.ddir,\r\n     4187      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py\", line 88, in compile_dir\r\n     4188        from concurrent.futures.process import _check_system_limits\r\n     4189      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/concurrent/futures/process.py\", line 52, in <module>\r\n     4190        import multiprocessing.connection\r\n     4191    IndexError: string index out of range\r\n  >> 4192    make: [Makefile:1551: libinstall] Error 1 (ignored)\r\n     4193    PYTHONPATH=/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10 LD_LIBRARY_PATH=/tmp/bc/spack-stage/spack-stage-python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/sp\r\n             ack-src/spack-build \\\r\n     4194    \t./python -E -Wi -OO /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py \\\r\n     4195    \t-j0 -d /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10 -f \\\r\n     4196    \t-x 'bad_coding|badsyntax|site-packages|lib2to3/tests/data' \\\r\n     4197    \t/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10\r\n     4198    Traceback (most recent call last):\r\n\r\n     ...\r\n\r\n     4202        if not compile_dir(dest, maxlevels, args.ddir,\r\n     4203      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py\", line 88, in compile_dir\r\n     4204        from concurrent.futures.process import _check_system_limits\r\n     4205      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/concurrent/futures/process.py\", line 52, in <module>\r\n     4206        import multiprocessing.connection\r\n     4207    IndexError: string index out of range\r\n  >> 4208    make: [Makefile:1552: libinstall] Error 1 (ignored)\r\n     4209    PYTHONPATH=/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10 LD_LIBRARY_PATH=/tmp/bc/spack-stage/spack-stage-python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/sp\r\n             ack-src/spack-build \\\r\n     4210    \t./python -E -Wi /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py \\\r\n     4211    \t-j0 -d /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/site-packages -f \\\r\n     4212    \t-x badsyntax /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/site-packages\r\n     4213    Traceback (most recent call last):\r\n     4214      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py\", line 462, in <module>\r\n\r\n     ...\r\n\r\n     4217        if not compile_dir(dest, maxlevels, args.ddir,\r\n     4218      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py\", line 88, in compile_dir\r\n     4219        from concurrent.futures.process import _check_system_limits\r\n     4220      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/concurrent/futures/process.py\", line 52, in <module>\r\n     4221        import multiprocessing.connection\r\n     4222    IndexError: string index out of range\r\n  >> 4223    make: [Makefile:1553: libinstall] Error 1 (ignored)\r\n     4224    PYTHONPATH=/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10 LD_LIBRARY_PATH=/tmp/bc/spack-stage/spack-stage-python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/sp\r\n             ack-src/spack-build \\\r\n     4225    \t./python -E -Wi -O /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py \\\r\n     4226    \t-j0 -d /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/site-packages -f \\\r\n     4227    \t-x badsyntax /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/site-packages\r\n     4228    Traceback (most recent call last):\r\n     4229      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py\", line 462, in <module>\r\n\r\n     ...\r\n\r\n     4232        if not compile_dir(dest, maxlevels, args.ddir,\r\n     4233      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py\", line 88, in compile_dir\r\n     4234        from concurrent.futures.process import _check_system_limits\r\n     4235      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/concurrent/futures/process.py\", line 52, in <module>\r\n     4236        import multiprocessing.connection\r\n     4237    IndexError: string index out of range\r\n  >> 4238    make: [Makefile:1554: libinstall] Error 1 (ignored)\r\n     4239    PYTHONPATH=/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10 LD_LIBRARY_PATH=/tmp/bc/spack-stage/spack-stage-python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/sp\r\n             ack-src/spack-build \\\r\n     4240    \t./python -E -Wi -OO /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py \\\r\n     4241    \t-j0 -d /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/site-packages -f \\\r\n     4242    \t-x badsyntax /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/site-packages\r\n     4243    Traceback (most recent call last):\r\n     4244      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py\", line 462, in <module>\r\n\r\n     ...\r\n\r\n     4247        if not compile_dir(dest, maxlevels, args.ddir,\r\n     4248      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/compileall.py\", line 88, in compile_dir\r\n     4249        from concurrent.futures.process import _check_system_limits\r\n     4250      File \"/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/concurrent/futures/process.py\", line 52, in <module>\r\n     4251        import multiprocessing.connection\r\n     4252    IndexError: string index out of range\r\n  >> 4253    make: [Makefile:1555: libinstall] Error 1 (ignored)\r\n     4254    PYTHONPATH=/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10 LD_LIBRARY_PATH=/tmp/bc/spack-stage/spack-stage-python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/sp\r\n             ack-src/spack-build \\\r\n     4255    \t./python -E -m lib2to3.pgen2.driver /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/lib2to3/Grammar.txt\r\n     4256    Generating grammar tables from /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/lib2to3/Grammar.txt\r\n     4257    Writing grammar tables to /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/lib2to3/Grammar3.10.2.final.0.pickle\r\n     4258    PYTHONPATH=/home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10 LD_LIBRARY_PATH=/tmp/bc/spack-stage/spack-stage-python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/sp\r\n             ack-src/spack-build \\\r\n     4259    \t./python -E -m lib2to3.pgen2.driver /home/bc/spack/opt/spack/linux-rocky8-zen2/aocc-3.2.0/python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/lib/python3.10/lib2to3/PatternGrammar.txt\r\n\r\n     ...\r\n\r\n     4308        return _run_pip([*args, *_PACKAGE_NAMES], additional_paths)\r\n     4309      File \"/tmp/bc/spack-stage/spack-stage-python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/spack-src/Lib/ensurepip/__init__.py\", line 93, in _run_pip\r\n     4310        return subprocess.run([sys.executable, '-W', 'ignore::DeprecationWarning',\r\n     4311      File \"/tmp/bc/spack-stage/spack-stage-python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/spack-src/Lib/subprocess.py\", line 524, in run\r\n     4312        raise CalledProcessError(retcode, process.args,\r\n     4313    subprocess.CalledProcessError: Command '['/tmp/bc/spack-stage/spack-stage-python-3.10.2-o74ynhlkzwbmdmwmwozk6aceygiweyjb/spack-src/spack-build/python', '-W', 'ignore::DeprecationWarning', '-c', '\\nimport runpy\\nimport sys\\ns\r\n             ys.path = [\\'/tmp/tmp_z9c7nyo/setuptools-58.1.0-py3-none-any.whl\\', \\'/tmp/tmp_z9c7nyo/pip-21.2.4-py3-none-any.whl\\'] + sys.path\\nsys.argv[1:] = [\\'install\\', \\'--no-cache-dir\\', \\'--no-index\\', \\'--find-links\\', \\'/tmp/tmp_\r\n             z9c7nyo\\', \\'--root\\', \\'/\\', \\'setuptools\\', \\'pip\\']\\nrunpy.run_module(\"pip\", run_name=\"__main__\", alter_sys=True)\\n']' returned non-zero exit status 1.\r\n  >> 4314    make: *** [Makefile:1280: install] Error 1\r\n</pre></details>\r\n\n\n### Information on your system\n\n```\r\n* **Spack:** 0.17.1-1305-51488dbff5\r\n* **Python:** 3.6.8\r\n* **Platform:** linux-rocky8-zen2\r\n* **Concretizer:** clingo\r\n```\n\n### Additional information\n\n[spack-build-out.txt](https://github.com/spack/spack/files/8112853/spack-build-out.txt)\r\n[spack-build-env.txt](https://github.com/spack/spack/files/8112852/spack-build-env.txt)\r\n\r\n@adamjstewart  @scheibelp  @skosukhin  @varioustoxins @amd-toolchain-support\r\n\r\n\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "zzzoom",
    "url": "https://api.github.com/repos/spack/spack/issues/29115",
    "updated_at": "2022-02-22 05:57:32",
    "created_at": "2022-02-22 01:09:59",
    "closed_at": "None",
    "state": "open",
    "title": "Installation issue: python %aocc@3.2.0",
    "number": 29115,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1146348169,
    "html_url": "https://github.com/spack/spack/issues/29115",
    "assignees": [],
    "comments": 4
}