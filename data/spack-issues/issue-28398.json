{
    "body": "### Steps to reproduce the issue\r\n\r\n`hsakmt-roct@4.5.0` build fails using:\r\n* `spack@develop` (1ea4497802dde0ac63ec9aa95ea4d601331b7e2e from `Thu Jan 13 05:50:11 2022 -0500`\r\n* Ubuntu 20.04, x86_64\r\n* GCC 9.3.0\r\n* CMake 3.22.1\r\n\r\nConcrete spec: [hsakmt-roct-7pgzyzz.spec.json.txt](https://github.com/spack/spack/files/7863620/hsakmt-roct-7pgzyzz.spec.json.txt)\r\n\r\nConcretization:\r\n```\r\n -   hsakmt-roct@4.5.0%gcc@9.3.0~ipo+shared build_type=Release arch=linux-ubuntu20.04-x86_64\r\n[+]      ^cmake@3.22.1%gcc@9.3.0~doc+ncurses+openssl+ownlibs~qt build_type=Release arch=linux-ubuntu20.04-x86_64\r\n[+]          ^ncurses@6.2%gcc@9.3.0~symlinks+termlib abi=none arch=linux-ubuntu20.04-x86_64\r\n[+]              ^pkgconf@1.8.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]          ^openssl@1.1.1m%gcc@9.3.0~docs certs=system arch=linux-ubuntu20.04-x86_64\r\n[+]              ^perl@5.34.0%gcc@9.3.0+cpanm+shared+threads arch=linux-ubuntu20.04-x86_64\r\n[+]                  ^berkeley-db@18.1.40%gcc@9.3.0+cxx~docs+stl patches=b231fcc4d5cff05e5c3a4814f6a5af0e9a966428dc2176540d2c05aff41de522 arch=linux-ubuntu20.04-x86_64\r\n[+]                  ^bzip2@1.0.8%gcc@9.3.0~debug~pic+shared arch=linux-ubuntu20.04-x86_64\r\n[+]                      ^diffutils@3.8%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]                          ^libiconv@1.16%gcc@9.3.0 libs=shared,static arch=linux-ubuntu20.04-x86_64\r\n[+]                  ^gdbm@1.19%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]                      ^readline@8.1%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]                  ^zlib@1.2.11%gcc@9.3.0+optimize+pic+shared arch=linux-ubuntu20.04-x86_64\r\n[+]      ^libdrm@2.4.100%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]          ^docbook-xml@4.5%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]              ^libxml2@2.9.12%gcc@9.3.0~python arch=linux-ubuntu20.04-x86_64\r\n[+]                  ^xz@5.2.5%gcc@9.3.0+pic libs=shared,static arch=linux-ubuntu20.04-x86_64\r\n[+]          ^docbook-xsl@1.79.2%gcc@9.3.0 patches=a92c39715c54949ba9369add1809527b8f155b7e2a2b2e30cb4b39ee715f2e30 arch=linux-ubuntu20.04-x86_64\r\n[+]          ^libpciaccess@0.16%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]              ^libtool@2.4.6%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]                  ^m4@1.4.19%gcc@9.3.0+sigsegv patches=9dc5fbd0d5cb1037ab1e6d0ecc74a30df218d0a94bdd5a02759a97f62daca573,bfdffa7c2eb01021d5849b36972c069693654ad826c1a20b53534009a4ec7a89 arch=linux-ubuntu20.04-x86_64\r\n[+]                      ^libsigsegv@2.13%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]              ^util-macros@1.19.3%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]          ^libpthread-stubs@0.4%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n[+]      ^numactl@2.0.14%gcc@9.3.0 patches=4e1d78cbbb85de625bad28705e748856033eaafab92a66dffd383a3d7e00cc94,62fc8a8bf7665a60e8f4c93ebbd535647cebf74198f7afafec4c085a8825c006,ff37630df599cfabf0740518b91ec8daaf18e8f288b19adaae5364dc1f6b2296 arch=linux-ubuntu20.04-x86_64\r\n[+]          ^autoconf@2.69%gcc@9.3.0 patches=35c449281546376449766f92d49fc121ca50e330e60fefcfc9be2af3253082c2,7793209b33013dc0f81208718c68440c5aae80e7a1c4b8d336e382525af791a7,a49dd5bac3b62daa0ff688ab4d508d71dbd2f4f8d7e2a02321926346161bf3ee arch=linux-ubuntu20.04-x86_64\r\n[+]          ^automake@1.16.5%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n```\r\n\r\nBuild error:\r\n```\r\n$> spack mirror add test https://cache.e4s.io/test-workflow\r\n$> spack buildcache keys -it\r\n\r\n$> spack install --only dependencies --include-build-deps --cache-only -f ./hsakmt-roct-7pgzyzz.spec.json\r\n... OK\r\n\r\n$> spack install --no-cache -f ./hsakmt-roct-7pgzyzz.spec.json\r\n...\r\n==> Installing hsakmt-roct-4.5.0-7pgzyzzm4mrkezealtm7onag4ekrvh4j\r\n==> Using cached archive: /spack/var/spack/cache/_source-cache/archive/62/620b39959e0ee5d709b8cf6eb3cc06c8356d72838343756230c638899b10bb9a.tar.gz\r\n==> No patches needed for hsakmt-roct\r\n==> hsakmt-roct: Executing phase: 'cmake'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    'cmake' '-G' 'Unix Makefiles' '-DCMAKE_INSTALL_PREFIX:STRING=/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/hsakmt-roct-4.5.0-7pgzyzzm4mrkezealtm7onag4ekrvh4j' '-DCMAKE_BUILD_TYPE:STRING=Release' '-DCMAKE_INTERPROCEDURAL_OPTIMIZATION:BOOL=OFF' '-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON' '-DCMAKE_INSTALL_RPATH_USE_LINK_PATH:BOOL=OFF' '-DCMAKE_INSTALL_RPATH:STRING=/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/hsakmt-roct-4.5.0-7pgzyzzm4mrkezealtm7onag4ekrvh4j/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/hsakmt-roct-4.5.0-7pgzyzzm4mrkezealtm7onag4ekrvh4j/lib64;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libdrm-2.4.100-oubvjpazucmha66spq7cpu277ecpl5mh/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libpciaccess-0.16-4jbn7mznw664dc4mlseouzovsfx6sor5/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libpthread-stubs-0.4-wngdhpdeuvwyfid6b7rkvbhbm22e4dzr/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/numactl-2.0.14-e3evcwcbrfcfnv4j2h55y6n6dciu37wi/lib' '-DCMAKE_PREFIX_PATH:STRING=/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/numactl-2.0.14-e3evcwcbrfcfnv4j2h55y6n6dciu37wi;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libdrm-2.4.100-oubvjpazucmha66spq7cpu277ecpl5mh;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libpthread-stubs-0.4-wngdhpdeuvwyfid6b7rkvbhbm22e4dzr;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libpciaccess-0.16-4jbn7mznw664dc4mlseouzovsfx6sor5;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cmake-3.22.1-uc6y7qdjd6gnm5bkgosu5mj22n7h2jxd' '-DBUILD_SHARED_LIBS:BOOL=ON' '/tmp/root/spack-stage/spack-stage-hsakmt-roct-4.5.0-7pgzyzzm4mrkezealtm7onag4ekrvh4j/spack-src'\r\n\r\n3 errors found in build log:\r\n     15    fatal: not a git repository (or any of the parent directories): .git\r\n     16    -- Could NOT find PkgConfig (missing: PKG_CONFIG_EXECUTABLE)\r\n     17    -- Detected distribution: ubuntu:\"20.04\"\r\n     18    -- Could NOT find PkgConfig (missing: PKG_CONFIG_EXECUTABLE)\r\n     19    -- LIBC:/usr/lib/x86_64-linux-gnu/libc.so.6\r\n     20    -- NUMA:/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/numactl-2.0.14-e3evcwcbrfcfnv4j2h55y6n6dciu37wi/lib/libnuma.so\r\n  >> 21    CMake Error at /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cmake-3.22.1-uc6y7qdjd6gnm5bkgosu5mj22n7h2jxd/share/cmake-3.22/Modules/FindPkgConfig.cmake:659\r\n           (message):\r\n     22      pkg-config tool not found\r\n     23    Call Stack (most recent call first):\r\n     24      /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cmake-3.22.1-uc6y7qdjd6gnm5bkgosu5mj22n7h2jxd/share/cmake-3.22/Modules/FindPkgConfig.cmake:825 (_pkg_check_m\r\n           odules_internal)\r\n     25      CMakeLists.txt:179 (pkg_check_modules)\r\n     26\r\n     27\r\n  >> 28    CMake Error at /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cmake-3.22.1-uc6y7qdjd6gnm5bkgosu5mj22n7h2jxd/share/cmake-3.22/Modules/FindPkgConfig.cmake:659\r\n           (message):\r\n     29      pkg-config tool not found\r\n     30    Call Stack (most recent call first):\r\n     31      /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cmake-3.22.1-uc6y7qdjd6gnm5bkgosu5mj22n7h2jxd/share/cmake-3.22/Modules/FindPkgConfig.cmake:825 (_pkg_check_m\r\n           odules_internal)\r\n     32      CMakeLists.txt:180 (pkg_check_modules)\r\n     33\r\n     34\r\n  >> 35    CMake Error at CMakeLists.txt:195 (find_library):\r\n     36      Could not find UDEV using the following names: libudev.so, libudev.a\r\n     37\r\n     38\r\n     39    -- Configuring incomplete, errors occurred!\r\n     40    See also \"/tmp/root/spack-stage/spack-stage-hsakmt-roct-4.5.0-7pgzyzzm4mrkezealtm7onag4ekrvh4j/spack-build-7pgzyzz/CMakeFiles/CMakeOutput.log\".\r\n```\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.17.1-824-1ea4497802\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-cascadelake\r\n* **Concretizer:** clingo\r\n\r\n### Additional information\r\n\r\n[CMakeOutput.log](https://github.com/spack/spack/files/7863669/CMakeOutput.log)\r\n[spack-build-01-cmake-out.txt](https://github.com/spack/spack/files/7863671/spack-build-01-cmake-out.txt)\r\n[spack-build-env.txt](https://github.com/spack/spack/files/7863672/spack-build-env.txt)\r\n[spack-build-out.txt](https://github.com/spack/spack/files/7863673/spack-build-out.txt)\r\n[spack-configure-args.txt](https://github.com/spack/spack/files/7863674/spack-configure-args.txt)\r\n\r\n@srekolam\r\n@arjun-raj-kuppala\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\r\n- [X] I have uploaded the build log and environment files\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "eugeneswalker",
    "url": "https://api.github.com/repos/spack/spack/issues/28398",
    "updated_at": "2022-01-14 15:38:19",
    "created_at": "2022-01-13 14:54:51",
    "closed_at": "2022-01-14 15:38:19",
    "state": "closed",
    "title": "hsakmt-roct@4.5.0 build fails: CMake: Could NOT find PkgConfig, Could not find UDEV",
    "number": 28398,
    "milestone": null,
    "labels": [
        "build-error",
        "e4s",
        "ROCm/hip"
    ],
    "id": 1101897914,
    "html_url": "https://github.com/spack/spack/issues/28398",
    "assignees": [
        "srekolam"
    ],
    "comments": 3
}