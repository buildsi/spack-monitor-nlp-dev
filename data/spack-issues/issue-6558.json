{
    "body": "`spack install py-matplotlib` with\r\n- mpl 2.0.2\r\n- python 2.7.13\r\n- GCC 6.3.0\r\n\r\n(- cython 0.25.2)\r\n\r\nfails on a Cython error in Debian 9.2 (note that cython is not a direct dependency of MPL).\r\n\r\n### Expected Result\r\n\r\nIt should build & install :)\r\n\r\n### Actual Result\r\n\r\n```\r\n==> Executing phase: 'build'\r\n==> '/home/axel/src/spack/opt/spack/linux-debian9-x86_64/gcc-6.3.0/python-2.7.13-rqdcehaqxz5gp2uplit25gtv6jm4g7fs/bin/python2.7' 'setup.py' '--no-user-cfg' 'build'\r\n============================================================================\r\nEdit setup.cfg to change the build options\r\n\r\nBUILDING MATPLOTLIB\r\n            matplotlib: yes [2.0.2]\r\n                python: yes [2.7.13 (default, Dec  2 2017, 14:03:34)  [GCC\r\n                        6.3.0 20170516]]\r\n              platform: yes [linux2]\r\n\r\nREQUIRED DEPENDENCIES AND EXTENSIONS\r\n                 numpy: yes [version 1.13.3]\r\n                   six: yes [using six version 1.10.0]\r\n              dateutil: yes [using dateutil version 2.5.2]\r\n           functools32: yes [using functools32]\r\n          subprocess32: yes [using subprocess32]\r\n                  pytz: yes [using pytz version 2017.2]\r\n                cycler: yes [using cycler version 0.10.0]\r\n               tornado: yes [using tornado version 4.3]\r\n             pyparsing: yes [using pyparsing version 2.2.0]\r\n                libagg: yes [pkg-config information for 'libagg' could not\r\n                        be found. Using local copy.]\r\n              freetype: yes [version 2.7.1]\r\n                   png: yes [version 1.6.29]\r\n                 qhull: yes [pkg-config information for 'qhull' could not be\r\n                        found. Using local copy.]\r\n\r\nOPTIONAL SUBPACKAGES\r\n           sample_data: yes [installing]\r\n              toolkits: yes [installing]\r\n                 tests: no  [skipping due to configuration]\r\n        toolkits_tests: no  [skipping due to configuration]\r\n\r\nOPTIONAL BACKEND EXTENSIONS\r\n                macosx: no  [Mac OS-X only]\r\n                qt5agg: no  [PyQt5 not found]\r\n                qt4agg: no  [PySide not found; PyQt4 not found]\r\n               gtk3agg: no  [Requires pygobject to be installed.]\r\n             gtk3cairo: no  [Requires cairocffi or pycairo to be installed.]\r\n                gtkagg: no  [Requires pygtk]\r\n                 tkagg: yes [installing; run-time loading from Python Tcl /\r\n                        Tk]\r\n                 wxagg: no  [requires wxPython]\r\n                   gtk: no  [Requires pygtk]\r\n                   agg: yes [installing]\r\n                 cairo: no  [cairocffi or pycairo not found]\r\n             windowing: no  [Microsoft Windows only]\r\n\r\nOPTIONAL LATEX DEPENDENCIES\r\n                dvipng: yes [version 1.14]\r\n           ghostscript: yes [version 9.20]\r\n                 latex: yes [version 3.14159265]\r\n               pdftops: yes [version 0.48.0]\r\n\r\nOPTIONAL PACKAGE DATA\r\n                  dlls: no  [skipping due to configuration]\r\n\r\nrunning build\r\nrunning build_py\r\ncopying lib/matplotlib/mpl-data/matplotlibrc -> build/lib.linux-x86_64-2.7/matplotlib/mpl-data\r\nUPDATING build/lib.linux-x86_64-2.7/matplotlib/_version.py\r\nset build/lib.linux-x86_64-2.7/matplotlib/_version.py to '2.0.2'\r\nrunning build_ext\r\nfailed to import Cython: /home/axel/.local/lib/python2.7/site-packages/Cython/Compiler/Scanning.so: undefined symbol: PyUnicodeUCS4_DecodeUTF8\r\nerror: Cython does not appear to be installed\r\n```\r\n\r\n### Steps to reproduce the issue\r\n\r\n```console\r\n$ spack install py-matplotlib\r\n```\r\n\r\n### Information on your system\r\n\r\n- Debian 9.2 (x86_64)\r\n- spack `develop` as of 80048ae4a\r\n\r\n### Misc\r\n\r\nCould this be related to the way python was build as in https://stackoverflow.com/a/2584554/2719194 ? Python seems to be indeed installed with `+pic+shared~tk~ucs4` when I check.\r\n\r\nRunning\r\n```console\r\n$ spack install py-matplotlib ^python+ucs4\r\n```\r\nthen fails on\r\n```\r\nCython/Compiler/Code.so: undefined symbol: PyFPE_jbuf\r\n```",
    "user": "ax3l",
    "url": "https://api.github.com/repos/spack/spack/issues/6558",
    "updated_at": "2018-10-17 22:52:06",
    "created_at": "2017-12-03 13:49:15",
    "closed_at": "2018-10-17 22:52:05",
    "state": "closed",
    "title": "setuptools build_ext always tries to load Cython",
    "number": 6558,
    "milestone": null,
    "labels": [
        "build-error",
        "python",
        "dependencies"
    ],
    "id": 278778107,
    "html_url": "https://github.com/spack/spack/issues/6558",
    "assignees": [],
    "comments": 12
}