{
    "body": "### Steps to reproduce\r\n\r\nWhen I load a package with `spack load`, I end up with duplicate paths in the environment variables that get set. For even a moderately sized set of packages (10+), this quickly exceeds the maximum length for environment variables on the system:\r\n```\r\n-bash: /usr/bin/dirname: Argument list too long\r\n```\r\n\r\nTo demonstrate this, take the `py-matplotlib` package:\r\n```console\r\n$ spack install py-matplotlib\r\n$ spack load --first py-matplotlib\r\n```\r\n\r\n### Error message\r\n\r\nWhen I check `PYTHONPATH`, I see that dependencies like setuptools appear 3 times, and six appears 4 times.\r\n```console\r\n$ echo $PYTHONPATH | tr : '\\n' | sort\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-cycler-0.10.0-5jodfhlupwm2e3adp3hemefhj34hffky/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-cycler-0.10.0-5jodfhlupwm2e3adp3hemefhj34hffky/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-kiwisolver-1.1.0-zikb73vv6sdlbyg67xpjhnmaaict5pkl/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-kiwisolver-1.1.0-zikb73vv6sdlbyg67xpjhnmaaict5pkl/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-matplotlib-3.4.2-i747rnk3jjwylwzfh6y3t6n4nw5qb7l4/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-numpy-1.21.1-4gd5peaoz6hufkh4asjmkttgqijx3gp2/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-numpy-1.21.1-4gd5peaoz6hufkh4asjmkttgqijx3gp2/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-pillow-simd-7.0.0.post3-nntq4ynahh6t4eulvisz67dzf5dajdl7/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-pillow-simd-7.0.0.post3-nntq4ynahh6t4eulvisz67dzf5dajdl7/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-pyparsing-2.4.7-t7pbxymwj64kxkyuxp72up4d4f7vajlz/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-pyparsing-2.4.7-t7pbxymwj64kxkyuxp72up4d4f7vajlz/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-python-dateutil-2.8.1-buwbm3rju5exkjbuui4rcwvhjabt25x7/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-python-dateutil-2.8.1-buwbm3rju5exkjbuui4rcwvhjabt25x7/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-setuptools-50.3.2-hazhr4mmmfcq3a2n7gyeav3jtuhp7u53/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-setuptools-50.3.2-hazhr4mmmfcq3a2n7gyeav3jtuhp7u53/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-setuptools-50.3.2-hazhr4mmmfcq3a2n7gyeav3jtuhp7u53/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-six-1.15.0-tsg7v3onyxhkobvgo6xlxj6sulaw4djl/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-six-1.15.0-tsg7v3onyxhkobvgo6xlxj6sulaw4djl/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-six-1.15.0-tsg7v3onyxhkobvgo6xlxj6sulaw4djl/lib/python3.8/site-packages\r\n/home/t-astewart/spack/opt/spack/linux-ubuntu20.04-skylake/gcc-9.3.0/py-six-1.15.0-tsg7v3onyxhkobvgo6xlxj6sulaw4djl/lib/python3.8/site-packages\r\n```\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.16.2-3828-cfbefee0fa\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-skylake\r\n* **Concretizer:** original\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "adamjstewart",
    "url": "https://api.github.com/repos/spack/spack/issues/25306",
    "updated_at": "2021-08-31 15:27:18",
    "created_at": "2021-08-07 21:54:59",
    "closed_at": "None",
    "state": "open",
    "title": "`spack load` results in duplicate paths in env vars",
    "number": 25306,
    "milestone": null,
    "labels": [
        "bug",
        "triage",
        "run-environment"
    ],
    "id": 963310040,
    "html_url": "https://github.com/spack/spack/issues/25306",
    "assignees": [],
    "comments": 6
}