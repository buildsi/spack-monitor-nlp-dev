{
    "body": "[This could well be user error....]\n\n`spack deactivate -a` crashed.  The details are in the final code block.  The rest is context.\n\nI'm still trying to get my head around extensions, so I installed r-shiny (a couple of packages are out of date, a PR's on the way) and did this:\n\n```\n[throgg@spack-central spack]$ spack activate r-shiny\n==> Activated extension r-R6@2.1.2%gcc@5.4.0 arch=linux-centos7-x86_64-r3mzzmi for R@3.3.1~external-lapack%gcc@5.4.0\n==> Activated extension r-digest@0.6.9%gcc@5.4.0 arch=linux-centos7-x86_64-m2sqzn6 for R@3.3.1~external-lapack%gcc@5.4.0\n==> Activated extension r-rcpp@0.12.6%gcc@5.4.0 arch=linux-centos7-x86_64-h4lnm7e for R@3.3.1~external-lapack%gcc@5.4.0\n==> Activated extension r-htmltools@0.3.5%gcc@5.4.0 arch=linux-centos7-x86_64-4fywxyo for R@3.3.1~external-lapack%gcc@5.4.0\n==> Activated extension r-httpuv@1.3.3%gcc@5.4.0 arch=linux-centos7-x86_64-vh2puab for R@3.3.1~external-lapack%gcc@5.4.0\n==> Activated extension r-jsonlite@1.0%gcc@5.4.0 arch=linux-centos7-x86_64-cg6jy6f for R@3.3.1~external-lapack%gcc@5.4.0\n==> Activated extension r-mime@0.5%gcc@5.4.0 arch=linux-centos7-x86_64-gx5ztlo for R@3.3.1~external-lapack%gcc@5.4.0\n==> Activated extension r-xtable@1.8-2%gcc@5.4.0 arch=linux-centos7-x86_64-t52tspc for R@3.3.1~external-lapack%gcc@5.4.0\n==> Activated extension r-shiny@0.13.2%gcc@5.4.0 arch=linux-centos7-x86_64-kqimhjd for R@3.3.1~external-lapack%gcc@5.4.0\n[throgg@spack-central spack]$ find /home/throgg/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/R-3.3.1-wapajixhz5htjddymx3pn7vgcyqhhcrk | grep shiny\n/home/throgg/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/R-3.3.1-wapajixhz5htjddymx3pn7vgcyqhhcrk/rlib/R/library/shiny\n/home/throgg/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/R-3.3.1-wapajixhz5htjddymx3pn7vgcyqhhcrk/rlib/R/library/shiny/LICENSE\n[...]\n```\n\nThen I deactivated it and was curious if the dependencies were still 'activated' (checked _jsonlite_):\n\n```\n[throgg@spack-central spack]$ spack deactivate r-shiny\n==> Deactivated extension r-shiny@0.13.2%gcc@5.4.0 arch=linux-centos7-x86_64-kqimhjd for R@3.3.1~external-lapack%gcc@5.4.0\n[throgg@spack-central spack]$ find /home/throgg/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/R-3.3.1-wapajixhz5htjddymx3pn7vgcyqhhcrk | grep shiny\n[throgg@spack-central spack]$ find /home/throgg/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/R-3.3.1-wapajixhz5htjddymx3pn7vgcyqhhcrk | grep jsonlite\n/home/throgg/spack/opt/spack/linux-centos7-x86_64/gcc-5.4.0/R-3.3.1-wapajixhz5htjddymx3pn7vgcyqhhcrk/rlib/R/library/jsonlite\n[...]\n```\n\nThen I tried the `-a` option, which didn't work because I'd already deactivated _r-shiny_.\n\nSo I reactivated it and then tried `deactivate -r` and got the following crash:\n\n```\n[throgg@spack-central spack]$ spack deactivate -a r-shiny\n==> Error: r-shiny@0.13.2%gcc@5.4.0 arch=linux-centos7-x86_64-kqimhjd is not activated.\n[throgg@spack-central spack]$ spack activate r-shiny\n==> Activated extension r-shiny@0.13.2%gcc@5.4.0 arch=linux-centos7-x86_64-kqimhjd for R@3.3.1~external-lapack%gcc@5.4.0\n[throgg@spack-central spack]$ spack deactivate -a r-shiny\n==> Deactivating r-shiny@0.13.2%gcc@5.4.0 arch=linux-centos7-x86_64-kqimhjd and all dependencies.\nTraceback (most recent call last):\n  File \"/home/throgg/spack/bin/spack\", line 179, in <module>\n    main()\n  File \"/home/throgg/spack/bin/spack\", line 157, in main\n    return_val = command(parser, args)\n  File \"/home/throgg/spack/lib/spack/spack/cmd/deactivate.py\", line 70, in deactivate\n    topo_order = topological_sort(spec)\n  File \"/home/throgg/spack/lib/spack/spack/graph.py\", line 105, in topological_sort\n    for dep in children(node).values():\nAttributeError: 'list' object has no attribute 'values'\n[throgg@spack-central spack]$\n```\n",
    "user": "hartzell",
    "url": "https://api.github.com/repos/spack/spack/issues/1372",
    "updated_at": "2016-08-08 21:16:11",
    "created_at": "2016-07-26 16:56:20",
    "closed_at": "2016-08-08 21:15:51",
    "state": "closed",
    "title": "Crash with `spack deactivate -a ...`",
    "number": 1372,
    "milestone": null,
    "labels": [],
    "id": 167658180,
    "html_url": "https://github.com/spack/spack/issues/1372",
    "assignees": [],
    "comments": 4
}