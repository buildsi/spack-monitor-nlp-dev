{
    "body": "### Steps to reproduce the issue\r\n\r\n`llvm@main +clang +compiler-rt +libcxx +lld +lldb +llvm_dylib ~cuda` fails to build using:\r\n* `spack@develop` (e4e4bf75ca1f640901621e18bfa0d69e4f5474c6 from `Wed Aug 25 16:35:49 2021 -0600`)\r\n* Ubuntu 20.04, GCC 9.3.0\r\n\r\nConcrete spec: [llvm.spec.yaml.txt](https://github.com/spack/spack/files/7050471/llvm.spec.yaml.txt)\r\n\r\nReproduced below using Docker container image `ecpe4s/ubuntu20.04-runner-x86_64:2021-07-01`\r\n\r\n```\r\n$> spack mirror add E4S https://cache.e4s.io\r\n$> spack buildcache keys -it\r\n\r\n$> spack install --cache-only --include-build-deps --only dependencies -f ./llvm.spec.yaml\r\nOK\r\n\r\n$> spack install --no-cache -f ./llvm.spec.yaml\r\n...\r\n==> Installing llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax\r\n==> No patches needed for llvm\r\n==> llvm: Executing phase: 'cmake'\r\n==> llvm: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j32'\r\n\r\n48 errors found in build log:\r\n     8166    In file included from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/compare:130,\r\n     8167                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/utility:226,\r\n     8168                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/__functional_base:26,\r\n     8169                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/memory:671,\r\n     8170                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/libcxxabi/src/include/atomic_support.h:17,\r\n     8171                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/libcxxabi/src/cxa_default_handlers.cpp:18:\r\n  >> 8172    /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/__compare/compare_three_way_result.h:28:45: error: expected\r\n             primary-expression before '>' token\r\n     8173       28 |   declval<__make_const_lvalue_ref<_Tp>>() <=> declval<__make_const_lvalue_ref<_Up>>(), void()\r\n     8174          |                                             ^\r\n  >> 8175    /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/__compare/compare_three_way_result.h:30:69: error: expected\r\n             primary-expression before '>' token\r\n     8176       30 |     using type = decltype(declval<__make_const_lvalue_ref<_Tp>>() <=> declval<__make_const_lvalue_ref<_Up>>());\r\n     8177          |                                                                     ^\r\n     8178    [ 20%] Building CXX object utils/benchmark/src/CMakeFiles/benchmark.dir/reporter.cc.o\r\n     8179    cd /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/utils/benchmark/src && /spack/lib/spack/env/gcc/g++ -DHAVE_POSIX_REGEX -\r\n             DHAVE_STD_REGEX -DHAVE_STEADY_CLOCK -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -I/tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7\r\n             pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/utils/benchmark/src -I/tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/llvm/utils/bench\r\n             mark/src -I/tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include -I/tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnji\r\n             xcy5dk523it3seaosznlax/spack-src/llvm/include -I/tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/llvm/utils/benchmark/include -I/tmp/r\r\n             oot/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/llvm/utils/benchmark/src/../include -std=c++11 -fPIC -fno-semantic-interposition -fvisibili\r\n             ty-inlines-hidden -Werror=date-time -Wall -Wextra -Wno-unused-parameter -Wwrite-strings -Wcast-qual -Wno-missing-field-initializers -pedantic -Wno-long-long -Wimplicit-fall\r\n             through -Wno-maybe-uninitialized -Wno-class-memaccess -Wno-redundant-move -Wno-pessimizing-move -Wno-noexcept-type -Wdelete-non-virtual-dtor -Wsuggest-override -Wno-comment\r\n              -Wmisleading-indentation -ffunction-sections -fdata-sections  -std=c++11  -Wall  -Wextra  -Wshadow  -pedantic  -pedantic-errors  -Wfloat-equal  -fstrict-aliasing  -fno-exc\r\n             eptions  -Wno-suggest-override  -Wstrict-aliasing -O3 -DNDEBUG -std=c++14 -MD -MT utils/benchmark/src/CMakeFiles/benchmark.dir/reporter.cc.o -MF CMakeFiles/benchmark.dir/re\r\n             porter.cc.o.d -o CMakeFiles/benchmark.dir/reporter.cc.o -c /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/llvm/utils/benchmark/src/r\r\n             eporter.cc\r\n     8180    [ 20%] Building CXX object utils/benchmark/src/CMakeFiles/benchmark.dir/sleep.cc.o\r\n     8181    cd /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/utils/benchmark/src && /spack/lib/spack/env/gcc/g++ -DHAVE_POSIX_REGEX -\r\n             DHAVE_STD_REGEX -DHAVE_STEADY_CLOCK -D_GNU_SOURCE -D__STDC_CONSTANT_MACROS -D__STDC_FORMAT_MACROS -D__STDC_LIMIT_MACROS -I/tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7\r\n             pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/utils/benchmark/src -I/tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/llvm/utils/bench\r\n             mark/src -I/tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include -I/tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnji\r\n             xcy5dk523it3seaosznlax/spack-src/llvm/include -I/tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/llvm/utils/benchmark/include -I/tmp/r\r\n             oot/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/llvm/utils/benchmark/src/../include -std=c++11 -fPIC -fno-semantic-interposition -fvisibili\r\n             ty-inlines-hidden -Werror=date-time -Wall -Wextra -Wno-unused-parameter -Wwrite-strings -Wcast-qual -Wno-missing-field-initializers -pedantic -Wno-long-long -Wimplicit-fall\r\n             through -Wno-maybe-uninitialized -Wno-class-memaccess -Wno-redundant-move -Wno-pessimizing-move -Wno-noexcept-type -Wdelete-non-virtual-dtor -Wsuggest-override -Wno-comment\r\n              -Wmisleading-indentation -ffunction-sections -fdata-sections  -std=c++11  -Wall  -Wextra  -Wshadow  -pedantic  -pedantic-errors  -Wfloat-equal  -fstrict-aliasing  -fno-exc\r\n             eptions  -Wno-suggest-override  -Wstrict-aliasing -O3 -DNDEBUG -std=c++14 -MD -MT utils/benchmark/src/CMakeFiles/benchmark.dir/sleep.cc.o -MF CMakeFiles/benchmark.dir/sleep\r\n             .cc.o.d -o CMakeFiles/benchmark.dir/sleep.cc.o -c /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/llvm/utils/benchmark/src/sleep.cc\r\n\r\n     ...\r\n\r\n     8184                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/__algorithm/search.h:16,\r\n     8185                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/functional:490,\r\n     8186                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/algorithm:653,\r\n     8187                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/libcxxabi/src/demangle/StringView.h:17,\r\n     8188                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/libcxxabi/src/demangle/ItaniumDemangle.h:22,\r\n     8189                     from /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-src/libcxxabi/src/cxa_demangle.cpp:13:\r\n  >> 8190    /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/__compare/compare_three_way_result.h:28:45: error: expected\r\n             primary-expression before '>' token\r\n     8191       28 |   declval<__make_const_lvalue_ref<_Tp>>() <=> declval<__make_const_lvalue_ref<_Up>>(), void()\r\n     8192          |                                             ^\r\n  >> 8193    /tmp/root/spack-stage/spack-stage-llvm-main-mbzkg7pnjixcy5dk523it3seaosznlax/spack-build-mbzkg7p/include/c++/v1/__compare/compare_three_way_result.h:30:69: error: expected\r\n             primary-expression before '>' token\r\n     8194       30 |     using type = decltype(declval<__make_const_lvalue_ref<_Tp>>() <=> declval<__make_const_lvalue_ref<_Up>>());\r\n     8195          |\r\n...\r\n```\r\n\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.16.2-4031-e4e4bf75ca\r\n* **Python:** 3.8.5\r\n* **Platform:** linux-ubuntu20.04-cascadelake\r\n* **Concretizer:** original\r\n\r\n### Additional information\r\n\r\nBuild log: [llvm-build-out.txt](https://github.com/spack/spack/files/7050474/llvm-build-out.txt)\r\n\r\n@trws @naromero77\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\r\n- [X] I have uploaded the build log and environment files\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "eugeneswalker",
    "url": "https://api.github.com/repos/spack/spack/issues/25617",
    "updated_at": "2021-08-27 23:18:12",
    "created_at": "2021-08-25 23:24:30",
    "closed_at": "2021-08-27 23:18:12",
    "state": "closed",
    "title": "llvm@main fails: expected primary-expression before '>' token",
    "number": 25617,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 979691877,
    "html_url": "https://github.com/spack/spack/issues/25617",
    "assignees": [],
    "comments": 4
}