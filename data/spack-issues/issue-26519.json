{
    "body": "### Steps to reproduce\r\n\r\nRunning tests on `py-numpy` installed on September 27th -- though likely from a branch and not `develop` -- yields import failures.  \r\n\r\nIf I uninstall and re-install the package from `develop`, I do not get those failures. While that is okay under development, I imagine it would not be acceptable for facilities.\r\n\r\n```\r\n$ spack test run py-numpy\r\n```\r\n\r\n### Error message\r\n\r\nRunning from the system I think I used to install the software:\r\n\r\n```\r\n$ spack -d test run py-numpy\r\n==> [2021-10-04-14:47:18.423531] Imported test from built-in commands\r\n==> [2021-10-04-14:47:18.425036] Reading config file /usr/WS1/dahlgren/spack/etc/spack/defaults/config.yaml\r\n==> [2021-10-04-14:47:18.445073] Imported test from built-in commands\r\n==> [2021-10-04-14:47:18.449202] Reading config file /usr/WS1/dahlgren/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2021-10-04-14:47:18.458374] DATABASE LOCK TIMEOUT: 3s\r\n==> [2021-10-04-14:47:18.458438] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2021-10-04-14:47:18.480020] Reading config file /usr/WS1/dahlgren/spack/etc/spack/defaults/repos.yaml\r\n==> [2021-10-04-14:47:18.482438] Reading config file /g/g21/dahlgren/.spack/repos.yaml\r\n==> [2021-10-04-14:47:19.124442] Spack test 7lynazwpycl2wfqekgj3ghqupicodesm\r\n==> [2021-10-04-14:47:19.126842] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/blas-lapack-order.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.130038] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/add_fj_compiler.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.132848] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/add_fj_compiler2.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.135492] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/add_fj_compiler3.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.138177] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/add_fj_compiler4.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.141100] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/check_executables.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.143777] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/check_executables2.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.146448] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/check_executables3.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.149259] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/check_executables4.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.151899] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/check_executables5.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.154415] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/package.py to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.157200] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/blas-lapack-order.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.159956] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/add_fj_compiler.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.162634] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/add_fj_compiler2.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.165179] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/add_fj_compiler3.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.167920] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/add_fj_compiler4.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.170794] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/check_executables.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.173410] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/check_executables2.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.175919] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/check_executables3.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.178687] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/check_executables4.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.181287] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/check_executables5.patch to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.183892] Installing /usr/WS1/dahlgren/spack/var/spack/repos/builtin/packages/py-numpy/package.py to /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/repo/py-numpy\r\n==> [2021-10-04-14:47:19.211037] Reading config file /g/g21/dahlgren/.spack/compilers.yaml\r\n==> [2021-10-04-14:47:19.391196] Reading config file /g/g21/dahlgren/.spack/linux/compilers.yaml\r\n==> [2021-10-04-14:47:20.066771] '/usr/tce/bin/python3.7' '-c' '\r\nimport json\r\nfrom distutils.sysconfig import (\r\n    get_config_vars,\r\n    get_config_h_filename,\r\n    get_makefile_filename,\r\n    get_python_inc,\r\n    get_python_lib,\r\n)\r\n\r\nconfig = get_config_vars()\r\nconfig['\"'\"'config_h_filename'\"'\"'] = get_config_h_filename()\r\nconfig['\"'\"'makefile_filename'\"'\"'] = get_makefile_filename()\r\nconfig['\"'\"'python_inc'\"'\"'] = {}\r\nconfig['\"'\"'python_lib'\"'\"'] = {}\r\n\r\nfor plat_specific in [True, False]:\r\n    plat_key = str(plat_specific).lower()\r\n    config['\"'\"'python_inc'\"'\"'][plat_key] = get_python_inc(plat_specific, prefix='\"'\"''\"'\"')\r\n    config['\"'\"'python_lib'\"'\"'][plat_key] = {}\r\n    for standard_lib in [True, False]:\r\n        lib_key = str(standard_lib).lower()\r\n        config['\"'\"'python_lib'\"'\"'][plat_key][lib_key] = get_python_lib(\r\n            plat_specific, standard_lib, prefix='\"'\"''\"'\"'\r\n        )\r\n\r\nprint(json.dumps(config))\r\n'\r\n==> [2021-10-04-14:47:20.180130] Reading config file /usr/WS1/dahlgren/spack/etc/spack/defaults/modules.yaml\r\n==> [2021-10-04-14:47:20.190782] Reading config file /usr/WS1/dahlgren/spack/etc/spack/defaults/linux/modules.yaml\r\n==> [2021-10-04-14:47:20.202485] '/usr/tce/packages/gcc/gcc-8.3.1/bin/g++' '-v' '/var/tmp/dahlgren/spack-implicit-link-info4jkzfnk2/main.c' '-o' '/var/tmp/dahlgren/spack-implicit-link-info4jkzfnk2/output'\r\n==> [2021-10-04-14:47:20.266319] parsing implicit link info\r\n==> [2021-10-04-14:47:20.266660] linker line:  /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../libexec/gcc/x86_64-redhat-linux/8/collect2 -plugin /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../libexec/gcc/x86_64-redhat-linux/8/liblto_plugin.so -plugin-opt=/usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../libexec/gcc/x86_64-redhat-linux/8/lto-wrapper -plugin-opt=-fresolution=/var/tmp/dahlgren/ccSHtmQd.res -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc --build-id --no-add-needed --eh-frame-hdr --hash-style=gnu -m elf_x86_64 -dynamic-linker /lib64/ld-linux-x86-64.so.2 -o /var/tmp/dahlgren/spack-implicit-link-info4jkzfnk2/output /lib/../lib64/crt1.o /lib/../lib64/crti.o /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/crtbegin.o -L/usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8 -L/usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc -L/usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../../../lib64 -L/lib/../lib64 -L/usr/lib/../lib64 -L/usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../.. /var/tmp/dahlgren/ccMittMh.o -lstdc++ -lm -lgcc_s -lgcc -lc -lgcc_s -lgcc /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/crtend.o /lib/../lib64/crtn.o\r\n==> [2021-10-04-14:47:20.266744] linkdir: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8\r\n==> [2021-10-04-14:47:20.266784] linkdir: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc\r\n==> [2021-10-04-14:47:20.266820] linkdir: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../../../lib64\r\n==> [2021-10-04-14:47:20.266855] linkdir: /lib/../lib64\r\n==> [2021-10-04-14:47:20.266887] linkdir: /usr/lib/../lib64\r\n==> [2021-10-04-14:47:20.266920] linkdir: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../..\r\n==> [2021-10-04-14:47:20.266966] found raw link dirs: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../../../lib64, /lib/../lib64, /usr/lib/../lib64, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../..\r\n==> [2021-10-04-14:47:20.267055] found link dirs: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/lib/gcc/x86_64-redhat-linux/8, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/lib/gcc, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/lib64, /lib64, /usr/lib64, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/lib\r\n==> Testing package py-numpy-1.21.1-wt3cvwg\r\n==> [2021-10-04-14:47:29.582365] Error: TestFailure: 2 tests failed.\r\n\r\n\r\nCommand exited with status 1:\r\n    '/usr/tce/bin/python3.7' '-c' 'import numpy.typing'\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx512/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/python3.7/site-packages/numpy/typing/__init__.py\", line 316, in <module>\r\n    from ._dtype_like import (\r\n  File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx512/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/python3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <module>\r\n    class _SupportsDType(Generic[_DType_co]):\r\nNameError: name '_DType_co' is not defined\r\n\r\n\r\n\r\n1 error found in test log:\r\n     96       File \"<string>\", line 1, in <module>\r\n     97       File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/__init__.py\", line 316, in <modu\r\n            le>\r\n     98         from ._dtype_like import (\r\n     99       File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <mo\r\n            dule>\r\n     100        class _SupportsDType(Generic[_DType_co]):\r\n     101    NameError: name '_DType_co' is not defined\r\n  >> 102    FAILED: Command exited with status 1:\r\n     103        '/usr/tce/bin/python3.7' '-c' 'import numpy.typing'\r\n     104    Traceback (most recent call last):\r\n     105      File \"<string>\", line 1, in <module>\r\n     106      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/__init__.py\", line 316, in <modu\r\n            le>\r\n     107        from ._dtype_like import (\r\n     108      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <mo\r\n            dule>\r\n\r\n\r\n\r\nCommand exited with status 1:\r\n    '/usr/tce/bin/python3.7' '-c' 'import numpy.typing.tests'\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx512/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/python3.7/site-packages/numpy/typing/__init__.py\", line 316, in <module>\r\n    from ._dtype_like import (\r\n  File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx512/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/python3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <module>\r\n    class _SupportsDType(Generic[_DType_co]):\r\nNameError: name '_DType_co' is not defined\r\n\r\n\r\n\r\n1 error found in test log:\r\n     151      File \"<string>\", line 1, in <module>\r\n     152      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/__init__.py\", line 316, in <modu\r\n            le>\r\n     153        from ._dtype_like import (\r\n     154      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <mo\r\n            dule>\r\n     155        class _SupportsDType(Generic[_DType_co]):\r\n     156    NameError: name '_DType_co' is not defined\r\n  >> 157    FAILED: Command exited with status 1:\r\n     158        '/usr/tce/bin/python3.7' '-c' 'import numpy.typing.tests'\r\n     159    Traceback (most recent call last):\r\n     160      File \"<string>\", line 1, in <module>\r\n     161      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/__init__.py\", line 316, in <modu\r\n            le>\r\n     162        from ._dtype_like import (\r\n     163      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <mo\r\n            dule>\r\n\r\n\r\n\r\n/usr/WS1/dahlgren/spack/lib/spack/spack/build_environment.py:1034, in _setup_pkg_and_run:\r\n       1031        tb_string = traceback.format_exc()\r\n       1032\r\n       1033        # build up some context from the offending package so we can\r\n  >>   1034        # show that, too.\r\n       1035        package_context = get_package_context(tb)\r\n       1036\r\n       1037        logfile = None\r\n\r\nSee test log for details:\r\n  /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/py-numpy-1.21.1-wt3cvwg-test-out.txt\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/WS1/dahlgren/spack/lib/spack/spack/build_environment.py\", line 1018, in _setup_pkg_and_run\r\n    return_value = function(pkg, kwargs)\r\n  File \"/usr/WS1/dahlgren/spack/lib/spack/spack/package.py\", line 2648, in test_process\r\n    raise TestFailure(pkg.test_failures)\r\nspack.install_test.TestFailure: 2 tests failed.\r\n\r\n\r\nCommand exited with status 1:\r\n    '/usr/tce/bin/python3.7' '-c' 'import numpy.typing'\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx512/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/python3.7/site-packages/numpy/typing/__init__.py\", line 316, in <module>\r\n    from ._dtype_like import (\r\n  File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx512/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/python3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <module>\r\n    class _SupportsDType(Generic[_DType_co]):\r\nNameError: name '_DType_co' is not defined\r\n\r\n\r\n\r\n1 error found in test log:\r\n     96       File \"<string>\", line 1, in <module>\r\n     97       File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/__init__.py\", line 316, in <modu\r\n            le>\r\n     98         from ._dtype_like import (\r\n     99       File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <mo\r\n            dule>\r\n     100        class _SupportsDType(Generic[_DType_co]):\r\n     101    NameError: name '_DType_co' is not defined\r\n  >> 102    FAILED: Command exited with status 1:\r\n     103        '/usr/tce/bin/python3.7' '-c' 'import numpy.typing'\r\n     104    Traceback (most recent call last):\r\n     105      File \"<string>\", line 1, in <module>\r\n     106      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/__init__.py\", line 316, in <modu\r\n            le>\r\n     107        from ._dtype_like import (\r\n     108      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <mo\r\n            dule>\r\n\r\n\r\n\r\nCommand exited with status 1:\r\n    '/usr/tce/bin/python3.7' '-c' 'import numpy.typing.tests'\r\nTraceback (most recent call last):\r\n  File \"<string>\", line 1, in <module>\r\n  File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx512/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/python3.7/site-packages/numpy/typing/__init__.py\", line 316, in <module>\r\n    from ._dtype_like import (\r\n  File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx512/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/python3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <module>\r\n    class _SupportsDType(Generic[_DType_co]):\r\nNameError: name '_DType_co' is not defined\r\n\r\n\r\n\r\n1 error found in test log:\r\n     151      File \"<string>\", line 1, in <module>\r\n     152      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/__init__.py\", line 316, in <modu\r\n            le>\r\n     153        from ._dtype_like import (\r\n     154      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <mo\r\n            dule>\r\n     155        class _SupportsDType(Generic[_DType_co]):\r\n     156    NameError: name '_DType_co' is not defined\r\n  >> 157    FAILED: Command exited with status 1:\r\n     158        '/usr/tce/bin/python3.7' '-c' 'import numpy.typing.tests'\r\n     159    Traceback (most recent call last):\r\n     160      File \"<string>\", line 1, in <module>\r\n     161      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/__init__.py\", line 316, in <modu\r\n            le>\r\n     162        from ._dtype_like import (\r\n     163      File \"/usr/WS1/dahlgren/spack/opt/spack/linux-rhel7-skylake_avx51\r\n            2/gcc-8.3.1/py-numpy-1.21.1-wt3cvwgxvbuz5kom2hqdp5fgjilw5ioi/lib/py\r\n            thon3.7/site-packages/numpy/typing/_dtype_like.py\", line 95, in <mo\r\n            dule>\r\n\r\n\r\n==> [2021-10-04-14:47:29.601596] Reading config file /g/g21/dahlgren/.spack/compilers.yaml\r\n==> [2021-10-04-14:47:29.778277] Reading config file /g/g21/dahlgren/.spack/linux/compilers.yaml\r\n==> [2021-10-04-14:47:30.434339] '/usr/tce/bin/python3.7' '-c' '\r\nimport json\r\nfrom distutils.sysconfig import (\r\n    get_config_vars,\r\n    get_config_h_filename,\r\n    get_makefile_filename,\r\n    get_python_inc,\r\n    get_python_lib,\r\n)\r\n\r\nconfig = get_config_vars()\r\nconfig['\"'\"'config_h_filename'\"'\"'] = get_config_h_filename()\r\nconfig['\"'\"'makefile_filename'\"'\"'] = get_makefile_filename()\r\nconfig['\"'\"'python_inc'\"'\"'] = {}\r\nconfig['\"'\"'python_lib'\"'\"'] = {}\r\n\r\nfor plat_specific in [True, False]:\r\n    plat_key = str(plat_specific).lower()\r\n    config['\"'\"'python_inc'\"'\"'][plat_key] = get_python_inc(plat_specific, prefix='\"'\"''\"'\"')\r\n    config['\"'\"'python_lib'\"'\"'][plat_key] = {}\r\n    for standard_lib in [True, False]:\r\n        lib_key = str(standard_lib).lower()\r\n        config['\"'\"'python_lib'\"'\"'][plat_key][lib_key] = get_python_lib(\r\n            plat_specific, standard_lib, prefix='\"'\"''\"'\"'\r\n        )\r\n\r\nprint(json.dumps(config))\r\n'\r\n==> [2021-10-04-14:47:30.525017] Reading config file /usr/WS1/dahlgren/spack/etc/spack/defaults/modules.yaml\r\n==> [2021-10-04-14:47:30.535101] Reading config file /usr/WS1/dahlgren/spack/etc/spack/defaults/linux/modules.yaml\r\n==> [2021-10-04-14:47:30.546794] '/usr/tce/packages/gcc/gcc-8.3.1/bin/g++' '-v' '/var/tmp/dahlgren/spack-implicit-link-info0n1ha5yw/main.c' '-o' '/var/tmp/dahlgren/spack-implicit-link-info0n1ha5yw/output'\r\n==> [2021-10-04-14:47:30.601327] parsing implicit link info\r\n==> [2021-10-04-14:47:30.601628] linker line:  /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../libexec/gcc/x86_64-redhat-linux/8/collect2 -plugin /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../libexec/gcc/x86_64-redhat-linux/8/liblto_plugin.so -plugin-opt=/usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../libexec/gcc/x86_64-redhat-linux/8/lto-wrapper -plugin-opt=-fresolution=/var/tmp/dahlgren/cc1oIVuM.res -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc --build-id --no-add-needed --eh-frame-hdr --hash-style=gnu -m elf_x86_64 -dynamic-linker /lib64/ld-linux-x86-64.so.2 -o /var/tmp/dahlgren/spack-implicit-link-info0n1ha5yw/output /lib/../lib64/crt1.o /lib/../lib64/crti.o /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/crtbegin.o -L/usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8 -L/usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc -L/usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../../../lib64 -L/lib/../lib64 -L/usr/lib/../lib64 -L/usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../.. /var/tmp/dahlgren/ccgIQABr.o -lstdc++ -lm -lgcc_s -lgcc -lc -lgcc_s -lgcc /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/crtend.o /lib/../lib64/crtn.o\r\n==> [2021-10-04-14:47:30.601705] linkdir: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8\r\n==> [2021-10-04-14:47:30.601744] linkdir: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc\r\n==> [2021-10-04-14:47:30.601778] linkdir: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../../../lib64\r\n==> [2021-10-04-14:47:30.601811] linkdir: /lib/../lib64\r\n==> [2021-10-04-14:47:30.601843] linkdir: /usr/lib/../lib64\r\n==> [2021-10-04-14:47:30.601874] linkdir: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../..\r\n==> [2021-10-04-14:47:30.601918] found raw link dirs: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../../../lib64, /lib/../lib64, /usr/lib/../lib64, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/bin/../lib/gcc/x86_64-redhat-linux/8/../../..\r\n==> [2021-10-04-14:47:30.602000] found link dirs: /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/lib/gcc/x86_64-redhat-linux/8, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/lib/gcc, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/lib64, /lib64, /usr/lib64, /usr/tce/packages/gcc/gcc-8.3.1/rh/usr/lib\r\n==> Testing package py-numpy-1.21.2-j7n3hgs\r\n==> [2021-10-04-14:47:37.400069] TestSuiteFailure: 1 test(s) in the suite failed.\r\n\r\n==> [2021-10-04-14:47:37.400167] Error: 1 test(s) in the suite failed.\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/WS1/dahlgren/spack/lib/spack/spack/main.py\", line 797, in main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/usr/WS1/dahlgren/spack/lib/spack/spack/main.py\", line 525, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/usr/WS1/dahlgren/spack/lib/spack/spack/cmd/test.py\", line 411, in test\r\n    globals()['test_%s' % args.test_command](args)\r\n  File \"/usr/WS1/dahlgren/spack/lib/spack/spack/cmd/test.py\", line 195, in test_run\r\n    fail_first=args.fail_first)\r\n  File \"/usr/WS1/dahlgren/spack/lib/spack/spack/install_test.py\", line 160, in __call__\r\n    raise TestSuiteFailure(self.fails)\r\nspack.install_test.TestSuiteFailure: 1 test(s) in the suite failed.\r\n```\r\n\r\nRunning from the same Spack instance on a different system, I get less useful information as shown below.  Perhaps better output could be provided so users don't have to look up unix signal codes?\r\n\r\n```\r\n$ spack test run py-numpy\r\n\r\n==> Spack test 7lynazwpycl2wfqekgj3ghqupicodesm\r\n==> Testing package py-numpy-1.21.1-wt3cvwg\r\n==> Error: TestFailure: 33 tests failed.\r\n\r\n\r\nCommand exited with status -4:\r\n    '/usr/tce/bin/python3.7' '-c' 'import numpy'\r\n\r\n\r\n1 error found in test log:\r\n  >> 5    FAILED: Command exited with status -4:\r\n     6        '/usr/tce/bin/python3.7' '-c' 'import numpy'\r\n     7      File \"/usr/WS1/dahlgren/spack/bin/spack\", line 100, in <module>\r\n     8        sys.exit(spack.main.main())\r\n     9      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/main.py\", line 797, i\r\n          n main\r\n     10       return _invoke_command(command, parser, args, unknown)\r\n     11     File \"/usr/WS1/dahlgren/spack/lib/spack/spack/main.py\", line 525, i\r\n          n _invoke_command\r\n\r\n\r\n\r\nCommand exited with status -4:\r\n    '/usr/tce/bin/python3.7' '-c' 'import numpy.compat'\r\n\r\n\r\n1 error found in test log:\r\n     39      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/package.py\", line 26\r\n           43, in test_process\r\n     40        test_fn(pkg)\r\n     41      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/build_systems/python\r\n           .py\", line 325, in test\r\n     42        work_dir='spack-test')\r\n     43    ==> [2021-10-04-14:11:43.402038] checking import of numpy.compat\r\n     44    ==> [2021-10-04-14:11:43.402522] '/usr/tce/bin/python3.7' '-c' 'impo\r\n           rt numpy.compat'\r\n  >> 45    FAILED: Command exited with status -4:\r\n     46        '/usr/tce/bin/python3.7' '-c' 'import numpy.compat'\r\n     47      File \"/usr/WS1/dahlgren/spack/bin/spack\", line 100, in <module>\r\n     48        sys.exit(spack.main.main())\r\n     49      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/main.py\", line 797, \r\n           in main\r\n     50        return _invoke_command(command, parser, args, unknown)\r\n     51      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/main.py\", line 525, \r\n           in _invoke_command\r\n\r\n\r\n\r\nCommand exited with status -4:\r\n    '/usr/tce/bin/python3.7' '-c' 'import numpy.compat.tests'\r\n\r\n\r\n1 error found in test log:\r\n     79      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/package.py\", line 26\r\n           43, in test_process\r\n     80        test_fn(pkg)\r\n     81      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/build_systems/python\r\n           .py\", line 325, in test\r\n     82        work_dir='spack-test')\r\n     83    ==> [2021-10-04-14:11:43.536775] checking import of numpy.compat.tes\r\n           ts\r\n     84    ==> [2021-10-04-14:11:43.537268] '/usr/tce/bin/python3.7' '-c' 'impo\r\n           rt numpy.compat.tests'\r\n  >> 85    FAILED: Command exited with status -4:\r\n     86        '/usr/tce/bin/python3.7' '-c' 'import numpy.compat.tests'\r\n     87      File \"/usr/WS1/dahlgren/spack/bin/spack\", line 100, in <module>\r\n     88        sys.exit(spack.main.main())\r\n     89      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/main.py\", line 797, \r\n           in main\r\n     90        return _invoke_command(command, parser, args, unknown)\r\n     91      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/main.py\", line 525, \r\n           in _invoke_command\r\n[...snip...]\r\n    '/usr/tce/bin/python3.7' '-c' 'import numpy.tests'\r\n\r\n\r\n1 error found in test log:\r\n     1279      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/package.py\", line \r\n             2643, in test_process\r\n     1280        test_fn(pkg)\r\n     1281      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/build_systems/pyth\r\n             on.py\", line 325, in test\r\n     1282        work_dir='spack-test')\r\n     1283    ==> [2021-10-04-14:12:01.764533] checking import of numpy.tests\r\n     1284    ==> [2021-10-04-14:12:01.764953] '/usr/tce/bin/python3.7' '-c' 'im\r\n             port numpy.tests'\r\n  >> 1285    FAILED: Command exited with status -4:\r\n     1286        '/usr/tce/bin/python3.7' '-c' 'import numpy.tests'\r\n     1287      File \"/usr/WS1/dahlgren/spack/bin/spack\", line 100, in <module>\r\n     1288        sys.exit(spack.main.main())\r\n     1289      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/main.py\", line 797\r\n             , in main\r\n     1290        return _invoke_command(command, parser, args, unknown)\r\n     1291      File \"/usr/WS1/dahlgren/spack/lib/spack/spack/main.py\", line 525\r\n             , in _invoke_command\r\n\r\n\r\n\r\n/usr/WS1/dahlgren/spack/lib/spack/spack/build_environment.py:1034, in _setup_pkg_and_run:\r\n       1031        tb_string = traceback.format_exc()\r\n       1032\r\n       1033        # build up some context from the offending package so we can\r\n  >>   1034        # show that, too.\r\n       1035        package_context = get_package_context(tb)\r\n       1036\r\n       1037        logfile = None\r\n\r\nSee test log for details:\r\n  /g/g21/dahlgren/.spack/test/7lynazwpycl2wfqekgj3ghqupicodesm/py-numpy-1.21.2-j7n3hgs-test-out.txt\r\n\r\n==> Error: 2 test(s) in the suite failed.\r\n```\r\n\r\n### Information on your system\r\n\r\nLikely install system:\r\n* **Spack:** 0.16.3-4678-b88c80bb1b\r\n* **Python:** 3.7.2\r\n* **Platform:** linux-rhel7-cascadelake\r\n* **Concretizer:** clingo\r\n\r\nSame instance but likely not the one used to install the software:\r\n* **Spack:** 0.16.3-4678-b88c80bb1b\r\n* **Python:** 3.7.2\r\n* **Platform:** linux-rhel7-broadwell\r\n* **Concretizer:** clingo\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "tldahlgren",
    "url": "https://api.github.com/repos/spack/spack/issues/26519",
    "updated_at": "2021-10-04 21:52:13",
    "created_at": "2021-10-04 21:50:17",
    "closed_at": "None",
    "state": "open",
    "title": "Import failures on stand-alone python package tests",
    "number": 26519,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1015667345,
    "html_url": "https://github.com/spack/spack/issues/26519",
    "assignees": [],
    "comments": 0
}