{
    "body": "I was bit confused by libmkl_rt in gcc compiled numpy:\r\n\r\n```\r\n$ find /gpfs/bbp.cscs.ch/scratch/gss/bgq/kumbhar-adm/SPACK_HOME/install_home/bbpviz_full/install/linux-rhel6-x86_64/gcc-5.3.0/py-numpy-1.13.1-lhfffv6h/ -name \"*.so\" -exec ldd {} \\; -exec grep mkl {} \\;\r\n\tlinux-vdso.so.1 =>  (0x00007fff38112000)\r\n.......\r\nBinary file /gpfs/bbp.cscs.ch/scratch/gss/bgq/kumbhar-adm/SPACK_HOME/install_home/bbpviz_full/install/linux-rhel6-x86_64/gcc-5.3.0/py-numpy-1.13.1-lhfffv6h/lib/python2.7/site-packages/numpy/linalg/lapack_lite.so matches\r\n\tlinux-vdso.so.1 =>  (0x00007ffc5bfba000)\r\n\tlibmkl_rt.so => not found\r\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007ff4906df000)\r\n```\r\n\r\nLooking into spec we don't see any Intel or MKL dependency : \r\n\r\n```\r\n$ spack spec -y /lhfffv6h\r\nspec:\r\n- py-numpy:\r\n    version: 1.13.1\r\n    arch:\r\n      platform: linux\r\n      platform_os: rhel6\r\n      target: x86_64\r\n    compiler:\r\n      name: gcc\r\n      version: 5.3.0\r\n    namespace: builtin\r\n    parameters:\r\n      blas: true\r\n      lapack: true\r\n      cflags: []\r\n      cppflags: []\r\n      cxxflags: []\r\n      fflags: []\r\n      ldflags: []\r\n      ldlibs: []\r\n    dependencies:\r\n      openblas:\r\n        hash: tgtgdmq2dgjfvktxmizfo3gadxkerjxc\r\n        type:\r\n        - build\r\n        - link\r\n      python:\r\n        hash: dhkjobmenmlls3dqb2xf3vel22fdrczc\r\n        type:\r\n        - build\r\n        - link\r\n        - run\r\n    hash: lhfffv6hlf5d5hnljecb574ocevmvbhq\r\n- openblas:\r\n    version: 0.2.20\r\n    arch:\r\n      platform: linux\r\n      platform_os: rhel6\r\n      target: x86_64\r\n    compiler:\r\n      name: gcc\r\n      version: 5.3.0\r\n    namespace: builtin\r\n    parameters:\r\n      openmp: true\r\n      pic: true\r\n      shared: true\r\n      cflags: []\r\n      cppflags: []\r\n      cxxflags: []\r\n      fflags: []\r\n      ldflags: []\r\n      ldlibs: []\r\n    hash: tgtgdmq2dgjfvktxmizfo3gadxkerjxc\r\n- python:\r\n    version: 2.7.13\r\n    arch:\r\n      platform: linux\r\n      platform_os: rhel6\r\n      target: x86_64\r\n    compiler:\r\n      name: gcc\r\n      version: 5.3.0\r\n    namespace: builtin\r\n    parameters:\r\n      shared: true\r\n      tk: false\r\n      ucs4: false\r\n      cflags: []\r\n      cppflags: []\r\n      cxxflags: []\r\n      fflags: []\r\n      ldflags: []\r\n      ldlibs: []\r\n    dependencies:\r\n      bzip2:\r\n        hash: npjovariojv5p4pml2t6e3prwuvfpucy\r\n        type:\r\n        - build\r\n        - link\r\n      ncurses:\r\n        hash: drvhqydmzj53gsnf32gykluasamrtbbi\r\n        type:\r\n        - build\r\n        - link\r\n      openssl:\r\n        hash: hkpcjq2zk7qdrrjz35m44tzrpiikdu33\r\n        type:\r\n        - build\r\n        - link\r\n      readline:\r\n        hash: u2nuuoap42ogsgp3py4q7bjunqjyhlfl\r\n        type:\r\n        - build\r\n        - link\r\n      sqlite:\r\n        hash: g2xodjde4jxzbdijstqv3gqwv3tiwnfk\r\n        type:\r\n        - build\r\n        - link\r\n      zlib:\r\n        hash: cabzx2gna7p6g6tsll42c4q3aia2gx4e\r\n        type:\r\n        - build\r\n        - link\r\n    hash: dhkjobmenmlls3dqb2xf3vel22fdrczc\r\n- bzip2:\r\n    version: 1.0.6\r\n    arch:\r\n      platform: linux\r\n      platform_os: rhel6\r\n      target: x86_64\r\n    compiler:\r\n      name: gcc\r\n      version: 5.3.0\r\n    namespace: builtin\r\n    parameters:\r\n      shared: true\r\n      cflags: []\r\n      cppflags: []\r\n      cxxflags: []\r\n      fflags: []\r\n      ldflags: []\r\n      ldlibs: []\r\n    hash: npjovariojv5p4pml2t6e3prwuvfpucy\r\n- ncurses:\r\n    version: 5.7.4\r\n    arch:\r\n      platform: linux\r\n      platform_os: rhel6\r\n      target: x86_64\r\n    compiler:\r\n      name: gcc\r\n      version: 5.3.0\r\n    namespace: builtin\r\n    parameters:\r\n      symlinks: false\r\n      cflags: []\r\n      cppflags: []\r\n      cxxflags: []\r\n      fflags: []\r\n      ldflags: []\r\n      ldlibs: []\r\n    external:\r\n      module: false\r\n      path: /usr\r\n    hash: drvhqydmzj53gsnf32gykluasamrtbbi\r\n- openssl:\r\n    version: '1.0'\r\n    arch:\r\n      platform: linux\r\n      platform_os: rhel6\r\n      target: x86_64\r\n    compiler:\r\n      name: gcc\r\n      version: 5.3.0\r\n    namespace: builtin\r\n    parameters:\r\n      cflags: []\r\n      cppflags: []\r\n      cxxflags: []\r\n      fflags: []\r\n      ldflags: []\r\n      ldlibs: []\r\n    external:\r\n      module: false\r\n      path: /usr\r\n    hash: hkpcjq2zk7qdrrjz35m44tzrpiikdu33\r\n- readline:\r\n    version: 6.0.4\r\n    arch:\r\n      platform: linux\r\n      platform_os: rhel6\r\n      target: x86_64\r\n    compiler:\r\n      name: gcc\r\n      version: 5.3.0\r\n    namespace: builtin\r\n    parameters:\r\n      cflags: []\r\n      cppflags: []\r\n      cxxflags: []\r\n      fflags: []\r\n      ldflags: []\r\n      ldlibs: []\r\n    external:\r\n      module: false\r\n      path: /usr\r\n    hash: u2nuuoap42ogsgp3py4q7bjunqjyhlfl\r\n- sqlite:\r\n    version: 3.6.20\r\n    arch:\r\n      platform: linux\r\n      platform_os: rhel6\r\n      target: x86_64\r\n    compiler:\r\n      name: gcc\r\n      version: 5.3.0\r\n    namespace: builtin\r\n    parameters:\r\n      cflags: []\r\n      cppflags: []\r\n      cxxflags: []\r\n      fflags: []\r\n      ldflags: []\r\n      ldlibs: []\r\n    external:\r\n      module: false\r\n      path: /usr\r\n    hash: g2xodjde4jxzbdijstqv3gqwv3tiwnfk\r\n- zlib:\r\n    version: 1.2.11\r\n    arch:\r\n      platform: linux\r\n      platform_os: rhel6\r\n      target: x86_64\r\n    compiler:\r\n      name: gcc\r\n      version: 5.3.0\r\n    namespace: builtin\r\n    parameters:\r\n      pic: true\r\n      shared: true\r\n      cflags: []\r\n      cppflags: []\r\n      cxxflags: []\r\n      fflags: []\r\n      ldflags: []\r\n      ldlibs: []\r\n    hash: cabzx2gna7p6g6tsll42c4q3aia2gx4e\r\n```\r\n\r\nIf I look at `build.out` then we see some MKL related stuff:\r\n\r\n```\r\n==> Executing phase: 'build'\r\n==> '/gpfs/bbp.cscs.ch/scratch/gss/bgq/kumbhar-adm/SPACK_HOME/install_home/bbpviz_full/install/linux-rhel6-x86_64/gcc-5.3.0/python-2.7.13-dhkjobme/bin/python2.7' 'setup.py' '--no-user-cfg' 'build' '-j' '16'\r\nRunning from numpy source directory.\r\nblas_opt_info:\r\nblas_mkl_info:\r\n  FOUND:\r\n    libraries = ['mkl_rt', 'pthread']\r\n    library_dirs = ['/gpfs/bbp.cscs.ch/home/kumbhar-adm/SPACK_HOME/install_home/externals/install/linux-rhel6-x86_64/gcc-4.4.7/intel-parallel-studio-professional.2017.4/compilers_and_libraries_2017.4.196/linux/mkl/lib/intel64']\r\n    define_macros = [('SCIPY_MKL_H', None), ('HAVE_CBLAS', None)]\r\n    include_dirs = ['/gpfs/bbp.cscs.ch/home/kumbhar-adm/SPACK_HOME/install_home/externals/install/linux-rhel6-x86_64/gcc-4.4.7/intel-parallel-studio-professional.2017.4/compilers_and_libraries_2017.4.196/linux/mkl', '/gpfs/bbp.cscs.ch/home/kumbhar-adm/SPACK_HOME/install_home/externals/install/linux-rhel6-x86_64/gcc-4.4.7/intel-parallel-studio-professional.2017.4/compilers_and_libraries_2017.4.196/linux/mkl/include', '/gpfs/bbp.cscs.ch/home/kumbhar-adm/SPACK_HOME/install_home/externals/install/linux-rhel6-x86_64/gcc-4.4.7/intel-parallel-studio-professional.2017.4/compilers_and_libraries_2017.4.196/linux/mkl/lib']\r\n\r\n  FOUND:\r\n    libraries = ['mkl_rt', 'pthread']\r\n    library_dirs = ['/gpfs/bbp.cscs.ch/home/kumbhar-adm/SPACK_HOME/install_home/externals/install/linux-rhel6-x86_64/gcc-4.4.7/intel-parallel-studio-professional.2017.4/compilers_and_libraries_2017.4.196/linux/mkl/lib/intel64']\r\n    define_macros = [('SCIPY_MKL_H', None), ('HAVE_CBLAS', None)]\r\n    include_dirs = ['/gpfs/bbp.cscs.ch/home/kumbhar-adm/SPACK_HOME/install_home/externals/install/linux-rhel6-x86_64/gcc-4.4.7/intel-parallel-studio-professional.2017.4/compilers_and_libraries_2017.4.196/linux/mkl', '/gpfs/bbp.cscs.ch/home/kumbhar-adm/SPACK_HOME/install_home/externals/install/linux-rhel6-x86_64/gcc-4.4.7/intel-parallel-studio-professional.2017.4/compilers_and_libraries_2017.4.196/linux/mkl/include', '/gpfs/bbp.cscs.ch/home/kumbhar-adm/SPACK_HOME/install_home/externals/install/linux-rhel6-x86_64/gcc-4.4.7/intel-parallel-studio-professional.2017.4/compilers_and_libraries_2017.4.196/linux/mkl/lib']\r\n\r\n....\r\n```\r\n\r\nAnd if I look at `build.env` we have : \r\n\r\n```\r\nMIC_LD_LIBRARY_PATH=/some/mkl/path/\r\nMIC_LIBRARY_PATH=/some/mkl/path/\r\nMKLROOT=/some/mkl/path/\r\n```\r\n\r\nI assume we don't remove these variables like LD_LIBRARY_PATH and causing MKL getting linked to py-numpy? Or, anything obvious I am missing here?\r\n\r\nEDIT: I confirm `MKLROOT` was set in my bash env.",
    "user": "pramodskumbhar",
    "url": "https://api.github.com/repos/spack/spack/issues/5327",
    "updated_at": "2019-08-06 23:20:24",
    "created_at": "2017-09-10 14:13:41",
    "closed_at": "2019-08-06 23:20:24",
    "state": "closed",
    "title": "py-numpy linking to intel mkl while compiling with gcc and openblas?",
    "number": 5327,
    "milestone": null,
    "labels": [
        "build-error",
        "linking"
    ],
    "id": 256512852,
    "html_url": "https://github.com/spack/spack/issues/5327",
    "assignees": [],
    "comments": 4
}