{
    "body": "### Steps to reproduce the issue\r\n\r\n`$ spack install dos2unix`\r\nOn many systems it fails to properly add -lintl as described by\r\n\r\n> I get a linker error \u201cundefined reference to libintl_gettext\u201d\r\n\r\nat\r\nhttps://www.gnu.org/software/gettext/FAQ.html#integrating_undefined\r\n\r\nThis did NOT happen on MacOS, neither on Ubuntu 18 with external gettext, but it did on many other platforms (Ubuntu18, 20, 20 on Raps Pi, CentOS7.8)\r\n\r\n```\r\n==> Installing gettext-0.21-iabdfai6dbsfkvnhkypztb3cygic7t4z\r\n==> No binary for gettext-0.21-iabdfai6dbsfkvnhkypztb3cygic7t4z found: installing from source\r\n==> Fetching https://mirror.spack.io/_source-cache/archive/d2/d20fcbb537e02dcf1383197ba05bd0734ef7bf5db06bdb241eb69b7d16b73192.tar.xz\r\n==> No patches needed for gettext\r\n==> gettext: Executing phase: 'autoreconf'\r\n==> gettext: Executing phase: 'configure'\r\n==> gettext: Executing phase: 'build'\r\n==> gettext: Executing phase: 'install'\r\n==> gettext: Successfully installed gettext-0.21-iabdfai6dbsfkvnhkypztb3cygic7t4z\r\n  Fetch: 4.46s.  Build: 2m 35.87s.  Total: 2m 40.33s.\r\n[+] /home2/cessenat/Softs/spack/opt/spack/linux-ubuntu18.04-zen/gcc-7.5.0/gettext-0.21-iabdfai6dbsfkvnhkypztb3cygic7t4z\r\n==> Installing dos2unix-7.3.4-u53v2na4tb2ejuj4urssi5mc5n3di7oq\r\n==> No binary for dos2unix-7.3.4-u53v2na4tb2ejuj4urssi5mc5n3di7oq found: installing from source\r\n==> Fetching https://mirror.spack.io/_source-cache/archive/8c/8ccda7bbc5a2f903dafd95900abb5bf5e77a769b572ef25150fde4056c5f30c5.tar.gz\r\n==> No patches needed for dos2unix\r\n==> dos2unix: Executing phase: 'edit'\r\n==> dos2unix: Executing phase: 'build'\r\n==> Error: ProcessError: Command exited with status 2:\r\n    'make' '-j6'\r\n\r\n28 errors found in build log:\r\n     24    msgfmt -c po/pt_BR.po -o po/pt_BR.mo\r\n     25    msgfmt -c po/zh_CN.po -o po/zh_CN.mo\r\n     26    msgfmt -c po/zh_TW.po -o po/zh_TW.mo\r\n     27    /home2/cessenat/Softs/spack/lib/spack/env/gcc/gcc dos2unix.o querycp.o common.o     -o dos2unix\r\n     28    /home2/cessenat/Softs/spack/lib/spack/env/gcc/gcc unix2dos.o querycp.o common.o     -o unix2dos\r\n     29    unix2dos.o: In function `PrintLicense':\r\n  >> 30    unix2dos.c:(.text+0xc): undefined reference to `libintl_gettext'\r\n     31    unix2dos.o: In function `ConvertUnixToDosW':\r\n  >> 32    unix2dos.c:(.text+0x25e): undefined reference to `libintl_gettext'\r\n  >> 33    unix2dos.c:(.text+0x4b3): undefined reference to `libintl_gettext'\r\n  >> 34    unix2dos.c:(.text+0x52b): undefined reference to `libintl_gettext'\r\n     35    unix2dos.o: In function `ConvertUnixToDos':\r\n  >> 36    unix2dos.c:(.text+0x688): undefined reference to `libintl_gettext'\r\n     37    unix2dos.o:unix2dos.c:(.text+0x83d): more undefined references to `libintl_gettext' follow\r\n     38    unix2dos.o: In function `main':\r\n  >> 39    unix2dos.c:(.text.startup+0xeb): undefined reference to `libintl_bindtextdomain'\r\n  >> 40    unix2dos.c:(.text.startup+0xf7): undefined reference to `libintl_textdomain'\r\n     41    common.o: In function `get_info_options.part.6':\r\n  >> 42    common.c:(.text+0x3be): undefined reference to `libintl_gettext'\r\n     43    common.o: In function `PrintBSDLicense':\r\n  >> 44    common.c:(.text+0x5ec): undefined reference to `libintl_gettext'\r\n  >> 45    common.c:(.text+0x607): undefined reference to `libintl_gettext'\r\n     46    common.o: In function `PrintUsage':\r\n  >> 47    common.c:(.text+0x67c): undefined reference to `libintl_gettext'\r\n  >> 48    common.c:(.text+0x6a1): undefined reference to `libintl_gettext'\r\n     49    common.o:common.c:(.text+0x6c3): more undefined references to `libintl_gettext' follow\r\n  >> 50    collect2: error: ld returned 1 exit status\r\n     51    dos2unix.o: In function `PrintLicense':\r\n  >> 52    dos2unix.c:(.text+0xc): undefined reference to `libintl_gettext'\r\n     53    dos2unix.o: In function `ConvertDosToUnixW':\r\n  >> 54    dos2unix.c:(.text+0x287): undefined reference to `libintl_gettext'\r\n  >> 55    dos2unix.c:(.text+0x4c8): undefined reference to `libintl_gettext'\r\n  >> 56    dos2unix.c:(.text+0x566): undefined reference to `libintl_gettext'\r\n     57    dos2unix.o: In function `ConvertDosToUnix':\r\n  >> 58    dos2unix.c:(.text+0x857): undefined reference to `libintl_gettext'\r\n     59    dos2unix.o:dos2unix.c:(.text+0xa88): more undefined references to `libintl_gettext' follow\r\n     60    dos2unix.o: In function `main':\r\n  >> 61    dos2unix.c:(.text.startup+0xeb): undefined reference to `libintl_bindtextdomain'\r\n  >> 62    dos2unix.c:(.text.startup+0xf7): undefined reference to `libintl_textdomain'\r\n     63    common.o: In function `get_info_options.part.6':\r\n  >> 64    common.c:(.text+0x3be): undefined reference to `libintl_gettext'\r\n     65    common.o: In function `PrintBSDLicense':\r\n  >> 66    common.c:(.text+0x5ec): undefined reference to `libintl_gettext'\r\n     67    common.c:(Makefile:388: recipe for target 'unix2dos' failed\r\n  >> 68    .text+make: *** [unix2dos] Error 1\r\n  >> 69    0x607): undefined reference to `libintl_gettext'\r\n     70    common.o: In function `PrintUsage':\r\n  >> 71    common.c:(.text+0x67c): undefined reference to `libintl_gettext'\r\n  >> 72    common.c:(.text+0x6a1): undefined reference to `libintl_gettext'\r\n     73    common.o:common.c:(.text+0x6c3): more undefined references to `libintl_gettext' follow\r\n     74    make: *** Waiting for unfinished jobs....\r\n  >> 75    collect2: error: ld returned 1 exit status\r\n     76    Makefile:385: recipe for target 'dos2unix' failed\r\n  >> 77    make: *** [dos2unix] Error 1\r\n\r\nSee build log for details:\r\n  /tmp/cessenat/spack-stage/spack-stage-dos2unix-7.3.4-u53v2na4tb2ejuj4urssi5mc5n3di7oq/spack-build-out.txt\r\n\r\n```\r\n\r\n\r\n### Information on your system\r\n\r\n$ spack debug report\r\n* **Spack:** 0.16.2-4021-df10e88e97\r\n* **Python:** 3.6.9\r\n* **Platform:** linux-ubuntu18.04-zen2\r\n* **Concretizer:** original\r\n\r\n\r\n### Additional information\r\n\r\n[spack-build-env.txt](https://github.com/spack/spack/files/7257493/spack-build-env.txt)\r\n[spack-build-out.txt](https://github.com/spack/spack/files/7257494/spack-build-out.txt)\r\n\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\r\n- [X] I have uploaded the build log and environment files\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "cessenat",
    "url": "https://api.github.com/repos/spack/spack/issues/26369",
    "updated_at": "2021-09-30 11:51:56",
    "created_at": "2021-09-30 07:30:05",
    "closed_at": "2021-09-30 11:51:56",
    "state": "closed",
    "title": "Installation issue: dos2unix",
    "number": 26369,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1011820688,
    "html_url": "https://github.com/spack/spack/issues/26369",
    "assignees": [],
    "comments": 1
}