{
    "body": "### Steps to reproduce the issue\r\n\r\n```console\r\nspack install fftw+openmp %apple-clang\r\n```\r\n\r\n```\r\nchecking for OpenMP flag of C compiler... unknown\r\nconfigure: error: don't know how to enable OpenMP\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '../configure' '--prefix=/Users/jlvay/warpxtest/spack/opt/spack/darwin-catalina-ivybridge/apple-clang-12.0.0/fftw-3.3.9-kdebyf3xpxej56c7ijxf22ezm5pqfrev' '--enable-shared' '--enable-threads' '--enable-openmp' '--enable-mpi' '--enable-sse2' '--enable-avx' '--disable-avx2' '--disable-avx512' '--disable-avx-128-fma' '--disable-kcvi' '--disable-vsx' '--disable-neon' '--disable-fma'\r\n\r\n1 error found in build log:\r\n     199    checking how to hardcode library paths into programs... immediate\r\n     200    checking how to get verbose linking output from /Users/jlvay/warpxtest/spack/lib/spack/env/clang/gfortran... -v\r\n     201    checking for Fortran 77 libraries of /Users/jlvay/warpxtest/spack/lib/spack/env/clang/gfortran...  -L/usr/local/Cellar/gcc/11.1.0_1/lib/gcc/11/gcc/x86_64-apple-darwin19/11.1.0 -L/usr/local/Cellar/gcc/11.1.0_1/lib/gcc/11/gcc/x86_64-apple-darwin19/11.1.0/../../.. -lgfortran -lquadmath -lm\r\n     202    checking for dummy main to link with Fortran 77 libraries... none\r\n     203    checking for Fortran 77 name-mangling scheme... lower case, underscore, no extra underscore\r\n     204    checking for OpenMP flag of C compiler... unknown\r\n  >> 205    configure: error: don't know how to enable OpenMP\r\n\r\nSee build log for details:\r\n  /var/folders/wv/6p9cjj9n7plgcx5krp_8kxgr0000gn/T/jlvay/spack-stage/spack-stage-fftw-3.3.9-kdebyf3xpxej56c7ijxf22ezm5pqfrev/spack-build-out.txt\r\n\r\n==> Updating view at /Users/jlvay/warpx/spack/var/spack/environments/warpx-dev/.spack-env/view\r\n==> Error: Cannot create view: file already exists and is not a link: /Users/jlvay/warpx/spack/var/spack/environments/warpx-dev/.spack-env/view\r\njean-lucs-pro:~/warpxtest$ \r\n```\r\n\r\n### Information on your system\r\n\r\n`spack debug report`:\r\n* **Spack:** 0.16.2-4280-bd415ec841\r\n* **Python:** 3.9.5\r\n* **Platform:** darwin-catalina-ivybridge\r\n* **Concretizer:** clingo\r\n\r\n### Additional information\r\n\r\n- [spack-build-env.txt](https://github.com/spack/spack/files/7188063/spack-build-env.1.txt)\r\n- [spack-build-out.txt](https://github.com/spack/spack/files/7188064/spack-build-out.1.txt)\r\n\r\nI tried to patch\r\n```diff\r\ndiff --git a/var/spack/repos/builtin/packages/fftw/package.py b/var/spack/repos/builtin/packages/fftw/package.py\r\nindex 5325545984..13e9cb3ec8 100644\r\n--- a/var/spack/repos/builtin/packages/fftw/package.py\r\n+++ b/var/spack/repos/builtin/packages/fftw/package.py\r\n@@ -101,9 +101,11 @@ def configure(self, spec, prefix):\r\n         # Variants that affect every precision\r\n         if '+openmp' in spec:\r\n             options.append('--enable-openmp')\r\n-            if spec.satisfies('@:2'):\r\n+            if spec.satisfies('@:2') or spec.satisfies('%apple-clang'):\r\n                 # TODO: libtool strips CFLAGS, so 2.x libxfftw_threads\r\n                 #       isn't linked to the openmp library. Patch Makefile?\r\n+                # work-around: autotools in FFTW does not find OpenMP without\r\n+                #              further help with AppleClang\r\n                 options.insert(0, 'CFLAGS=' + self.compiler.openmp_flag)\r\n         if '+mpi' in spec:\r\n             options.append('--enable-mpi')\r\n```\r\nbut this does not solve it yet:\r\n```\r\n\r\nchecking for OpenMP flag of C compiler... unknown\r\nconfigure: error: don't know how to enable OpenMP\r\n==> Error: ProcessError: Command exited with status 1:\r\n    '../configure' 'CFLAGS=-Xpreprocessor -fopenmp' '--prefix=/Users/jlvay/warpxtest/spack/opt/spack/darwin-catalina-ivybridge/apple-clang-12.0.0/fftw-3.3.9-kdebyf3xpxej56c7ijxf22ezm5pqfrev' '--enable-shared' '--enable-threads' '--enable-openmp' '--enable-mpi' '--enable-sse2' '--enable-avx' '--disable-avx2' '--disable-avx512' '--disable-avx-128-fma' '--disable-kcvi' '--disable-vsx' '--disable-neon' '--disable-fma'\r\n\r\n1 error found in build log:\r\n     196    checking how to hardcode library paths into programs... immediate\r\n     197    checking how to get verbose linking output from /Users/jlvay/warpxtest/spack/lib/spack/env/clang/gfortran... -v\r\n     198    checking for Fortran 77 libraries of /Users/jlvay/warpxtest/spack/lib/spack/env/clang/gfortran...  -L/usr/local/Cellar/gcc/11.1.0_1/lib/gcc/11/gcc/x86_64-apple-darwin19/11.1.0 -L/usr/local/Cellar/gcc/11.1.0_1/lib/gcc/11/gcc/x86_64-apple-darwin19/11.1.0/../../.. -lgfortran -lquadmath -lm\r\n     199    checking for dummy main to link with Fortran 77 libraries... none\r\n     200    checking for Fortran 77 name-mangling scheme... lower case, underscore, no extra underscore\r\n     201    checking for OpenMP flag of C compiler... unknown\r\n  >> 202    configure: error: don't know how to enable OpenMP\r\n```\r\n\r\nLooks like a problem with Autotools on macOS in general.\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\r\n- [X] I have uploaded the build log and environment files\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "ax3l",
    "url": "https://api.github.com/repos/spack/spack/issues/26037",
    "updated_at": "2021-09-18 21:13:48",
    "created_at": "2021-09-17 19:20:18",
    "closed_at": "2021-09-18 21:13:48",
    "state": "closed",
    "title": "Installation issue: fftw+openmp %apple-clang",
    "number": 26037,
    "milestone": null,
    "labels": [
        "macOS",
        "build-error",
        "openmp"
    ],
    "id": 999652978,
    "html_url": "https://github.com/spack/spack/issues/26037",
    "assignees": [],
    "comments": 2
}