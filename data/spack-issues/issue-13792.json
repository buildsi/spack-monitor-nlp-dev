{
    "body": "One of my cron jobs tripped an alarm this morning.  I've tracked the\r\nproblem down to this commit.  (The date says Nov 4, but it was merged\r\nyesterday, Nov 18).\r\n\r\n```\r\ncommit 99dfff447509a68d672a82812e5abfbc463b6d26\r\nAuthor: Greg Becker <becker33@llnl.gov>\r\nDate:   Mon Nov 4 23:03:35 2019 -0600\r\n\r\n    binary distribution: relocate text files properly in relative binaries (#13578)\r\n    \r\n    * Make relative binaries relocate text files properly\r\n    * rb strings aren't valid in python 2\r\n    * move perl to new interface for setup_environment family methods\r\n\r\nM       lib/spack/spack/binary_distribution.py\r\nM       lib/spack/spack/relocate.py\r\nM       var/spack/repos/builtin/packages/perl/package.py\r\n```\r\n\r\nI want to build libunwind version 2018.10.12.\r\n\r\n```\r\n$ spack spec libunwind @2018.10.12 %gcc@5.3.0\r\nInput spec\r\n--------------------------------\r\nlibunwind@2018.10.12%gcc@5.3.0\r\n\r\nConcretized\r\n--------------------------------\r\nlibunwind@2018.10.12%gcc@5.3.0~xz arch=linux-rhel7-broadwell\r\n    ^autoconf@2.69%gcc@5.3.0 arch=linux-rhel7-broadwell\r\n        ^m4@1.4.18%gcc@5.3.0 patches=3877ab548f88597ab2327a2230ee048d2d07ace1062efe81fc92e91b7f39cd00,fc9b61654a3ba1a8d6cd78ce087e7c96366c290bc8d2c299f09828d793b853c8 +sigsegv arch=linux-rhel7-broadwell\r\n            ^libsigsegv@2.12%gcc@5.3.0 arch=linux-rhel7-broadwell\r\n        ^perl@5.16.3%gcc@5.3.0+cpanm patches=0eac10ed90aeb0459ad8851f88081d439a4e41978e586ec743069e8b059370ac +shared+threads arch=linux-rhel7-broadwell\r\n    ^automake@1.16.1%gcc@5.3.0 arch=linux-rhel7-broadwell\r\n    ^libtool@2.4.6%gcc@5.3.0 arch=linux-rhel7-broadwell\r\n```\r\n\r\nThis is on RedHat 7.7, x86_64.  gcc 5.3.0 is from a spack-built module\r\n(/usr/bin/gcc is 4.8.5, hence the module).  This has all worked for\r\nmonths.\r\n\r\nDefault config.yaml.  Packages.yaml just has a path system perl.\r\n\r\n```\r\npackages:\r\n  perl:\r\n    paths:\r\n      perl@5.16.3:  /usr\r\n    buildable: False\r\n```\r\n\r\nIt fails with a libtool version problem, something to do with\r\n`/usr/bin/libtool` version 2.4.2 and the spack-built one 2.4.6.\r\n\r\n```\r\n/bin/sh ../libtool  --tag=CC   --mode=compile /home/krentel/failure/spack-repo/lib/spack/env/gcc/gcc -DHAVE_CONFIG_H -I. -I../include  -I../include -I../include/tdep-x86_64 -I. -D_GNU_SOURCE -DNDEBUG  -g -O2 -fexceptions -Wall -Wsign-compare -MT mi/Gget_proc_info_by_ip.lo -MD -MP -MF $depbase.Tpo -c -o mi/Gget_proc_info_by_ip.lo mi/Gget_proc_info_by_ip.c &&\\\r\nmv -f $depbase.Tpo $depbase.Plo\r\nlibtool: Version mismatch error.  This is libtool 2.4.2, but the\r\nlibtool: definition of this LT_INIT comes from libtool 2.4.6.\r\nlibtool: You should recreate aclocal.m4 with macros from libtool 2.4.2\r\nlibtool: and run autoconf again.\r\nmake[2]: *** [os-linux.lo] Error 63\r\nmake[2]: *** Waiting for unfinished jobs....\r\n```\r\n\r\nNote: libunwind 2018.10.12 doesn't include the autotools-generated\r\nfiles.  So for this version, the autotools prereqs are required to\r\ngenerate them.  I put this in libuwind `package.py`.\r\n\r\n```\r\ndepends_on('autoconf', type='build', when='@2018:')\r\ndepends_on('automake', type='build', when='@2018:')\r\ndepends_on('libtool',  type='build', when='@2018:')\r\ndepends_on('m4',       type='build', when='@2018:')\r\n```\r\n\r\nAutotools writes the value of PATH in `config.log`.  I tracked this\r\ndown to putting `/usr/bin` early in my spack path.\r\n\r\nThe previous commit has this and works:\r\n\r\n```\r\nPATH: /home/krentel/failure/spack-repo/lib/spack/env/gcc\r\nPATH: /home/krentel/failure/spack-repo/lib/spack/env/case-insensitive\r\nPATH: /home/krentel/failure/spack-repo/lib/spack/env\r\nPATH: /home/krentel/failure/install/linux-rhel7-broadwell/gcc-5.3.0/libtool-2.4.6-xvngx4hjmii7ixzx4m23yf2bepp5xwpw/bin\r\nPATH: /home/krentel/failure/install/linux-rhel7-broadwell/gcc-5.3.0/m4-1.4.18-eo2dulb33kd3q5zfw2r2njczfng3wcux/bin\r\nPATH: /home/krentel/failure/install/linux-rhel7-broadwell/gcc-5.3.0/automake-1.16.1-qf74dlj76f2mlzy5jbdkfzedjtzlekzd/bin\r\nPATH: /home/krentel/failure/install/linux-rhel7-broadwell/gcc-5.3.0/m4-1.4.18-eo2dulb33kd3q5zfw2r2njczfng3wcux/bin\r\n...\r\n```\r\n\r\nThe 99dfff44750 commit has this:\r\n\r\n```\r\nPATH: /usr/bin\r\nPATH: /home/krentel/failure/spack-repo/lib/spack/env/gcc\r\nPATH: /home/krentel/failure/spack-repo/lib/spack/env/case-insensitive\r\nPATH: /home/krentel/failure/spack-repo/lib/spack/env\r\nPATH: /home/krentel/failure/install/linux-rhel7-broadwell/gcc-5.3.0/libtool-2.4.6-xvngx4hjmii7ixzx4m23yf2bepp5xwpw/bin\r\nPATH: /home/krentel/failure/install/linux-rhel7-broadwell/gcc-5.3.0/m4-1.4.18-eo2dulb33kd3q5zfw2r2njczfng3wcux/bin\r\nPATH: /home/krentel/failure/install/linux-rhel7-broadwell/gcc-5.3.0/automake-1.16.1-qf74dlj76f2mlzy5jbdkfzedjtzlekzd/bin\r\n...\r\n```\r\n\r\nThis is going to break a lot of build dependencies if you put\r\n`/usr/bin` at the front of PATH.\r\n\r\nping @becker33 ",
    "user": "mwkrentel",
    "url": "https://api.github.com/repos/spack/spack/issues/13792",
    "updated_at": "2019-11-29 11:30:41",
    "created_at": "2019-11-19 20:42:08",
    "closed_at": "2019-11-29 11:30:41",
    "state": "closed",
    "title": "external perl from /usr breaks build dependencies",
    "number": 13792,
    "milestone": null,
    "labels": [
        "bug",
        "impact-low"
    ],
    "id": 525254497,
    "html_url": "https://github.com/spack/spack/issues/13792",
    "assignees": [
        "scheibelp"
    ],
    "comments": 3
}