{
    "body": "### Steps to reproduce the issue\n\nThe command.\r\n\r\n```console\r\nspack install -j 4 ascent+shared+mpi~openmp+python~vtkh~dray~fortran %gcc@11.2.0\r\n```\r\n\r\nThe error with --verbose --stacktrace on:\r\n```console\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/ncurses-6.2-34rtfejtbumggcwiinlhmhohvlsh5xer\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/berkeley-db-18.1.40-bibpdt762rgu2lpume4kfeg5bsxelypm\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/libiconv-1.16-dvmasuijosalk4slnymrt3dw37o537in\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/zlib-1.2.11-sudngp7k3vr7lknscbfii2n2rcrubghg\r\nlib/spack/spack/installer.py:323 ==> mpich@8.1.10-spock : has external module in ['craype-network-ofi', 'libfabric/1.11.0.4.75', 'cray-mpich/8.1.10']\r\n[+] /opt/cray/pe/mpich/8.1.10/gtl (external mpich-8.1.10-spock-mlqdr2ygrffdrrki5cj2jhglqbykm4tk)\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/pkgconf-1.8.0-56u5dumncfbiit2usbym4tgcxhltcnv4\r\nlib/spack/spack/installer.py:323 ==> py-mpi4py@3.0.3-spock : has external module in ['cray-python/3.8.5.1']\r\n[+] /opt/cray/pe/python/3.8.5.1 (external py-mpi4py-3.0.3-spock-2dfvre2mtkhpvd4to7x6nscciq4ymjem)\r\nlib/spack/spack/installer.py:323 ==> py-numpy@1.18.2-spock : has external module in ['cray-python/3.8.5.1']\r\n[+] /opt/cray/pe/python/3.8.5.1 (external py-numpy-1.18.2-spock-t7rn4ut5gxfqawyxrweu6upkboonzod3)\r\nlib/spack/spack/installer.py:323 ==> python@3.8.5.1-spock : has external module in ['cray-python/3.8.5.1']\r\n[+] /opt/cray/pe/python/3.9.4.1 (external python-3.8.5.1-spock-xh5zbpneaenl76ontqaglulu5thifzgp)\r\nlib/spack/spack/installer.py:323 ==> py-pip@20.1.1-spock : has external module in ['cray-python/3.8.5.1']\r\n[+] /opt/cray/pe/python/3.8.5.1 (external py-pip-20.1.1-spock-r3lqii2opu2brxzlncvz57ebfl44enus)\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/readline-8.1-e5rezb2rtanzq3tt3nslenepbdjfznnf\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/diffutils-3.8-l75huvldatvdf3kbcxju7n2p76l4ndaq\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/gdbm-1.19-u4663v5sjkczci4mjwidnyjwjamtbgco\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/bzip2-1.0.8-okqitxvyrdezbkbdkdfeifyrjjf5qrdo\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/perl-5.34.0-scze5mv6tig5zqtufb423yxxd2pmbjgw\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/openssl-1.1.1m-rrr5ke5oqfoqwyvtijwka7b5or4eu5lq\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/cmake-3.22.1-sxug24tr2ejimmgj4hl7qhbuogebpy6y\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/hdf5-1.8.22-6k56s3ksovqz7jefeswclzhcqvpe4nc4\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/metis-5.1.0-nmtzjo4st4pqsnzuqctlt6ymcxtntxxk\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/parmetis-4.0.3-og7hwxmk6xewona563umboohitoe74rq\r\n[+] /gpfs/alpine/csc444/scratch/rkratt/opt/spack/cray-sles15-zen2/gcc-11.2.0/conduit-0.7.2-kq52cevkkp6a6uptlxetlco74cuenfid\r\nlib/spack/spack/installer.py:1160 ==> Installing ascent-0.7.1-trxhsymh5qi7e5wskcuxokggmgdie3bz\r\nlib/spack/spack/installer.py:286 ==> No binary for ascent-0.7.1-trxhsymh5qi7e5wskcuxokggmgdie3bz found: installing from source\r\nlib/spack/spack/error.py:54 ==> Error: KeyError: 'No spec with name python in py-pip@20.1.1-spock%gcc@11.2.0 arch=cray-sles15-zen2'\r\n\r\n/autofs/nccs-svm1_home1/rkratt/repos/spack/var/spack/repos/builtin/packages/py-pip/package.py:53, in setup_dependent_package:\r\n         52    def setup_dependent_package(self, module, dependent_spec):\r\n  >>     53        pip = self.spec['python'].command\r\n         54        pip.add_default_arg('-m')\r\n         55        pip.add_default_arg('pip')\r\n         56        setattr(module, 'pip', pip)\r\n\r\n```\n\n### Information on your system\n\nOn Spock@ORNL\r\n\r\npackages.yaml (abridged)\r\n```yaml\r\npackages:\r\n  py-pip:\r\n    externals:\r\n    - spec: py-pip@20.1.1-spock\r\n      modules:\r\n        - cray-python/3.8.5.1\r\n    buildable: false\r\n  python:\r\n    externals:\r\n    - spec: python@3.8.5.1-spock\r\n      modules:\r\n      - cray-python/3.8.5.1\r\n      prefix: /opt/cray/pe/python/3.9.4.1\r\n    buildable: false\r\n```\r\n\r\nI am on a custom branch for testing a few different changes on spock. The relevant changes for building conduit at a minimum are [here](https://github.com/kwryankrattiger/spack/tree/conduit_no_check_fc) and all of the changes on this are [here](https://github.com/kwryankrattiger/spack/tree/spock_test).\r\n\r\n```console\r\n* **Spack:** 0.17.1-922-8752c39b47\r\n* **Python:** 3.6.13\r\n* **Platform:** cray-sles15-zen2\r\n* **Concretizer:** clingo\r\n```\n\n### Additional information\n\n[ascent-build-out.txt](https://github.com/spack/spack/files/7930049/ascent-build-out.txt)\r\n[ascent-build-env.txt](https://github.com/spack/spack/files/7930050/ascent-build-env.txt)\r\n\r\n@adamjstewart \n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "kwryankrattiger",
    "url": "https://api.github.com/repos/spack/spack/issues/28578",
    "updated_at": "2022-01-25 02:13:01",
    "created_at": "2022-01-25 02:03:38",
    "closed_at": "2022-01-25 02:13:01",
    "state": "closed",
    "title": "Build issue: py-pip can't find spec `python`",
    "number": 28578,
    "milestone": null,
    "labels": [
        "build-error"
    ],
    "id": 1113337375,
    "html_url": "https://github.com/spack/spack/issues/28578",
    "assignees": [],
    "comments": 1
}