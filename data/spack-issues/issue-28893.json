{
    "body": "### Steps to reproduce\r\n\r\n```\r\nStart container:\r\ndocker pull satmandu/crewbuild:alex-i686.m58\r\ndocker pull tonistiigi/binfmt\r\ndocker run --privileged --rm tonistiigi/binfmt --install all\r\ndocker run --platform linux/386 --rm -v $(pwd)/pkg_cache:/usr/local/tmp/packages -v $(pwd):/output -h $(hostname)-i686 -it satmandu/crewbuild:alex-i686.m58 /usr/local/bin/setarch i686 sudo -i -u chronos /usr/local/bin/bash -i\r\n```\r\nThat starts the container.\r\nNow in the container:\r\n```\r\ncd /usr/local/tmp\r\n\r\ngit clone -c feature.manyFiles=true https://github.com/spack/spack.git\r\ngit checkout releases/v0.17\r\n. share/spack/setup-env.sh\r\nspack install gdb\r\n```\r\n\r\n### Error message\r\n\r\n==> Error: the \"target\" field in compilers.yaml accepts only target families [replace \"i686\" with \"x86\" in \"clang@13.0.1\" specification]\r\n\r\n```\r\n spack -d install gdb @11.1\r\n==> [2022-02-11-17:38:49.103052] Imported install from built-in commands\r\n==> [2022-02-11-17:38:49.105086] Reading config file /usr/local/tmp/spack/etc/spack/defaults/config.yaml\r\n==> [2022-02-11-17:38:49.125603] Imported install from built-in commands\r\n==> [2022-02-11-17:38:49.126397] Reading config file /usr/local/tmp/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2022-02-11-17:38:49.135730] Reading config file /usr/local/tmp/spack/etc/spack/defaults/config.yaml\r\n==> [2022-02-11-17:38:49.154913] DATABASE LOCK TIMEOUT: 3s\r\n==> [2022-02-11-17:38:49.154978] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2022-02-11-17:38:49.155463] Reading config file /usr/local/tmp/spack/etc/spack/defaults/bootstrap.yaml\r\n==> [2022-02-11-17:38:49.163433] DATABASE LOCK TIMEOUT: 3s\r\n==> [2022-02-11-17:38:49.163514] PACKAGE LOCK TIMEOUT: No timeout\r\n==> [2022-02-11-17:38:49.163600] [BOOTSTRAP CONFIG SCOPE] name=_builtin\r\n==> [2022-02-11-17:38:49.164039] [BOOTSTRAP CONFIG SCOPE] name=defaults, path=/usr/local/tmp/spack/etc/spack/defaults\r\n==> [2022-02-11-17:38:49.164084] [BOOTSTRAP CONFIG SCOPE] name=defaults/linux, path=/usr/local/tmp/spack/etc/spack/defaults/linux\r\n==> [2022-02-11-17:38:49.164137] [BOOTSTRAP CONFIG SCOPE] name=bootstrap, path=/home/chronos/user/.spack/bootstrap/config\r\n==> [2022-02-11-17:38:49.164184] [BOOTSTRAP CONFIG SCOPE] name=bootstrap/linux, path=/home/chronos/user/.spack/bootstrap/config/linux\r\n==> [2022-02-11-17:38:49.164555] Reading config file /home/chronos/user/.spack/bootstrap/config/linux/compilers.yaml\r\n==> [2022-02-11-17:38:49.174643] Reading config file /usr/local/tmp/spack/etc/spack/defaults/config.yaml\r\nTraceback (most recent call last):\r\n  File \"/usr/local/tmp/spack/bin/spack\", line 100, in <module>\r\n    sys.exit(spack.main.main())\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/main.py\", line 900, in main\r\n    return _main(argv)\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/main.py\", line 883, in _main\r\n    return _invoke_command(command, parser, args, unknown)\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/main.py\", line 553, in _invoke_command\r\n    return_val = command(parser, args)\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/cmd/install.py\", line 401, in install\r\n    specs = spack.cmd.parse_specs(\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/cmd/__init__.py\", line 166, in parse_specs\r\n    spec.concretize(tests=tests, reuse=reuse)  # implies normalize\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/spec.py\", line 2639, in concretize\r\n    self._new_concretize(tests, reuse=reuse)\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/spec.py\", line 2610, in _new_concretize\r\n    result = spack.solver.asp.solve([self], tests=tests, reuse=reuse)\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/solver/asp.py\", line 2041, in solve\r\n    driver = PyclingoDriver()\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/solver/asp.py\", line 489, in __init__\r\n    bootstrap_clingo()\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/solver/asp.py\", line 467, in bootstrap_clingo\r\n    with spack.bootstrap.ensure_bootstrap_configuration():\r\n  File \"/usr/local/lib/python3.10/contextlib.py\", line 135, in __enter__\r\n    return next(self.gen)\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/bootstrap.py\", line 691, in ensure_bootstrap_configuration\r\n    _add_compilers_if_missing()\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/bootstrap.py\", line 659, in _add_compilers_if_missing\r\n    if not spack.compilers.compilers_for_arch(arch):\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/compilers/__init__.py\", line 333, in compilers_for_arch\r\n    return list(get_compilers(config, arch_spec=arch_spec))\r\n  File \"/usr/local/tmp/spack/lib/spack/spack/compilers/__init__.py\", line 450, in get_compilers\r\n    raise ValueError(msg)\r\nValueError: the \"target\" field in compilers.yaml accepts only target families [replace \"i686\" with \"x86\" in \"clang@13.0.1\" specification]\r\n```\r\n\r\neven editing the relevant yaml file doesn't help:\r\n```\r\nsed -i 's/i686/x86/g' /home/chronos/user/.spack/bootstrap/config/linux/compilers.yaml\r\nspack install gdb\r\nxz: /lib/liblzma.so.5: version `XZ_5.3.1alpha' not found (required by xz)\r\n/usr/local/bin/tar: Child returned status 1\r\n/usr/local/bin/tar: Error is not recoverable: exiting now\r\n==> Error: ProcessError: Command exited with status 2:\r\n    '/usr/local/bin/tar' '-oxf' '/usr/local/tmp/chronos/spack-stage/spack-stage-re2c-2.2-eulg4qcwv7kuulggayxgmiix5nccwgoe/re2c-2.2.tar.xz'\r\n==> Warning: Skipping build of clingo-bootstrap-spack-keegk5g75ms5irj5l6ihxtrt2n5govaf since re2c-2.2-eulg4qcwv7kuulggayxgmiix5nccwgoe failed\r\n==> Error: cannot bootstrap the \"clingo\" Python module from spec \"clingo-bootstrap@spack+python %gcc target=i686\" due to the following failures:\r\n    'spack-install' raised InstallError: Terminating after first install failure: ProcessError: Command exited with status 2:\r\n    '/usr/local/bin/tar' '-oxf' '/usr/local/tmp/chronos/spack-stage/spack-stage-re2c-2.2-eulg4qcwv7kuulggayxgmiix5nccwgoe/re2c-2.2.tar.xz'\r\n    Please run `spack -d spec zlib` for more verbose error messages\r\n```\r\nEdit: I had to add a static version of xz to get the build to continue.\r\n```\r\ncrew install musl_xz\r\nPATH=/usr/local/share/musl/bin:$PATH spack install gdb\r\n```\r\n\r\nI guess spack doesn't handle a non-standard LD_LIBRARY_PATH?\r\n\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.17.1\r\n* **Python:** 3.10.2\r\n* **Platform:** linux-chromeos58-i686\r\n* **Concretizer:** clingo\r\n\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "satmandu",
    "url": "https://api.github.com/repos/spack/spack/issues/28893",
    "updated_at": "2022-02-11 21:09:12",
    "created_at": "2022-02-11 17:39:23",
    "closed_at": "None",
    "state": "open",
    "title": "spack i686 compat",
    "number": 28893,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 1132902028,
    "html_url": "https://github.com/spack/spack/issues/28893",
    "assignees": [],
    "comments": 0
}