{
    "body": "### Steps to reproduce the issue\n\n`vtk-m@1.6.0 +cuda` build fails if `cuda_arch=none`\r\n\r\nUsing:\r\n* `spack@develop` (f81d84dfc6b1c3a821dffab785e62ecd79f130ab from `Tue Dec 7 12:30:14 2021 +0100`)\r\n* Ubuntu 20.04, GCC 9.3.0, X86_64\r\n\r\nConcrete spec: [vtk-m.spec.json.txt](https://github.com/spack/spack/files/7694066/vtk-m.spec.json.txt)\r\n\r\nConcretization:\r\n```\r\nvtk-m@1.6.0%gcc@9.3.0~64bitids+ascent_types+cuda+doubleprecision~hip~ipo~logging+mpi+openmp+rendering~shared~tbb~virtuals amdgpu_target=none build_type=Release cuda_arch=none arch=linux-ubuntu20.04-x86_64\r\n    ^cmake@3.21.4%gcc@9.3.0~doc+ncurses+openssl+ownlibs~qt build_type=Release arch=linux-ubuntu20.04-x86_64\r\n        ^ncurses@6.2%gcc@9.3.0~symlinks+termlib abi=none arch=linux-ubuntu20.04-x86_64\r\n            ^pkgconf@1.8.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^openssl@1.1.1l%gcc@9.3.0~docs certs=system arch=linux-ubuntu20.04-x86_64\r\n            ^perl@5.34.0%gcc@9.3.0+cpanm+shared+threads arch=linux-ubuntu20.04-x86_64\r\n                ^berkeley-db@18.1.40%gcc@9.3.0+cxx~docs+stl patches=b231fcc4d5cff05e5c3a4814f6a5af0e9a966428dc2176540d2c05aff41de522 arch=linux-ubuntu20.04-x86_64\r\n                ^bzip2@1.0.8%gcc@9.3.0~debug~pic+shared arch=linux-ubuntu20.04-x86_64\r\n                    ^diffutils@3.8%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                        ^libiconv@1.16%gcc@9.3.0 libs=shared,static arch=linux-ubuntu20.04-x86_64\r\n                ^gdbm@1.19%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^readline@8.1%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^zlib@1.2.11%gcc@9.3.0+optimize+pic+shared arch=linux-ubuntu20.04-x86_64\r\n    ^cuda@11.5.1%gcc@9.3.0~dev arch=linux-ubuntu20.04-x86_64\r\n        ^libxml2@2.9.12%gcc@9.3.0~python arch=linux-ubuntu20.04-x86_64\r\n            ^xz@5.2.5%gcc@9.3.0+pic libs=shared,static arch=linux-ubuntu20.04-x86_64\r\n    ^mpich@3.4.2%gcc@9.3.0~argobots+fortran+hwloc+hydra+libxml2+pci+romio~slurm~two_level_namespace~verbs~wrapperrpath device=ch4 netmod=ofi pmi=pmi arch=linux-ubuntu20.04-x86_64\r\n        ^findutils@4.8.0%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^hwloc@2.6.0%gcc@9.3.0~cairo~cuda~gl~libudev+libxml2~netloc~nvml~opencl+pci~rocm+shared arch=linux-ubuntu20.04-x86_64\r\n            ^libpciaccess@0.16%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^libtool@2.4.6%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                    ^m4@1.4.19%gcc@9.3.0+sigsegv patches=9dc5fbd0d5cb1037ab1e6d0ecc74a30df218d0a94bdd5a02759a97f62daca573,bfdffa7c2eb01021d5849b36972c069693654ad826c1a20b53534009a4ec7a89 arch=linux-ubuntu20.04-x86_64\r\n                        ^libsigsegv@2.13%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n                ^util-macros@1.19.3%gcc@9.3.0 arch=linux-ubuntu20.04-x86_64\r\n        ^libfabric@1.14.0%gcc@9.3.0~debug~kdreg fabrics=rxm,sockets,tcp,udp arch=linux-ubuntu20.04-x86_64\r\n```\r\n\r\nError:\r\n```\r\n$> spack install -f ./vtk-m.spec.json\r\n...\r\n==> Installing vtk-m-1.6.0-uczqqylkiff7uob3g4e4nic4kcwejx7i\r\n==> No binary for vtk-m-1.6.0-uczqqylkiff7uob3g4e4nic4kcwejx7i found: installing from source\r\n==> Using cached archive: /spack/var/spack/cache/_source-cache/archive/14/14e62d306dd33f82eb9ddb1d5cee987b7a0b91bf08a7a02ca3bce3968c95fd76.tar.gz\r\n==> No patches needed for vtk-m\r\n==> vtk-m: Executing phase: 'cmake'\r\n==> Error: ProcessError: Command exited with status 1:\r\n    'cmake' '-G' 'Unix Makefiles' '-DCMAKE_INSTALL_PREFIX:STRING=/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/vtk-m-1.6.0-uczqqylkiff7uob3g4e4nic4kcwejx7i' '-DCMAKE_BUILD_TYPE:STRING=Release' '-DCMAKE_INTERPROCEDURAL_OPTIMIZATION:BOOL=OFF' '-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON' '-DCMAKE_INSTALL_RPATH_USE_LINK_PATH:BOOL=OFF' '-DCMAKE_INSTALL_RPATH:STRING=/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/vtk-m-1.6.0-uczqqylkiff7uob3g4e4nic4kcwejx7i/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/vtk-m-1.6.0-uczqqylkiff7uob3g4e4nic4kcwejx7i/lib64;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libxml2-2.9.12-xlbi5rk675mptoyjnuff4q3e2lajs2wr/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libiconv-1.16-zth4ohvj7y3p532iqjw7fptg3kkn3ixv/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/xz-5.2.5-mq4ikt5q4zttamuxqkqe66jlftjbvkf4/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/zlib-1.2.11-ufqpqnpj5gjkfx5sd2o3twwveuowcz2b/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/mpich-3.4.2-da2intlyhnltoebtrcvfl7qeffmwwzp6/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/hwloc-2.6.0-bivhc36xulak7wjqfzshvzhioqs3ki77/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libpciaccess-0.16-4jbn7mznw664dc4mlseouzovsfx6sor5/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/ncurses-6.2-nxjjphalwbf2ywlxpn74nsfcsrq2bbtd/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libfabric-1.14.0-ohufqpc3kq5sd32tcn2pp3t636knmxxd/lib;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cuda-11.5.1-7zovxzh23daik22jdh4kb5l4gobp5ojt/lib64' '-DCMAKE_PREFIX_PATH:STRING=/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/mpich-3.4.2-da2intlyhnltoebtrcvfl7qeffmwwzp6;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libfabric-1.14.0-ohufqpc3kq5sd32tcn2pp3t636knmxxd;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/hwloc-2.6.0-bivhc36xulak7wjqfzshvzhioqs3ki77;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libpciaccess-0.16-4jbn7mznw664dc4mlseouzovsfx6sor5;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cuda-11.5.1-7zovxzh23daik22jdh4kb5l4gobp5ojt;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libxml2-2.9.12-xlbi5rk675mptoyjnuff4q3e2lajs2wr;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/xz-5.2.5-mq4ikt5q4zttamuxqkqe66jlftjbvkf4;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cmake-3.21.4-55vqjfj2bk55ga4fj3erj5tpzugh3t3b;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/zlib-1.2.11-ufqpqnpj5gjkfx5sd2o3twwveuowcz2b;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/libiconv-1.16-zth4ohvj7y3p532iqjw7fptg3kkn3ixv;/spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/ncurses-6.2-nxjjphalwbf2ywlxpn74nsfcsrq2bbtd' '-DVTKm_ENABLE_TESTING:BOOL=OFF' '-DBUILD_SHARED_LIBS=OFF' '-DVTKm_USE_DOUBLE_PRECISION:BOOL=ON' '-DVTKm_ENABLE_LOGGING:BOOL=OFF' '-DVTKm_ENABLE_MPI:BOOL=ON' '-DVTKm_ENABLE_RENDERING:BOOL=ON' '-DVTKm_USE_DEFAULT_TYPES_FOR_ASCENT:BOOL=ON' '-DVTKm_NO_DEPRECATED_VIRTUAL:BOOL=ON' '-DVTKm_USE_64BIT_IDS:BOOL=OFF' '-DVTKm_ENABLE_CUDA:BOOL=ON' '-DCMAKE_CUDA_HOST_COMPILER=/usr/bin/g++' '-DVTKm_ENABLE_HIP:BOOL=OFF' '-DVTKm_ENABLE_OPENMP:BOOL=ON' '-DVTKm_ENABLE_TBB:BOOL=OFF' '/tmp/root/spack-stage/spack-stage-vtk-m-1.6.0-uczqqylkiff7uob3g4e4nic4kcwejx7i/spack-src'\r\n\r\n1 error found in build log:\r\n     17    -- The CUDA compiler identification is NVIDIA 11.5.119\r\n     18    -- Detecting CUDA compiler ABI info\r\n     19    -- Detecting CUDA compiler ABI info - done\r\n     20    -- Check for working CUDA compiler: /spack/opt/spack/linux-ubuntu20.04-x86_64/gcc-9.3.0/cuda-11.5.1-7zovxzh23daik22jdh4kb5l4gobp5ojt/bin/nvcc\r\n           - skipped\r\n     21    -- Detecting CUDA compile features\r\n     22    -- Detecting CUDA compile features - done\r\n  >> 23    CMake Error at CMake/VTKmDeviceAdapters.cmake:224 (message):\r\n     24      Error detecting architecture flags for CUDA.  Please set\r\n     25      VTKm_CUDA_Architecture manually.\r\n     26    Call Stack (most recent call first):\r\n     27      CMake/VTKmWrappers.cmake:14 (include)\r\n     28      CMakeLists.txt:179 (include)\r\n```\n\n### Information on your system\n\n* **Spack:** 0.17.0-445-f81d84dfc6\r\n* **Python:** 3.8.10\r\n* **Platform:** linux-ubuntu20.04-cascadelake\r\n* **Concretizer:** clingo\n\n### Additional information\n\n[spack-build-01-cmake-out.txt](https://github.com/spack/spack/files/7694086/spack-build-01-cmake-out.txt)\r\n[spack-build-env.txt](https://github.com/spack/spack/files/7694087/spack-build-env.txt)\r\n[spack-build-out.txt](https://github.com/spack/spack/files/7694088/spack-build-out.txt)\r\n\r\n@kmorel\r\n@robertmaynard \r\n@vicentebolea\n\n### General information\n\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\n- [X] I have run `spack maintainers <name-of-the-package>` and **@mentioned** any maintainers\n- [X] I have uploaded the build log and environment files\n- [X] I have searched the issues of this repo and believe this is not a duplicate",
    "user": "eugeneswalker",
    "url": "https://api.github.com/repos/spack/spack/issues/27915",
    "updated_at": "2021-12-13 16:46:09",
    "created_at": "2021-12-10 16:55:42",
    "closed_at": "2021-12-13 16:46:09",
    "state": "closed",
    "title": "vtk-m +cuda build fails when cuda_arch=none: VTKmDeviceAdapters.cmake:224: set VTKm_CUDA_Architecture manually",
    "number": 27915,
    "milestone": null,
    "labels": [
        "build-error",
        "cuda",
        "e4s"
    ],
    "id": 1077045472,
    "html_url": "https://github.com/spack/spack/issues/27915",
    "assignees": [],
    "comments": 0
}