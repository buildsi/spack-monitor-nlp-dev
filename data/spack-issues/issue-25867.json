{
    "body": "### Steps to reproduce\r\n\r\n```console\r\n$ git fetch && git checkout develop && git reset --hard origin/develop\r\n$ spack clean -dfmps\r\n$ spack unit-test --lf\r\n```\r\n\r\n### Error message\r\n\r\n```\r\n======================================================================================================================================== FAILURES ========================================================================================================================================\r\n___________________________________________________________________________________________________________________ test_default_rpaths_create_install_default_layout ____________________________________________________________________________________________________________________\r\n\r\nmirror_dir = '/tmp/pytest-of-user/pytest-5/mirror0'\r\n\r\n    @pytest.mark.requires_executables(*args)\r\n    @pytest.mark.maybeslow\r\n    @pytest.mark.usefixtures(\r\n        'default_config', 'cache_directory', 'install_dir_default_layout',\r\n        'test_mirror'\r\n    )\r\n    def test_default_rpaths_create_install_default_layout(mirror_dir):\r\n        \"\"\"\r\n        Test the creation and installation of buildcaches with default rpaths\r\n        into the default directory layout scheme.\r\n        \"\"\"\r\n        gspec, cspec = Spec('garply').concretized(), Spec('corge').concretized()\r\n    \r\n        # Install 'corge' without using a cache\r\n        install_cmd('--no-cache', cspec.name)\r\n    \r\n        # Create a buildache\r\n        buildcache_cmd('create', '-au', '-d', mirror_dir, cspec.name)\r\n        # Test force overwrite create buildcache (-f option)\r\n        buildcache_cmd('create', '-auf', '-d', mirror_dir, cspec.name)\r\n    \r\n        # Create mirror index\r\n        mirror_url = 'file://{0}'.format(mirror_dir)\r\n        buildcache_cmd('update-index', '-d', mirror_url)\r\n        # List the buildcaches in the mirror\r\n        buildcache_cmd('list', '-alv')\r\n    \r\n        # Uninstall the package and deps\r\n>       uninstall_cmd('-y', '--dependents', gspec.name)\r\n\r\nlib/spack/spack/test/bindist.py:219: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088ee47c0>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n_______________________________________________________________________________________________________________________ test_relative_rpaths_create_default_layout _______________________________________________________________________________________________________________________\r\n\r\nmirror_dir = '/tmp/pytest-of-user/pytest-5/mirror0'\r\n\r\n    @pytest.mark.requires_executables(*args)\r\n    @pytest.mark.maybeslow\r\n    @pytest.mark.nomockstage\r\n    @pytest.mark.usefixtures(\r\n        'default_config', 'cache_directory', 'install_dir_default_layout'\r\n    )\r\n    def test_relative_rpaths_create_default_layout(mirror_dir):\r\n        \"\"\"\r\n        Test the creation and installation of buildcaches with relative\r\n        rpaths into the default directory layout scheme.\r\n        \"\"\"\r\n    \r\n        gspec, cspec = Spec('garply').concretized(), Spec('corge').concretized()\r\n    \r\n        # Install 'corge' without using a cache\r\n        install_cmd('--no-cache', cspec.name)\r\n    \r\n        # Create build cache with relative rpaths\r\n        buildcache_cmd(\r\n            'create', '-aur', '-d', mirror_dir, cspec.name\r\n        )\r\n    \r\n        # Create mirror index\r\n        mirror_url = 'file://%s' % mirror_dir\r\n        buildcache_cmd('update-index', '-d', mirror_url)\r\n    \r\n        # Uninstall the package and deps\r\n>       uninstall_cmd('-y', '--dependents', gspec.name)\r\n\r\nlib/spack/spack/test/bindist.py:286: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd08870a730>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n______________________________________________________________________________________________________________________ test_relative_rpaths_install_default_layout _______________________________________________________________________________________________________________________\r\n\r\nmirror_dir = '/tmp/pytest-of-user/pytest-5/mirror0'\r\n\r\n    @pytest.mark.requires_executables(*args)\r\n    @pytest.mark.maybeslow\r\n    @pytest.mark.nomockstage\r\n    @pytest.mark.usefixtures(\r\n        'default_config', 'cache_directory', 'install_dir_default_layout',\r\n        'test_mirror'\r\n    )\r\n    def test_relative_rpaths_install_default_layout(mirror_dir):\r\n        \"\"\"\r\n        Test the creation and installation of buildcaches with relative\r\n        rpaths into the default directory layout scheme.\r\n        \"\"\"\r\n        gspec, cspec = Spec('garply').concretized(), Spec('corge').concretized()\r\n    \r\n        # Install buildcache created with relativized rpaths\r\n        buildcache_cmd('install', '-auf', cspec.name)\r\n    \r\n        # This gives warning that spec is already installed\r\n        buildcache_cmd('install', '-auf', cspec.name)\r\n    \r\n        # Uninstall the package and deps\r\n>       uninstall_cmd('-y', '--dependents', gspec.name)\r\n\r\nlib/spack/spack/test/bindist.py:310: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088ae7100>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n____________________________________________________________________________________________________________________________ test_update_sbang[mock_archive0] ____________________________________________________________________________________________________________________________\r\n\r\ntmpdir = local('/tmp/pytest-of-user/pytest-5/test_update_sbang_mock_archive0'), test_mirror = '/tmp/pytest-of-user/pytest-5/mirror0'\r\n\r\n    @pytest.mark.usefixtures('mock_fetch', 'install_mockery')\r\n    def test_update_sbang(tmpdir, test_mirror):\r\n        \"\"\"Test the creation and installation of buildcaches with default rpaths\r\n        into the non-default directory layout scheme, triggering an update of the\r\n        sbang.\r\n        \"\"\"\r\n        scheme = os.path.join(\r\n            '${name}', '${version}',\r\n            '${architecture}-${compiler.name}-${compiler.version}-${hash}'\r\n        )\r\n        spec_str = 'old-sbang'\r\n        # Concretize a package with some old-fashioned sbang lines.\r\n        old_spec = Spec(spec_str).concretized()\r\n        old_spec_hash_str = '/{0}'.format(old_spec.dag_hash())\r\n    \r\n        # Need a fake mirror with *function* scope.\r\n        mirror_dir = test_mirror\r\n        mirror_url = 'file://{0}'.format(mirror_dir)\r\n    \r\n        # Assume all commands will concretize old_spec the same way.\r\n        install_cmd('--no-cache', old_spec.name)\r\n    \r\n        # Create a buildcache with the installed spec.\r\n        buildcache_cmd('create', '-u', '-a', '-d', mirror_dir, old_spec_hash_str)\r\n    \r\n        # Need to force an update of the buildcache index\r\n        buildcache_cmd('update-index', '-d', mirror_url)\r\n    \r\n        # Uninstall the original package.\r\n>       uninstall_cmd('-y', old_spec_hash_str)\r\n\r\nlib/spack/spack/test/bindist.py:569: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088d5c880>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n________________________________________________________________________________________________________________________ test_uninstall_deprecated[mock_archive0] ________________________________________________________________________________________________________________________\r\n\r\nmock_packages = <spack.repo.RepoPath object at 0x7fd08b440580>\r\nmock_archive = Archive(url='file:///tmp/pytest-of-user/pytest-5/mock-archive-dir0/spack-src.tar.gz', path='/tmp/pytest-of-user/py...archive_file='/tmp/pytest-of-user/pytest-5/mock-archive-dir0/spack-src.tar.gz', expanded_archive_basedir='spack-src'), mock_fetch = None\r\ninstall_mockery = None\r\n\r\n    def test_uninstall_deprecated(mock_packages, mock_archive, mock_fetch,\r\n                                  install_mockery):\r\n        \"\"\"Tests that we can still uninstall deprecated packages.\"\"\"\r\n        install('libelf@0.8.13')\r\n        install('libelf@0.8.10')\r\n    \r\n        deprecate('-y', 'libelf@0.8.10', 'libelf@0.8.13')\r\n    \r\n        non_deprecated = spack.store.db.query()\r\n    \r\n>       uninstall('-y', 'libelf@0.8.10')\r\n\r\nlib/spack/spack/test/cmd/deprecate.py:121: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd08b4d6ca0>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n_______________________________________________________________________________________________________________ test_compiler_bootstrap_from_binary_mirror[mock_archive0] ________________________________________________________________________________________________________________\r\n\r\ninstall_mockery_mutable_config = None, mock_packages = <spack.repo.RepoPath object at 0x7fd0894c21f0>, mock_fetch = None\r\nmock_archive = Archive(url='file:///tmp/pytest-of-user/pytest-5/mock-archive-dir0/spack-src.tar.gz', path='/tmp/pytest-of-user/py...archive_file='/tmp/pytest-of-user/pytest-5/mock-archive-dir0/spack-src.tar.gz', expanded_archive_basedir='spack-src')\r\nmutable_config = <spack.config.Configuration object at 0x7fd08891a850>, monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7fd088c632e0>, tmpdir = local('/tmp/pytest-of-user/pytest-5/test_compiler_bootstrap_from_b0')\r\n\r\n    def test_compiler_bootstrap_from_binary_mirror(\r\n            install_mockery_mutable_config, mock_packages, mock_fetch,\r\n            mock_archive, mutable_config, monkeypatch, tmpdir):\r\n        \"\"\"\r\n        Make sure installing compiler from buildcache registers compiler\r\n        \"\"\"\r\n    \r\n        # Create a temp mirror directory for buildcache usage\r\n        mirror_dir = tmpdir.join('mirror_dir')\r\n        mirror_url = 'file://{0}'.format(mirror_dir.strpath)\r\n    \r\n        # Install a compiler, because we want to put it in a buildcache\r\n        install('gcc@10.2.0')\r\n    \r\n        # Put installed compiler in the buildcache\r\n        buildcache(\r\n            'create', '-u', '-a', '-f', '-d', mirror_dir.strpath, 'gcc@10.2.0'\r\n        )\r\n    \r\n        # Now uninstall the compiler\r\n>       uninstall('-y', 'gcc@10.2.0')\r\n\r\nlib/spack/spack/test/cmd/install.py:908: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088dbb5e0>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n___________________________________________________________________________________________________________________ test_cache_install_full_hash_match[mock_archive0] ____________________________________________________________________________________________________________________\r\n\r\ninstall_mockery_mutable_config = None, mock_packages = <spack.repo.RepoPath object at 0x7fd089073d90>, mock_fetch = None\r\nmock_archive = Archive(url='file:///tmp/pytest-of-user/pytest-5/mock-archive-dir0/spack-src.tar.gz', path='/tmp/pytest-of-user/py...archive_file='/tmp/pytest-of-user/pytest-5/mock-archive-dir0/spack-src.tar.gz', expanded_archive_basedir='spack-src')\r\nmutable_config = <spack.config.Configuration object at 0x7fd088da48e0>, monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7fd088d7a9a0>, tmpdir = local('/tmp/pytest-of-user/pytest-5/test_cache_install_full_hash_m0')\r\n\r\n    def test_cache_install_full_hash_match(\r\n            install_mockery_mutable_config, mock_packages, mock_fetch,\r\n            mock_archive, mutable_config, monkeypatch, tmpdir):\r\n        \"\"\"Make sure installing from cache respects full hash argument\"\"\"\r\n    \r\n        # Create a temp mirror directory for buildcache usage\r\n        mirror_dir = tmpdir.join('mirror_dir')\r\n        mirror_url = 'file://{0}'.format(mirror_dir.strpath)\r\n    \r\n        s = Spec('libdwarf').concretized()\r\n        package_id = spack.installer.package_id(s.package)\r\n    \r\n        # Install a package\r\n        install(s.name)\r\n    \r\n        # Put installed package in the buildcache\r\n        buildcache('create', '-u', '-a', '-f', '-d', mirror_dir.strpath, s.name)\r\n    \r\n        # Now uninstall the package\r\n>       uninstall('-y', s.name)\r\n\r\nlib/spack/spack/test/cmd/install.py:996: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd0889060a0>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n___________________________________________________________________________________________________________________________ test_mirror_destroy[mock_archive0] ___________________________________________________________________________________________________________________________\r\n\r\ninstall_mockery_mutable_config = None, mock_packages = <spack.repo.RepoPath object at 0x7fd088d7aaf0>, mock_fetch = None\r\nmock_archive = Archive(url='file:///tmp/pytest-of-user/pytest-5/mock-archive-dir0/spack-src.tar.gz', path='/tmp/pytest-of-user/py...archive_file='/tmp/pytest-of-user/pytest-5/mock-archive-dir0/spack-src.tar.gz', expanded_archive_basedir='spack-src')\r\nmutable_config = <spack.config.Configuration object at 0x7fd088e3d130>, monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7fd088dc8670>, tmpdir = local('/tmp/pytest-of-user/pytest-5/test_mirror_destroy_mock_archi0')\r\n\r\n    def test_mirror_destroy(install_mockery_mutable_config,\r\n                            mock_packages, mock_fetch, mock_archive,\r\n                            mutable_config, monkeypatch, tmpdir):\r\n        # Create a temp mirror directory for buildcache usage\r\n        mirror_dir = tmpdir.join('mirror_dir')\r\n        mirror_url = 'file://{0}'.format(mirror_dir.strpath)\r\n        mirror('add', 'atest', mirror_url)\r\n    \r\n        spec_name = 'libdwarf'\r\n    \r\n        # Put a binary package in a buildcache\r\n        install('--no-cache', spec_name)\r\n        buildcache('create', '-u', '-a', '-f', '-d', mirror_dir.strpath, spec_name)\r\n    \r\n        contents = os.listdir(mirror_dir.strpath)\r\n        assert('build_cache' in contents)\r\n    \r\n        # Destroy mirror by name\r\n        mirror('destroy', '-m', 'atest')\r\n    \r\n        assert(not os.path.exists(mirror_dir.strpath))\r\n    \r\n        buildcache('create', '-u', '-a', '-f', '-d', mirror_dir.strpath, spec_name)\r\n    \r\n        contents = os.listdir(mirror_dir.strpath)\r\n        assert('build_cache' in contents)\r\n    \r\n        # Destroy mirror by url\r\n        mirror('destroy', '--mirror-url', mirror_url)\r\n    \r\n        assert(not os.path.exists(mirror_dir.strpath))\r\n    \r\n>       uninstall('-y', spec_name)\r\n\r\nlib/spack/spack/test/cmd/mirror.py:224: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088d51bb0>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n________________________________________________________________________________________________________________________________ test_install_legacy_yaml ________________________________________________________________________________________________________________________________\r\n\r\ntest_legacy_mirror = local('/tmp/pytest-of-user/pytest-5/test_install_legacy_yaml0/legacy_yaml_mirror'), install_mockery_mutable_config = None, mock_packages = <spack.repo.RepoPath object at 0x7fd08b4f7670>\r\n\r\n    def test_install_legacy_yaml(test_legacy_mirror, install_mockery_mutable_config,\r\n                                 mock_packages):\r\n        install_cmd('--no-check-signature', '--cache-only', '-f', legacy_mirror_dir\r\n                    + '/build_cache/test-debian6-core2-gcc-4.5.0-zlib-' +\r\n                    '1.2.11-t5mczux3tfqpxwmg7egp7axy2jvyulqk.spec.yaml')\r\n>       uninstall_cmd('-y', '/t5mczux3tfqpxwmg7egp7axy2jvyulqk')\r\n\r\nlib/spack/spack/test/bindist.py:617: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088c17250>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n____________________________________________________________________________________________________________________________ test_function_calls[-a-effects5] ____________________________________________________________________________________________________________________________\r\n\r\ncommand_line = '-a', effects = ['stages', 'downloads', 'caches', 'failures'], mock_calls_for_clean = {'caches': 1, 'downloads': 1, 'failures': 1, 'package': 0, ...}\r\n\r\n    @pytest.mark.usefixtures(\r\n        'mock_packages', 'config'\r\n    )\r\n    @pytest.mark.parametrize('command_line,effects', [\r\n        ('mpileaks', ['package']),\r\n        ('-s',       ['stages']),\r\n        ('-sd',      ['stages', 'downloads']),\r\n        ('-m',       ['caches']),\r\n        ('-f',       ['failures']),\r\n        ('-a',       all_effects),\r\n        ('',         []),\r\n    ])\r\n    def test_function_calls(command_line, effects, mock_calls_for_clean):\r\n    \r\n        # Call the command with the supplied command line\r\n>       clean(command_line)\r\n\r\nlib/spack/spack/test/cmd/clean.py:61: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/clean.py:109: in clean\r\n    uninstall('-a', '-y')\r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088bb16a0>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n_________________________________________________________________________________________________________________________________ test_mark_one_explicit _________________________________________________________________________________________________________________________________\r\n\r\nmutable_database = <spack.database.Database object at 0x7fd0888e4970>\r\n\r\n    @pytest.mark.db\r\n    def test_mark_one_explicit(mutable_database):\r\n        mark('-e', 'libelf')\r\n>       uninstall('-y', '-a', 'mpileaks')\r\n\r\nlib/spack/spack/test/cmd/mark.py:48: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088d83940>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n--------------------------------------------------------------------------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------------------------------------------------------------------------\r\n==> Installing libelf-0.8.13-snduugzfyej6xayqhrz23peuzdto5g37\r\n==> No binary for libelf-0.8.13-snduugzfyej6xayqhrz23peuzdto5g37 found: installing from source\r\n==> libelf: Successfully installed libelf-0.8.13-snduugzfyej6xayqhrz23peuzdto5g37\r\n  Fetch: .  Build: 0.01s.  Total: 0.01s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/libelf-0.8.13-snduugzfyej6xayqhrz23peuzdto5g37\r\n==> Installing mpich-3.0.4-my7k6etkgkosk2wdyebtajaiyxfbftgi\r\n==> No binary for mpich-3.0.4-my7k6etkgkosk2wdyebtajaiyxfbftgi found: installing from source\r\n==> mpich: Successfully installed mpich-3.0.4-my7k6etkgkosk2wdyebtajaiyxfbftgi\r\n  Fetch: .  Build: 0.01s.  Total: 0.01s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/mpich-3.0.4-my7k6etkgkosk2wdyebtajaiyxfbftgi\r\n==> Installing libdwarf-20130729-l4jgpc5efynz4lag76crxhn6odbibcgv\r\n==> No binary for libdwarf-20130729-l4jgpc5efynz4lag76crxhn6odbibcgv found: installing from source\r\n==> libdwarf: Successfully installed libdwarf-20130729-l4jgpc5efynz4lag76crxhn6odbibcgv\r\n  Fetch: .  Build: 0.01s.  Total: 0.01s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/libdwarf-20130729-l4jgpc5efynz4lag76crxhn6odbibcgv\r\n==> Installing dyninst-8.2-oq4xerumwdazt2rinzhrz5jzfio4slr2\r\n==> No binary for dyninst-8.2-oq4xerumwdazt2rinzhrz5jzfio4slr2 found: installing from source\r\n==> dyninst: Successfully installed dyninst-8.2-oq4xerumwdazt2rinzhrz5jzfio4slr2\r\n  Fetch: .  Build: 0.02s.  Total: 0.02s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/dyninst-8.2-oq4xerumwdazt2rinzhrz5jzfio4slr2\r\n==> Installing callpath-1.0-iki7b4p4zwfslj5fruemmb7fbwdxwayf\r\n==> No binary for callpath-1.0-iki7b4p4zwfslj5fruemmb7fbwdxwayf found: installing from source\r\n==> callpath: Successfully installed callpath-1.0-iki7b4p4zwfslj5fruemmb7fbwdxwayf\r\n  Fetch: .  Build: 0.02s.  Total: 0.02s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/callpath-1.0-iki7b4p4zwfslj5fruemmb7fbwdxwayf\r\n==> Installing mpileaks-2.3-sbxqpp36xwglprdywzpwvmgqb34rgx4u\r\n==> No binary for mpileaks-2.3-sbxqpp36xwglprdywzpwvmgqb34rgx4u found: installing from source\r\n==> mpileaks: Successfully installed mpileaks-2.3-sbxqpp36xwglprdywzpwvmgqb34rgx4u\r\n  Fetch: .  Build: 0.02s.  Total: 0.02s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/mpileaks-2.3-sbxqpp36xwglprdywzpwvmgqb34rgx4u\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/libelf-0.8.13-snduugzfyej6xayqhrz23peuzdto5g37\r\n==> Installing mpich2-1.5-nakudp4aztyxigoacdd5jaesujortvut\r\n==> No binary for mpich2-1.5-nakudp4aztyxigoacdd5jaesujortvut found: installing from source\r\n==> mpich2: Successfully installed mpich2-1.5-nakudp4aztyxigoacdd5jaesujortvut\r\n  Fetch: .  Build: 0.01s.  Total: 0.01s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/mpich2-1.5-nakudp4aztyxigoacdd5jaesujortvut\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/libdwarf-20130729-l4jgpc5efynz4lag76crxhn6odbibcgv\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/dyninst-8.2-oq4xerumwdazt2rinzhrz5jzfio4slr2\r\n==> Installing callpath-1.0-gdo336gzfl3sbhqgb7vkhbzzkdjymm3i\r\n==> No binary for callpath-1.0-gdo336gzfl3sbhqgb7vkhbzzkdjymm3i found: installing from source\r\n==> callpath: Successfully installed callpath-1.0-gdo336gzfl3sbhqgb7vkhbzzkdjymm3i\r\n  Fetch: .  Build: 0.02s.  Total: 0.02s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/callpath-1.0-gdo336gzfl3sbhqgb7vkhbzzkdjymm3i\r\n==> Installing mpileaks-2.3-3bwhm75rcrcp2pgajnc25ywwsssf4lcs\r\n==> No binary for mpileaks-2.3-3bwhm75rcrcp2pgajnc25ywwsssf4lcs found: installing from source\r\n==> mpileaks: Successfully installed mpileaks-2.3-3bwhm75rcrcp2pgajnc25ywwsssf4lcs\r\n  Fetch: .  Build: 0.02s.  Total: 0.02s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/mpileaks-2.3-3bwhm75rcrcp2pgajnc25ywwsssf4lcs\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/libelf-0.8.13-snduugzfyej6xayqhrz23peuzdto5g37\r\n==> Installing fake-1.0-yxjepovioa55hhuueayjwcb4wpk7yoap\r\n==> No binary for fake-1.0-yxjepovioa55hhuueayjwcb4wpk7yoap found: installing from source\r\n==> fake: Successfully installed fake-1.0-yxjepovioa55hhuueayjwcb4wpk7yoap\r\n  Fetch: .  Build: 0.01s.  Total: 0.01s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/fake-1.0-yxjepovioa55hhuueayjwcb4wpk7yoap\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/libdwarf-20130729-l4jgpc5efynz4lag76crxhn6odbibcgv\r\n==> Installing zmpi-1.0-blrzj3lj3b327rczpabcrafi4gje4gbx\r\n==> No binary for zmpi-1.0-blrzj3lj3b327rczpabcrafi4gje4gbx found: installing from source\r\n==> zmpi: Successfully installed zmpi-1.0-blrzj3lj3b327rczpabcrafi4gje4gbx\r\n  Fetch: .  Build: 0.01s.  Total: 0.01s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/zmpi-1.0-blrzj3lj3b327rczpabcrafi4gje4gbx\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/dyninst-8.2-oq4xerumwdazt2rinzhrz5jzfio4slr2\r\n==> Installing callpath-1.0-tll7qk6ypp27wlhzlg4oa7d2bzcbahms\r\n==> No binary for callpath-1.0-tll7qk6ypp27wlhzlg4oa7d2bzcbahms found: installing from source\r\n==> callpath: Successfully installed callpath-1.0-tll7qk6ypp27wlhzlg4oa7d2bzcbahms\r\n  Fetch: .  Build: 0.02s.  Total: 0.02s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/callpath-1.0-tll7qk6ypp27wlhzlg4oa7d2bzcbahms\r\n==> Installing mpileaks-2.3-4glifsifafqcrkphplq4rewlcxnomf5l\r\n==> No binary for mpileaks-2.3-4glifsifafqcrkphplq4rewlcxnomf5l found: installing from source\r\n==> mpileaks: Successfully installed mpileaks-2.3-4glifsifafqcrkphplq4rewlcxnomf5l\r\n  Fetch: .  Build: 0.02s.  Total: 0.02s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/mpileaks-2.3-4glifsifafqcrkphplq4rewlcxnomf5l\r\n[+] /path/to/external_tool (external externaltool-1.0-z6nog2otsocdkq7k5nhs7r2bbkouvbjv)\r\n[+] /path/to/external_virtual_gcc (external externalvirtual-1.0-culoyhgparxirrrvsjjbyrizhsb5frvr)\r\n==> Installing externaltest-1.0-semfsmmquwrwhw3z3w3vnm7trtcdhaeg\r\n==> No binary for externaltest-1.0-semfsmmquwrwhw3z3w3vnm7trtcdhaeg found: installing from source\r\n==> externaltest: Successfully installed externaltest-1.0-semfsmmquwrwhw3z3w3vnm7trtcdhaeg\r\n  Fetch: .  Build: 0.01s.  Total: 0.01s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/externaltest-1.0-semfsmmquwrwhw3z3w3vnm7trtcdhaeg\r\n==> Installing trivial-smoke-test-1.0-xeiuz3vzu3fvfmmagueenita4gpyb674\r\n==> No binary for trivial-smoke-test-1.0-xeiuz3vzu3fvfmmagueenita4gpyb674 found: installing from source\r\n==> trivial-smoke-test: Successfully installed trivial-smoke-test-1.0-xeiuz3vzu3fvfmmagueenita4gpyb674\r\n  Fetch: .  Build: 0.01s.  Total: 0.01s.\r\n[+] /tmp/pytest-of-user/pytest-5/mock_store0/test-debian6-core2/gcc-4.5.0/trivial-smoke-test-1.0-xeiuz3vzu3fvfmmagueenita4gpyb674\r\n--------------------------------------------------------------------------------------------------------------------------------- Captured stderr setup ----------------------------------------------------------------------------------------------------------------------------------\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/user/spack/share/spack/modules/test-debian6-core2/libelf-0.8.13-gcc-4.5.0-snduugz\r\nspec : libelf@0.8.13%gcc@4.5.0 arch=test-debian6-core2\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/user/spack/share/spack/modules/test-debian6-core2/libdwarf-20130729-gcc-4.5.0-l4jgpc5\r\nspec : libdwarf@20130729%gcc@4.5.0 arch=test-debian6-core2 ^libelf@0.8.13%gcc@4.5.0 arch=test-debian6-core2\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/user/spack/share/spack/modules/test-debian6-core2/dyninst-8.2-gcc-4.5.0-oq4xeru\r\nspec : dyninst@8.2%gcc@4.5.0 arch=test-debian6-core2 ^libdwarf@20130729%gcc@4.5.0 arch=test-debian6-core2 ^libelf@0.8.13%gcc@4.5.0 arch=test-debian6-core2\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/user/spack/share/spack/modules/test-debian6-core2/mpich2-1.5-gcc-4.5.0-nakudp4\r\nspec : mpich2@1.5%gcc@4.5.0 arch=test-debian6-core2\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/user/spack/share/spack/modules/test-debian6-core2/callpath-1.0-gcc-4.5.0-gdo336g\r\nspec : callpath@1.0%gcc@4.5.0 arch=test-debian6-core2 ^dyninst@8.2%gcc@4.5.0 arch=test-debian6-core2 ^libdwarf@20130729%gcc@4.5.0 arch=test-debian6-core2 ^libelf@0.8.13%gcc@4.5.0 arch=test-debian6-core2 ^mpich2@1.5%gcc@4.5.0 arch=test-debian6-core2\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/user/spack/share/spack/modules/test-debian6-core2/fake-1.0-gcc-4.5.0-yxjepov\r\nspec : fake@1.0%gcc@4.5.0 arch=test-debian6-core2\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/user/spack/share/spack/modules/test-debian6-core2/zmpi-1.0-gcc-4.5.0-blrzj3l\r\nspec : zmpi@1.0%gcc@4.5.0 arch=test-debian6-core2 ^fake@1.0%gcc@4.5.0 arch=test-debian6-core2\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/user/spack/share/spack/modules/test-debian6-core2/callpath-1.0-gcc-4.5.0-tll7qk6\r\nspec : callpath@1.0%gcc@4.5.0 arch=test-debian6-core2 ^dyninst@8.2%gcc@4.5.0 arch=test-debian6-core2 ^fake@1.0%gcc@4.5.0 arch=test-debian6-core2 ^libdwarf@20130729%gcc@4.5.0 arch=test-debian6-core2 ^libelf@0.8.13%gcc@4.5.0 arch=test-debian6-core2 ^zmpi@1.0%gcc@4.5.0 arch=test-debian6-core2\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/user/spack/share/spack/modules/test-debian6-core2/externaltest-1.0-gcc-4.5.0-semfsmm\r\nspec : externaltest@1.0%gcc@4.5.0 arch=test-debian6-core2 ^externaltool@1.0%gcc@4.5.0 arch=test-debian6-core2 ^externalvirtual@1.0%gcc@4.5.0 arch=test-debian6-core2\r\n==> Warning: Module file already exists : skipping creation\r\nfile : /home/user/spack/share/spack/modules/test-debian6-core2/trivial-smoke-test-1.0-gcc-4.5.0-xeiuz3v\r\nspec : trivial-smoke-test@1.0%gcc@4.5.0 arch=test-debian6-core2\r\n_______________________________________________________________________________________________________________________________ test_installed_dependents ________________________________________________________________________________________________________________________________\r\n\r\nmutable_database = <spack.database.Database object at 0x7fd088b550d0>\r\n\r\n    @pytest.mark.db\r\n    def test_installed_dependents(mutable_database):\r\n        \"\"\"Test can't uninstall when there are installed dependents.\"\"\"\r\n        with pytest.raises(SpackCommandError):\r\n>           uninstall('-y', 'libelf')\r\n\r\nlib/spack/spack/test/cmd/uninstall.py:38: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd0890f0bb0>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n________________________________________________________________________________________________________________________________ test_recursive_uninstall ________________________________________________________________________________________________________________________________\r\n\r\nmutable_database = <spack.database.Database object at 0x7fd088a66a00>\r\n\r\n    @pytest.mark.db\r\n    def test_recursive_uninstall(mutable_database):\r\n        \"\"\"Test recursive uninstall.\"\"\"\r\n>       uninstall('-y', '-a', '--dependents', 'callpath')\r\n\r\nlib/spack/spack/test/cmd/uninstall.py:44: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088df47f0>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n___________________________________________________________________________________________________________________ test_uninstall_spec_with_multiple_roots[dyninst-8] ___________________________________________________________________________________________________________________\r\n\r\nconstraint = 'dyninst', expected_number_of_specs = 8, mutable_database = <spack.database.Database object at 0x7fd088e30400>\r\n\r\n    @pytest.mark.db\r\n    @pytest.mark.regression('3690')\r\n    @pytest.mark.parametrize('constraint,expected_number_of_specs', [\r\n        ('dyninst', 8), ('libelf', 6)\r\n    ])\r\n    def test_uninstall_spec_with_multiple_roots(\r\n            constraint, expected_number_of_specs, mutable_database\r\n    ):\r\n>       uninstall('-y', '-a', '--dependents', constraint)\r\n\r\nlib/spack/spack/test/cmd/uninstall.py:66: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd0888ec880>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n___________________________________________________________________________________________________________________ test_uninstall_spec_with_multiple_roots[libelf-6] ____________________________________________________________________________________________________________________\r\n\r\nconstraint = 'libelf', expected_number_of_specs = 6, mutable_database = <spack.database.Database object at 0x7fd088883d00>\r\n\r\n    @pytest.mark.db\r\n    @pytest.mark.regression('3690')\r\n    @pytest.mark.parametrize('constraint,expected_number_of_specs', [\r\n        ('dyninst', 8), ('libelf', 6)\r\n    ])\r\n    def test_uninstall_spec_with_multiple_roots(\r\n            constraint, expected_number_of_specs, mutable_database\r\n    ):\r\n>       uninstall('-y', '-a', '--dependents', constraint)\r\n\r\nlib/spack/spack/test/cmd/uninstall.py:66: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd0888aea60>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n_____________________________________________________________________________________________________________ test_force_uninstall_spec_with_ref_count_not_zero[dyninst-14] ______________________________________________________________________________________________________________\r\n\r\nconstraint = 'dyninst', expected_number_of_specs = 14, mutable_database = <spack.database.Database object at 0x7fd088b81ee0>\r\n\r\n    @pytest.mark.db\r\n    @pytest.mark.parametrize('constraint,expected_number_of_specs', [\r\n        ('dyninst', 14), ('libelf', 14)\r\n    ])\r\n    def test_force_uninstall_spec_with_ref_count_not_zero(\r\n            constraint, expected_number_of_specs, mutable_database\r\n    ):\r\n>       uninstall('-f', '-y', constraint)\r\n\r\nlib/spack/spack/test/cmd/uninstall.py:79: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088b69b20>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n______________________________________________________________________________________________________________ test_force_uninstall_spec_with_ref_count_not_zero[libelf-14] ______________________________________________________________________________________________________________\r\n\r\nconstraint = 'libelf', expected_number_of_specs = 14, mutable_database = <spack.database.Database object at 0x7fd088dbeb50>\r\n\r\n    @pytest.mark.db\r\n    @pytest.mark.parametrize('constraint,expected_number_of_specs', [\r\n        ('dyninst', 14), ('libelf', 14)\r\n    ])\r\n    def test_force_uninstall_spec_with_ref_count_not_zero(\r\n            constraint, expected_number_of_specs, mutable_database\r\n    ):\r\n>       uninstall('-f', '-y', constraint)\r\n\r\nlib/spack/spack/test/cmd/uninstall.py:79: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd0888c3d60>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n_______________________________________________________________________________________________________________________ test_force_uninstall_and_reinstall_by_hash _______________________________________________________________________________________________________________________\r\n\r\nmutable_database = <spack.database.Database object at 0x7fd08a88fcd0>\r\n\r\n    @pytest.mark.db\r\n    def test_force_uninstall_and_reinstall_by_hash(mutable_database):\r\n        \"\"\"Test forced uninstall and reinstall of old specs.\"\"\"\r\n        # this is the spec to be removed\r\n        callpath_spec = spack.store.db.query_one('callpath ^mpich')\r\n        dag_hash = callpath_spec.dag_hash()\r\n    \r\n        # ensure can look up by hash and that it's a dependent of mpileaks\r\n        def validate_callpath_spec(installed):\r\n            assert installed is True or installed is False\r\n    \r\n            specs = spack.store.db.get_by_hash(dag_hash, installed=installed)\r\n            assert len(specs) == 1 and specs[0] == callpath_spec\r\n    \r\n            specs = spack.store.db.get_by_hash(dag_hash[:7], installed=installed)\r\n            assert len(specs) == 1 and specs[0] == callpath_spec\r\n    \r\n            specs = spack.store.db.get_by_hash(dag_hash, installed=any)\r\n            assert len(specs) == 1 and specs[0] == callpath_spec\r\n    \r\n            specs = spack.store.db.get_by_hash(dag_hash[:7], installed=any)\r\n            assert len(specs) == 1 and specs[0] == callpath_spec\r\n    \r\n            specs = spack.store.db.get_by_hash(dag_hash, installed=not installed)\r\n            assert specs is None\r\n    \r\n            specs = spack.store.db.get_by_hash(dag_hash[:7],\r\n                                               installed=not installed)\r\n            assert specs is None\r\n    \r\n            mpileaks_spec = spack.store.db.query_one('mpileaks ^mpich')\r\n            assert callpath_spec in mpileaks_spec\r\n    \r\n            spec = spack.store.db.query_one('callpath ^mpich', installed=installed)\r\n            assert spec == callpath_spec\r\n    \r\n            spec = spack.store.db.query_one('callpath ^mpich', installed=any)\r\n            assert spec == callpath_spec\r\n    \r\n            spec = spack.store.db.query_one('callpath ^mpich',\r\n                                            installed=not installed)\r\n            assert spec is None\r\n    \r\n        validate_callpath_spec(True)\r\n    \r\n>       uninstall('-y', '-f', 'callpath ^mpich')\r\n\r\nlib/spack/spack/test/cmd/uninstall.py:130: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd088d30f40>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n______________________________________________________________________________________________________________________ test_in_memory_consistency_when_uninstalling ______________________________________________________________________________________________________________________\r\n\r\nmutable_database = <spack.database.Database object at 0x7fd088dc8f40>, monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7fd088835550>\r\n\r\n    @pytest.mark.db\r\n    @pytest.mark.regression('15773')\r\n    def test_in_memory_consistency_when_uninstalling(\r\n            mutable_database, monkeypatch\r\n    ):\r\n        \"\"\"Test that uninstalling doesn't raise warnings\"\"\"\r\n        def _warn(*args, **kwargs):\r\n            raise RuntimeError('a warning was triggered!')\r\n        monkeypatch.setattr(tty, 'warn', _warn)\r\n        # Now try to uninstall and check this doesn't trigger warnings\r\n>       uninstall('-y', '-a')\r\n\r\nlib/spack/spack/test/cmd/uninstall.py:174: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nlib/spack/spack/main.py:584: in __call__\r\n    self.returncode = _invoke_command(\r\nlib/spack/spack/main.py:525: in _invoke_command\r\n    return_val = command(parser, args)\r\nlib/spack/spack/cmd/uninstall.py:360: in uninstall\r\n    uninstall_specs(args, specs)\r\nlib/spack/spack/cmd/uninstall.py:316: in uninstall_specs\r\n    uninstall_list, remove_list = get_uninstall_list(args, specs, env)\r\nlib/spack/spack/cmd/uninstall.py:252: in get_uninstall_list\r\n    spec_envs = dependent_environments(uninstall_list)\r\nlib/spack/spack/cmd/uninstall.py:163: in dependent_environments\r\n    hashes = set(env.all_hashes())\r\nlib/spack/spack/environment.py:1550: in all_hashes\r\n    return list(set(s.dag_hash() for s in self.all_specs()))\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <spack.environment.Environment object at 0x7fd08b502040>\r\n\r\n    def all_specs(self):\r\n        \"\"\"Return all specs, even those a user spec would shadow.\"\"\"\r\n        all_specs = set()\r\n        for h in self.concretized_order:\r\n>           all_specs.update(self.specs_by_hash[h].traverse())\r\nE           KeyError: 'hul5b3wgfnfor3wndznoksqdphdp3ocs'\r\n\r\nlib/spack/spack/environment.py:1542: KeyError\r\n================================================================================================================================= 3019 tests deselected ==================================================================================================================================\r\n====================================================================================================================== 19 failed, 3019 deselected in 20.57 seconds =======================================================================================================================\r\n```\r\n\r\n### Information on your system\r\n\r\n* **Spack:** 0.16.2-4205-161f0d5045\r\n* **Python:** 3.8.11\r\n* **Platform:** linux-ubuntu20.04-zen2\r\n* **Concretizer:** clingo\r\n\r\n### General information\r\n\r\n- [X] I have run `spack debug report` and reported the version of Spack/Python/Platform\r\n- [X] I have searched the issues of this repo and believe this is not a duplicate\r\n- [X] I have run the failing commands in debug mode and reported the output",
    "user": "haampie",
    "url": "https://api.github.com/repos/spack/spack/issues/25867",
    "updated_at": "2021-09-13 21:25:49",
    "created_at": "2021-09-09 11:16:55",
    "closed_at": "2021-09-13 21:25:49",
    "state": "closed",
    "title": "Local test failures after #22845",
    "number": 25867,
    "milestone": null,
    "labels": [
        "bug",
        "triage"
    ],
    "id": 992101764,
    "html_url": "https://github.com/spack/spack/issues/25867",
    "assignees": [
        "alalazo"
    ],
    "comments": 1
}